import{o as i,f as a,g as o,y as Z,t as R,l as v,F as D,D as M,z as S,q as k,u as q,b as y,c as B,w as j,E as Ce,G as ke,k as P,H as Re,A as te,I as $e,v as Se,J as De,K as be}from"./vendor-C5FfeEaS.js";import{u as Ee,b as Le}from"./router-Cvbgimde.js";import{_ as I,u as qe,a as Me,s as U}from"./index-CmUZZITA.js";import{I as oe,s as xe,a as Ve}from"./AudioPlayerTaigi-CWgaieRU.js";import{L as Ae}from"./Loader-Cth2euVp.js";import Fe from"./EditWord-CQd5qnB_.js";import Ie from"./EditWordMknoll-CsFCvzmE.js";import Be from"./RandomWord-DOE8s4vb.js";import{M as Te,a as Qe,I as We,C as Ue,b as K}from"./CommunityDefinitionCard-nk4ta4ay.js";import{_ as Ne}from"./Pinyinzhuyin-aFsnSd4o.js";import{u as se,I as Oe}from"./favoritesStore-CTEzz-4U.js";import{C as He}from"./CommunityDefinitionForm-DxlPrvZz.js";import"./AudioRecorder-B6379Soo.js";import"./pinyin-web-Brx8g6kF.js";import"./IconEdit-BhSTa8nK.js";import"./index-BeZKRCO5.js";const ze={key:0},Ke={class:"moe-search-results-header search-results-header"},Ze={key:0,class:"results-count"},je={key:0},Pe={class:"results moe-results"},Ge={__name:"MoeSearchResults",props:{results:{type:Array,default:()=>[]},searchExecuted:{type:Boolean,default:!1}},emits:["readChinese","readEnglish","openEditDialog","addDefinition"],setup(s,{emit:f}){return(c,e)=>s.results.length?(i(),a("section",ze,[o("header",Ke,[e[5]||(e[5]=o("h4",{class:"moe-title"}," Ministry of Education Taiwanese Dictionary of Common Words 教育部臺灣台語常用詞辭典 ",-1)),s.searchExecuted?(i(),a("div",Ze,[Z(R(s.results.length)+" result",1),s.results.length!=1?(i(),a("span",je,"s")):v("",!0),e[4]||(e[4]=Z(" found "))])):v("",!0)]),o("ul",Pe,[(i(!0),a(D,null,M(s.results,u=>(i(),S(Te,{key:u.id,word:u,onReadChinese:e[0]||(e[0]=m=>c.$emit("readChinese",m)),onReadEnglish:e[1]||(e[1]=m=>c.$emit("readEnglish",m)),onOpenEditDialog:e[2]||(e[2]=m=>c.$emit("openEditDialog",m)),onAddDefinition:e[3]||(e[3]=m=>c.$emit("addDefinition",m))},null,8,["word"]))),128))])])):v("",!0)}},Je=I(Ge,[["__scopeId","data-v-e15c8d92"]]),Xe={key:0,class:"mknoll"},Ye={class:"mknoll-results"},_e={__name:"MknollSearchResults",props:{results:{type:Array,default:()=>[]}},emits:["openEditDialog","addDefinition"],setup(s,{emit:f}){return(c,e)=>s.results.length?(i(),a("section",Xe,[e[2]||(e[2]=o("header",{class:"mknoll-search-results-header search-results-header"},[o("h4",{class:"mknoll-title"},"Mary Knoll Dictionary")],-1)),o("ul",Ye,[(i(!0),a(D,null,M(s.results,(u,m)=>(i(),S(Qe,{key:m,word:u,onOpenEditDialog:e[0]||(e[0]=l=>c.$emit("openEditDialog",l)),onAddDefinition:e[1]||(e[1]=l=>c.$emit("addDefinition",l))},null,8,["word"]))),128))])])):v("",!0)}},et=I(_e,[["__scopeId","data-v-864ff1c9"]]),tt={class:"cedict-item cedict-crossref-item"},ot={key:0,class:"cedict-traditional"},st={key:1,class:"cedict-traditional"},it={class:"pinyin-zhuyin cedict-pinyin-zhuyin"},rt={class:"cedict-english"},lt={class:"word-actions"},nt={__name:"CedictCrossRefCard",props:{word:{type:Object,required:!0}},emits:["readChinese","addDefinition"],setup(s,{emit:f}){const c=se();return(e,u)=>(i(),a("li",tt,[s.word.traditional!=null?(i(),a("p",ot,R(s.word.traditional),1)):v("",!0),s.word.traditional===null?(i(),a("p",st,R(s.word.chinese),1)):v("",!0),s.word.traditional?(i(),S(oe,{key:2,onClick:u[0]||(u[0]=m=>e.$emit("readChinese",s.word.traditional))})):v("",!0),s.word.traditional===null&&s.word.chinese!=null?(i(),S(oe,{key:3,onClick:u[1]||(u[1]=m=>e.$emit("readChinese",s.word.chinese))})):v("",!0),o("div",it,[k(Ne,{han:s.word.traditional},null,8,["han"])]),o("div",rt,R(s.word.english_cedict),1),o("div",lt,[k(Oe,{isFavorited:q(c).isFavorited(s.word.id),onClick:u[2]||(u[2]=m=>q(c).toggleFavorite(s.word)),title:"Add to favorites"},null,8,["isFavorited"]),k(We,{class:"add-definition",title:"Add community definition",onClick:u[3]||(u[3]=m=>e.$emit("addDefinition",s.word))})])]))}},at=I(nt,[["__scopeId","data-v-4e1e86f5"]]),dt={key:0},ut={class:"cedict-results"},ct={key:1},mt={class:"cedict-crossref"},ht={__name:"CedictSearchResults",props:{results:{type:Array,default:()=>[]},crossRefResults:{type:Array,default:()=>[]}},emits:["readChinese","addDefinition"],setup(s,{emit:f}){return(c,e)=>(i(),a(D,null,[s.results.length?(i(),a("section",dt,[e[3]||(e[3]=o("header",{class:"cedict-search-results-header search-results-header"},[o("h4",{class:"cedict-title"}," CC-CEDICT (Creative Commons Chinese English Dictionary) ")],-1)),o("ul",ut,[(i(!0),a(D,null,M(s.results,(u,m)=>(i(),S(Ue,{key:m,word:u,onAddDefinition:e[0]||(e[0]=l=>c.$emit("addDefinition",l))},null,8,["word"]))),128))])])):v("",!0),s.crossRefResults.length>0?(i(),a("section",ct,[e[4]||(e[4]=o("header",{class:"search-results-header"},[o("h4",{class:"section-header cedict-header"},"CC-CEDICT Cross reference")],-1)),o("ul",mt,[(i(!0),a(D,null,M(s.crossRefResults,(u,m)=>(i(),S(at,{key:m,word:u,onReadChinese:e[1]||(e[1]=l=>c.$emit("readChinese",l)),onAddDefinition:e[2]||(e[2]=l=>c.$emit("addDefinition",l))},null,8,["word"]))),128))])])):v("",!0)],64))}},ft=I(ht,[["__scopeId","data-v-2bff9642"]]),vt={key:0,class:"community-search-results"},yt={class:"section-header"},gt={class:"results-count"},wt={key:0,class:"loading-container"},pt={key:1,class:"error-container"},Ct={key:2,class:"results-list"},kt={key:0,class:"high-quality-results"},Rt={key:1,class:"medium-quality-results"},$t={key:0,class:"quality-separator"},St={key:2,class:"low-quality-results"},Dt={class:"low-quality-toggle"},bt=["aria-expanded"],Et={class:"low-quality-content"},Lt={key:3,class:"load-more-container"},qt=["disabled"],Mt={key:0,class:"loading-spinner"},xt={key:3,class:"empty-state"},Vt={class:"empty-message"},At={__name:"CommunitySearchResults",props:{results:{type:Array,default:()=>[]},searchQuery:{type:String,default:""},searchExecuted:{type:Boolean,default:!1},loading:{type:Boolean,default:!1},loadingMore:{type:Boolean,default:!1},error:{type:String,default:null},hasMore:{type:Boolean,default:!1},hideThreshold:{type:Number,default:-5},minScoreForDisplay:{type:Number,default:-10}},emits:["vote-submitted","vote-updated","voting-error","login-required","load-more","retry"],setup(s,{emit:f}){const c=s,e=f,u=y(!1),m=B(()=>c.searchExecuted&&(c.loading||c.error||c.results.length>0)),l=B(()=>c.results.filter(d=>d.voteScore>=c.minScoreForDisplay)),p=B(()=>l.value.filter(d=>d.voteScore>5).sort((d,r)=>r.voteScore-d.voteScore)),x=B(()=>l.value.filter(d=>d.voteScore>=0&&d.voteScore<=5).sort((d,r)=>r.voteScore-d.voteScore)),$=B(()=>l.value.filter(d=>d.voteScore<0&&d.voteScore>=c.minScoreForDisplay).sort((d,r)=>r.voteScore-d.voteScore));function b(d){e("vote-submitted",d)}function E(d){e("vote-updated",d)}function L(d){e("voting-error",d)}return j(()=>c.searchQuery,()=>{u.value=!1}),(d,r)=>m.value?(i(),a("section",vt,[o("div",yt,[r[6]||(r[6]=Ce('<h2 class="section-title" data-v-811aaac1><svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="community-icon" data-v-811aaac1><path d="M12 2L13.09 8.26L20 9L13.09 9.74L12 16L10.91 9.74L4 9L10.91 8.26L12 2Z" fill="currentColor" data-v-811aaac1></path><path d="M19 15L19.5 17L21 17.5L19.5 18L19 20L18.5 18L17 17.5L18.5 17L19 15Z" fill="currentColor" data-v-811aaac1></path><path d="M5 15L5.5 17L7 17.5L5.5 18L5 20L4.5 18L3 17.5L4.5 17L5 15Z" fill="currentColor" data-v-811aaac1></path></svg> Community Definitions </h2>',1)),o("div",gt,R(l.value.length)+" "+R(l.value.length===1?"result":"results"),1)]),s.loading?(i(),a("div",wt,r[7]||(r[7]=[o("div",{class:"spinner"},null,-1),o("span",{class:"loading-text"},"Loading community definitions...",-1)]))):s.error?(i(),a("div",pt,[r[8]||(r[8]=o("div",{class:"error-icon"},"⚠️",-1)),r[9]||(r[9]=o("span",{class:"error-text"},"Failed to load community definitions",-1)),o("button",{class:"retry-button",onClick:r[0]||(r[0]=g=>d.$emit("retry"))}," Retry ")])):l.value.length>0?(i(),a("div",Ct,[p.value.length>0?(i(),a("div",kt,[(i(!0),a(D,null,M(p.value,g=>(i(),S(K,{key:g.id,definition:g,"hide-threshold":s.hideThreshold,class:"search-result-card",onVoteSubmitted:b,onVoteUpdated:E,onLoginRequired:r[1]||(r[1]=C=>d.$emit("login-required")),onVotingError:L},null,8,["definition","hide-threshold"]))),128))])):v("",!0),x.value.length>0?(i(),a("div",Rt,[p.value.length>0?(i(),a("div",$t,r[10]||(r[10]=[o("span",{class:"separator-text"},"Other Community Definitions",-1)]))):v("",!0),(i(!0),a(D,null,M(x.value,g=>(i(),S(K,{key:g.id,definition:g,"hide-threshold":s.hideThreshold,class:"search-result-card medium-quality",onVoteSubmitted:b,onVoteUpdated:E,onLoginRequired:r[2]||(r[2]=C=>d.$emit("login-required")),onVotingError:L},null,8,["definition","hide-threshold"]))),128))])):v("",!0),$.value.length>0?(i(),a("div",St,[o("div",Dt,[o("button",{class:"toggle-low-quality-button",onClick:r[3]||(r[3]=g=>u.value=!u.value),"aria-expanded":u.value},[(i(),a("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",class:ke(["toggle-icon",{expanded:u.value}])},r[11]||(r[11]=[o("path",{d:"M6 9l6 6 6-6",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},null,-1)]),2)),o("span",null,R(u.value?"Hide":"Show")+" "+R($.value.length)+" low-scored "+R($.value.length===1?"definition":"definitions"),1)],8,bt)]),P(o("div",Et,[(i(!0),a(D,null,M($.value,g=>(i(),S(K,{key:g.id,definition:g,"hide-threshold":s.hideThreshold,class:"search-result-card low-quality",onVoteSubmitted:b,onVoteUpdated:E,onLoginRequired:r[4]||(r[4]=C=>d.$emit("login-required")),onVotingError:L},null,8,["definition","hide-threshold"]))),128))],512),[[Re,u.value]])])):v("",!0),s.hasMore?(i(),a("div",Lt,[o("button",{class:"load-more-button",onClick:r[5]||(r[5]=g=>d.$emit("load-more")),disabled:s.loadingMore},[s.loadingMore?(i(),a("span",Mt)):v("",!0),Z(" "+R(s.loadingMore?"Loading...":"Load More Community Definitions"),1)],8,qt)])):v("",!0)])):s.searchExecuted&&!s.loading?(i(),a("div",xt,[r[12]||(r[12]=o("div",{class:"empty-icon"},[o("svg",{width:"32",height:"32",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[o("path",{d:"M12 2L13.09 8.26L20 9L13.09 9.74L12 16L10.91 9.74L4 9L10.91 8.26L12 2Z",stroke:"currentColor","stroke-width":"2",fill:"none"})])],-1)),o("p",Vt,' No community definitions found for "'+R(s.searchQuery)+'" ',1),r[13]||(r[13]=o("p",{class:"empty-suggestion"}," Be the first to contribute a community definition! ",-1))])):v("",!0)])):v("",!0)}},Ft=I(At,[["__scopeId","data-v-811aaac1"]]),It={id:"dictionary-search"},Bt={class:"search-header"},Tt={class:"search-words"},Qt={class:"search-options"},Wt={class:"exact-search-container"},Ut={__name:"DictionarySearch",setup(s){const f=Ee(),c=Le(),e=qe(),u=se(),m=Me(),l=y(""),p=y(!1),x=y(!1),$=y(!1),b=y(!1),E=y(!1),L=y(!1),d=y(null),r=y(null),g=y(null),C=y([]),N=y(!1),T=y(!1),O=y(null),H=y(!1),ie=()=>{b.value=!1,document.body.style.overflow="scroll"},re=()=>{E.value=!1,document.body.style.overflow="scroll"},le=t=>{d.value=t,b.value=!0,document.body.style.overflow="hidden"},ne=t=>{r.value=t,E.value=!0,document.body.style.overflow="hidden"},z=t=>{g.value=t,L.value=!0,document.body.style.overflow="hidden"},G=()=>{L.value=!1,g.value=null,document.body.style.overflow="scroll"},ae=async t=>{try{G(),l.value.trim()&&await Q()}catch(n){console.error("Error handling definition submission:",n)}},de=()=>{l.value="",V()},V=async()=>{if(!l.value.trim()){$.value=!1,await e.setSearchResults([]),await e.setMknollResults([]),await e.setCedictResults([]),await e.setCrossRefCedict([]),C.value=[];return}x.value=!0,$.value=!0,X(l.value,p.value);try{await e.addToHistory(l.value);const t=p.value?l.value:`%${l.value}%`;let n=U.from("words").select(`
        *,
        definitions (
          defid,
          wordid,
          partofspeech,
          def_chinese,
          def_english
        )
      `).or(`chinese.ilike.${t},english.ilike.${t},romaji.ilike.${t}`),h=U.from("maryknoll").select("*").or(`taiwanese.ilike.${t},chinese.ilike.${t},english_mknoll.ilike.${t}`),w=U.from("cedict").select("*").or(`traditional.ilike.${t},simplified.ilike.${t},english_cedict.ilike.${t}`);const{data:A,error:F}=await n.limit(50);if(F)throw F;const{data:ye,error:Y}=await h.limit(20);if(Y)throw Y;const{data:ge,error:_}=await w.limit(20);if(_)throw _;const{data:we,error:ee}=await U.from("cedict").select("*").or(`traditional.ilike.${t},simplified.ilike.${t}`).limit(10);if(ee)throw ee;const pe=we||[];await e.setSearchResults(A||[]),await e.setMknollResults(ye||[]),await e.setCedictResults(ge||[]),await e.setCrossRefCedict(pe),await Q()}catch(t){console.error("Search error:",t)}finally{x.value=!1}},Q=async(t=!1)=>{var n;if(!l.value.trim()){C.value=[];return}try{t?T.value=!0:(N.value=!0,C.value=[]),O.value=null;const h={sortBy:"score",sortOrder:"desc",status:["approved","pending"],limit:10,offset:t?C.value.length:0},w=await m.searchDefinitions({...h,searchTerm:l.value});if(w.success)console.log("Community search results:",w.data),console.log("Search filters used:",h),t?C.value.push(...w.data):C.value=w.data,H.value=w.data.length===h.limit;else throw new Error(((n=w.error)==null?void 0:n.message)||"Failed to search community definitions")}catch(h){console.error("Community search error:",h),O.value=h.message}finally{N.value=!1,T.value=!1}},ue=async()=>{!H.value||T.value||await Q(!0)},ce=t=>{console.log("Community vote submitted:",t)},me=t=>{console.log("Community vote updated:",t);const n=C.value.find(h=>h.id===t.definitionId);n&&(n.voteScore=t.voteScore,n.upvotes=t.upvotes,n.downvotes=t.downvotes,n.userVote=t.userVote)},he=t=>{console.error("Community voting error:",t)},fe=()=>{console.log("Login required for community features")},J=async t=>{xe(t)},ve=async t=>{Ve(t)};te(async()=>{await e.loadFromIndexedDB(),await e.loadSearchHistoryFromSupabase(),await u.loadFromIndexedDB(),await u.loadFromSupabase()}),$e(()=>{W&&clearTimeout(W)}),te(()=>{f.params.query&&(l.value=f.params.query),f.query.q&&(l.value=f.query.q),f.query.exact!==void 0&&(p.value=f.query.exact==="true"),l.value.trim()&&V()}),j(()=>[f.params.query,f.query.q,f.query.exact],([t,n,h])=>{const w=t||n||"",A=h==="true";let F=!1;w!==l.value&&(l.value=w,F=!0),A!==p.value&&(p.value=A,F=!0),F&&w.trim()&&V()}),j([l,p],([t,n])=>{clearTimeout(W),W=setTimeout(()=>{X(t,n)},300)});let W=null;const X=(t,n)=>{if(!t.trim())$.value=!1,(f.name==="search"||f.query.q)&&c.push({name:"dictionary"});else{const h={q:t};n&&(h.exact="true");const w=f.query.q||f.params.query||"",A=f.query.exact==="true";(w!==t||A!==n)&&c.push({name:"search",params:{query:t},query:h})}};return(t,n)=>(i(),a(D,null,[k(Ae,{loading:x.value},null,8,["loading"]),o("div",It,[o("section",Bt,[o("div",Tt,[P(o("input",{type:"text","onUpdate:modelValue":n[0]||(n[0]=h=>l.value=h),onKeyup:De(V,["enter"]),placeholder:"Search English, Chinese, Taiwanese · 中文或英文搜尋",class:"text-field search-words-text-field",autocapitalize:"off"},null,544),[[Se,l.value]]),l.value.length>0?(i(),a("button",{key:0,class:"clear-search",onClick:de},n[4]||(n[4]=[o("span",{class:"visually-hidden"},"Clear",-1)]))):v("",!0)]),o("div",Qt,[o("div",Wt,[P(o("input",{type:"checkbox",id:"exact-search","onUpdate:modelValue":n[1]||(n[1]=h=>p.value=h),onChange:V},null,544),[[be,p.value]]),n[5]||(n[5]=o("label",{for:"exact-search"},"Strict search",-1))]),o("div",{class:"search-actions"},[o("button",{class:"search-button",onClick:V},"Search")])])]),q(e).showRandomWord?(i(),S(Be,{key:0})):v("",!0),k(Je,{results:q(e).searchResults,searchExecuted:$.value,onReadChinese:J,onReadEnglish:ve,onOpenEditDialog:le,onAddDefinition:z},null,8,["results","searchExecuted"]),k(et,{results:q(e).mknollResults,onOpenEditDialog:ne,onAddDefinition:z},null,8,["results"]),k(ft,{results:q(e).cedictResults,crossRefResults:q(e).crossRefResults,onReadChinese:J,onAddDefinition:z},null,8,["results","crossRefResults"]),k(Ft,{results:C.value,"search-query":l.value,"search-executed":$.value,loading:N.value,"loading-more":T.value,error:O.value,"has-more":H.value,onVoteSubmitted:ce,onVoteUpdated:me,onVotingError:he,onLoginRequired:fe,onLoadMore:ue,onRetry:Q},null,8,["results","search-query","search-executed","loading","loading-more","error","has-more"]),k(Fe,{visible:b.value,word:d.value,onClose:n[2]||(n[2]=h=>ie())},null,8,["visible","word"]),k(Ie,{visible:E.value,word:r.value,onClose:n[3]||(n[3]=h=>re())},null,8,["visible","word"]),k(He,{visible:L.value,word:g.value,onClose:G,onSubmit:ae},null,8,["visible","word"])])],64))}},so=I(Ut,[["__scopeId","data-v-70955325"]]);export{so as default};
