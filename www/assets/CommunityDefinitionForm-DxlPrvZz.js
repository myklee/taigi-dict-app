import{b as y,c as L,w as N,A as Y,o as n,f as l,g as t,t as d,l as u,j as p,y as $,k,v as D,G as E,J as O,F as z,D as G}from"./vendor-C5FfeEaS.js";import{_ as H,a as Q,b as R,v as W,C as X}from"./index-CmUZZITA.js";const Z={class:"modal-header"},ee={class:"community-definition-form"},te={key:0,class:"source-word-info"},se={class:"source-word-details"},ae={key:0,class:"word-display moe-word"},oe={class:"word-taiwanese"},ie={key:0,class:"word-chinese"},ne={key:1,class:"word-english"},le={key:1,class:"word-display mknoll-word"},re={class:"word-taiwanese"},de={key:0,class:"word-chinese"},ue={key:1,class:"word-english"},ce={key:2,class:"word-display cedict-word"},ve={class:"word-chinese"},me={key:0,class:"word-english"},ge={key:3,class:"word-display unknown-word"},fe={class:"word-text"},ye={class:"form-group"},he=["disabled"],we={class:"field-info"},be={class:"char-count"},xe={key:0,class:"error-message"},pe={class:"form-group"},ke=["disabled"],De={class:"field-info"},Ee={class:"char-count"},Ce={key:0,class:"error-message"},_e={class:"form-group"},Se={class:"tags-input-container"},Te=["disabled","onKeydown"],Fe=["disabled"],Ie={class:"tags-display"},$e=["disabled","onClick"],Oe={class:"field-info"},Ve={class:"tag-count"},je={key:0,class:"error-message"},Ae={class:"form-group"},Be=["disabled"],Me={class:"field-info"},Ue={class:"char-count"},Je={key:0,class:"error-message"},Ke={class:"form-actions"},Pe=["disabled"],qe={key:0},Le={key:1},Ne=["disabled"],Ye={key:0},ze={key:1},Ge={key:0,class:"general-error"},He={key:1,class:"success-message"},Qe={__name:"CommunityDefinitionForm",props:{word:{type:Object,required:!0},visible:{type:Boolean,default:!1},initialData:{type:Object,default:()=>({})}},emits:["success","cancel","draft-saved","close","submit"],setup(r,{emit:V}){const b=r,x=V,j=Q(),A=R(),s=y({definition:"",usageExample:"",tags:[],context:""}),h=y(""),v=y(!1),C=y(!1),i=y({}),g=y(""),f=y(""),B=L(()=>s.value.definition.trim().length>=5&&Object.keys(i.value).length===0),m=a=>{const e={};switch(a){case"definition":const o=s.value.definition.trim();o?o.length<5?e.definition="Definition must be at least 5 characters long":o.length>2e3&&(e.definition="Definition is too long (max 2000 characters)"):e.definition="Definition is required";break;case"usageExample":s.value.usageExample.length>1e3&&(e.usageExample="Usage example is too long (max 1000 characters)");break;case"tags":s.value.tags.length>10&&(e.tags="Too many tags (max 10)");break;case"context":s.value.context.length>500&&(e.context="Context is too long (max 500 characters)");break}e[a]?i.value[a]=e[a]:delete i.value[a]},M=()=>(m("definition"),m("usageExample"),m("tags"),m("context"),Object.keys(i.value).length===0),_=()=>{const a=h.value.trim().toLowerCase();if(a){if(s.value.tags.length>=10){i.value.tags="Maximum 10 tags allowed";return}if(a.length>50){i.value.tags="Tag is too long (max 50 characters)";return}if(s.value.tags.includes(a)){i.value.tags="Tag already exists";return}s.value.tags.push(a),h.value="",delete i.value.tags}},U=a=>{s.value.tags.splice(a,1),delete i.value.tags},J=async()=>{var a,e,o;if(!A.user){g.value="You must be logged in to submit definitions";return}if(!M()){g.value="Please fix the errors above";return}v.value=!0,g.value="",f.value="";try{const c={wordId:((e=(a=b.word)==null?void 0:a.id)==null?void 0:e.toString())||"unknown",definition:s.value.definition.trim(),usageExample:s.value.usageExample.trim()||void 0,tags:s.value.tags,context:s.value.context.trim()||void 0};W(c);const w=await j.submitDefinition(c);w.success?(f.value="Definition submitted successfully! It will be reviewed by the community.",I(),x("success",w.data),x("submit",w.data),setTimeout(()=>{P()},2e3)):g.value=((o=w.error)==null?void 0:o.message)||"Failed to submit definition"}catch(c){c instanceof X?c.field?i.value[c.field]=c.message:g.value=c.message:(g.value="An unexpected error occurred. Please try again.",console.error("Form submission error:",c))}finally{v.value=!1}},S=()=>{var a;return`community-definition-draft-${((a=b.word)==null?void 0:a.id)||"unknown"}`},F=async()=>{C.value=!0;try{const a={...s.value,timestamp:Date.now()};localStorage.setItem(S(),JSON.stringify(a));const e=f.value;f.value="Draft saved locally",setTimeout(()=>{f.value==="Draft saved locally"&&(f.value=e)},2e3),x("draft-saved",a)}catch(a){console.error("Failed to save draft:",a)}finally{C.value=!1}},K=()=>{try{const a=localStorage.getItem(S());if(a){const e=JSON.parse(a);Date.now()-e.timestamp<24*60*60*1e3?(s.value.definition=e.definition||"",s.value.usageExample=e.usageExample||"",s.value.tags=e.tags||[],s.value.context=e.context||""):I()}}catch(a){console.error("Failed to load draft:",a)}},I=()=>{localStorage.removeItem(S())},P=()=>{s.value={definition:"",usageExample:"",tags:[],context:""},h.value="",i.value={},g.value="",f.value=""},q=()=>{x("close")};let T;return N(()=>s.value,()=>{T&&clearTimeout(T),T=setTimeout(()=>{(s.value.definition.trim()||s.value.usageExample.trim()||s.value.tags.length>0||s.value.context.trim())&&F()},2e3)},{deep:!0}),Y(()=>{b.initialData?Object.assign(s.value,b.initialData):K()}),(a,e)=>r.visible?(n(),l("div",{key:0,class:"modal-overlay",onClick:q},[t("div",{class:"modal-content",onClick:e[12]||(e[12]=p(()=>{},["stop"]))},[t("div",Z,[e[13]||(e[13]=t("h2",null,"Add Community Definition",-1)),t("button",{class:"close-btn",onClick:e[0]||(e[0]=o=>a.$emit("close")),type:"button"},"×")]),t("div",ee,[e[23]||(e[23]=t("div",{class:"form-header"},[t("p",{class:"form-description"}," Share your knowledge by contributing a definition for this word. Your submission will be reviewed by the community. ")],-1)),r.word?(n(),l("div",te,[e[18]||(e[18]=t("h3",{class:"source-word-title"},"Adding definition for:",-1)),t("div",se,[r.word.romaji?(n(),l("div",ae,[t("div",oe,d(r.word.romaji),1),r.word.chinese?(n(),l("div",ie,d(r.word.chinese),1)):u("",!0),r.word.english?(n(),l("div",ne,d(r.word.english),1)):u("",!0),e[14]||(e[14]=t("div",{class:"word-source"},"Ministry of Education Dictionary",-1))])):r.word.taiwanese?(n(),l("div",le,[t("div",re,d(r.word.taiwanese),1),r.word.chinese?(n(),l("div",de,d(r.word.chinese),1)):u("",!0),r.word.english_mknoll?(n(),l("div",ue,d(r.word.english_mknoll),1)):u("",!0),e[15]||(e[15]=t("div",{class:"word-source"},"Maryknoll Dictionary",-1))])):r.word.traditional?(n(),l("div",ce,[t("div",ve,d(r.word.traditional),1),r.word.english_cedict?(n(),l("div",me,d(r.word.english_cedict),1)):u("",!0),e[16]||(e[16]=t("div",{class:"word-source"},"CC-CEDICT",-1))])):(n(),l("div",ge,[t("div",fe,d(r.word.chinese||r.word.english||JSON.stringify(r.word)),1),e[17]||(e[17]=t("div",{class:"word-source"},"Dictionary Entry",-1))]))])])):u("",!0),t("form",{onSubmit:p(J,["prevent"]),class:"definition-form"},[t("div",ye,[e[19]||(e[19]=t("label",{for:"definition",class:"form-label"},[$(" Definition "),t("span",{class:"required"},"*")],-1)),k(t("textarea",{id:"definition","onUpdate:modelValue":e[1]||(e[1]=o=>s.value.definition=o),class:E(["form-textarea",{error:i.value.definition}]),placeholder:"Enter your definition here...",rows:"4",maxlength:"2000",disabled:v.value,onInput:e[2]||(e[2]=o=>m("definition")),onBlur:e[3]||(e[3]=o=>m("definition"))},null,42,he),[[D,s.value.definition]]),t("div",we,[t("span",be,d(s.value.definition.length)+"/2000",1),i.value.definition?(n(),l("div",xe,d(i.value.definition),1)):u("",!0)])]),t("div",pe,[e[20]||(e[20]=t("label",{for:"usageExample",class:"form-label"}," Usage Example ",-1)),k(t("textarea",{id:"usageExample","onUpdate:modelValue":e[4]||(e[4]=o=>s.value.usageExample=o),class:E(["form-textarea",{error:i.value.usageExample}]),placeholder:"Provide an example of how this word is used...",rows:"3",maxlength:"1000",disabled:v.value,onInput:e[5]||(e[5]=o=>m("usageExample")),onBlur:e[6]||(e[6]=o=>m("usageExample"))},null,42,ke),[[D,s.value.usageExample]]),t("div",De,[t("span",Ee,d(s.value.usageExample.length)+"/1000",1),i.value.usageExample?(n(),l("div",Ce,d(i.value.usageExample),1)):u("",!0)])]),t("div",_e,[e[21]||(e[21]=t("label",{for:"tags",class:"form-label"}," Tags ",-1)),t("div",Se,[k(t("input",{id:"tags","onUpdate:modelValue":e[7]||(e[7]=o=>h.value=o),type:"text",class:E(["form-input",{error:i.value.tags}]),placeholder:"Add tags (press Enter to add)",maxlength:"50",disabled:v.value||s.value.tags.length>=10,onKeydown:[O(p(_,["prevent"]),["enter"]),O(p(_,["prevent"]),["comma"])],onInput:e[8]||(e[8]=o=>m("tags"))},null,42,Te),[[D,h.value]]),t("button",{type:"button",class:"add-tag-btn",disabled:!h.value.trim()||s.value.tags.length>=10||v.value,onClick:_}," Add ",8,Fe)]),t("div",Ie,[(n(!0),l(z,null,G(s.value.tags,(o,c)=>(n(),l("span",{key:c,class:"tag"},[$(d(o)+" ",1),t("button",{type:"button",class:"remove-tag",disabled:v.value,onClick:w=>U(c)}," × ",8,$e)]))),128))]),t("div",Oe,[t("span",Ve,d(s.value.tags.length)+"/10 tags",1),i.value.tags?(n(),l("div",je,d(i.value.tags),1)):u("",!0)])]),t("div",Ae,[e[22]||(e[22]=t("label",{for:"context",class:"form-label"}," Context ",-1)),k(t("textarea",{id:"context","onUpdate:modelValue":e[9]||(e[9]=o=>s.value.context=o),class:E(["form-textarea",{error:i.value.context}]),placeholder:"Provide additional context (e.g., regional usage, formality level, etc.)",rows:"2",maxlength:"500",disabled:v.value,onInput:e[10]||(e[10]=o=>m("context")),onBlur:e[11]||(e[11]=o=>m("context"))},null,42,Be),[[D,s.value.context]]),t("div",Me,[t("span",Ue,d(s.value.context.length)+"/500",1),i.value.context?(n(),l("div",Je,d(i.value.context),1)):u("",!0)])]),t("div",Ke,[t("button",{type:"button",class:"btn-secondary",disabled:v.value,onClick:F},[C.value?(n(),l("span",qe,"Saving...")):(n(),l("span",Le,"Save Draft"))],8,Pe),t("button",{type:"submit",class:"btn-primary",disabled:!B.value||v.value},[v.value?(n(),l("span",Ye,"Submitting...")):(n(),l("span",ze,"Submit Definition"))],8,Ne)]),g.value?(n(),l("div",Ge,d(g.value),1)):u("",!0),f.value?(n(),l("div",He,d(f.value),1)):u("",!0)],32)])])])):u("",!0)}},Xe=H(Qe,[["__scopeId","data-v-97489660"]]);export{Xe as C};
