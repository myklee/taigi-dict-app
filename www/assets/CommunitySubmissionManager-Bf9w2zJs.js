import{_ as Q,a as X,b as Z}from"./index-CmUZZITA.js";import{C as ee}from"./CommunityDefinitionForm-DxlPrvZz.js";import{b as f,c as l,A as se,I as te,w as ae,f as i,q as ne,g as t,G as E,t as u,l as d,E as ie,o}from"./vendor-C5FfeEaS.js";import"./router-Cvbgimde.js";const oe={class:"community-submission-manager"},re={key:0,class:"submission-step"},ue={key:1,class:"submission-step"},le={class:"status-container"},de={class:"status-header"},ce={class:"status-title"},ve={class:"status-message"},me={key:0,class:"submission-details"},fe={class:"detail-item"},pe={class:"detail-value"},be={class:"detail-item"},he={class:"detail-item"},ge={class:"detail-value"},ye={key:0,class:"detail-item"},we={class:"detail-value"},Se={key:1,class:"progress-indicator"},_e={class:"status-actions"},ke={key:2,class:"submission-step"},De={class:"error-container"},Ce={class:"error-message"},Ie={key:0,class:"error-details"},je={key:3,class:"offline-indicator"},xe={key:4,class:"draft-indicator"},Ee={class:"draft-content"},Ne={class:"draft-text"},Te={__name:"CommunitySubmissionManager",props:{wordId:{type:String,required:!0},initialStep:{type:String,default:"form",validator:g=>["form","status","error"].includes(g)},submissionId:{type:String,default:null}},emits:["complete","cancel","status-change"],setup(g,{emit:N}){const c=g,v=N,w=X();Z();const r=f(c.initialStep),s=f(null),S=f(""),y=f(""),p=f({}),b=f(null),_=f(!navigator.onLine),T=l(()=>{if(!s.value)return"";switch(s.value.status){case"pending":return"Submission Under Review";case"approved":return"Submission Approved!";case"rejected":return"Submission Rejected";case"hidden":return"Submission Hidden";default:return"Submission Status"}}),M=l(()=>{if(!s.value)return"";switch(s.value.status){case"pending":return"Your definition has been submitted and is awaiting community review.";case"approved":return"Congratulations! Your definition has been approved and is now visible to all users.";case"rejected":return"Your submission has been rejected. Please review the feedback and consider resubmitting.";case"hidden":return"Your submission has been hidden due to community reports or moderation.";default:return""}}),$=l(()=>{if(!s.value)return"";switch(s.value.status){case"pending":return"‚è≥";case"approved":return"‚úÖ";case"rejected":return"‚ùå";case"hidden":return"üëÅÔ∏è‚Äçüó®Ô∏è";default:return"üìÑ"}}),A=l(()=>{if(!s.value)return"";switch(s.value.status){case"pending":return"status-pending";case"approved":return"status-approved";case"rejected":return"status-rejected";case"hidden":return"status-hidden";default:return""}}),B=l(()=>{if(!s.value)return"";switch(s.value.status){case"pending":return"badge-pending";case"approved":return"badge-approved";case"rejected":return"badge-rejected";case"hidden":return"badge-hidden";default:return""}}),Y=l(()=>{var e,a;return((e=s.value)==null?void 0:e.status)==="pending"||((a=s.value)==null?void 0:a.status)==="rejected"}),F=l(()=>{var e;return((e=s.value)==null?void 0:e.status)==="pending"}),L=l(()=>{var e;switch((e=s.value)==null?void 0:e.status){case"approved":return"View Definition";case"rejected":return"Submit New Definition";default:return"Continue"}}),O=l(()=>Object.keys(p.value).length>0&&b.value),V=e=>{s.value=e,r.value="status",v("status-change","submitted",e),k()},D=e=>{S.value=e.message||"An unexpected error occurred",y.value=e.details?JSON.stringify(e.details,null,2):"",r.value="error",v("status-change","error",e)},R=()=>{v("cancel")},U=e=>{p.value=e,b.value=e.timestamp},J=()=>{var e;switch((e=s.value)==null?void 0:e.status){case"approved":v("complete",{action:"view",data:s.value});break;case"rejected":r.value="form",s.value=null;break;default:v("complete",{action:"continue",data:s.value})}},W=()=>{s.value&&(p.value={definition:s.value.definition,usageExample:s.value.usageExample,tags:s.value.tags||[],context:s.value.context}),r.value="form"},q=async()=>{if(s.value&&confirm("Are you sure you want to withdraw this submission? This action cannot be undone."))try{const e=await w.deleteDefinition(s.value.id);e.success?v("complete",{action:"withdrawn",data:s.value}):D(e.error)}catch(e){D(e)}},C=()=>{r.value="form",S.value="",y.value=""},G=()=>{C()},k=()=>{const e=`community-definition-draft-${c.wordId}`;localStorage.removeItem(e),p.value={},b.value=null},K=()=>{try{const e=`community-definition-draft-${c.wordId}`,a=localStorage.getItem(e);if(a){const n=JSON.parse(a);Date.now()-n.timestamp<24*60*60*1e3?(p.value=n,b.value=n.timestamp):k()}}catch(e){console.error("Failed to load draft:",e)}},z=async()=>{if(c.submissionId)try{const a=w.communityDefinitions.find(n=>n.id===c.submissionId);if(a)s.value=a,r.value="status";else{const n=await w.fetchDefinitionsForWord(c.wordId);if(n.success){const m=n.data.find(h=>h.id===c.submissionId);m&&(s.value=m,r.value="status")}}}catch(e){console.error("Failed to load submission status:",e)}},H=e=>e?new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}):"",P=e=>{if(!e)return"";const n=Date.now()-e,m=Math.floor(n/(1e3*60)),h=Math.floor(n/(1e3*60*60)),x=Math.floor(n/(1e3*60*60*24));return m<1?"just now":m<60?`${m} minute${m===1?"":"s"} ago`:h<24?`${h} hour${h===1?"":"s"} ago`:`${x} day${x===1?"":"s"} ago`},I=()=>{_.value=!1},j=()=>{_.value=!0};return se(()=>{K(),z(),window.addEventListener("online",I),window.addEventListener("offline",j)}),te(()=>{window.removeEventListener("online",I),window.removeEventListener("offline",j)}),ae(()=>s.value,e=>{e&&v("status-change",e.status,e)}),(e,a)=>{var n;return o(),i("div",oe,[r.value==="form"?(o(),i("div",re,[ne(ee,{"word-id":g.wordId,"initial-data":p.value,onSuccess:V,onCancel:R,onDraftSaved:U},null,8,["word-id","initial-data"])])):r.value==="status"?(o(),i("div",ue,[t("div",le,[t("div",de,[t("div",{class:E(["status-icon",A.value])},u($.value),3),t("h2",ce,u(T.value),1),t("p",ve,u(M.value),1)]),s.value?(o(),i("div",me,[t("div",fe,[a[0]||(a[0]=t("span",{class:"detail-label"},"Submission ID:",-1)),t("span",pe,u(s.value.id),1)]),t("div",be,[a[1]||(a[1]=t("span",{class:"detail-label"},"Status:",-1)),t("span",{class:E(["detail-value status-badge",B.value])},u(s.value.status),3)]),t("div",he,[a[2]||(a[2]=t("span",{class:"detail-label"},"Submitted:",-1)),t("span",ge,u(H(s.value.createdAt)),1)]),s.value.moderatorNotes?(o(),i("div",ye,[a[3]||(a[3]=t("span",{class:"detail-label"},"Notes:",-1)),t("span",we,u(s.value.moderatorNotes),1)])):d("",!0)])):d("",!0),((n=s.value)==null?void 0:n.status)==="pending"?(o(),i("div",Se,a[4]||(a[4]=[ie('<div class="progress-steps" data-v-38502aea><div class="step completed" data-v-38502aea><div class="step-icon" data-v-38502aea>‚úì</div><span class="step-label" data-v-38502aea>Submitted</span></div><div class="step active" data-v-38502aea><div class="step-icon" data-v-38502aea>‚è≥</div><span class="step-label" data-v-38502aea>Under Review</span></div><div class="step" data-v-38502aea><div class="step-icon" data-v-38502aea>üìù</div><span class="step-label" data-v-38502aea>Decision</span></div></div><p class="progress-note" data-v-38502aea> Your submission is being reviewed by the community. This typically takes 1-3 days. </p>',2)]))):d("",!0),t("div",_e,[Y.value?(o(),i("button",{key:0,class:"btn-secondary",onClick:W}," Edit Submission ")):d("",!0),F.value?(o(),i("button",{key:1,class:"btn-danger",onClick:q}," Withdraw Submission ")):d("",!0),t("button",{class:"btn-primary",onClick:J},u(L.value),1)])])])):r.value==="error"?(o(),i("div",ke,[t("div",De,[a[6]||(a[6]=t("div",{class:"error-icon"},"‚ö†Ô∏è",-1)),a[7]||(a[7]=t("h2",{class:"error-title"},"Submission Failed",-1)),t("p",Ce,u(S.value),1),y.value?(o(),i("div",Ie,[t("details",null,[a[5]||(a[5]=t("summary",null,"Error Details",-1)),t("pre",null,u(y.value),1)])])):d("",!0),t("div",{class:"error-actions"},[t("button",{class:"btn-secondary",onClick:C}," Go Back "),t("button",{class:"btn-primary",onClick:G}," Try Again ")])])])):d("",!0),_.value?(o(),i("div",je,a[8]||(a[8]=[t("div",{class:"offline-content"},[t("span",{class:"offline-icon"},"üì°"),t("span",{class:"offline-text"}," You're offline. Your changes are being saved locally and will sync when you're back online. ")],-1)]))):d("",!0),O.value&&r.value==="form"?(o(),i("div",xe,[t("div",Ee,[a[9]||(a[9]=t("span",{class:"draft-icon"},"üíæ",-1)),t("span",Ne," Draft saved "+u(P(b.value)),1),t("button",{class:"clear-draft-btn",onClick:k}," Clear ")])])):d("",!0)])}}},Ye=Q(Te,[["__scopeId","data-v-38502aea"]]);export{Ye as default};
