import{o as n,f as d,g as e,t as a,l as m,z as _,q as w,y as B,F as T,D as J,u as x,j as U,b as C,c as $,w as q,A as tt,I as et,G as S,E as ot}from"./vendor-C5FfeEaS.js";import{b as H}from"./router-Cvbgimde.js";import{A as it,I as G}from"./AudioPlayerTaigi-CWgaieRU.js";import{_ as O}from"./Pinyinzhuyin-aFsnSd4o.js";import{I as K}from"./IconEdit-BhSTa8nK.js";import{u as P,I as Y}from"./favoritesStore-CTEzz-4U.js";import{_ as D,b as Q,a as nt}from"./index-CmUZZITA.js";const st={width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",class:"icon-add"},dt={__name:"IconAdd",setup(t){return(p,i)=>(n(),d("svg",st,i[0]||(i[0]=[e("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm5 11h-4v4h-2v-4H7v-2h4V7h2v4h4v2z",fill:"currentColor"},null,-1)])))}},W=D(dt,[["__scopeId","data-v-d0e0ef07"]]),at={class:"entry moe-result-item"},rt=["src"],lt={class:"moe-english-chinese"},ut={key:0,class:"word-item moe-word-chinese logographic"},ct={class:""},vt={key:1,class:"word-item moe-word-english alphabetic"},ft={class:"alphabetic"},mt={class:"logographic"},wt={__name:"MoeResultCard",props:{word:{type:Object,required:!0}},emits:["readChinese","readEnglish","openEditDialog","addDefinition"],setup(t,{emit:p}){const i=H(),f=P(),h=t,g=()=>{h.word.id&&i.push({name:"word-detail",params:{id:h.word.id.toString()}})};return(c,o)=>(n(),d("li",at,[t.word.romaji!=null?(n(),d("div",{key:0,class:"word-item moe-word-taigi alphabetic",onClick:g,style:{cursor:"pointer"},title:"Click to view full word details"},[e("p",null,a(t.word.romaji),1),t.word.audio_url?(n(),d("audio",{key:0,ref:"audio",src:`${t.word.audio_url}`,controls:""},null,8,rt)):m("",!0),t.word.audioid?(n(),_(it,{key:1,audioID:t.word.audioid},null,8,["audioID"])):m("",!0)])):m("",!0),e("div",lt,[t.word.chinese!=null?(n(),d("div",ut,[e("span",ct,a(t.word.chinese),1),w(O,{han:t.word.chinese},null,8,["han"]),w(G,{onClick:o[0]||(o[0]=l=>c.$emit("readChinese",t.word.chinese))})])):m("",!0),t.word.english!=null?(n(),d("div",vt,[B(a(t.word.english)+" ",1),w(G,{onClick:o[1]||(o[1]=l=>c.$emit("readEnglish",t.word.english))})])):m("",!0)]),e("ul",null,[(n(!0),d(T,null,J(t.word.definitions,l=>(n(),d("li",{key:l.id},[e("ul",null,[e("li",ft,a(l.def_english),1),e("li",mt,a(l.def_chinese),1)])]))),128))]),e("div",{class:"word-actions",onClick:o[5]||(o[5]=U(()=>{},["stop"]))},[w(Y,{isFavorited:x(f).isFavorited(t.word.id),onClick:o[2]||(o[2]=l=>x(f).toggleFavorite(t.word)),title:"Add to favorites"},null,8,["isFavorited"]),w(W,{class:"add-definition",title:"Add community definition",onClick:o[3]||(o[3]=l=>c.$emit("addDefinition",t.word))}),w(K,{class:"edit-word",title:"Edit entry",onClick:o[4]||(o[4]=l=>c.$emit("openEditDialog",t.word))})])]))}},fe=D(wt,[["__scopeId","data-v-75fa7df1"]]),ht={class:"mknoll-taiwanese"},gt={class:"mknoll-chinese"},bt={class:"mknoll-english"},$t=["src"],yt={__name:"MknollResultCard",props:{word:{type:Object,required:!0}},emits:["openEditDialog","addDefinition"],setup(t,{emit:p}){const i=H(),f=P(),h=t,g=()=>{h.word.id&&i.push({name:"word-detail",params:{id:h.word.id.toString()}})};return(c,o)=>(n(),d("li",{class:"mknoll-result-item",onClick:g,style:{cursor:"pointer"},title:"Click to view full word details"},[e("div",null,[e("div",ht,a(t.word.taiwanese),1),e("div",gt,[B(a(t.word.chinese)+" ",1),w(O,{han:t.word.chinese},null,8,["han"])])]),e("div",bt,[B(a(t.word.english_mknoll)+" ",1),t.word.audio_url?(n(),d("audio",{key:0,ref:"audio",src:`${t.word.audio_url}`,controls:""},null,8,$t)):m("",!0)]),e("div",{class:"word-actions",onClick:o[3]||(o[3]=U(()=>{},["stop"]))},[w(Y,{isFavorited:x(f).isFavorited(t.word.id),onClick:o[0]||(o[0]=l=>x(f).toggleFavorite(t.word)),title:"Add to favorites"},null,8,["isFavorited"]),w(W,{class:"add-definition",title:"Add community definition",onClick:o[1]||(o[1]=l=>c.$emit("addDefinition",t.word))}),w(K,{title:"Edit entry",onClick:o[2]||(o[2]=l=>c.$emit("openEditDialog",t.word))})])]))}},me=D(yt,[["__scopeId","data-v-999b5b72"]]),kt={class:"word-content"},Ct={class:"word-text"},pt={class:"word-definition"},It={__name:"CedictResultCard",props:{word:{type:Object,required:!0}},emits:["addDefinition"],setup(t,{emit:p}){const i=H(),f=P(),h=t,g=()=>{h.word.id&&i.push({name:"word-detail",params:{id:h.word.id.toString()}})};return(c,o)=>(n(),d("li",{class:"cedict-result-item",onClick:g,style:{cursor:"pointer"},title:"Click to view full word details"},[e("div",kt,[e("div",Ct,[B(a(t.word.traditional)+" ",1),w(O,{han:t.word.traditional},null,8,["han"])]),e("div",pt,a(t.word.english_cedict),1)]),e("div",{class:"word-actions",onClick:o[2]||(o[2]=U(()=>{},["stop"]))},[w(Y,{isFavorited:x(f).isFavorited(t.word.id),onClick:o[0]||(o[0]=l=>x(f).toggleFavorite(t.word)),title:"Add to favorites"},null,8,["isFavorited"]),w(W,{class:"add-definition",title:"Add community definition",onClick:o[1]||(o[1]=l=>c.$emit("addDefinition",t.word))})])]))}},we=D(It,[["__scopeId","data-v-3274ef7f"]]),St=["disabled","aria-label"],Vt={width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",class:"vote-icon"},Lt=["fill","stroke"],xt={class:"vote-count"},Dt=["disabled","aria-label"],Mt={width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",class:"vote-icon"},At=["fill","stroke"],Et={class:"vote-count"},Ft={key:0,class:"loading-indicator"},jt={class:"login-prompt-actions"},Nt={__name:"VotingButtons",props:{definitionId:{type:String,required:!0},voteScore:{type:Number,default:0},upvotes:{type:Number,default:0},downvotes:{type:Number,default:0},userVote:{type:String,default:null,validator:t=>t===null||["upvote","downvote"].includes(t)},authorId:{type:String,required:!0},disabled:{type:Boolean,default:!1}},emits:["vote-submitted","vote-updated","login-required","error"],setup(t,{emit:p}){const i=t,f=p,h=Q(),g=nt(),c=C(!1),o=C(!1),l=C(null),I=C(i.voteScore),M=C(i.upvotes),A=C(i.downvotes),E=C(i.userVote);let F=null;const j=$(()=>h.isAuthenticated),r=$(()=>{var u;return(u=h.user)==null?void 0:u.id}),v=$(()=>!(i.disabled||!j.value||r.value===i.authorId)),y=$(()=>I.value>0?"positive":I.value<0?"negative":"neutral"),N=$(()=>I.value),V=$(()=>M.value),L=$(()=>A.value),b=$(()=>E.value);async function z(u){var s,R;try{if(l.value=null,!j.value){o.value=!0;return}if(!v.value){if(r.value===i.authorId){l.value="You cannot vote on your own content",f("error",l.value);return}return}if(c.value=!0,b.value===u){const k=await g.removeVote(i.definitionId);if(k.success)f("vote-submitted",{definitionId:i.definitionId,voteType:null,previousVote:u});else throw new Error(((s=k.error)==null?void 0:s.message)||"Failed to remove vote")}else{const k=await g.submitVote(i.definitionId,u);if(k.success)f("vote-submitted",{definitionId:i.definitionId,voteType:u,previousVote:b.value});else throw new Error(((R=k.error)==null?void 0:R.message)||"Failed to submit vote")}}catch(k){console.error("Vote submission error:",k),l.value=k.message,f("error",l.value)}finally{c.value=!1}}function Z(){o.value=!1}function X(u){if(u.definitionId===i.definitionId){const s=g.getVoteSummary(i.definitionId);I.value=s.score,M.value=s.upvotes,A.value=s.downvotes,E.value=s.userVote,f("vote-updated",{definitionId:i.definitionId,voteScore:s.score,upvotes:s.upvotes,downvotes:s.downvotes,userVote:s.userVote})}}return q(()=>i.voteScore,u=>{I.value=u}),q(()=>i.upvotes,u=>{M.value=u}),q(()=>i.downvotes,u=>{A.value=u}),q(()=>i.userVote,u=>{E.value=u}),q(j,u=>{u&&o.value&&(o.value=!1)}),tt(()=>{F=g.onVoteUpdate(X)}),et(()=>{F&&F()}),(u,s)=>(n(),d(T,null,[e("div",{class:S(["voting-buttons",{disabled:!v.value}])},[e("button",{class:S(["vote-button upvote-button",{active:b.value==="upvote",disabled:!v.value||c.value}]),onClick:s[0]||(s[0]=R=>z("upvote")),disabled:!v.value||c.value,"aria-label":`Upvote this definition. Current upvotes: ${V.value}`},[(n(),d("svg",Vt,[e("path",{d:"M12 4l8 8h-6v8h-4v-8H4l8-8z",fill:b.value==="upvote"?"#27ae60":"none",stroke:b.value==="upvote"?"#27ae60":"currentColor","stroke-width":"2","stroke-linejoin":"round"},null,8,Lt)])),e("span",xt,a(V.value),1)],10,St),e("div",{class:S(["vote-score",y.value])},a(N.value),3),e("button",{class:S(["vote-button downvote-button",{active:b.value==="downvote",disabled:!v.value||c.value}]),onClick:s[1]||(s[1]=R=>z("downvote")),disabled:!v.value||c.value,"aria-label":`Downvote this definition. Current downvotes: ${L.value}`},[(n(),d("svg",Mt,[e("path",{d:"M12 20l-8-8h6V4h4v8h6l-8 8z",fill:b.value==="downvote"?"#e74c3c":"none",stroke:b.value==="downvote"?"#e74c3c":"currentColor","stroke-width":"2","stroke-linejoin":"round"},null,8,At)])),e("span",Et,a(L.value),1)],10,Dt),c.value?(n(),d("div",Ft,s[4]||(s[4]=[e("div",{class:"spinner"},null,-1)]))):m("",!0)],2),o.value?(n(),d("div",{key:0,class:"login-prompt-overlay",onClick:Z},[e("div",{class:"login-prompt",onClick:s[3]||(s[3]=U(()=>{},["stop"]))},[s[5]||(s[5]=e("h3",null,"Sign in to vote",-1)),s[6]||(s[6]=e("p",null,"You need to be logged in to vote on community definitions.",-1)),e("div",jt,[e("button",{class:"login-button",onClick:s[2]||(s[2]=R=>u.$emit("login-required"))}," Sign In "),e("button",{class:"cancel-button",onClick:Z}," Cancel ")])])])):m("",!0)],64))}},Rt=D(Nt,[["__scopeId","data-v-7462838b"]]),qt={key:0,class:"status-indicator"},Bt={class:"definition-content"},Ut={class:"definition-text"},zt={class:"definition"},Tt={key:0,class:"usage-example"},Ht={class:"usage-text"},Ot={key:1,class:"context"},Pt={class:"context-text"},Yt={key:0,class:"tags"},Wt={class:"definition-footer"},Zt={class:"author-info"},Gt={class:"author-details"},Jt={class:"author-name"},Kt={class:"metadata"},Qt=["datetime","title"],Xt={key:0,class:"edited-indicator"},_t={class:"voting-section"},te={key:1,class:"moderator-notes"},ee={class:"moderator-notes-text"},oe={key:2,class:"hidden-overlay"},ie={class:"hidden-content"},ne={class:"hidden-message"},se={__name:"CommunityDefinitionCard",props:{definition:{type:Object,required:!0},hideThreshold:{type:Number,default:-5}},emits:["vote-submitted","vote-updated","login-required","voting-error"],setup(t,{emit:p}){const i=t,f=p,h=Q(),g=C(!1),c=$(()=>i.definition.voteScore<=i.hideThreshold),o=$(()=>{switch(i.definition.status){case"pending":return"Pending Review";case"rejected":return"Rejected";case"hidden":return"Hidden";default:return""}}),l=$(()=>{const r=i.definition.authorReputation;return r>=1e3?"high-reputation":r>=100?"medium-reputation":r>=10?"low-reputation":"new-user"}),I=$(()=>{const r=h.user;return r&&(r.role==="moderator"||r.role==="admin")});function M(r){const y=Math.floor((new Date-r)/1e3);if(y<60)return"just now";const N=Math.floor(y/60);if(N<60)return`${N}m ago`;const V=Math.floor(N/60);if(V<24)return`${V}h ago`;const L=Math.floor(V/24);if(L<30)return`${L}d ago`;const b=Math.floor(L/30);return b<12?`${b}mo ago`:`${Math.floor(b/12)}y ago`}function A(r){return r.toLocaleString()}function E(r){f("vote-submitted",r)}function F(r){f("vote-updated",r)}function j(r){f("voting-error",r)}return(r,v)=>(n(),d("div",{class:S(["community-definition-card",{"low-score":t.definition.voteScore<-5,hidden:c.value,pending:t.definition.status==="pending",rejected:t.definition.status==="rejected"}])},[v[5]||(v[5]=ot('<div class="community-badge" data-v-894fba1d><svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="community-icon" data-v-894fba1d><path d="M12 2L13.09 8.26L20 9L13.09 9.74L12 16L10.91 9.74L4 9L10.91 8.26L12 2Z" fill="currentColor" data-v-894fba1d></path><path d="M19 15L19.5 17L21 17.5L19.5 18L19 20L18.5 18L17 17.5L18.5 17L19 15Z" fill="currentColor" data-v-894fba1d></path><path d="M5 15L5.5 17L7 17.5L5.5 18L5 20L4.5 18L3 17.5L4.5 17L5 15Z" fill="currentColor" data-v-894fba1d></path></svg><span class="community-label" data-v-894fba1d>Community</span></div>',1)),t.definition.status!=="approved"?(n(),d("div",qt,[e("span",{class:S(["status-badge",t.definition.status])},a(o.value),3)])):m("",!0),e("div",Bt,[e("div",Ut,[e("p",zt,a(t.definition.definition),1),t.definition.usageExample?(n(),d("div",Tt,[v[2]||(v[2]=e("span",{class:"usage-label"},"Example:",-1)),e("span",Ht,a(t.definition.usageExample),1)])):m("",!0),t.definition.context?(n(),d("div",Ot,[v[3]||(v[3]=e("span",{class:"context-label"},"Context:",-1)),e("span",Pt,a(t.definition.context),1)])):m("",!0)]),t.definition.tags&&t.definition.tags.length>0?(n(),d("div",Yt,[(n(!0),d(T,null,J(t.definition.tags,y=>(n(),d("span",{key:y,class:"tag"},a(y),1))),128))])):m("",!0)]),e("div",Wt,[e("div",Zt,[e("div",Gt,[e("span",Jt,a(t.definition.username),1),e("span",{class:S(["reputation",l.value])},a(t.definition.authorReputation)+" rep ",3)]),e("div",Kt,[e("time",{datetime:t.definition.createdAt.toISOString(),title:A(t.definition.createdAt),class:"submission-date"},a(M(t.definition.createdAt)),9,Qt),t.definition.updatedAt>t.definition.createdAt?(n(),d("span",Xt," (edited) ")):m("",!0)])]),e("div",_t,[w(Rt,{"definition-id":t.definition.id,"vote-score":t.definition.voteScore,upvotes:t.definition.upvotes,downvotes:t.definition.downvotes,"user-vote":t.definition.userVote,"author-id":t.definition.userId,disabled:t.definition.status!=="approved",onVoteSubmitted:E,onVoteUpdated:F,onLoginRequired:v[0]||(v[0]=y=>r.$emit("login-required")),onError:j},null,8,["definition-id","vote-score","upvotes","downvotes","user-vote","author-id","disabled"])])]),t.definition.moderatorNotes&&I.value?(n(),d("div",te,[v[4]||(v[4]=e("div",{class:"moderator-notes-header"},[e("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[e("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z",fill:"currentColor"})]),e("span",null,"Moderator Notes")],-1)),e("p",ee,a(t.definition.moderatorNotes),1)])):m("",!0),c.value&&!g.value?(n(),d("div",oe,[e("div",ie,[e("p",ne," This content has been hidden due to low community score ("+a(t.definition.voteScore)+"). ",1),e("button",{class:"show-hidden-button",onClick:v[1]||(v[1]=y=>g.value=!0),type:"button"}," Show Content ")])])):m("",!0)],2))}},he=D(se,[["__scopeId","data-v-894fba1d"]]);export{we as C,W as I,fe as M,me as a,he as b};
