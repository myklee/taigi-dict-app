import{b as _,c as b,A as O,w as H,f as i,q as g,g as s,t as o,u as r,F as N,D as $,l as f,j as P,k as h,v as k,o as l}from"./vendor-C5FfeEaS.js";import{b as z}from"./router-Cvbgimde.js";import{_ as G,b as J}from"./index-CmUZZITA.js";import{u as K,I as C}from"./favoritesStore-CTEzz-4U.js";import{L as Q}from"./Loader-Cth2euVp.js";const W={id:"user-profile-page"},X={class:"profile-header"},Y={class:"header-content"},Z={class:"user-info"},ss={class:"user-avatar-large"},es={class:"user-details"},ts={class:"user-role"},os={class:"profile-content"},as={class:"content-container"},ns={class:"info-section"},is={class:"info-grid"},ls={class:"info-item"},rs={class:"info-item"},ds={class:"info-item"},us={class:"favorites-section"},vs={class:"section-header"},cs={class:"favorites-count"},ms={key:0,class:"no-favorites"},fs={key:1,class:"favorites-content"},ps={class:"recent-favorites"},ws={class:"favorites-grid"},_s={class:"favorite-word-info"},bs={class:"word-main"},ys={class:"chinese"},gs={class:"romaji"},hs={class:"word-english"},ks={key:0,class:"definition-preview"},Ps={class:"favorite-date"},Cs=["onClick"],Fs={key:0,class:"all-favorites"},Us={class:"favorites-list"},Ss={class:"favorite-content"},As={class:"word-info"},Ds={class:"chinese"},Ns={class:"romaji"},$s={class:"english"},xs={class:"favorite-meta"},Ls={class:"date"},Vs=["onClick"],Is={class:"favorites-actions"},Ts={class:"actions-section"},Bs={class:"action-buttons"},Es={class:"modal-header"},Ms={class:"form-group"},Rs={class:"form-group"},js={class:"form-actions"},qs=["disabled"],Os={class:"modal-header"},Hs={class:"form-group"},zs={class:"form-group"},Gs={class:"form-group"},Js={class:"form-actions"},Ks=["disabled"],Qs={key:2,class:"success-message"},Ws={key:3,class:"error-message"},Xs={__name:"UserProfile",emits:["close"],setup(Ys,{emit:Zs}){const x=z(),n=J(),d=K(),p=_(!1),w=_(!1),u=_(""),y=_(!1),c=_({displayName:"",bio:""}),v=_({currentPassword:"",newPassword:"",confirmPassword:""}),m=b(()=>n.user),L=b(()=>{var a;return(a=m.value)!=null&&a.email?m.value.email.charAt(0).toUpperCase():"?"}),V=b(()=>n.isAdmin?"Administrator":"User"),I=b(()=>{var a;return(a=m.value)!=null&&a.created_at?new Date(m.value.created_at).toLocaleDateString():"Unknown"}),T=b(()=>{var a;return(a=m.value)!=null&&a.last_sign_in_at?new Date(m.value.last_sign_in_at).toLocaleString():"Unknown"}),B=b(()=>d.favorites.slice(0,3)),F=()=>{x.push({name:"dictionary"})},E=async()=>{(await n.signOut()).success&&F()},M=async()=>{const a={};c.value.displayName&&(a.display_name=c.value.displayName),c.value.bio&&(a.bio=c.value.bio),(await n.updateProfile(a)).success&&(u.value="Profile updated successfully!",p.value=!1,setTimeout(()=>{u.value=""},3e3))},R=async()=>{if(v.value.newPassword!==v.value.confirmPassword){n.error="New passwords do not match";return}(await n.updatePassword(v.value.newPassword)).success&&(u.value="Password changed successfully!",w.value=!1,v.value={currentPassword:"",newPassword:"",confirmPassword:""},setTimeout(()=>{u.value=""},3e3))},U=async a=>{await d.removeFavorite(a),u.value="Removed from favorites",setTimeout(()=>{u.value=""},2e3)},j=async()=>{confirm("Are you sure you want to remove all favorites? This action cannot be undone.")&&(y.value=!0,await d.clearFavorites(),u.value="All favorites cleared",y.value=!1,setTimeout(()=>{u.value=""},2e3))},S=a=>new Date(a).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"});return O(async()=>{y.value=!0,await d.loadFromIndexedDB(),await d.loadFromSupabase(),y.value=!1}),H(()=>n.error,()=>{n.error&&(u.value="")}),(a,e)=>{var A,D;return l(),i("div",W,[g(Q,{loading:y.value},null,8,["loading"]),s("section",X,[s("div",Y,[s("div",Z,[s("div",ss,o(L.value),1),s("div",es,[s("h1",null,o((A=m.value)==null?void 0:A.email),1),s("div",ts,o(V.value),1)])]),s("button",{onClick:e[0]||(e[0]=t=>F()),class:"back-button"}," ← Back to Dictionary ")])]),s("section",os,[s("div",as,[s("div",ns,[e[20]||(e[20]=s("h2",null,"Account Information",-1)),s("div",is,[s("div",ls,[e[17]||(e[17]=s("label",null,"Email:",-1)),s("span",null,o((D=m.value)==null?void 0:D.email),1)]),s("div",rs,[e[18]||(e[18]=s("label",null,"Member since:",-1)),s("span",null,o(I.value),1)]),s("div",ds,[e[19]||(e[19]=s("label",null,"Last sign in:",-1)),s("span",null,o(T.value),1)])])]),s("div",us,[s("div",vs,[e[21]||(e[21]=s("h2",null,"My Favorites 我的最愛",-1)),s("div",cs,[g(C,{isFavorited:!0}),s("span",null,o(r(d).favorites.length),1)])]),r(d).favorites.length===0?(l(),i("div",ms,[g(C,{isFavorited:!1}),e[22]||(e[22]=s("h3",null,"No favorites yet",-1)),e[23]||(e[23]=s("p",null,"Start exploring the dictionary and click the heart icon to save words you'd like to remember!",-1)),s("button",{onClick:e[1]||(e[1]=t=>F()),class:"btn-primary"}," Start Exploring ")])):(l(),i("div",fs,[s("div",ps,[e[24]||(e[24]=s("h3",null,"Recent favorites:",-1)),s("div",ws,[(l(!0),i(N,null,$(B.value,t=>(l(),i("div",{key:t.id,class:"favorite-card"},[s("div",_s,[s("div",bs,[s("span",ys,o(t.word_data.chinese),1),s("span",gs,o(t.word_data.romaji),1)]),s("div",hs,o(t.word_data.english),1),t.word_data.definitions&&t.word_data.definitions.length?(l(),i("div",ks,o(t.word_data.definitions[0].def_english),1)):f("",!0),s("div",Ps,o(S(t.created_at)),1)]),s("button",{onClick:q=>U(t.word_data.id),class:"remove-favorite",title:"Remove from favorites"},[g(C,{isFavorited:!0})],8,Cs)]))),128))])]),r(d).favorites.length>3?(l(),i("div",Fs,[s("h3",null,"All Favorites ("+o(r(d).favorites.length)+")",1),s("div",Us,[(l(!0),i(N,null,$(r(d).favorites,t=>(l(),i("div",{key:t.id,class:"favorite-list-item"},[s("div",Ss,[s("div",As,[s("span",Ds,o(t.word_data.chinese),1),s("span",Ns,o(t.word_data.romaji),1),s("span",$s,o(t.word_data.english),1)]),s("div",xs,[s("span",Ls,o(S(t.created_at)),1)])]),s("button",{onClick:q=>U(t.word_data.id),class:"remove-favorite-btn",title:"Remove from favorites"},[g(C,{isFavorited:!0})],8,Vs)]))),128))])])):f("",!0),s("div",Is,[r(d).favorites.length>0?(l(),i("button",{key:0,class:"btn-danger-outline",onClick:j}," Clear All Favorites ")):f("",!0)])]))]),s("div",Ts,[e[25]||(e[25]=s("h2",null,"Account Actions",-1)),s("div",Bs,[s("button",{class:"btn-secondary",onClick:e[2]||(e[2]=t=>p.value=!0)}," Update Profile "),s("button",{class:"btn-secondary",onClick:e[3]||(e[3]=t=>w.value=!0)}," Change Password "),s("button",{class:"btn-danger",onClick:E}," Sign Out ")])])])]),p.value?(l(),i("div",{key:0,class:"modal-overlay",onClick:e[9]||(e[9]=t=>p.value=!1)},[s("div",{class:"modal",onClick:e[8]||(e[8]=P(()=>{},["stop"]))},[s("div",Es,[e[27]||(e[27]=s("h4",null,"Update Profile",-1)),s("button",{class:"close-button",onClick:e[4]||(e[4]=t=>p.value=!1)},e[26]||(e[26]=[s("span",null,"×",-1)]))]),s("form",{onSubmit:P(M,["prevent"]),class:"modal-content"},[s("div",Ms,[e[28]||(e[28]=s("label",{for:"display-name"},"Display Name",-1)),h(s("input",{id:"display-name","onUpdate:modelValue":e[5]||(e[5]=t=>c.value.displayName=t),type:"text",placeholder:"Enter display name"},null,512),[[k,c.value.displayName]])]),s("div",Rs,[e[29]||(e[29]=s("label",{for:"bio"},"Bio",-1)),h(s("textarea",{id:"bio","onUpdate:modelValue":e[6]||(e[6]=t=>c.value.bio=t),placeholder:"Tell us about yourself",rows:"3"},null,512),[[k,c.value.bio]])]),s("div",js,[s("button",{type:"button",class:"btn-secondary",onClick:e[7]||(e[7]=t=>p.value=!1)}," Cancel "),s("button",{type:"submit",class:"btn-primary",disabled:r(n).loading},o(r(n).loading?"Updating...":"Update Profile"),9,qs)])],32)])])):f("",!0),w.value?(l(),i("div",{key:1,class:"modal-overlay",onClick:e[16]||(e[16]=t=>w.value=!1)},[s("div",{class:"modal",onClick:e[15]||(e[15]=P(()=>{},["stop"]))},[s("div",Os,[e[31]||(e[31]=s("h4",null,"Change Password",-1)),s("button",{class:"close-button",onClick:e[10]||(e[10]=t=>w.value=!1)},e[30]||(e[30]=[s("span",null,"×",-1)]))]),s("form",{onSubmit:P(R,["prevent"]),class:"modal-content"},[s("div",Hs,[e[32]||(e[32]=s("label",{for:"current-password"},"Current Password",-1)),h(s("input",{id:"current-password","onUpdate:modelValue":e[11]||(e[11]=t=>v.value.currentPassword=t),type:"password",required:"",placeholder:"Enter current password"},null,512),[[k,v.value.currentPassword]])]),s("div",zs,[e[33]||(e[33]=s("label",{for:"new-password"},"New Password",-1)),h(s("input",{id:"new-password","onUpdate:modelValue":e[12]||(e[12]=t=>v.value.newPassword=t),type:"password",required:"",placeholder:"Enter new password"},null,512),[[k,v.value.newPassword]])]),s("div",Gs,[e[34]||(e[34]=s("label",{for:"confirm-new-password"},"Confirm New Password",-1)),h(s("input",{id:"confirm-new-password","onUpdate:modelValue":e[13]||(e[13]=t=>v.value.confirmPassword=t),type:"password",required:"",placeholder:"Confirm new password"},null,512),[[k,v.value.confirmPassword]])]),s("div",Js,[s("button",{type:"button",class:"btn-secondary",onClick:e[14]||(e[14]=t=>w.value=!1)}," Cancel "),s("button",{type:"submit",class:"btn-primary",disabled:r(n).loading},o(r(n).loading?"Changing...":"Change Password"),9,Ks)])],32)])])):f("",!0),u.value?(l(),i("div",Qs,o(u.value),1)):f("",!0),r(n).error?(l(),i("div",Ws,o(r(n).error),1)):f("",!0)])}}},ne=G(Xs,[["__scopeId","data-v-9818cb5e"]]);export{ne as default};
