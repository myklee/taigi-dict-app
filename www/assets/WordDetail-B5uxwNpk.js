import{u as K,b as Q}from"./router-Cvbgimde.js";import{_ as X,a as Y,s as _}from"./index-CmUZZITA.js";import{s as Z,a as W}from"./AudioPlayerTaigi-CWgaieRU.js";import{L as oo}from"./Loader-Cth2euVp.js";import{M as eo,a as to,C as no,b as io}from"./CommunityDefinitionCard-nk4ta4ay.js";import so from"./EditWord-CQd5qnB_.js";import lo from"./EditWordMknoll-CsFCvzmE.js";import{C as ro}from"./CommunityDefinitionForm-DxlPrvZz.js";import{b as i,w as ao,A as uo,f as l,q as u,g as n,t as co,l as c,F as I,D as N,o as s,z as A}from"./vendor-C5FfeEaS.js";import"./Pinyinzhuyin-aFsnSd4o.js";import"./pinyin-web-Brx8g6kF.js";import"./index-BeZKRCO5.js";import"./IconEdit-BhSTa8nK.js";import"./favoritesStore-CTEzz-4U.js";import"./AudioRecorder-B6379Soo.js";const fo={class:"word-detail"},mo={key:0,class:"error-message"},vo={key:1,class:"not-found"},ho={key:2,class:"word-content"},yo={key:0,class:"word-section"},po={class:"word-card"},wo={key:1,class:"word-section"},go={class:"word-card"},ko={key:2,class:"word-section"},Do={class:"word-cards"},bo={key:3,class:"word-section"},Co={class:"word-cards"},Eo={__name:"WordDetail",props:{id:{type:String,required:!0,validator:h=>{const f=parseInt(h);return!isNaN(f)&&f>0}}},setup(h){const f=K(),R=Q(),F=Y(),m=i(!1),a=i(null),r=i(null),y=i(null),p=i([]),v=i([]),w=i(!1),g=i(!1),k=i(!1),D=i(null),b=i(null),C=i(null),S=h,B=async o=>{if(!o){a.value="Invalid word ID provided";return}m.value=!0,a.value=null;try{const e=parseInt(o);if(isNaN(e)||e<=0)throw new Error("Invalid word ID format");const{data:t,error:d}=await _.from("words").select(`
        *,
        definitions (
          defid,
          wordid,
          partofspeech,
          def_chinese,
          def_english
        )
      `).eq("id",e).single();if(d&&d.code!=="PGRST116")throw d;r.value=t,t?await j(t):a.value=null}catch(e){console.error("Error fetching word:",e),a.value=e.message||"Failed to load word details"}finally{m.value=!1}},j=async o=>{try{if(o.chinese||o.english||o.romaji){const e=[];if(o.chinese&&e.push(`chinese.ilike.%${o.chinese}%`),o.english&&e.push(`english_mknoll.ilike.%${o.english}%`),o.romaji&&e.push(`taiwanese.ilike.%${o.romaji}%`),e.length>0){const{data:t}=await _.from("maryknoll").select("*").or(e.join(",")).limit(5);t&&t.length>0&&(y.value=t[0])}}if(o.chinese){const{data:e}=await _.from("cedict").select("*").or(`traditional.ilike.%${o.chinese}%,simplified.ilike.%${o.chinese}%`).limit(5);p.value=e||[]}await M(o)}catch(e){console.error("Error fetching related entries:",e)}},M=async o=>{try{const e={sortBy:"score",sortOrder:"desc",status:["approved"],limit:10},t=[o.chinese,o.english,o.romaji].filter(Boolean).join(" ");if(t){const d=await F.searchDefinitions({...e,searchTerm:t});d.success&&(v.value=d.data)}}catch(e){console.error("Error fetching community definitions:",e)}},q=()=>{window.history.length>1?R.go(-1):R.push({name:"dictionary"})},V=o=>{Z(o)},L=o=>{W(o)},T=o=>{D.value=o,w.value=!0,document.body.style.overflow="hidden"},O=()=>{w.value=!1,D.value=null,document.body.style.overflow="scroll"},U=o=>{b.value=o,g.value=!0,document.body.style.overflow="hidden"},x=()=>{g.value=!1,b.value=null,document.body.style.overflow="scroll"},E=o=>{C.value=o,k.value=!0,document.body.style.overflow="hidden"},$=()=>{k.value=!1,C.value=null,document.body.style.overflow="scroll"},z=async()=>{$(),r.value&&await M(r.value)},G=o=>{console.log("Community vote submitted:",o)},P=o=>{console.log("Community vote updated:",o);const e=v.value.find(t=>t.id===o.definitionId);e&&(e.voteScore=o.voteScore,e.upvotes=o.upvotes,e.downvotes=o.downvotes,e.userVote=o.userVote)},H=o=>{console.error("Community voting error:",o)},J=()=>{console.log("Login required for community features")};return ao(()=>f.params.id,o=>{o&&o!==S.id&&B(o)}),uo(()=>{B(S.id)}),(o,e)=>(s(),l("div",fo,[u(oo,{loading:m.value},null,8,["loading"]),a.value?(s(),l("div",mo,[e[2]||(e[2]=n("h2",null,"Error",-1)),n("p",null,co(a.value),1),n("button",{onClick:e[0]||(e[0]=t=>o.$router.push({name:"dictionary"})),class:"back-button"}," Back to Dictionary ")])):!m.value&&!r.value?(s(),l("div",vo,[e[3]||(e[3]=n("h2",null,"Word Not Found",-1)),e[4]||(e[4]=n("p",null,"The word you're looking for could not be found.",-1)),n("button",{onClick:e[1]||(e[1]=t=>o.$router.push({name:"dictionary"})),class:"back-button"}," Back to Dictionary ")])):r.value?(s(),l("div",ho,[n("div",{class:"word-header"},[n("button",{onClick:q,class:"back-button"}," ← Back "),e[5]||(e[5]=n("h1",null,"Word Detail",-1))]),r.value?(s(),l("div",yo,[e[6]||(e[6]=n("h2",null,"Ministry of Education Dictionary",-1)),n("div",po,[u(eo,{word:r.value,onReadChinese:V,onReadEnglish:L,onOpenEditDialog:T,onAddDefinition:E},null,8,["word"])])])):c("",!0),y.value?(s(),l("div",wo,[e[7]||(e[7]=n("h2",null,"Maryknoll Dictionary",-1)),n("div",go,[u(to,{word:y.value,onOpenEditDialog:U,onAddDefinition:E},null,8,["word"])])])):c("",!0),p.value.length>0?(s(),l("div",ko,[e[8]||(e[8]=n("h2",null,"CEDICT Dictionary",-1)),n("div",Do,[(s(!0),l(I,null,N(p.value,t=>(s(),A(no,{key:t.id,word:t,onReadChinese:V,onAddDefinition:E},null,8,["word"]))),128))])])):c("",!0),v.value.length>0?(s(),l("div",bo,[e[9]||(e[9]=n("h2",null,"Community Definitions",-1)),n("div",Co,[(s(!0),l(I,null,N(v.value,t=>(s(),A(io,{key:t.id,definition:t,onVoteSubmitted:G,onVoteUpdated:P,onVotingError:H,onLoginRequired:J},null,8,["definition"]))),128))])])):c("",!0)])):c("",!0),u(so,{visible:w.value,word:D.value,onClose:O},null,8,["visible","word"]),u(lo,{visible:g.value,word:b.value,onClose:x},null,8,["visible","word"]),u(ro,{visible:k.value,word:C.value,onClose:$,onSubmit:z},null,8,["visible","word"])]))}},Oo=X(Eo,[["__scopeId","data-v-9ecfad4b"]]);export{Oo as default};
