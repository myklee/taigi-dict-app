import{b as u,A as U,f as n,q as _,g as e,k as x,v as B,J as L,l as a,L as N,K as W,u as h,F as m,D as g,y as f,t as o,o as l,G as F,z as T}from"./vendor-C5FfeEaS.js";import{_ as K,u as q,s as z}from"./index-CmUZZITA.js";import{A as G,I as k,s as J,a as Q}from"./AudioPlayerTaigi-CWgaieRU.js";import O from"./EditWord-CQd5qnB_.js";import{L as X}from"./Loader-Cth2euVp.js";import{f as Y}from"./index-BeZKRCO5.js";import"./router-Cvbgimde.js";import"./AudioRecorder-B6379Soo.js";const Z={id:"supasearch"},ee={class:"search-header"},se={class:"search-words"},ie=["placeholder"],le={class:"search-options"},te={class:"search-mode-container"},ne={class:"exact-search-container"},ae={key:0,class:"search-history"},oe={class:"search-history-header"},re={class:"moe-search-results-header search-results-header"},ce={key:0,class:"results-count"},ue={key:0},he={key:0,class:"phonetic-hint"},de={key:1,class:"results moe-results"},pe={key:0,class:"moe-title"},ve=["src"],ye={class:"moe-english-chinese"},me={key:0,class:"word-item moe-word-chinese logographic"},_e={class:""},ge={class:"pinyin-zhuyin"},fe={class:"pinyin"},ke={class:"zhuyin"},Ce={key:1,class:"word-item moe-word-english alphabetic"},be={class:"alphabetic"},Se={class:"logographic"},Ee=["onClick"],$e={key:2,class:"results-cedict"},xe={key:0,class:"cedict-traditional"},Te={key:1,class:"cedict-traditional"},we={class:"pinyin-zhuyin cedict-pinyin-zhuyin"},ze={class:"cedict-pinyin pinyin"},De={class:"cedict-zhuyin zhuyin"},je={class:"cedict-english"},He={__name:"SearchHistory",setup(Ie){const D=u([]),v=u([]),d=u(""),C=u(!1),p=u("all"),w=u(null),b=u(!1);u({partofspeech:"",def_english:"",def_chinese:""});const S=u(!1),E=u(!1);u([]);const r=q();U(()=>{r.loadFromIndexedDB()});const j=()=>{d.value="",D.value=[],v.value=[],E.value=!1,r.searchResults=[]},H=t=>{console.log(t),b.value=!0,document.body.style.overflow="hidden",w.value={...t,definitions:t.definitions||[]}},I=()=>{b.value=!1,document.body.style.overflow="scroll"},R=async()=>{y()},y=async()=>{if(d.value.length!=0)try{r.addToHistory(d.value),S.value=!0,E.value=!0;const t=C.value?d.value:`%${d.value}%`;let i=z.from("words").select("id, english, chinese, romaji, audioid, pinyin, zhuyin, taiwanese, audio_url, english_mknoll, definitions (defid, def_english, def_chinese)");switch(p.value){case"phonetic":i=i.or(`romaji.ilike.${t}`);break;case"chinese":i=i.or(`chinese.ilike.${t}`);break;case"english":i=i.or(`english.ilike.${t},english_mknoll.ilike.${t}`);break;default:i=i.or(`chinese.ilike.${t},english.ilike.${t},english_mknoll.ilike.${t},romaji.ilike.${t},taiwanese.ilike.${t}`)}const{data:s,error:c}=await i;c?console.error("Error fetching words:",c.message):r.setSearchResults(s),p.value==="chinese"||p.value==="all"?P(d.value):v.value=[]}catch(t){console.error("Error in searchWords:",t.message)}finally{S.value=!1}else console.log("empty search field!")},P=async t=>{try{const{data:i,error:s}=await z.rpc("search_words_cedict",{search_term:t});return s?(console.error("Error fetching search results:",s.message),[]):(v.value=i,console.log("Search results:",i),i)}catch(i){return console.error("Unexpected error:",i),[]}},$=t=>J(t),V=t=>Q(t),A=()=>{switch(p.value){case"phonetic":return"Search phonetic (Taiwanese romanization) · 台羅搜尋";case"chinese":return"Search Chinese characters · 中文搜尋";case"english":return"Search English · 英文搜尋";default:return"Search English, Chinese, Taiwanese · 中文或英文搜尋"}};return(t,i)=>(l(),n(m,null,[_(X,{loading:S.value},null,8,["loading"]),e("div",Z,[e("div",ee,[e("div",se,[x(e("input",{type:"text","onUpdate:modelValue":i[0]||(i[0]=s=>d.value=s),onKeyup:L(y,["enter"]),placeholder:A(),class:"text-field search-words-text-field",autocapitalize:"off"},null,40,ie),[[B,d.value]]),d.value.length>0?(l(),n("button",{key:0,class:"clear-search",onClick:j},i[5]||(i[5]=[e("span",{class:"visually-hidden"},"Clear",-1)]))):a("",!0)]),e("div",le,[e("div",te,[i[7]||(i[7]=e("label",{for:"search-mode"},"Search mode:",-1)),x(e("select",{id:"search-mode","onUpdate:modelValue":i[1]||(i[1]=s=>p.value=s),onChange:y,class:"search-mode-select"},i[6]||(i[6]=[e("option",{value:"all"},"All (English, Chinese, Taiwanese)",-1),e("option",{value:"phonetic"},"Phonetic (Taiwanese romanization)",-1),e("option",{value:"chinese"},"Chinese characters",-1),e("option",{value:"english"},"English",-1)]),544),[[N,p.value]])]),e("div",ne,[x(e("input",{id:"exact-search",type:"checkbox","onUpdate:modelValue":i[2]||(i[2]=s=>C.value=s),onChange:y},null,544),[[W,C.value]]),i[8]||(i[8]=e("label",{for:"exact-search"},"Exact Search",-1))]),e("div",{class:"search-actions"},[e("button",{class:"search-button",onClick:y},"Search")])]),h(r).searchHistory.length>0?(l(),n("div",ae,[e("div",oe,[i[9]||(i[9]=e("h3",null,"Search History",-1)),e("button",{class:"search-history-trash",onClick:i[3]||(i[3]=(...s)=>h(r).clearSearchHistory&&h(r).clearSearchHistory(...s))}," Clear search history ")]),e("ul",null,[(l(!0),n(m,null,g(h(r).searchHistory,(s,c)=>(l(),n("li",{key:c},o(s.term),1))),128))])])):a("",!0),e("div",re,[E.value?(l(),n("div",ce,[f(o(h(r).searchResults.length)+" result",1),h(r).searchResults.length!=1?(l(),n("span",ue,"s")):a("",!0),i[10]||(i[10]=f(" found "))])):a("",!0)])]),p.value==="phonetic"?(l(),n("section",he,i[11]||(i[11]=[e("div",{class:"hint-content"},[e("p",null,[f("💡 "),e("strong",null,"Phonetic Search Tips:")]),e("ul",null,[e("li",null,'Use Taiwanese romanization (Tâi-lô) like "tshuē" for 搜'),e("li",null,'Try partial matches: "tsh" will find words starting with "tsh"'),e("li",null,'Common patterns: "a̍" (a with dot below), "o͘" (o with dot above)')])],-1)]))):a("",!0),h(r).searchResults.length!=0?(l(),n("ul",de,[e("li",null,[h(r).searchResults.length?(l(),n("div",pe,i[12]||(i[12]=[e("div",null,"Ministry of Education Taiwanese Dictionary of Common Words",-1),e("div",null,"教育部臺灣台語常用詞辭典",-1)]))):a("",!0)]),(l(!0),n(m,null,g(h(r).searchResults,s=>(l(),n("li",{key:s.id,class:"entry moe-result-item"},[s.romaji!=null?(l(),n("div",{key:0,class:F(["word-item","moe-word-taigi","alphabetic",{"phonetic-highlight":p.value==="phonetic"}])},[e("p",null,o(s.romaji),1),s.audio_url?(l(),n("audio",{key:0,ref_for:!0,ref:"audio",src:`${s.audio_url}`,controls:""},null,8,ve)):a("",!0),s.audioid?(l(),T(G,{key:1,audioID:s.audioid},null,8,["audioID"])):a("",!0)],2)):a("",!0),e("div",ye,[s.chinese!=null?(l(),n("div",me,[e("span",_e,o(s.chinese),1),e("div",ge,[e("span",fe,o(t.pinyin(s.chinese).join(" ")),1),e("span",ke,o(s.zhuyin),1)]),_(k,{onClick:c=>$(s.chinese)},null,8,["onClick"])])):a("",!0),s.english!=null?(l(),n("div",Ce,[f(o(s.english)+" ",1),_(k,{onClick:c=>V(s.english)},null,8,["onClick"])])):a("",!0)]),e("ul",null,[(l(!0),n(m,null,g(s.definitions,c=>(l(),n("li",{key:c.id},[e("ul",null,[e("li",be,o(c.def_english),1),e("li",Se,o(c.def_chinese),1)])]))),128))]),e("button",{class:"edit-word",onClick:c=>H(s)}," Edit word ",8,Ee)]))),128))])):a("",!0),v.value.length?(l(),n("ul",$e,[i[13]||(i[13]=e("h2",{class:"section-header cedict-header"}," CC-CEDICT (Creative Commons Chinese English Dictionary) ",-1)),(l(!0),n(m,null,g(v.value,(s,c)=>(l(),n("li",{class:"cedict-item",key:c},[s.traditional!=null?(l(),n("p",xe,o(s.traditional),1)):a("",!0),s.traditional===null?(l(),n("p",Te,o(s.chinese),1)):a("",!0),s.traditional?(l(),T(k,{key:2,onClick:M=>$(s.traditional)},null,8,["onClick"])):a("",!0),s.traditional===null&&s.chinese!=null?(l(),T(k,{key:3,onClick:M=>$(s.chinese)},null,8,["onClick"])):a("",!0),e("div",we,[e("p",ze,o(t.pinyin(s.traditional).join(" ")),1),e("p",De,o(h(Y)(t.pinyin(s.traditional).join(" ")).join(" ")),1)]),e("p",je,o(s.english_cedict),1)]))),128))])):a("",!0),_(O,{visible:b.value,word:w.value,onClose:i[4]||(i[4]=s=>I()),onWordUpdated:R},null,8,["visible","word"])])],64))}},Ne=K(He,[["__scopeId","data-v-71fb1e36"]]);export{Ne as default};
