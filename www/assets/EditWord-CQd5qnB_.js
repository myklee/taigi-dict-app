import{b as w,f as m,q as y,l as v,g as o,j as g,k as a,v as f,F as j,D as C,o as p}from"./vendor-C5FfeEaS.js";import{_ as S,s as u}from"./index-CmUZZITA.js";import{A}from"./AudioRecorder-B6379Soo.js";import{L as W}from"./Loader-Cth2euVp.js";import"./router-Cvbgimde.js";const $={key:0,class:"edit-dialog"},B={class:"edit-moe-word"},q={class:"edit-moe-word edit-romaji"},I={class:"edit-moe-word edit-english"},L={class:"edit-moe-word edit-chinese"},N={class:"edit-moe-word edit-classification"},F={key:1,class:"edit-definitions-list"},M=["onSubmit"],P={class:"edit-def edit-english-def"},R=["onUpdate:modelValue"],O={class:"edit-chinese-def"},T=["onUpdate:modelValue"],z=["onUpdate:modelValue"],G=["onClick"],H={class:"add-definition"},J={class:"add-partofspeech"},K={class:"add-def-english"},Q={class:"add-def-chinese"},X={__name:"EditWord",props:{visible:Boolean,word:Object},emits:["close","update-word","update-definition","delete-definition","add-definition"],setup(t,{emit:b}){const c=t,n=w(!1),h=b,r=w({partofspeech:"",def_english:"",def_chinese:""}),D=()=>h("close"),V=async(d,e)=>{n.value=!0;const{data:i,error:s}=await u.from("words").upsert({id:d.id,chinese:d.chinese,romaji:d.romaji,classification:d.classification,english:d.english});s?(console.error("Error updating word:",s.message),n.value=!1):(console.log("Word updated successfully:",i),n.value=!1,h("word-updated",d))},E=async(d,e)=>{n.value=!0;try{const i=c.word.definitions[e],{data:s,error:l}=await u.from("definitions").upsert({defid:d,wordid:c.word.id,partofspeech:i.partofspeech,def_english:i.def_english,def_chinese:i.def_chinese});console.log("Definition updated successfully:",s)}catch(i){console.error("Error updating definition:",i.message)}finally{n.value=!1}},x=async(d,e)=>{n.value=!0;try{const{error:i}=await u.storage.from("audio-files").remove([e]);if(i)throw i;await u.from("words").update({audio_url:null}).eq("id",d),c.word.audio_url=null,console.log("Audio deleted successfully!")}catch(i){console.error("Error deleting audio:",i)}finally{n.value=!1}},U=async(d,e)=>{n.value=!0;try{const{data:i,error:s}=await u.from("definitions").delete().eq("defid",d);if(s){console.error("Error deleting definition:",s.message),n.value=!1;return}c.word.definitions.splice(e,1),console.log("Definition deleted successfully:",i)}catch(i){console.error("Error in deleteDefinition:",i.message)}finally{n.value=!1}},k=async d=>{n.value=!1;try{const e={wordid:d,partofspeech:r.value.partofspeech,def_english:r.value.def_english,def_chinese:r.value.def_chinese},{data:i,error:s}=await u.from("definitions").insert([e]).select();if(s){console.error("Error adding definition:",s.message),n.value=!1;return}if(i&&i.length>0){const l=i[0];c.word.definitions.push(l),r.value={partofspeech:"",def_english:"",def_chinese:""},console.log("Definition added successfully:",l)}}catch(e){console.error("Error in addDefinition:",e.message)}finally{n.value=!1}};return(d,e)=>t.visible?(p(),m("div",$,[y(W,{loading:n.value},null,8,["loading"]),y(A,{wordId:t.word.id},null,8,["wordId"]),t.word.audio_url?(p(),m("button",{key:0,onClick:e[0]||(e[0]=i=>x(t.word.id,t.word.audio_url))}," Delete Audio ")):v("",!0),o("button",{class:"close-dialog",onClick:D},"Close"),o("div",B,[o("form",{onSubmit:e[5]||(e[5]=g(i=>V(t.word,d.index),["prevent"]))},[o("div",q,[e[10]||(e[10]=o("label",{for:"romaji"},"Romaji",-1)),a(o("input",{"onUpdate:modelValue":e[1]||(e[1]=i=>t.word.romaji=i),type:"text",id:"romaji"},null,512),[[f,t.word.romaji]])]),o("div",I,[e[11]||(e[11]=o("label",{for:"english"},"English",-1)),a(o("input",{"onUpdate:modelValue":e[2]||(e[2]=i=>t.word.english=i),type:"text",id:"english"},null,512),[[f,t.word.english]])]),o("div",L,[e[12]||(e[12]=o("label",{for:"chinese"},"Chinese",-1)),a(o("input",{"onUpdate:modelValue":e[3]||(e[3]=i=>t.word.chinese=i),type:"text",id:"chinese"},null,512),[[f,t.word.chinese]])]),o("div",N,[e[13]||(e[13]=o("label",{for:"classification"},"Classification:",-1)),a(o("input",{"onUpdate:modelValue":e[4]||(e[4]=i=>t.word.classification=i),type:"text",id:"classification"},null,512),[[f,t.word.classification]])]),e[14]||(e[14]=o("button",{type:"submit"},"Save Word",-1))],32)]),t.word.definitions.length>0?(p(),m("div",F,[(p(!0),m(j,null,C(t.word.definitions,(i,s)=>(p(),m("div",{key:i.defid,class:"edit-definition-container"},[o("form",{onSubmit:g(l=>E(i.defid,s),["prevent"])},[o("div",P,[e[15]||(e[15]=o("label",{for:"def_english"},"English Definition:",-1)),a(o("textarea",{"onUpdate:modelValue":l=>i.def_english=l,id:"def_english"},null,8,R),[[f,i.def_english]])]),o("div",O,[e[16]||(e[16]=o("label",{for:"def_chinese"},"Chinese Definition:",-1)),a(o("input",{"onUpdate:modelValue":l=>i.def_chinese=l,type:"text",id:"def_chinese"},null,8,T),[[f,i.def_chinese]])]),o("div",null,[e[17]||(e[17]=o("label",{for:"partofspeech"},"Part of Speech:",-1)),a(o("input",{"onUpdate:modelValue":l=>i.partofspeech=l,type:"text",id:"partofspeech"},null,8,z),[[f,i.partofspeech]])]),e[18]||(e[18]=o("button",{type:"submit"},"Save Definition",-1)),o("button",{type:"button",onClick:l=>U(i.defid,s)}," Delete Definition ",8,G)],40,M)]))),128))])):v("",!0),o("div",H,[e[23]||(e[23]=o("h4",null,"Add a new definition",-1)),o("form",{onSubmit:e[9]||(e[9]=g(i=>k(t.word.id),["prevent"]))},[o("div",J,[e[19]||(e[19]=o("label",{for:"partofspeech"},"Part of Speech:",-1)),a(o("input",{"onUpdate:modelValue":e[6]||(e[6]=i=>r.value.partofspeech=i),id:"partofspeech"},null,512),[[f,r.value.partofspeech]])]),o("div",K,[e[20]||(e[20]=o("label",{for:"def_english"},"English Definition:",-1)),a(o("textarea",{"onUpdate:modelValue":e[7]||(e[7]=i=>r.value.def_english=i),id:"def_english"},null,512),[[f,r.value.def_english]])]),o("div",Q,[e[21]||(e[21]=o("label",{for:"def_chinese"},"Chinese Definition:",-1)),a(o("textarea",{"onUpdate:modelValue":e[8]||(e[8]=i=>r.value.def_chinese=i),id:"def_chinese"},null,512),[[f,r.value.def_chinese]])]),e[22]||(e[22]=o("button",{type:"submit"},"Add Definition",-1))],32)])])):v("",!0)}},oe=S(X,[["__scopeId","data-v-4bffbed1"]]);export{oe as default};
