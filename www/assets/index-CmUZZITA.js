const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/DictionarySearch-C9fa7WW8.js","assets/vendor-C5FfeEaS.js","assets/router-Cvbgimde.js","assets/AudioPlayerTaigi-CWgaieRU.js","assets/AudioPlayerTaigi-BkLThubU.css","assets/Loader-Cth2euVp.js","assets/Loader-P9c-VOF0.css","assets/EditWord-CQd5qnB_.js","assets/AudioRecorder-B6379Soo.js","assets/EditWord-CvnThwJ8.css","assets/EditWordMknoll-CsFCvzmE.js","assets/EditWordMknoll-BW8b4lda.css","assets/RandomWord-DOE8s4vb.js","assets/pinyin-web-Brx8g6kF.js","assets/IconEdit-BhSTa8nK.js","assets/favoritesStore-CTEzz-4U.js","assets/favoritesStore-DfSyOp3O.css","assets/RandomWord-CyaIL0WO.css","assets/CommunityDefinitionCard-nk4ta4ay.js","assets/Pinyinzhuyin-aFsnSd4o.js","assets/index-BeZKRCO5.js","assets/CommunityDefinitionCard-BgDdwj7V.css","assets/CommunityDefinitionForm-DxlPrvZz.js","assets/CommunityDefinitionForm-Boa6uocu.css","assets/DictionarySearch-BQ5q7UN6.css","assets/WordDetail-B5uxwNpk.js","assets/WordDetail-CkFH9wO1.css","assets/ComparisonTable-Bu_aFAvO.js","assets/UserProfile-Bncy3LLl.js","assets/UserProfile-CHqU70fQ.css","assets/Favorites-B9oakTXc.js","assets/Favorites-DQ774uSx.css","assets/SearchHistory-CLPnVaVq.js","assets/SearchHistory-BaiDriZc.css","assets/AdminDashboard-Dqv7CwZA.js","assets/CommunityModerationPanel-CjBc-mqK.js","assets/CommunityModerationPanel-DzmrpWC8.css","assets/UserManagementPanel-CISrlDwJ.js","assets/UserManagementPanel-DFQ2mjDm.css","assets/AdminDashboard-BiM7mygP.css","assets/CommunitySubmissionManager-Bf9w2zJs.js","assets/CommunitySubmissionManager-DacL3Nfg.css","assets/NotFound-CLjgmdCf.js","assets/NotFound-9O1DKwV0.css"])))=>i.map(i=>d[i]);
import{e as as,b as ze,c as ot,w as su,o as Me,f as Ke,g as ie,t as br,j as In,k as vr,v as gr,u as Je,l as Jt,m as Ui,q as qn,x as Js,y as Ys,z as iu,A as au,F as uu,B as cu,C as lu}from"./vendor-C5FfeEaS.js";import{c as du,a as hu}from"./router-Cvbgimde.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const c of a.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&n(c)}).observe(document,{childList:!0,subtree:!0});function r(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerPolicy&&(a.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?a.credentials="include":s.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(s){if(s.ep)return;s.ep=!0;const a=r(s);fetch(s.href,a)}})();const fu="modulepreload",pu=function(t){return"/"+t},Qs={},$e=function(e,r,n){let s=Promise.resolve();if(r&&r.length>0){document.getElementsByTagName("link");const c=document.querySelector("meta[property=csp-nonce]"),h=(c==null?void 0:c.nonce)||(c==null?void 0:c.getAttribute("nonce"));s=Promise.allSettled(r.map(p=>{if(p=pu(p),p in Qs)return;Qs[p]=!0;const v=p.endsWith(".css"),_=v?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${p}"]${_}`))return;const I=document.createElement("link");if(I.rel=v?"stylesheet":fu,v||(I.as="script"),I.crossOrigin="",I.href=p,h&&I.setAttribute("nonce",h),document.head.appendChild(I),v)return new Promise((U,q)=>{I.addEventListener("load",U),I.addEventListener("error",()=>q(new Error(`Unable to preload CSS for ${p}`)))})}))}function a(c){const h=new Event("vite:preloadError",{cancelable:!0});if(h.payload=c,window.dispatchEvent(h),!h.defaultPrevented)throw c}return s.then(c=>{for(const h of c||[])h.status==="rejected"&&a(h.reason);return e().catch(a)})},mu=t=>{let e;return t?e=t:typeof fetch>"u"?e=(...r)=>$e(async()=>{const{default:n}=await Promise.resolve().then(()=>Sr);return{default:n}},void 0).then(({default:n})=>n(...r)):e=fetch,(...r)=>e(...r)};class us extends Error{constructor(e,r="FunctionsError",n){super(e),this.name=r,this.context=n}}class vu extends us{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class gu extends us{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class yu extends us{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var Go;(function(t){t.Any="any",t.ApNortheast1="ap-northeast-1",t.ApNortheast2="ap-northeast-2",t.ApSouth1="ap-south-1",t.ApSoutheast1="ap-southeast-1",t.ApSoutheast2="ap-southeast-2",t.CaCentral1="ca-central-1",t.EuCentral1="eu-central-1",t.EuWest1="eu-west-1",t.EuWest2="eu-west-2",t.EuWest3="eu-west-3",t.SaEast1="sa-east-1",t.UsEast1="us-east-1",t.UsWest1="us-west-1",t.UsWest2="us-west-2"})(Go||(Go={}));var _u=function(t,e,r,n){function s(a){return a instanceof r?a:new r(function(c){c(a)})}return new(r||(r=Promise))(function(a,c){function h(_){try{v(n.next(_))}catch(I){c(I)}}function p(_){try{v(n.throw(_))}catch(I){c(I)}}function v(_){_.done?a(_.value):s(_.value).then(h,p)}v((n=n.apply(t,e||[])).next())})};class wu{constructor(e,{headers:r={},customFetch:n,region:s=Go.Any}={}){this.url=e,this.headers=r,this.region=s,this.fetch=mu(n)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e,r={}){var n;return _u(this,void 0,void 0,function*(){try{const{headers:s,method:a,body:c}=r;let h={},{region:p}=r;p||(p=this.region),p&&p!=="any"&&(h["x-region"]=p);let v;c&&(s&&!Object.prototype.hasOwnProperty.call(s,"Content-Type")||!s)&&(typeof Blob<"u"&&c instanceof Blob||c instanceof ArrayBuffer?(h["Content-Type"]="application/octet-stream",v=c):typeof c=="string"?(h["Content-Type"]="text/plain",v=c):typeof FormData<"u"&&c instanceof FormData?v=c:(h["Content-Type"]="application/json",v=JSON.stringify(c)));const _=yield this.fetch(`${this.url}/${e}`,{method:a||"POST",headers:Object.assign(Object.assign(Object.assign({},h),this.headers),s),body:v}).catch(G=>{throw new vu(G)}),I=_.headers.get("x-relay-error");if(I&&I==="true")throw new gu(_);if(!_.ok)throw new yu(_);let U=((n=_.headers.get("Content-Type"))!==null&&n!==void 0?n:"text/plain").split(";")[0].trim(),q;return U==="application/json"?q=yield _.json():U==="application/octet-stream"?q=yield _.blob():U==="text/event-stream"?q=_:U==="multipart/form-data"?q=yield _.formData():q=yield _.text(),{data:q,error:null}}catch(s){return{data:null,error:s}}})}}var et=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function bu(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function ku(t){if(t.__esModule)return t;var e=t.default;if(typeof e=="function"){var r=function n(){return this instanceof n?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};r.prototype=e.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(t).forEach(function(n){var s=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(r,n,s.get?s:{enumerable:!0,get:function(){return t[n]}})}),r}var Xe={},cs={},Kn={},Yr={},Wn={},Hn={},Eu=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},Er=Eu();const Ou=Er.fetch,Ni=Er.fetch.bind(Er),Fi=Er.Headers,Su=Er.Request,Au=Er.Response,Sr=Object.freeze(Object.defineProperty({__proto__:null,Headers:Fi,Request:Su,Response:Au,default:Ni,fetch:Ou},Symbol.toStringTag,{value:"Module"})),Tu=ku(Sr);var Gn={};Object.defineProperty(Gn,"__esModule",{value:!0});class xu extends Error{constructor(e){super(e.message),this.name="PostgrestError",this.details=e.details,this.hint=e.hint,this.code=e.code}}Gn.default=xu;var Li=et&&et.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(Hn,"__esModule",{value:!0});const Pu=Li(Tu),Ru=Li(Gn);let Iu=class{constructor(e){this.shouldThrowOnError=!1,this.method=e.method,this.url=e.url,this.headers=e.headers,this.schema=e.schema,this.body=e.body,this.shouldThrowOnError=e.shouldThrowOnError,this.signal=e.signal,this.isMaybeSingle=e.isMaybeSingle,e.fetch?this.fetch=e.fetch:typeof fetch>"u"?this.fetch=Pu.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(e,r){return this.headers=Object.assign({},this.headers),this.headers[e]=r,this}then(e,r){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),this.method!=="GET"&&this.method!=="HEAD"&&(this.headers["Content-Type"]="application/json");const n=this.fetch;let s=n(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async a=>{var c,h,p;let v=null,_=null,I=null,U=a.status,q=a.statusText;if(a.ok){if(this.method!=="HEAD"){const oe=await a.text();oe===""||(this.headers.Accept==="text/csv"||this.headers.Accept&&this.headers.Accept.includes("application/vnd.pgrst.plan+text")?_=oe:_=JSON.parse(oe))}const F=(c=this.headers.Prefer)===null||c===void 0?void 0:c.match(/count=(exact|planned|estimated)/),V=(h=a.headers.get("content-range"))===null||h===void 0?void 0:h.split("/");F&&V&&V.length>1&&(I=parseInt(V[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(_)&&(_.length>1?(v={code:"PGRST116",details:`Results contain ${_.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},_=null,I=null,U=406,q="Not Acceptable"):_.length===1?_=_[0]:_=null)}else{const F=await a.text();try{v=JSON.parse(F),Array.isArray(v)&&a.status===404&&(_=[],v=null,U=200,q="OK")}catch{a.status===404&&F===""?(U=204,q="No Content"):v={message:F}}if(v&&this.isMaybeSingle&&(!((p=v==null?void 0:v.details)===null||p===void 0)&&p.includes("0 rows"))&&(v=null,U=200,q="OK"),v&&this.shouldThrowOnError)throw new Ru.default(v)}return{error:v,data:_,count:I,status:U,statusText:q}});return this.shouldThrowOnError||(s=s.catch(a=>{var c,h,p;return{error:{message:`${(c=a==null?void 0:a.name)!==null&&c!==void 0?c:"FetchError"}: ${a==null?void 0:a.message}`,details:`${(h=a==null?void 0:a.stack)!==null&&h!==void 0?h:""}`,hint:"",code:`${(p=a==null?void 0:a.code)!==null&&p!==void 0?p:""}`},data:null,count:null,status:0,statusText:""}})),s.then(e,r)}};Hn.default=Iu;var $u=et&&et.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(Wn,"__esModule",{value:!0});const Du=$u(Hn);let Cu=class extends Du.default{select(e){let r=!1;const n=(e??"*").split("").map(s=>/\s/.test(s)&&!r?"":(s==='"'&&(r=!r),s)).join("");return this.url.searchParams.set("select",n),this.headers.Prefer&&(this.headers.Prefer+=","),this.headers.Prefer+="return=representation",this}order(e,{ascending:r=!0,nullsFirst:n,foreignTable:s,referencedTable:a=s}={}){const c=a?`${a}.order`:"order",h=this.url.searchParams.get(c);return this.url.searchParams.set(c,`${h?`${h},`:""}${e}.${r?"asc":"desc"}${n===void 0?"":n?".nullsfirst":".nullslast"}`),this}limit(e,{foreignTable:r,referencedTable:n=r}={}){const s=typeof n>"u"?"limit":`${n}.limit`;return this.url.searchParams.set(s,`${e}`),this}range(e,r,{foreignTable:n,referencedTable:s=n}={}){const a=typeof s>"u"?"offset":`${s}.offset`,c=typeof s>"u"?"limit":`${s}.limit`;return this.url.searchParams.set(a,`${e}`),this.url.searchParams.set(c,`${r-e+1}`),this}abortSignal(e){return this.signal=e,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return this.method==="GET"?this.headers.Accept="application/json":this.headers.Accept="application/vnd.pgrst.object+json",this.isMaybeSingle=!0,this}csv(){return this.headers.Accept="text/csv",this}geojson(){return this.headers.Accept="application/geo+json",this}explain({analyze:e=!1,verbose:r=!1,settings:n=!1,buffers:s=!1,wal:a=!1,format:c="text"}={}){var h;const p=[e?"analyze":null,r?"verbose":null,n?"settings":null,s?"buffers":null,a?"wal":null].filter(Boolean).join("|"),v=(h=this.headers.Accept)!==null&&h!==void 0?h:"application/json";return this.headers.Accept=`application/vnd.pgrst.plan+${c}; for="${v}"; options=${p};`,c==="json"?this:this}rollback(){var e;return((e=this.headers.Prefer)!==null&&e!==void 0?e:"").trim().length>0?this.headers.Prefer+=",tx=rollback":this.headers.Prefer="tx=rollback",this}returns(){return this}};Wn.default=Cu;var ju=et&&et.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(Yr,"__esModule",{value:!0});const zu=ju(Wn);let Uu=class extends zu.default{eq(e,r){return this.url.searchParams.append(e,`eq.${r}`),this}neq(e,r){return this.url.searchParams.append(e,`neq.${r}`),this}gt(e,r){return this.url.searchParams.append(e,`gt.${r}`),this}gte(e,r){return this.url.searchParams.append(e,`gte.${r}`),this}lt(e,r){return this.url.searchParams.append(e,`lt.${r}`),this}lte(e,r){return this.url.searchParams.append(e,`lte.${r}`),this}like(e,r){return this.url.searchParams.append(e,`like.${r}`),this}likeAllOf(e,r){return this.url.searchParams.append(e,`like(all).{${r.join(",")}}`),this}likeAnyOf(e,r){return this.url.searchParams.append(e,`like(any).{${r.join(",")}}`),this}ilike(e,r){return this.url.searchParams.append(e,`ilike.${r}`),this}ilikeAllOf(e,r){return this.url.searchParams.append(e,`ilike(all).{${r.join(",")}}`),this}ilikeAnyOf(e,r){return this.url.searchParams.append(e,`ilike(any).{${r.join(",")}}`),this}is(e,r){return this.url.searchParams.append(e,`is.${r}`),this}in(e,r){const n=Array.from(new Set(r)).map(s=>typeof s=="string"&&new RegExp("[,()]").test(s)?`"${s}"`:`${s}`).join(",");return this.url.searchParams.append(e,`in.(${n})`),this}contains(e,r){return typeof r=="string"?this.url.searchParams.append(e,`cs.${r}`):Array.isArray(r)?this.url.searchParams.append(e,`cs.{${r.join(",")}}`):this.url.searchParams.append(e,`cs.${JSON.stringify(r)}`),this}containedBy(e,r){return typeof r=="string"?this.url.searchParams.append(e,`cd.${r}`):Array.isArray(r)?this.url.searchParams.append(e,`cd.{${r.join(",")}}`):this.url.searchParams.append(e,`cd.${JSON.stringify(r)}`),this}rangeGt(e,r){return this.url.searchParams.append(e,`sr.${r}`),this}rangeGte(e,r){return this.url.searchParams.append(e,`nxl.${r}`),this}rangeLt(e,r){return this.url.searchParams.append(e,`sl.${r}`),this}rangeLte(e,r){return this.url.searchParams.append(e,`nxr.${r}`),this}rangeAdjacent(e,r){return this.url.searchParams.append(e,`adj.${r}`),this}overlaps(e,r){return typeof r=="string"?this.url.searchParams.append(e,`ov.${r}`):this.url.searchParams.append(e,`ov.{${r.join(",")}}`),this}textSearch(e,r,{config:n,type:s}={}){let a="";s==="plain"?a="pl":s==="phrase"?a="ph":s==="websearch"&&(a="w");const c=n===void 0?"":`(${n})`;return this.url.searchParams.append(e,`${a}fts${c}.${r}`),this}match(e){return Object.entries(e).forEach(([r,n])=>{this.url.searchParams.append(r,`eq.${n}`)}),this}not(e,r,n){return this.url.searchParams.append(e,`not.${r}.${n}`),this}or(e,{foreignTable:r,referencedTable:n=r}={}){const s=n?`${n}.or`:"or";return this.url.searchParams.append(s,`(${e})`),this}filter(e,r,n){return this.url.searchParams.append(e,`${r}.${n}`),this}};Yr.default=Uu;var Nu=et&&et.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(Kn,"__esModule",{value:!0});const Mr=Nu(Yr);let Fu=class{constructor(e,{headers:r={},schema:n,fetch:s}){this.url=e,this.headers=r,this.schema=n,this.fetch=s}select(e,{head:r=!1,count:n}={}){const s=r?"HEAD":"GET";let a=!1;const c=(e??"*").split("").map(h=>/\s/.test(h)&&!a?"":(h==='"'&&(a=!a),h)).join("");return this.url.searchParams.set("select",c),n&&(this.headers.Prefer=`count=${n}`),new Mr.default({method:s,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}insert(e,{count:r,defaultToNull:n=!0}={}){const s="POST",a=[];if(this.headers.Prefer&&a.push(this.headers.Prefer),r&&a.push(`count=${r}`),n||a.push("missing=default"),this.headers.Prefer=a.join(","),Array.isArray(e)){const c=e.reduce((h,p)=>h.concat(Object.keys(p)),[]);if(c.length>0){const h=[...new Set(c)].map(p=>`"${p}"`);this.url.searchParams.set("columns",h.join(","))}}return new Mr.default({method:s,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}upsert(e,{onConflict:r,ignoreDuplicates:n=!1,count:s,defaultToNull:a=!0}={}){const c="POST",h=[`resolution=${n?"ignore":"merge"}-duplicates`];if(r!==void 0&&this.url.searchParams.set("on_conflict",r),this.headers.Prefer&&h.push(this.headers.Prefer),s&&h.push(`count=${s}`),a||h.push("missing=default"),this.headers.Prefer=h.join(","),Array.isArray(e)){const p=e.reduce((v,_)=>v.concat(Object.keys(_)),[]);if(p.length>0){const v=[...new Set(p)].map(_=>`"${_}"`);this.url.searchParams.set("columns",v.join(","))}}return new Mr.default({method:c,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}update(e,{count:r}={}){const n="PATCH",s=[];return this.headers.Prefer&&s.push(this.headers.Prefer),r&&s.push(`count=${r}`),this.headers.Prefer=s.join(","),new Mr.default({method:n,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}delete({count:e}={}){const r="DELETE",n=[];return e&&n.push(`count=${e}`),this.headers.Prefer&&n.unshift(this.headers.Prefer),this.headers.Prefer=n.join(","),new Mr.default({method:r,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}};Kn.default=Fu;var Jn={},Yn={};Object.defineProperty(Yn,"__esModule",{value:!0});Yn.version=void 0;Yn.version="0.0.0-automated";Object.defineProperty(Jn,"__esModule",{value:!0});Jn.DEFAULT_HEADERS=void 0;const Lu=Yn;Jn.DEFAULT_HEADERS={"X-Client-Info":`postgrest-js/${Lu.version}`};var Mi=et&&et.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(cs,"__esModule",{value:!0});const Mu=Mi(Kn),qu=Mi(Yr),Bu=Jn;let Zu=class qi{constructor(e,{headers:r={},schema:n,fetch:s}={}){this.url=e,this.headers=Object.assign(Object.assign({},Bu.DEFAULT_HEADERS),r),this.schemaName=n,this.fetch=s}from(e){const r=new URL(`${this.url}/${e}`);return new Mu.default(r,{headers:Object.assign({},this.headers),schema:this.schemaName,fetch:this.fetch})}schema(e){return new qi(this.url,{headers:this.headers,schema:e,fetch:this.fetch})}rpc(e,r={},{head:n=!1,get:s=!1,count:a}={}){let c;const h=new URL(`${this.url}/rpc/${e}`);let p;n||s?(c=n?"HEAD":"GET",Object.entries(r).filter(([_,I])=>I!==void 0).map(([_,I])=>[_,Array.isArray(I)?`{${I.join(",")}}`:`${I}`]).forEach(([_,I])=>{h.searchParams.append(_,I)})):(c="POST",p=r);const v=Object.assign({},this.headers);return a&&(v.Prefer=`count=${a}`),new qu.default({method:c,url:h,headers:v,schema:this.schemaName,body:p,fetch:this.fetch,allowEmpty:!1})}};cs.default=Zu;var Ar=et&&et.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(Xe,"__esModule",{value:!0});Xe.PostgrestError=Xe.PostgrestBuilder=Xe.PostgrestTransformBuilder=Xe.PostgrestFilterBuilder=Xe.PostgrestQueryBuilder=Xe.PostgrestClient=void 0;const Bi=Ar(cs);Xe.PostgrestClient=Bi.default;const Zi=Ar(Kn);Xe.PostgrestQueryBuilder=Zi.default;const Vi=Ar(Yr);Xe.PostgrestFilterBuilder=Vi.default;const Ki=Ar(Wn);Xe.PostgrestTransformBuilder=Ki.default;const Wi=Ar(Hn);Xe.PostgrestBuilder=Wi.default;const Hi=Ar(Gn);Xe.PostgrestError=Hi.default;var Vu=Xe.default={PostgrestClient:Bi.default,PostgrestQueryBuilder:Zi.default,PostgrestFilterBuilder:Vi.default,PostgrestTransformBuilder:Ki.default,PostgrestBuilder:Wi.default,PostgrestError:Hi.default};const{PostgrestClient:Ku,PostgrestQueryBuilder:Rm,PostgrestFilterBuilder:Im,PostgrestTransformBuilder:$m,PostgrestBuilder:Dm}=Vu,Wu="2.10.7",Hu={"X-Client-Info":`realtime-js/${Wu}`},Gu="1.0.0",Gi=1e4,Ju=1e3;var kr;(function(t){t[t.connecting=0]="connecting",t[t.open=1]="open",t[t.closing=2]="closing",t[t.closed=3]="closed"})(kr||(kr={}));var nt;(function(t){t.closed="closed",t.errored="errored",t.joined="joined",t.joining="joining",t.leaving="leaving"})(nt||(nt={}));var ct;(function(t){t.close="phx_close",t.error="phx_error",t.join="phx_join",t.reply="phx_reply",t.leave="phx_leave",t.access_token="access_token"})(ct||(ct={}));var Jo;(function(t){t.websocket="websocket"})(Jo||(Jo={}));var Qt;(function(t){t.Connecting="connecting",t.Open="open",t.Closing="closing",t.Closed="closed"})(Qt||(Qt={}));class Yu{constructor(){this.HEADER_LENGTH=1}decode(e,r){return e.constructor===ArrayBuffer?r(this._binaryDecode(e)):r(typeof e=="string"?JSON.parse(e):{})}_binaryDecode(e){const r=new DataView(e),n=new TextDecoder;return this._decodeBroadcast(e,r,n)}_decodeBroadcast(e,r,n){const s=r.getUint8(1),a=r.getUint8(2);let c=this.HEADER_LENGTH+2;const h=n.decode(e.slice(c,c+s));c=c+s;const p=n.decode(e.slice(c,c+a));c=c+a;const v=JSON.parse(n.decode(e.slice(c,e.byteLength)));return{ref:null,topic:h,event:p,payload:v}}}class Ji{constructor(e,r){this.callback=e,this.timerCalc=r,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=r}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var Ee;(function(t){t.abstime="abstime",t.bool="bool",t.date="date",t.daterange="daterange",t.float4="float4",t.float8="float8",t.int2="int2",t.int4="int4",t.int4range="int4range",t.int8="int8",t.int8range="int8range",t.json="json",t.jsonb="jsonb",t.money="money",t.numeric="numeric",t.oid="oid",t.reltime="reltime",t.text="text",t.time="time",t.timestamp="timestamp",t.timestamptz="timestamptz",t.timetz="timetz",t.tsrange="tsrange",t.tstzrange="tstzrange"})(Ee||(Ee={}));const Xs=(t,e,r={})=>{var n;const s=(n=r.skipTypes)!==null&&n!==void 0?n:[];return Object.keys(e).reduce((a,c)=>(a[c]=Qu(c,t,e,s),a),{})},Qu=(t,e,r,n)=>{const s=e.find(h=>h.name===t),a=s==null?void 0:s.type,c=r[t];return a&&!n.includes(a)?Yi(a,c):Yo(c)},Yi=(t,e)=>{if(t.charAt(0)==="_"){const r=t.slice(1,t.length);return rc(e,r)}switch(t){case Ee.bool:return Xu(e);case Ee.float4:case Ee.float8:case Ee.int2:case Ee.int4:case Ee.int8:case Ee.numeric:case Ee.oid:return ec(e);case Ee.json:case Ee.jsonb:return tc(e);case Ee.timestamp:return nc(e);case Ee.abstime:case Ee.date:case Ee.daterange:case Ee.int4range:case Ee.int8range:case Ee.money:case Ee.reltime:case Ee.text:case Ee.time:case Ee.timestamptz:case Ee.timetz:case Ee.tsrange:case Ee.tstzrange:return Yo(e);default:return Yo(e)}},Yo=t=>t,Xu=t=>{switch(t){case"t":return!0;case"f":return!1;default:return t}},ec=t=>{if(typeof t=="string"){const e=parseFloat(t);if(!Number.isNaN(e))return e}return t},tc=t=>{if(typeof t=="string")try{return JSON.parse(t)}catch(e){return console.log(`JSON parse error: ${e}`),t}return t},rc=(t,e)=>{if(typeof t!="string")return t;const r=t.length-1,n=t[r];if(t[0]==="{"&&n==="}"){let a;const c=t.slice(1,r);try{a=JSON.parse("["+c+"]")}catch{a=c?c.split(","):[]}return a.map(h=>Yi(e,h))}return t},nc=t=>typeof t=="string"?t.replace(" ","T"):t,Qi=t=>{let e=t;return e=e.replace(/^ws/i,"http"),e=e.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),e.replace(/\/+$/,"")};class qo{constructor(e,r,n={},s=Gi){this.channel=e,this.event=r,this.payload=n,this.timeout=s,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,r){var n;return this._hasReceived(e)&&r((n=this.receivedResp)===null||n===void 0?void 0:n.response),this.recHooks.push({status:e,callback:r}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=r=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=r,this._matchReceive(r)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,r){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:r})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:r}){this.recHooks.filter(n=>n.status===e).forEach(n=>n.callback(r))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var ei;(function(t){t.SYNC="sync",t.JOIN="join",t.LEAVE="leave"})(ei||(ei={}));class Vr{constructor(e,r){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const n=(r==null?void 0:r.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(n.state,{},s=>{const{onJoin:a,onLeave:c,onSync:h}=this.caller;this.joinRef=this.channel._joinRef(),this.state=Vr.syncState(this.state,s,a,c),this.pendingDiffs.forEach(p=>{this.state=Vr.syncDiff(this.state,p,a,c)}),this.pendingDiffs=[],h()}),this.channel._on(n.diff,{},s=>{const{onJoin:a,onLeave:c,onSync:h}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(s):(this.state=Vr.syncDiff(this.state,s,a,c),h())}),this.onJoin((s,a,c)=>{this.channel._trigger("presence",{event:"join",key:s,currentPresences:a,newPresences:c})}),this.onLeave((s,a,c)=>{this.channel._trigger("presence",{event:"leave",key:s,currentPresences:a,leftPresences:c})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,r,n,s){const a=this.cloneDeep(e),c=this.transformState(r),h={},p={};return this.map(a,(v,_)=>{c[v]||(p[v]=_)}),this.map(c,(v,_)=>{const I=a[v];if(I){const U=_.map(V=>V.presence_ref),q=I.map(V=>V.presence_ref),G=_.filter(V=>q.indexOf(V.presence_ref)<0),F=I.filter(V=>U.indexOf(V.presence_ref)<0);G.length>0&&(h[v]=G),F.length>0&&(p[v]=F)}else h[v]=_}),this.syncDiff(a,{joins:h,leaves:p},n,s)}static syncDiff(e,r,n,s){const{joins:a,leaves:c}={joins:this.transformState(r.joins),leaves:this.transformState(r.leaves)};return n||(n=()=>{}),s||(s=()=>{}),this.map(a,(h,p)=>{var v;const _=(v=e[h])!==null&&v!==void 0?v:[];if(e[h]=this.cloneDeep(p),_.length>0){const I=e[h].map(q=>q.presence_ref),U=_.filter(q=>I.indexOf(q.presence_ref)<0);e[h].unshift(...U)}n(h,_,p)}),this.map(c,(h,p)=>{let v=e[h];if(!v)return;const _=p.map(I=>I.presence_ref);v=v.filter(I=>_.indexOf(I.presence_ref)<0),e[h]=v,s(h,v,p),v.length===0&&delete e[h]}),e}static map(e,r){return Object.getOwnPropertyNames(e).map(n=>r(n,e[n]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((r,n)=>{const s=e[n];return"metas"in s?r[n]=s.metas.map(a=>(a.presence_ref=a.phx_ref,delete a.phx_ref,delete a.phx_ref_prev,a)):r[n]=s,r},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var ti;(function(t){t.ALL="*",t.INSERT="INSERT",t.UPDATE="UPDATE",t.DELETE="DELETE"})(ti||(ti={}));var ri;(function(t){t.BROADCAST="broadcast",t.PRESENCE="presence",t.POSTGRES_CHANGES="postgres_changes",t.SYSTEM="system"})(ri||(ri={}));var ni;(function(t){t.SUBSCRIBED="SUBSCRIBED",t.TIMED_OUT="TIMED_OUT",t.CLOSED="CLOSED",t.CHANNEL_ERROR="CHANNEL_ERROR"})(ni||(ni={}));class ls{constructor(e,r={config:{}},n){this.topic=e,this.params=r,this.socket=n,this.bindings={},this.state=nt.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:""},private:!1},r.config),this.timeout=this.socket.timeout,this.joinPush=new qo(this,ct.join,this.params,this.timeout),this.rejoinTimer=new Ji(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=nt.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(s=>s.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=nt.closed,this.socket._remove(this)}),this._onError(s=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,s),this.state=nt.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=nt.errored,this.rejoinTimer.scheduleTimeout())}),this._on(ct.reply,{},(s,a)=>{this._trigger(this._replyEventName(a),s)}),this.presence=new Vr(this),this.broadcastEndpointURL=Qi(this.socket.endPoint)+"/api/broadcast",this.private=this.params.config.private||!1}subscribe(e,r=this.timeout){var n,s;if(this.socket.isConnected()||this.socket.connect(),this.joinedOnce)throw"tried to subscribe multiple times. 'subscribe' can only be called a single time per channel instance";{const{config:{broadcast:a,presence:c,private:h}}=this.params;this._onError(_=>e&&e("CHANNEL_ERROR",_)),this._onClose(()=>e&&e("CLOSED"));const p={},v={broadcast:a,presence:c,postgres_changes:(s=(n=this.bindings.postgres_changes)===null||n===void 0?void 0:n.map(_=>_.filter))!==null&&s!==void 0?s:[],private:h};this.socket.accessToken&&(p.access_token=this.socket.accessToken),this.updateJoinPayload(Object.assign({config:v},p)),this.joinedOnce=!0,this._rejoin(r),this.joinPush.receive("ok",({postgres_changes:_})=>{var I;if(this.socket.accessToken&&this.socket.setAuth(this.socket.accessToken),_===void 0){e&&e("SUBSCRIBED");return}else{const U=this.bindings.postgres_changes,q=(I=U==null?void 0:U.length)!==null&&I!==void 0?I:0,G=[];for(let F=0;F<q;F++){const V=U[F],{filter:{event:oe,schema:se,table:ae,filter:le}}=V,Ie=_&&_[F];if(Ie&&Ie.event===oe&&Ie.schema===se&&Ie.table===ae&&Ie.filter===le)G.push(Object.assign(Object.assign({},V),{id:Ie.id}));else{this.unsubscribe(),e&&e("CHANNEL_ERROR",new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=G,e&&e("SUBSCRIBED");return}}).receive("error",_=>{e&&e("CHANNEL_ERROR",new Error(JSON.stringify(Object.values(_).join(", ")||"error")))}).receive("timeout",()=>{e&&e("TIMED_OUT")})}return this}presenceState(){return this.presence.state}async track(e,r={}){return await this.send({type:"presence",event:"track",payload:e},r.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,r,n){return this._on(e,r,n)}async send(e,r={}){var n,s;if(!this._canPush()&&e.type==="broadcast"){const{event:a,payload:c}=e,h={method:"POST",headers:{Authorization:this.socket.accessToken?`Bearer ${this.socket.accessToken}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:a,payload:c,private:this.private}]})};try{const p=await this._fetchWithTimeout(this.broadcastEndpointURL,h,(n=r.timeout)!==null&&n!==void 0?n:this.timeout);return await((s=p.body)===null||s===void 0?void 0:s.cancel()),p.ok?"ok":"error"}catch(p){return p.name==="AbortError"?"timed out":"error"}}else return new Promise(a=>{var c,h,p;const v=this._push(e.type,e,r.timeout||this.timeout);e.type==="broadcast"&&!(!((p=(h=(c=this.params)===null||c===void 0?void 0:c.config)===null||h===void 0?void 0:h.broadcast)===null||p===void 0)&&p.ack)&&a("ok"),v.receive("ok",()=>a("ok")),v.receive("error",()=>a("error")),v.receive("timeout",()=>a("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=nt.leaving;const r=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(ct.close,"leave",this._joinRef())};return this.rejoinTimer.reset(),this.joinPush.destroy(),new Promise(n=>{const s=new qo(this,ct.leave,{},e);s.receive("ok",()=>{r(),n("ok")}).receive("timeout",()=>{r(),n("timed out")}).receive("error",()=>{n("error")}),s.send(),this._canPush()||s.trigger("ok",{})})}async _fetchWithTimeout(e,r,n){const s=new AbortController,a=setTimeout(()=>s.abort(),n),c=await this.socket.fetch(e,Object.assign(Object.assign({},r),{signal:s.signal}));return clearTimeout(a),c}_push(e,r,n=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let s=new qo(this,e,r,n);return this._canPush()?s.send():(s.startTimeout(),this.pushBuffer.push(s)),s}_onMessage(e,r,n){return r}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,r,n){var s,a;const c=e.toLocaleLowerCase(),{close:h,error:p,leave:v,join:_}=ct;if(n&&[h,p,v,_].indexOf(c)>=0&&n!==this._joinRef())return;let U=this._onMessage(c,r,n);if(r&&!U)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(c)?(s=this.bindings.postgres_changes)===null||s===void 0||s.filter(q=>{var G,F,V;return((G=q.filter)===null||G===void 0?void 0:G.event)==="*"||((V=(F=q.filter)===null||F===void 0?void 0:F.event)===null||V===void 0?void 0:V.toLocaleLowerCase())===c}).map(q=>q.callback(U,n)):(a=this.bindings[c])===null||a===void 0||a.filter(q=>{var G,F,V,oe,se,ae;if(["broadcast","presence","postgres_changes"].includes(c))if("id"in q){const le=q.id,Ie=(G=q.filter)===null||G===void 0?void 0:G.event;return le&&((F=r.ids)===null||F===void 0?void 0:F.includes(le))&&(Ie==="*"||(Ie==null?void 0:Ie.toLocaleLowerCase())===((V=r.data)===null||V===void 0?void 0:V.type.toLocaleLowerCase()))}else{const le=(se=(oe=q==null?void 0:q.filter)===null||oe===void 0?void 0:oe.event)===null||se===void 0?void 0:se.toLocaleLowerCase();return le==="*"||le===((ae=r==null?void 0:r.event)===null||ae===void 0?void 0:ae.toLocaleLowerCase())}else return q.type.toLocaleLowerCase()===c}).map(q=>{if(typeof U=="object"&&"ids"in U){const G=U.data,{schema:F,table:V,commit_timestamp:oe,type:se,errors:ae}=G;U=Object.assign(Object.assign({},{schema:F,table:V,commit_timestamp:oe,eventType:se,new:{},old:{},errors:ae}),this._getPayloadRecords(G))}q.callback(U,n)})}_isClosed(){return this.state===nt.closed}_isJoined(){return this.state===nt.joined}_isJoining(){return this.state===nt.joining}_isLeaving(){return this.state===nt.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,r,n){const s=e.toLocaleLowerCase(),a={type:s,filter:r,callback:n};return this.bindings[s]?this.bindings[s].push(a):this.bindings[s]=[a],this}_off(e,r){const n=e.toLocaleLowerCase();return this.bindings[n]=this.bindings[n].filter(s=>{var a;return!(((a=s.type)===null||a===void 0?void 0:a.toLocaleLowerCase())===n&&ls.isEqual(s.filter,r))}),this}static isEqual(e,r){if(Object.keys(e).length!==Object.keys(r).length)return!1;for(const n in e)if(e[n]!==r[n])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(ct.close,{},e)}_onError(e){this._on(ct.error,{},r=>e(r))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=nt.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const r={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(r.new=Xs(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(r.old=Xs(e.columns,e.old_record)),r}}const oc=()=>{},sc=typeof WebSocket<"u",ic=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class ac{constructor(e,r){var n;this.accessToken=null,this.apiKey=null,this.channels=[],this.endPoint="",this.httpEndpoint="",this.headers=Hu,this.params={},this.timeout=Gi,this.heartbeatIntervalMs=3e4,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.ref=0,this.logger=oc,this.conn=null,this.sendBuffer=[],this.serializer=new Yu,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this._resolveFetch=a=>{let c;return a?c=a:typeof fetch>"u"?c=(...h)=>$e(async()=>{const{default:p}=await Promise.resolve().then(()=>Sr);return{default:p}},void 0).then(({default:p})=>p(...h)):c=fetch,(...h)=>c(...h)},this.endPoint=`${e}/${Jo.websocket}`,this.httpEndpoint=Qi(e),r!=null&&r.transport?this.transport=r.transport:this.transport=null,r!=null&&r.params&&(this.params=r.params),r!=null&&r.headers&&(this.headers=Object.assign(Object.assign({},this.headers),r.headers)),r!=null&&r.timeout&&(this.timeout=r.timeout),r!=null&&r.logger&&(this.logger=r.logger),r!=null&&r.heartbeatIntervalMs&&(this.heartbeatIntervalMs=r.heartbeatIntervalMs);const s=(n=r==null?void 0:r.params)===null||n===void 0?void 0:n.apikey;if(s&&(this.accessToken=s,this.apiKey=s),this.reconnectAfterMs=r!=null&&r.reconnectAfterMs?r.reconnectAfterMs:a=>[1e3,2e3,5e3,1e4][a-1]||1e4,this.encode=r!=null&&r.encode?r.encode:(a,c)=>c(JSON.stringify(a)),this.decode=r!=null&&r.decode?r.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new Ji(async()=>{this.disconnect(),this.connect()},this.reconnectAfterMs),this.fetch=this._resolveFetch(r==null?void 0:r.fetch),r!=null&&r.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.worker=(r==null?void 0:r.worker)||!1,this.workerUrl=r==null?void 0:r.workerUrl}}connect(){if(!this.conn){if(this.transport){this.conn=new this.transport(this._endPointURL(),void 0,{headers:this.headers});return}if(sc){this.conn=new WebSocket(this._endPointURL()),this.setupConnection();return}this.conn=new uc(this._endPointURL(),void 0,{close:()=>{this.conn=null}}),$e(async()=>{const{default:e}=await import("./browser-BSafpOys.js").then(r=>r.b);return{default:e}},[]).then(({default:e})=>{this.conn=new e(this._endPointURL(),void 0,{headers:this.headers}),this.setupConnection()})}}disconnect(e,r){this.conn&&(this.conn.onclose=function(){},e?this.conn.close(e,r??""):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset())}getChannels(){return this.channels}async removeChannel(e){const r=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),r}async removeAllChannels(){const e=await Promise.all(this.channels.map(r=>r.unsubscribe()));return this.disconnect(),e}log(e,r,n){this.logger(e,r,n)}connectionState(){switch(this.conn&&this.conn.readyState){case kr.connecting:return Qt.Connecting;case kr.open:return Qt.Open;case kr.closing:return Qt.Closing;default:return Qt.Closed}}isConnected(){return this.connectionState()===Qt.Open}channel(e,r={config:{}}){const n=new ls(`realtime:${e}`,r,this);return this.channels.push(n),n}push(e){const{topic:r,event:n,payload:s,ref:a}=e,c=()=>{this.encode(e,h=>{var p;(p=this.conn)===null||p===void 0||p.send(h)})};this.log("push",`${r} ${n} (${a})`,s),this.isConnected()?c():this.sendBuffer.push(c)}setAuth(e){this.accessToken=e,this.channels.forEach(r=>{e&&r.updateJoinPayload({access_token:e}),r.joinedOnce&&r._isJoined()&&r._push(ct.access_token,{access_token:e})})}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let r=this.channels.find(n=>n.topic===e&&(n._isJoined()||n._isJoining()));r&&(this.log("transport",`leaving duplicate topic "${e}"`),r.unsubscribe())}_remove(e){this.channels=this.channels.filter(r=>r._joinRef()!==e._joinRef())}setupConnection(){this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_endPointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:Gu}))}_onConnMessage(e){this.decode(e.data,r=>{let{topic:n,event:s,payload:a,ref:c}=r;(c&&c===this.pendingHeartbeatRef||s===(a==null?void 0:a.type))&&(this.pendingHeartbeatRef=null),this.log("receive",`${a.status||""} ${n} ${s} ${c&&"("+c+")"||""}`,a),this.channels.filter(h=>h._isMember(n)).forEach(h=>h._trigger(s,a,c)),this.stateChangeCallbacks.message.forEach(h=>h(r))})}async _onConnOpen(){if(this.log("transport",`connected to ${this._endPointURL()}`),this._flushSendBuffer(),this.reconnectTimer.reset(),!this.worker)this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this._sendHeartbeat(),this.heartbeatIntervalMs);else{this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=r=>{this.log("worker","worker error",r.message),this.workerRef.terminate()},this.workerRef.onmessage=r=>{r.data.event==="keepAlive"&&this._sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}this.stateChangeCallbacks.open.forEach(e=>e())}_onConnClose(e){this.log("transport","close",e),this._triggerChanError(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach(r=>r(e))}_onConnError(e){this.log("transport",e.message),this._triggerChanError(),this.stateChangeCallbacks.error.forEach(r=>r(e))}_triggerChanError(){this.channels.forEach(e=>e._trigger(ct.error))}_appendParams(e,r){if(Object.keys(r).length===0)return e;const n=e.match(/\?/)?"&":"?",s=new URLSearchParams(r);return`${e}${n}${s}`}_flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_sendHeartbeat(){var e;if(this.isConnected()){if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),(e=this.conn)===null||e===void 0||e.close(Ju,"hearbeat timeout");return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.setAuth(this.accessToken)}}_workerObjectUrl(e){let r;if(e)r=e;else{const n=new Blob([ic],{type:"application/javascript"});r=URL.createObjectURL(n)}return r}}class uc{constructor(e,r,n){this.binaryType="arraybuffer",this.onclose=()=>{},this.onerror=()=>{},this.onmessage=()=>{},this.onopen=()=>{},this.readyState=kr.connecting,this.send=()=>{},this.url=null,this.url=e,this.close=n.close}}class ds extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function Le(t){return typeof t=="object"&&t!==null&&"__isStorageError"in t}class cc extends ds{constructor(e,r){super(e),this.name="StorageApiError",this.status=r}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class Qo extends ds{constructor(e,r){super(e),this.name="StorageUnknownError",this.originalError=r}}var lc=function(t,e,r,n){function s(a){return a instanceof r?a:new r(function(c){c(a)})}return new(r||(r=Promise))(function(a,c){function h(_){try{v(n.next(_))}catch(I){c(I)}}function p(_){try{v(n.throw(_))}catch(I){c(I)}}function v(_){_.done?a(_.value):s(_.value).then(h,p)}v((n=n.apply(t,e||[])).next())})};const Xi=t=>{let e;return t?e=t:typeof fetch>"u"?e=(...r)=>$e(async()=>{const{default:n}=await Promise.resolve().then(()=>Sr);return{default:n}},void 0).then(({default:n})=>n(...r)):e=fetch,(...r)=>e(...r)},dc=()=>lc(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield $e(()=>Promise.resolve().then(()=>Sr),void 0)).Response:Response}),Xo=t=>{if(Array.isArray(t))return t.map(r=>Xo(r));if(typeof t=="function"||t!==Object(t))return t;const e={};return Object.entries(t).forEach(([r,n])=>{const s=r.replace(/([-_][a-z])/gi,a=>a.toUpperCase().replace(/[-_]/g,""));e[s]=Xo(n)}),e};var tr=function(t,e,r,n){function s(a){return a instanceof r?a:new r(function(c){c(a)})}return new(r||(r=Promise))(function(a,c){function h(_){try{v(n.next(_))}catch(I){c(I)}}function p(_){try{v(n.throw(_))}catch(I){c(I)}}function v(_){_.done?a(_.value):s(_.value).then(h,p)}v((n=n.apply(t,e||[])).next())})};const Bo=t=>t.msg||t.message||t.error_description||t.error||JSON.stringify(t),hc=(t,e,r)=>tr(void 0,void 0,void 0,function*(){const n=yield dc();t instanceof n&&!(r!=null&&r.noResolveJson)?t.json().then(s=>{e(new cc(Bo(s),t.status||500))}).catch(s=>{e(new Qo(Bo(s),s))}):e(new Qo(Bo(t),t))}),fc=(t,e,r,n)=>{const s={method:t,headers:(e==null?void 0:e.headers)||{}};return t==="GET"?s:(s.headers=Object.assign({"Content-Type":"application/json"},e==null?void 0:e.headers),n&&(s.body=JSON.stringify(n)),Object.assign(Object.assign({},s),r))};function Qr(t,e,r,n,s,a){return tr(this,void 0,void 0,function*(){return new Promise((c,h)=>{t(r,fc(e,n,s,a)).then(p=>{if(!p.ok)throw p;return n!=null&&n.noResolveJson?p:p.json()}).then(p=>c(p)).catch(p=>hc(p,h,n))})})}function Bn(t,e,r,n){return tr(this,void 0,void 0,function*(){return Qr(t,"GET",e,r,n)})}function It(t,e,r,n,s){return tr(this,void 0,void 0,function*(){return Qr(t,"POST",e,n,s,r)})}function pc(t,e,r,n,s){return tr(this,void 0,void 0,function*(){return Qr(t,"PUT",e,n,s,r)})}function mc(t,e,r,n){return tr(this,void 0,void 0,function*(){return Qr(t,"HEAD",e,Object.assign(Object.assign({},r),{noResolveJson:!0}),n)})}function ea(t,e,r,n,s){return tr(this,void 0,void 0,function*(){return Qr(t,"DELETE",e,n,s,r)})}var Qe=function(t,e,r,n){function s(a){return a instanceof r?a:new r(function(c){c(a)})}return new(r||(r=Promise))(function(a,c){function h(_){try{v(n.next(_))}catch(I){c(I)}}function p(_){try{v(n.throw(_))}catch(I){c(I)}}function v(_){_.done?a(_.value):s(_.value).then(h,p)}v((n=n.apply(t,e||[])).next())})};const vc={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},oi={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class gc{constructor(e,r={},n,s){this.url=e,this.headers=r,this.bucketId=n,this.fetch=Xi(s)}uploadOrUpdate(e,r,n,s){return Qe(this,void 0,void 0,function*(){try{let a;const c=Object.assign(Object.assign({},oi),s);let h=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(c.upsert)});const p=c.metadata;typeof Blob<"u"&&n instanceof Blob?(a=new FormData,a.append("cacheControl",c.cacheControl),p&&a.append("metadata",this.encodeMetadata(p)),a.append("",n)):typeof FormData<"u"&&n instanceof FormData?(a=n,a.append("cacheControl",c.cacheControl),p&&a.append("metadata",this.encodeMetadata(p))):(a=n,h["cache-control"]=`max-age=${c.cacheControl}`,h["content-type"]=c.contentType,p&&(h["x-metadata"]=this.toBase64(this.encodeMetadata(p)))),s!=null&&s.headers&&(h=Object.assign(Object.assign({},h),s.headers));const v=this._removeEmptyFolders(r),_=this._getFinalPath(v),I=yield this.fetch(`${this.url}/object/${_}`,Object.assign({method:e,body:a,headers:h},c!=null&&c.duplex?{duplex:c.duplex}:{})),U=yield I.json();return I.ok?{data:{path:v,id:U.Id,fullPath:U.Key},error:null}:{data:null,error:U}}catch(a){if(Le(a))return{data:null,error:a};throw a}})}upload(e,r,n){return Qe(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,r,n)})}uploadToSignedUrl(e,r,n,s){return Qe(this,void 0,void 0,function*(){const a=this._removeEmptyFolders(e),c=this._getFinalPath(a),h=new URL(this.url+`/object/upload/sign/${c}`);h.searchParams.set("token",r);try{let p;const v=Object.assign({upsert:oi.upsert},s),_=Object.assign(Object.assign({},this.headers),{"x-upsert":String(v.upsert)});typeof Blob<"u"&&n instanceof Blob?(p=new FormData,p.append("cacheControl",v.cacheControl),p.append("",n)):typeof FormData<"u"&&n instanceof FormData?(p=n,p.append("cacheControl",v.cacheControl)):(p=n,_["cache-control"]=`max-age=${v.cacheControl}`,_["content-type"]=v.contentType);const I=yield this.fetch(h.toString(),{method:"PUT",body:p,headers:_}),U=yield I.json();return I.ok?{data:{path:a,fullPath:U.Key},error:null}:{data:null,error:U}}catch(p){if(Le(p))return{data:null,error:p};throw p}})}createSignedUploadUrl(e,r){return Qe(this,void 0,void 0,function*(){try{let n=this._getFinalPath(e);const s=Object.assign({},this.headers);r!=null&&r.upsert&&(s["x-upsert"]="true");const a=yield It(this.fetch,`${this.url}/object/upload/sign/${n}`,{},{headers:s}),c=new URL(this.url+a.url),h=c.searchParams.get("token");if(!h)throw new ds("No token returned by API");return{data:{signedUrl:c.toString(),path:e,token:h},error:null}}catch(n){if(Le(n))return{data:null,error:n};throw n}})}update(e,r,n){return Qe(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,r,n)})}move(e,r,n){return Qe(this,void 0,void 0,function*(){try{return{data:yield It(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:r,destinationBucket:n==null?void 0:n.destinationBucket},{headers:this.headers}),error:null}}catch(s){if(Le(s))return{data:null,error:s};throw s}})}copy(e,r,n){return Qe(this,void 0,void 0,function*(){try{return{data:{path:(yield It(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:r,destinationBucket:n==null?void 0:n.destinationBucket},{headers:this.headers})).Key},error:null}}catch(s){if(Le(s))return{data:null,error:s};throw s}})}createSignedUrl(e,r,n){return Qe(this,void 0,void 0,function*(){try{let s=this._getFinalPath(e),a=yield It(this.fetch,`${this.url}/object/sign/${s}`,Object.assign({expiresIn:r},n!=null&&n.transform?{transform:n.transform}:{}),{headers:this.headers});const c=n!=null&&n.download?`&download=${n.download===!0?"":n.download}`:"";return a={signedUrl:encodeURI(`${this.url}${a.signedURL}${c}`)},{data:a,error:null}}catch(s){if(Le(s))return{data:null,error:s};throw s}})}createSignedUrls(e,r,n){return Qe(this,void 0,void 0,function*(){try{const s=yield It(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:r,paths:e},{headers:this.headers}),a=n!=null&&n.download?`&download=${n.download===!0?"":n.download}`:"";return{data:s.map(c=>Object.assign(Object.assign({},c),{signedUrl:c.signedURL?encodeURI(`${this.url}${c.signedURL}${a}`):null})),error:null}}catch(s){if(Le(s))return{data:null,error:s};throw s}})}download(e,r){return Qe(this,void 0,void 0,function*(){const s=typeof(r==null?void 0:r.transform)<"u"?"render/image/authenticated":"object",a=this.transformOptsToQueryString((r==null?void 0:r.transform)||{}),c=a?`?${a}`:"";try{const h=this._getFinalPath(e);return{data:yield(yield Bn(this.fetch,`${this.url}/${s}/${h}${c}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(h){if(Le(h))return{data:null,error:h};throw h}})}info(e){return Qe(this,void 0,void 0,function*(){const r=this._getFinalPath(e);try{const n=yield Bn(this.fetch,`${this.url}/object/info/${r}`,{headers:this.headers});return{data:Xo(n),error:null}}catch(n){if(Le(n))return{data:null,error:n};throw n}})}exists(e){return Qe(this,void 0,void 0,function*(){const r=this._getFinalPath(e);try{return yield mc(this.fetch,`${this.url}/object/${r}`,{headers:this.headers}),{data:!0,error:null}}catch(n){if(Le(n)&&n instanceof Qo){const s=n.originalError;if([400,404].includes(s==null?void 0:s.status))return{data:!1,error:n}}throw n}})}getPublicUrl(e,r){const n=this._getFinalPath(e),s=[],a=r!=null&&r.download?`download=${r.download===!0?"":r.download}`:"";a!==""&&s.push(a);const h=typeof(r==null?void 0:r.transform)<"u"?"render/image":"object",p=this.transformOptsToQueryString((r==null?void 0:r.transform)||{});p!==""&&s.push(p);let v=s.join("&");return v!==""&&(v=`?${v}`),{data:{publicUrl:encodeURI(`${this.url}/${h}/public/${n}${v}`)}}}remove(e){return Qe(this,void 0,void 0,function*(){try{return{data:yield ea(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(r){if(Le(r))return{data:null,error:r};throw r}})}list(e,r,n){return Qe(this,void 0,void 0,function*(){try{const s=Object.assign(Object.assign(Object.assign({},vc),r),{prefix:e||""});return{data:yield It(this.fetch,`${this.url}/object/list/${this.bucketId}`,s,{headers:this.headers},n),error:null}}catch(s){if(Le(s))return{data:null,error:s};throw s}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return typeof Buffer<"u"?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const r=[];return e.width&&r.push(`width=${e.width}`),e.height&&r.push(`height=${e.height}`),e.resize&&r.push(`resize=${e.resize}`),e.format&&r.push(`format=${e.format}`),e.quality&&r.push(`quality=${e.quality}`),r.join("&")}}const yc="2.7.1",_c={"X-Client-Info":`storage-js/${yc}`};var yr=function(t,e,r,n){function s(a){return a instanceof r?a:new r(function(c){c(a)})}return new(r||(r=Promise))(function(a,c){function h(_){try{v(n.next(_))}catch(I){c(I)}}function p(_){try{v(n.throw(_))}catch(I){c(I)}}function v(_){_.done?a(_.value):s(_.value).then(h,p)}v((n=n.apply(t,e||[])).next())})};class wc{constructor(e,r={},n){this.url=e,this.headers=Object.assign(Object.assign({},_c),r),this.fetch=Xi(n)}listBuckets(){return yr(this,void 0,void 0,function*(){try{return{data:yield Bn(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(Le(e))return{data:null,error:e};throw e}})}getBucket(e){return yr(this,void 0,void 0,function*(){try{return{data:yield Bn(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(r){if(Le(r))return{data:null,error:r};throw r}})}createBucket(e,r={public:!1}){return yr(this,void 0,void 0,function*(){try{return{data:yield It(this.fetch,`${this.url}/bucket`,{id:e,name:e,public:r.public,file_size_limit:r.fileSizeLimit,allowed_mime_types:r.allowedMimeTypes},{headers:this.headers}),error:null}}catch(n){if(Le(n))return{data:null,error:n};throw n}})}updateBucket(e,r){return yr(this,void 0,void 0,function*(){try{return{data:yield pc(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:r.public,file_size_limit:r.fileSizeLimit,allowed_mime_types:r.allowedMimeTypes},{headers:this.headers}),error:null}}catch(n){if(Le(n))return{data:null,error:n};throw n}})}emptyBucket(e){return yr(this,void 0,void 0,function*(){try{return{data:yield It(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(r){if(Le(r))return{data:null,error:r};throw r}})}deleteBucket(e){return yr(this,void 0,void 0,function*(){try{return{data:yield ea(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(r){if(Le(r))return{data:null,error:r};throw r}})}}class bc extends wc{constructor(e,r={},n){super(e,r,n)}from(e){return new gc(this.url,this.headers,e,this.fetch)}}const kc="2.46.1";let Zr="";typeof Deno<"u"?Zr="deno":typeof document<"u"?Zr="web":typeof navigator<"u"&&navigator.product==="ReactNative"?Zr="react-native":Zr="node";const Ec={"X-Client-Info":`supabase-js-${Zr}/${kc}`},Oc={headers:Ec},Sc={schema:"public"},Ac={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},Tc={};var xc=function(t,e,r,n){function s(a){return a instanceof r?a:new r(function(c){c(a)})}return new(r||(r=Promise))(function(a,c){function h(_){try{v(n.next(_))}catch(I){c(I)}}function p(_){try{v(n.throw(_))}catch(I){c(I)}}function v(_){_.done?a(_.value):s(_.value).then(h,p)}v((n=n.apply(t,e||[])).next())})};const Pc=t=>{let e;return t?e=t:typeof fetch>"u"?e=Ni:e=fetch,(...r)=>e(...r)},Rc=()=>typeof Headers>"u"?Fi:Headers,Ic=(t,e,r)=>{const n=Pc(r),s=Rc();return(a,c)=>xc(void 0,void 0,void 0,function*(){var h;const p=(h=yield e())!==null&&h!==void 0?h:t;let v=new s(c==null?void 0:c.headers);return v.has("apikey")||v.set("apikey",t),v.has("Authorization")||v.set("Authorization",`Bearer ${p}`),n(a,Object.assign(Object.assign({},c),{headers:v}))})};var $c=function(t,e,r,n){function s(a){return a instanceof r?a:new r(function(c){c(a)})}return new(r||(r=Promise))(function(a,c){function h(_){try{v(n.next(_))}catch(I){c(I)}}function p(_){try{v(n.throw(_))}catch(I){c(I)}}function v(_){_.done?a(_.value):s(_.value).then(h,p)}v((n=n.apply(t,e||[])).next())})};function Dc(t){return t.replace(/\/$/,"")}function Cc(t,e){const{db:r,auth:n,realtime:s,global:a}=t,{db:c,auth:h,realtime:p,global:v}=e,_={db:Object.assign(Object.assign({},c),r),auth:Object.assign(Object.assign({},h),n),realtime:Object.assign(Object.assign({},p),s),global:Object.assign(Object.assign({},v),a),accessToken:()=>$c(this,void 0,void 0,function*(){return""})};return t.accessToken?_.accessToken=t.accessToken:delete _.accessToken,_}const ta="2.65.1",jc="http://localhost:9999",zc="supabase.auth.token",Uc={"X-Client-Info":`gotrue-js/${ta}`},si=10,es="X-Supabase-Api-Version",ra={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}};function Nc(t){return Math.round(Date.now()/1e3)+t}function Fc(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){const e=Math.random()*16|0;return(t=="x"?e:e&3|8).toString(16)})}const ut=()=>typeof document<"u",Gt={tested:!1,writable:!1},Kr=()=>{if(!ut())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(Gt.tested)return Gt.writable;const t=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(t,t),globalThis.localStorage.removeItem(t),Gt.tested=!0,Gt.writable=!0}catch{Gt.tested=!0,Gt.writable=!1}return Gt.writable};function Zo(t){const e={},r=new URL(t);if(r.hash&&r.hash[0]==="#")try{new URLSearchParams(r.hash.substring(1)).forEach((s,a)=>{e[a]=s})}catch{}return r.searchParams.forEach((n,s)=>{e[s]=n}),e}const na=t=>{let e;return t?e=t:typeof fetch>"u"?e=(...r)=>$e(async()=>{const{default:n}=await Promise.resolve().then(()=>Sr);return{default:n}},void 0).then(({default:n})=>n(...r)):e=fetch,(...r)=>e(...r)},Lc=t=>typeof t=="object"&&t!==null&&"status"in t&&"ok"in t&&"json"in t&&typeof t.json=="function",oa=async(t,e,r)=>{await t.setItem(e,JSON.stringify(r))},$n=async(t,e)=>{const r=await t.getItem(e);if(!r)return null;try{return JSON.parse(r)}catch{return r}},Dn=async(t,e)=>{await t.removeItem(e)};function Mc(t){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";let r="",n,s,a,c,h,p,v,_=0;for(t=t.replace("-","+").replace("_","/");_<t.length;)c=e.indexOf(t.charAt(_++)),h=e.indexOf(t.charAt(_++)),p=e.indexOf(t.charAt(_++)),v=e.indexOf(t.charAt(_++)),n=c<<2|h>>4,s=(h&15)<<4|p>>2,a=(p&3)<<6|v,r=r+String.fromCharCode(n),p!=64&&s!=0&&(r=r+String.fromCharCode(s)),v!=64&&a!=0&&(r=r+String.fromCharCode(a));return r}class Qn{constructor(){this.promise=new Qn.promiseConstructor((e,r)=>{this.resolve=e,this.reject=r})}}Qn.promiseConstructor=Promise;function ii(t){const e=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}=?$|[a-z0-9_-]{2}(==)?$)$/i,r=t.split(".");if(r.length!==3)throw new Error("JWT is not valid: not a JWT structure");if(!e.test(r[1]))throw new Error("JWT is not valid: payload is not in base64url format");const n=r[1];return JSON.parse(Mc(n))}async function qc(t){return await new Promise(e=>{setTimeout(()=>e(null),t)})}function Bc(t,e){return new Promise((n,s)=>{(async()=>{for(let a=0;a<1/0;a++)try{const c=await t(a);if(!e(a,null,c)){n(c);return}}catch(c){if(!e(a,c)){s(c);return}}})()})}function Zc(t){return("0"+t.toString(16)).substr(-2)}function Vc(){const e=new Uint32Array(56);if(typeof crypto>"u"){const r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",n=r.length;let s="";for(let a=0;a<56;a++)s+=r.charAt(Math.floor(Math.random()*n));return s}return crypto.getRandomValues(e),Array.from(e,Zc).join("")}async function Kc(t){const r=new TextEncoder().encode(t),n=await crypto.subtle.digest("SHA-256",r),s=new Uint8Array(n);return Array.from(s).map(a=>String.fromCharCode(a)).join("")}function Wc(t){return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function Hc(t){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),t;const r=await Kc(t);return Wc(r)}async function _r(t,e,r=!1){const n=Vc();let s=n;r&&(s+="/PASSWORD_RECOVERY"),await oa(t,`${e}-code-verifier`,s);const a=await Hc(n);return[a,n===a?"plain":"s256"]}const Gc=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function Jc(t){const e=t.headers.get(es);if(!e||!e.match(Gc))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}class hs extends Error{constructor(e,r,n){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=r,this.code=n}}function pe(t){return typeof t=="object"&&t!==null&&"__isAuthError"in t}class Yc extends hs{constructor(e,r,n){super(e,r,n),this.name="AuthApiError",this.status=r,this.code=n}}function Qc(t){return pe(t)&&t.name==="AuthApiError"}class sa extends hs{constructor(e,r){super(e),this.name="AuthUnknownError",this.originalError=r}}class rr extends hs{constructor(e,r,n,s){super(e,n,s),this.name=r,this.status=n}}class Pt extends rr{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function Xc(t){return pe(t)&&t.name==="AuthSessionMissingError"}class Vo extends rr{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class Cn extends rr{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class jn extends rr{constructor(e,r=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=r}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class ai extends rr{constructor(e,r=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=r}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class ts extends rr{constructor(e,r){super(e,"AuthRetryableFetchError",r,void 0)}}function Ko(t){return pe(t)&&t.name==="AuthRetryableFetchError"}class ui extends rr{constructor(e,r,n){super(e,"AuthWeakPasswordError",r,"weak_password"),this.reasons=n}}var el=function(t,e){var r={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,n=Object.getOwnPropertySymbols(t);s<n.length;s++)e.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(t,n[s])&&(r[n[s]]=t[n[s]]);return r};const Yt=t=>t.msg||t.message||t.error_description||t.error||JSON.stringify(t),tl=[502,503,504];async function ci(t){var e;if(!Lc(t))throw new ts(Yt(t),0);if(tl.includes(t.status))throw new ts(Yt(t),t.status);let r;try{r=await t.json()}catch(a){throw new sa(Yt(a),a)}let n;const s=Jc(t);if(s&&s.getTime()>=ra["2024-01-01"].timestamp&&typeof r=="object"&&r&&typeof r.code=="string"?n=r.code:typeof r=="object"&&r&&typeof r.error_code=="string"&&(n=r.error_code),n){if(n==="weak_password")throw new ui(Yt(r),t.status,((e=r.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(n==="session_not_found")throw new Pt}else if(typeof r=="object"&&r&&typeof r.weak_password=="object"&&r.weak_password&&Array.isArray(r.weak_password.reasons)&&r.weak_password.reasons.length&&r.weak_password.reasons.reduce((a,c)=>a&&typeof c=="string",!0))throw new ui(Yt(r),t.status,r.weak_password.reasons);throw new Yc(Yt(r),t.status||500,n)}const rl=(t,e,r,n)=>{const s={method:t,headers:(e==null?void 0:e.headers)||{}};return t==="GET"?s:(s.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e==null?void 0:e.headers),s.body=JSON.stringify(n),Object.assign(Object.assign({},s),r))};async function ge(t,e,r,n){var s;const a=Object.assign({},n==null?void 0:n.headers);a[es]||(a[es]=ra["2024-01-01"].name),n!=null&&n.jwt&&(a.Authorization=`Bearer ${n.jwt}`);const c=(s=n==null?void 0:n.query)!==null&&s!==void 0?s:{};n!=null&&n.redirectTo&&(c.redirect_to=n.redirectTo);const h=Object.keys(c).length?"?"+new URLSearchParams(c).toString():"",p=await nl(t,e,r+h,{headers:a,noResolveJson:n==null?void 0:n.noResolveJson},{},n==null?void 0:n.body);return n!=null&&n.xform?n==null?void 0:n.xform(p):{data:Object.assign({},p),error:null}}async function nl(t,e,r,n,s,a){const c=rl(e,n,s,a);let h;try{h=await t(r,Object.assign({},c))}catch(p){throw console.error(p),new ts(Yt(p),0)}if(h.ok||await ci(h),n!=null&&n.noResolveJson)return h;try{return await h.json()}catch(p){await ci(p)}}function Rt(t){var e;let r=null;al(t)&&(r=Object.assign({},t),t.expires_at||(r.expires_at=Nc(t.expires_in)));const n=(e=t.user)!==null&&e!==void 0?e:t;return{data:{session:r,user:n},error:null}}function li(t){const e=Rt(t);return!e.error&&t.weak_password&&typeof t.weak_password=="object"&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.message&&typeof t.weak_password.message=="string"&&t.weak_password.reasons.reduce((r,n)=>r&&typeof n=="string",!0)&&(e.data.weak_password=t.weak_password),e}function $t(t){var e;return{data:{user:(e=t.user)!==null&&e!==void 0?e:t},error:null}}function ol(t){return{data:t,error:null}}function sl(t){const{action_link:e,email_otp:r,hashed_token:n,redirect_to:s,verification_type:a}=t,c=el(t,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),h={action_link:e,email_otp:r,hashed_token:n,redirect_to:s,verification_type:a},p=Object.assign({},c);return{data:{properties:h,user:p},error:null}}function il(t){return t}function al(t){return t.access_token&&t.refresh_token&&t.expires_in}var ul=function(t,e){var r={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,n=Object.getOwnPropertySymbols(t);s<n.length;s++)e.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(t,n[s])&&(r[n[s]]=t[n[s]]);return r};class cl{constructor({url:e="",headers:r={},fetch:n}){this.url=e,this.headers=r,this.fetch=na(n),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(e,r="global"){try{return await ge(this.fetch,"POST",`${this.url}/logout?scope=${r}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(n){if(pe(n))return{data:null,error:n};throw n}}async inviteUserByEmail(e,r={}){try{return await ge(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:r.data},headers:this.headers,redirectTo:r.redirectTo,xform:$t})}catch(n){if(pe(n))return{data:{user:null},error:n};throw n}}async generateLink(e){try{const{options:r}=e,n=ul(e,["options"]),s=Object.assign(Object.assign({},n),r);return"newEmail"in n&&(s.new_email=n==null?void 0:n.newEmail,delete s.newEmail),await ge(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:s,headers:this.headers,xform:sl,redirectTo:r==null?void 0:r.redirectTo})}catch(r){if(pe(r))return{data:{properties:null,user:null},error:r};throw r}}async createUser(e){try{return await ge(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:$t})}catch(r){if(pe(r))return{data:{user:null},error:r};throw r}}async listUsers(e){var r,n,s,a,c,h,p;try{const v={nextPage:null,lastPage:0,total:0},_=await ge(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(n=(r=e==null?void 0:e.page)===null||r===void 0?void 0:r.toString())!==null&&n!==void 0?n:"",per_page:(a=(s=e==null?void 0:e.perPage)===null||s===void 0?void 0:s.toString())!==null&&a!==void 0?a:""},xform:il});if(_.error)throw _.error;const I=await _.json(),U=(c=_.headers.get("x-total-count"))!==null&&c!==void 0?c:0,q=(p=(h=_.headers.get("link"))===null||h===void 0?void 0:h.split(","))!==null&&p!==void 0?p:[];return q.length>0&&(q.forEach(G=>{const F=parseInt(G.split(";")[0].split("=")[1].substring(0,1)),V=JSON.parse(G.split(";")[1].split("=")[1]);v[`${V}Page`]=F}),v.total=parseInt(U)),{data:Object.assign(Object.assign({},I),v),error:null}}catch(v){if(pe(v))return{data:{users:[]},error:v};throw v}}async getUserById(e){try{return await ge(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:$t})}catch(r){if(pe(r))return{data:{user:null},error:r};throw r}}async updateUserById(e,r){try{return await ge(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:r,headers:this.headers,xform:$t})}catch(n){if(pe(n))return{data:{user:null},error:n};throw n}}async deleteUser(e,r=!1){try{return await ge(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:r},xform:$t})}catch(n){if(pe(n))return{data:{user:null},error:n};throw n}}async _listFactors(e){try{const{data:r,error:n}=await ge(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:s=>({data:{factors:s},error:null})});return{data:r,error:n}}catch(r){if(pe(r))return{data:null,error:r};throw r}}async _deleteFactor(e){try{return{data:await ge(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(r){if(pe(r))return{data:null,error:r};throw r}}}const ll={getItem:t=>Kr()?globalThis.localStorage.getItem(t):null,setItem:(t,e)=>{Kr()&&globalThis.localStorage.setItem(t,e)},removeItem:t=>{Kr()&&globalThis.localStorage.removeItem(t)}};function di(t={}){return{getItem:e=>t[e]||null,setItem:(e,r)=>{t[e]=r},removeItem:e=>{delete t[e]}}}function dl(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}const wr={debug:!!(globalThis&&Kr()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class ia extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class hl extends ia{}async function fl(t,e,r){wr.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",t,e);const n=new globalThis.AbortController;return e>0&&setTimeout(()=>{n.abort(),wr.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",t)},e),await globalThis.navigator.locks.request(t,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:n.signal},async s=>{if(s){wr.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",t,s.name);try{return await r()}finally{wr.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",t,s.name)}}else{if(e===0)throw wr.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",t),new hl(`Acquiring an exclusive Navigator LockManager lock "${t}" immediately failed`);if(wr.debug)try{const a=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(a,null,"  "))}catch(a){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",a)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await r()}})}dl();const pl={url:jc,storageKey:zc,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:Uc,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1},qr=30*1e3,hi=3;async function fi(t,e,r){return await r()}class Hr{constructor(e){var r,n;this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=Hr.nextInstanceID,Hr.nextInstanceID+=1,this.instanceID>0&&ut()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const s=Object.assign(Object.assign({},pl),e);if(this.logDebugMessages=!!s.debug,typeof s.debug=="function"&&(this.logger=s.debug),this.persistSession=s.persistSession,this.storageKey=s.storageKey,this.autoRefreshToken=s.autoRefreshToken,this.admin=new cl({url:s.url,headers:s.headers,fetch:s.fetch}),this.url=s.url,this.headers=s.headers,this.fetch=na(s.fetch),this.lock=s.lock||fi,this.detectSessionInUrl=s.detectSessionInUrl,this.flowType=s.flowType,this.hasCustomAuthorizationHeader=s.hasCustomAuthorizationHeader,s.lock?this.lock=s.lock:ut()&&(!((r=globalThis==null?void 0:globalThis.navigator)===null||r===void 0)&&r.locks)?this.lock=fl:this.lock=fi,this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?s.storage?this.storage=s.storage:Kr()?this.storage=ll:(this.memoryStorage={},this.storage=di(this.memoryStorage)):(this.memoryStorage={},this.storage=di(this.memoryStorage)),ut()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(a){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",a)}(n=this.broadcastChannel)===null||n===void 0||n.addEventListener("message",async a=>{this._debug("received broadcast notification from other tab or client",a),await this._notifyAllSubscribers(a.data.event,a.data.session,!1)})}this.initialize()}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${ta}) ${new Date().toISOString()}`,...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){try{const e=ut()?await this._isPKCEFlow():!1;if(this._debug("#_initialize()","begin","is PKCE flow",e),e||this.detectSessionInUrl&&this._isImplicitGrantFlow()){const{data:r,error:n}=await this._getSessionFromURL(e);if(n)return this._debug("#_initialize()","error detecting session from URL",n),(n==null?void 0:n.code)==="identity_already_exists"?{error:n}:(await this._removeSession(),{error:n});const{session:s,redirectType:a}=r;return this._debug("#_initialize()","detected session in URL",s,"redirect type",a),await this._saveSession(s),setTimeout(async()=>{a==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",s):await this._notifyAllSubscribers("SIGNED_IN",s)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(e){return pe(e)?{error:e}:{error:new sa("Unexpected error during initialization",e)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var r,n,s;try{const a=await ge(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(n=(r=e==null?void 0:e.options)===null||r===void 0?void 0:r.data)!==null&&n!==void 0?n:{},gotrue_meta_security:{captcha_token:(s=e==null?void 0:e.options)===null||s===void 0?void 0:s.captchaToken}},xform:Rt}),{data:c,error:h}=a;if(h||!c)return{data:{user:null,session:null},error:h};const p=c.session,v=c.user;return c.session&&(await this._saveSession(c.session),await this._notifyAllSubscribers("SIGNED_IN",p)),{data:{user:v,session:p},error:null}}catch(a){if(pe(a))return{data:{user:null,session:null},error:a};throw a}}async signUp(e){var r,n,s;try{let a;if("email"in e){const{email:_,password:I,options:U}=e;let q=null,G=null;this.flowType==="pkce"&&([q,G]=await _r(this.storage,this.storageKey)),a=await ge(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:U==null?void 0:U.emailRedirectTo,body:{email:_,password:I,data:(r=U==null?void 0:U.data)!==null&&r!==void 0?r:{},gotrue_meta_security:{captcha_token:U==null?void 0:U.captchaToken},code_challenge:q,code_challenge_method:G},xform:Rt})}else if("phone"in e){const{phone:_,password:I,options:U}=e;a=await ge(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:_,password:I,data:(n=U==null?void 0:U.data)!==null&&n!==void 0?n:{},channel:(s=U==null?void 0:U.channel)!==null&&s!==void 0?s:"sms",gotrue_meta_security:{captcha_token:U==null?void 0:U.captchaToken}},xform:Rt})}else throw new Cn("You must provide either an email or phone number and a password");const{data:c,error:h}=a;if(h||!c)return{data:{user:null,session:null},error:h};const p=c.session,v=c.user;return c.session&&(await this._saveSession(c.session),await this._notifyAllSubscribers("SIGNED_IN",p)),{data:{user:v,session:p},error:null}}catch(a){if(pe(a))return{data:{user:null,session:null},error:a};throw a}}async signInWithPassword(e){try{let r;if("email"in e){const{email:a,password:c,options:h}=e;r=await ge(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:a,password:c,gotrue_meta_security:{captcha_token:h==null?void 0:h.captchaToken}},xform:li})}else if("phone"in e){const{phone:a,password:c,options:h}=e;r=await ge(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:a,password:c,gotrue_meta_security:{captcha_token:h==null?void 0:h.captchaToken}},xform:li})}else throw new Cn("You must provide either an email or phone number and a password");const{data:n,error:s}=r;return s?{data:{user:null,session:null},error:s}:!n||!n.session||!n.user?{data:{user:null,session:null},error:new Vo}:(n.session&&(await this._saveSession(n.session),await this._notifyAllSubscribers("SIGNED_IN",n.session)),{data:Object.assign({user:n.user,session:n.session},n.weak_password?{weakPassword:n.weak_password}:null),error:s})}catch(r){if(pe(r))return{data:{user:null,session:null},error:r};throw r}}async signInWithOAuth(e){var r,n,s,a;return await this._handleProviderSignIn(e.provider,{redirectTo:(r=e.options)===null||r===void 0?void 0:r.redirectTo,scopes:(n=e.options)===null||n===void 0?void 0:n.scopes,queryParams:(s=e.options)===null||s===void 0?void 0:s.queryParams,skipBrowserRedirect:(a=e.options)===null||a===void 0?void 0:a.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async _exchangeCodeForSession(e){const r=await $n(this.storage,`${this.storageKey}-code-verifier`),[n,s]=(r??"").split("/");try{const{data:a,error:c}=await ge(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:n},xform:Rt});if(await Dn(this.storage,`${this.storageKey}-code-verifier`),c)throw c;return!a||!a.session||!a.user?{data:{user:null,session:null,redirectType:null},error:new Vo}:(a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",a.session)),{data:Object.assign(Object.assign({},a),{redirectType:s??null}),error:c})}catch(a){if(pe(a))return{data:{user:null,session:null,redirectType:null},error:a};throw a}}async signInWithIdToken(e){try{const{options:r,provider:n,token:s,access_token:a,nonce:c}=e,h=await ge(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:n,id_token:s,access_token:a,nonce:c,gotrue_meta_security:{captcha_token:r==null?void 0:r.captchaToken}},xform:Rt}),{data:p,error:v}=h;return v?{data:{user:null,session:null},error:v}:!p||!p.session||!p.user?{data:{user:null,session:null},error:new Vo}:(p.session&&(await this._saveSession(p.session),await this._notifyAllSubscribers("SIGNED_IN",p.session)),{data:p,error:v})}catch(r){if(pe(r))return{data:{user:null,session:null},error:r};throw r}}async signInWithOtp(e){var r,n,s,a,c;try{if("email"in e){const{email:h,options:p}=e;let v=null,_=null;this.flowType==="pkce"&&([v,_]=await _r(this.storage,this.storageKey));const{error:I}=await ge(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:h,data:(r=p==null?void 0:p.data)!==null&&r!==void 0?r:{},create_user:(n=p==null?void 0:p.shouldCreateUser)!==null&&n!==void 0?n:!0,gotrue_meta_security:{captcha_token:p==null?void 0:p.captchaToken},code_challenge:v,code_challenge_method:_},redirectTo:p==null?void 0:p.emailRedirectTo});return{data:{user:null,session:null},error:I}}if("phone"in e){const{phone:h,options:p}=e,{data:v,error:_}=await ge(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:h,data:(s=p==null?void 0:p.data)!==null&&s!==void 0?s:{},create_user:(a=p==null?void 0:p.shouldCreateUser)!==null&&a!==void 0?a:!0,gotrue_meta_security:{captcha_token:p==null?void 0:p.captchaToken},channel:(c=p==null?void 0:p.channel)!==null&&c!==void 0?c:"sms"}});return{data:{user:null,session:null,messageId:v==null?void 0:v.message_id},error:_}}throw new Cn("You must provide either an email or phone number.")}catch(h){if(pe(h))return{data:{user:null,session:null},error:h};throw h}}async verifyOtp(e){var r,n;try{let s,a;"options"in e&&(s=(r=e.options)===null||r===void 0?void 0:r.redirectTo,a=(n=e.options)===null||n===void 0?void 0:n.captchaToken);const{data:c,error:h}=await ge(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:a}}),redirectTo:s,xform:Rt});if(h)throw h;if(!c)throw new Error("An error occurred on token verification.");const p=c.session,v=c.user;return p!=null&&p.access_token&&(await this._saveSession(p),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",p)),{data:{user:v,session:p},error:null}}catch(s){if(pe(s))return{data:{user:null,session:null},error:s};throw s}}async signInWithSSO(e){var r,n,s;try{let a=null,c=null;return this.flowType==="pkce"&&([a,c]=await _r(this.storage,this.storageKey)),await ge(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(n=(r=e.options)===null||r===void 0?void 0:r.redirectTo)!==null&&n!==void 0?n:void 0}),!((s=e==null?void 0:e.options)===null||s===void 0)&&s.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:a,code_challenge_method:c}),headers:this.headers,xform:ol})}catch(a){if(pe(a))return{data:null,error:a};throw a}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:r},error:n}=e;if(n)throw n;if(!r)throw new Pt;const{error:s}=await ge(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:r.access_token});return{data:{user:null,session:null},error:s}})}catch(e){if(pe(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{const r=`${this.url}/resend`;if("email"in e){const{email:n,type:s,options:a}=e,{error:c}=await ge(this.fetch,"POST",r,{headers:this.headers,body:{email:n,type:s,gotrue_meta_security:{captcha_token:a==null?void 0:a.captchaToken}},redirectTo:a==null?void 0:a.emailRedirectTo});return{data:{user:null,session:null},error:c}}else if("phone"in e){const{phone:n,type:s,options:a}=e,{data:c,error:h}=await ge(this.fetch,"POST",r,{headers:this.headers,body:{phone:n,type:s,gotrue_meta_security:{captcha_token:a==null?void 0:a.captchaToken}}});return{data:{user:null,session:null,messageId:c==null?void 0:c.message_id},error:h}}throw new Cn("You must provide either an email or phone number and a type")}catch(r){if(pe(r))return{data:{user:null,session:null},error:r};throw r}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async r=>r))}async _acquireLock(e,r){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const n=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),s=(async()=>(await n,await r()))();return this.pendingInLock.push((async()=>{try{await s}catch{}})()),s}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const n=r();for(this.pendingInLock.push((async()=>{try{await n}catch{}})()),await n;this.pendingInLock.length;){const s=[...this.pendingInLock];await Promise.all(s),this.pendingInLock.splice(0,s.length)}return await n}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const r=await this.__loadSession();return await e(r)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const r=await $n(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",r),r!==null&&(this._isValidSession(r)?e=r:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const n=e.expires_at?e.expires_at<=Date.now()/1e3:!1;if(this._debug("#__loadSession()",`session has${n?"":" not"} expired`,"expires_at",e.expires_at),!n){if(this.storage.isServer){let c=this.suppressGetSessionWarning;e=new Proxy(e,{get:(p,v,_)=>(!c&&v==="user"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and many not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),c=!0,this.suppressGetSessionWarning=!0),Reflect.get(p,v,_))})}return{data:{session:e},error:null}}const{session:s,error:a}=await this._callRefreshToken(e.refresh_token);return a?{data:{session:null},error:a}:{data:{session:s},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){return e?await this._getUser(e):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(e){try{return e?await ge(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:$t}):await this._useSession(async r=>{var n,s,a;const{data:c,error:h}=r;if(h)throw h;return!(!((n=c.session)===null||n===void 0)&&n.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new Pt}:await ge(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(a=(s=c.session)===null||s===void 0?void 0:s.access_token)!==null&&a!==void 0?a:void 0,xform:$t})})}catch(r){if(pe(r))return Xc(r)&&(await this._removeSession(),await Dn(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:r};throw r}}async updateUser(e,r={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,r))}async _updateUser(e,r={}){try{return await this._useSession(async n=>{const{data:s,error:a}=n;if(a)throw a;if(!s.session)throw new Pt;const c=s.session;let h=null,p=null;this.flowType==="pkce"&&e.email!=null&&([h,p]=await _r(this.storage,this.storageKey));const{data:v,error:_}=await ge(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:r==null?void 0:r.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:h,code_challenge_method:p}),jwt:c.access_token,xform:$t});if(_)throw _;return c.user=v.user,await this._saveSession(c),await this._notifyAllSubscribers("USER_UPDATED",c),{data:{user:c.user},error:null}})}catch(n){if(pe(n))return{data:{user:null},error:n};throw n}}_decodeJWT(e){return ii(e)}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new Pt;const r=Date.now()/1e3;let n=r,s=!0,a=null;const c=ii(e.access_token);if(c.exp&&(n=c.exp,s=n<=r),s){const{session:h,error:p}=await this._callRefreshToken(e.refresh_token);if(p)return{data:{user:null,session:null},error:p};if(!h)return{data:{user:null,session:null},error:null};a=h}else{const{data:h,error:p}=await this._getUser(e.access_token);if(p)throw p;a={access_token:e.access_token,refresh_token:e.refresh_token,user:h.user,token_type:"bearer",expires_in:n-r,expires_at:n},await this._saveSession(a),await this._notifyAllSubscribers("SIGNED_IN",a)}return{data:{user:a.user,session:a},error:null}}catch(r){if(pe(r))return{data:{session:null,user:null},error:r};throw r}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async r=>{var n;if(!e){const{data:c,error:h}=r;if(h)throw h;e=(n=c.session)!==null&&n!==void 0?n:void 0}if(!(e!=null&&e.refresh_token))throw new Pt;const{session:s,error:a}=await this._callRefreshToken(e.refresh_token);return a?{data:{user:null,session:null},error:a}:s?{data:{user:s.user,session:s},error:null}:{data:{user:null,session:null},error:null}})}catch(r){if(pe(r))return{data:{user:null,session:null},error:r};throw r}}async _getSessionFromURL(e){try{if(!ut())throw new jn("No browser detected.");if(this.flowType==="implicit"&&!this._isImplicitGrantFlow())throw new jn("Not a valid implicit grant flow url.");if(this.flowType=="pkce"&&!e)throw new ai("Not a valid PKCE flow url.");const r=Zo(window.location.href);if(e){if(!r.code)throw new ai("No code detected.");const{data:se,error:ae}=await this._exchangeCodeForSession(r.code);if(ae)throw ae;const le=new URL(window.location.href);return le.searchParams.delete("code"),window.history.replaceState(window.history.state,"",le.toString()),{data:{session:se.session,redirectType:null},error:null}}if(r.error||r.error_description||r.error_code)throw new jn(r.error_description||"Error in URL with unspecified error_description",{error:r.error||"unspecified_error",code:r.error_code||"unspecified_code"});const{provider_token:n,provider_refresh_token:s,access_token:a,refresh_token:c,expires_in:h,expires_at:p,token_type:v}=r;if(!a||!h||!c||!v)throw new jn("No session defined in URL");const _=Math.round(Date.now()/1e3),I=parseInt(h);let U=_+I;p&&(U=parseInt(p));const q=U-_;q*1e3<=qr&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${q}s, should have been closer to ${I}s`);const G=U-I;_-G>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",G,U,_):_-G<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",G,U,_);const{data:F,error:V}=await this._getUser(a);if(V)throw V;const oe={provider_token:n,provider_refresh_token:s,access_token:a,expires_in:I,expires_at:U,refresh_token:c,token_type:v,user:F.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:oe,redirectType:r.type},error:null}}catch(r){if(pe(r))return{data:{session:null,redirectType:null},error:r};throw r}}_isImplicitGrantFlow(){const e=Zo(window.location.href);return!!(ut()&&(e.access_token||e.error_description))}async _isPKCEFlow(){const e=Zo(window.location.href),r=await $n(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&r)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async r=>{var n;const{data:s,error:a}=r;if(a)return{error:a};const c=(n=s.session)===null||n===void 0?void 0:n.access_token;if(c){const{error:h}=await this.admin.signOut(c,e);if(h&&!(Qc(h)&&(h.status===404||h.status===401||h.status===403)))return{error:h}}return e!=="others"&&(await this._removeSession(),await Dn(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(e){const r=Fc(),n={id:r,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",r),this.stateChangeEmitters.delete(r)}};return this._debug("#onAuthStateChange()","registered callback with id",r),this.stateChangeEmitters.set(r,n),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(r)})))(),{data:{subscription:n}}}async _emitInitialSession(e){return await this._useSession(async r=>{var n,s;try{const{data:{session:a},error:c}=r;if(c)throw c;await((n=this.stateChangeEmitters.get(e))===null||n===void 0?void 0:n.callback("INITIAL_SESSION",a)),this._debug("INITIAL_SESSION","callback id",e,"session",a)}catch(a){await((s=this.stateChangeEmitters.get(e))===null||s===void 0?void 0:s.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",a),console.error(a)}})}async resetPasswordForEmail(e,r={}){let n=null,s=null;this.flowType==="pkce"&&([n,s]=await _r(this.storage,this.storageKey,!0));try{return await ge(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:n,code_challenge_method:s,gotrue_meta_security:{captcha_token:r.captchaToken}},headers:this.headers,redirectTo:r.redirectTo})}catch(a){if(pe(a))return{data:null,error:a};throw a}}async getUserIdentities(){var e;try{const{data:r,error:n}=await this.getUser();if(n)throw n;return{data:{identities:(e=r.user.identities)!==null&&e!==void 0?e:[]},error:null}}catch(r){if(pe(r))return{data:null,error:r};throw r}}async linkIdentity(e){var r;try{const{data:n,error:s}=await this._useSession(async a=>{var c,h,p,v,_;const{data:I,error:U}=a;if(U)throw U;const q=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(c=e.options)===null||c===void 0?void 0:c.redirectTo,scopes:(h=e.options)===null||h===void 0?void 0:h.scopes,queryParams:(p=e.options)===null||p===void 0?void 0:p.queryParams,skipBrowserRedirect:!0});return await ge(this.fetch,"GET",q,{headers:this.headers,jwt:(_=(v=I.session)===null||v===void 0?void 0:v.access_token)!==null&&_!==void 0?_:void 0})});if(s)throw s;return ut()&&!(!((r=e.options)===null||r===void 0)&&r.skipBrowserRedirect)&&window.location.assign(n==null?void 0:n.url),{data:{provider:e.provider,url:n==null?void 0:n.url},error:null}}catch(n){if(pe(n))return{data:{provider:e.provider,url:null},error:n};throw n}}async unlinkIdentity(e){try{return await this._useSession(async r=>{var n,s;const{data:a,error:c}=r;if(c)throw c;return await ge(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(s=(n=a.session)===null||n===void 0?void 0:n.access_token)!==null&&s!==void 0?s:void 0})})}catch(r){if(pe(r))return{data:null,error:r};throw r}}async _refreshAccessToken(e){const r=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(r,"begin");try{const n=Date.now();return await Bc(async s=>(s>0&&await qc(200*Math.pow(2,s-1)),this._debug(r,"refreshing attempt",s),await ge(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:Rt})),(s,a)=>{const c=200*Math.pow(2,s);return a&&Ko(a)&&Date.now()+c-n<qr})}catch(n){if(this._debug(r,"error",n),pe(n))return{data:{session:null,user:null},error:n};throw n}finally{this._debug(r,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,r){const n=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:r.redirectTo,scopes:r.scopes,queryParams:r.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",r,"url",n),ut()&&!r.skipBrowserRedirect&&window.location.assign(n),{data:{provider:e,url:n},error:null}}async _recoverAndRefresh(){var e;const r="#_recoverAndRefresh()";this._debug(r,"begin");try{const n=await $n(this.storage,this.storageKey);if(this._debug(r,"session from storage",n),!this._isValidSession(n)){this._debug(r,"session is not valid"),n!==null&&await this._removeSession();return}const s=Math.round(Date.now()/1e3),a=((e=n.expires_at)!==null&&e!==void 0?e:1/0)<s+si;if(this._debug(r,`session has${a?"":" not"} expired with margin of ${si}s`),a){if(this.autoRefreshToken&&n.refresh_token){const{error:c}=await this._callRefreshToken(n.refresh_token);c&&(console.error(c),Ko(c)||(this._debug(r,"refresh failed with a non-retryable error, removing the session",c),await this._removeSession()))}}else await this._notifyAllSubscribers("SIGNED_IN",n)}catch(n){this._debug(r,"error",n),console.error(n);return}finally{this._debug(r,"end")}}async _callRefreshToken(e){var r,n;if(!e)throw new Pt;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const s=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(s,"begin");try{this.refreshingDeferred=new Qn;const{data:a,error:c}=await this._refreshAccessToken(e);if(c)throw c;if(!a.session)throw new Pt;await this._saveSession(a.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",a.session);const h={session:a.session,error:null};return this.refreshingDeferred.resolve(h),h}catch(a){if(this._debug(s,"error",a),pe(a)){const c={session:null,error:a};return Ko(a)||await this._removeSession(),(r=this.refreshingDeferred)===null||r===void 0||r.resolve(c),c}throw(n=this.refreshingDeferred)===null||n===void 0||n.reject(a),a}finally{this.refreshingDeferred=null,this._debug(s,"end")}}async _notifyAllSubscribers(e,r,n=!0){const s=`#_notifyAllSubscribers(${e})`;this._debug(s,"begin",r,`broadcast = ${n}`);try{this.broadcastChannel&&n&&this.broadcastChannel.postMessage({event:e,session:r});const a=[],c=Array.from(this.stateChangeEmitters.values()).map(async h=>{try{await h.callback(e,r)}catch(p){a.push(p)}});if(await Promise.all(c),a.length>0){for(let h=0;h<a.length;h+=1)console.error(a[h]);throw a[0]}}finally{this._debug(s,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0,await oa(this.storage,this.storageKey,e)}async _removeSession(){this._debug("#_removeSession()"),await Dn(this.storage,this.storageKey),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&ut()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(r){console.error("removing visibilitychange callback failed",r)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),qr);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async r=>{const{data:{session:n}}=r;if(!n||!n.refresh_token||!n.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const s=Math.floor((n.expires_at*1e3-e)/qr);this._debug("#_autoRefreshTokenTick()",`access token expires in ${s} ticks, a tick lasts ${qr}ms, refresh threshold is ${hi} ticks`),s<=hi&&await this._callRefreshToken(n.refresh_token)})}catch(r){console.error("Auto refresh tick failed with error. This is likely a transient error.",r)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof ia)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!ut()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const r=`#_onVisibilityChanged(${e})`;this._debug(r,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(r,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,r,n){const s=[`provider=${encodeURIComponent(r)}`];if(n!=null&&n.redirectTo&&s.push(`redirect_to=${encodeURIComponent(n.redirectTo)}`),n!=null&&n.scopes&&s.push(`scopes=${encodeURIComponent(n.scopes)}`),this.flowType==="pkce"){const[a,c]=await _r(this.storage,this.storageKey),h=new URLSearchParams({code_challenge:`${encodeURIComponent(a)}`,code_challenge_method:`${encodeURIComponent(c)}`});s.push(h.toString())}if(n!=null&&n.queryParams){const a=new URLSearchParams(n.queryParams);s.push(a.toString())}return n!=null&&n.skipBrowserRedirect&&s.push(`skip_http_redirect=${n.skipBrowserRedirect}`),`${e}?${s.join("&")}`}async _unenroll(e){try{return await this._useSession(async r=>{var n;const{data:s,error:a}=r;return a?{data:null,error:a}:await ge(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(n=s==null?void 0:s.session)===null||n===void 0?void 0:n.access_token})})}catch(r){if(pe(r))return{data:null,error:r};throw r}}async _enroll(e){try{return await this._useSession(async r=>{var n,s;const{data:a,error:c}=r;if(c)return{data:null,error:c};const h=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:{issuer:e.issuer}),{data:p,error:v}=await ge(this.fetch,"POST",`${this.url}/factors`,{body:h,headers:this.headers,jwt:(n=a==null?void 0:a.session)===null||n===void 0?void 0:n.access_token});return v?{data:null,error:v}:(e.factorType==="totp"&&(!((s=p==null?void 0:p.totp)===null||s===void 0)&&s.qr_code)&&(p.totp.qr_code=`data:image/svg+xml;utf-8,${p.totp.qr_code}`),{data:p,error:null})})}catch(r){if(pe(r))return{data:null,error:r};throw r}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async r=>{var n;const{data:s,error:a}=r;if(a)return{data:null,error:a};const{data:c,error:h}=await ge(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:(n=s==null?void 0:s.session)===null||n===void 0?void 0:n.access_token});return h?{data:null,error:h}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+c.expires_in},c)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",c),{data:c,error:h})})}catch(r){if(pe(r))return{data:null,error:r};throw r}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async r=>{var n;const{data:s,error:a}=r;return a?{data:null,error:a}:await ge(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:{channel:e.channel},headers:this.headers,jwt:(n=s==null?void 0:s.session)===null||n===void 0?void 0:n.access_token})})}catch(r){if(pe(r))return{data:null,error:r};throw r}})}async _challengeAndVerify(e){const{data:r,error:n}=await this._challenge({factorId:e.factorId});return n?{data:null,error:n}:await this._verify({factorId:e.factorId,challengeId:r.id,code:e.code})}async _listFactors(){const{data:{user:e},error:r}=await this.getUser();if(r)return{data:null,error:r};const n=(e==null?void 0:e.factors)||[],s=n.filter(c=>c.factor_type==="totp"&&c.status==="verified"),a=n.filter(c=>c.factor_type==="phone"&&c.status==="verified");return{data:{all:n,totp:s,phone:a},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async e=>{var r,n;const{data:{session:s},error:a}=e;if(a)return{data:null,error:a};if(!s)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const c=this._decodeJWT(s.access_token);let h=null;c.aal&&(h=c.aal);let p=h;((n=(r=s.user.factors)===null||r===void 0?void 0:r.filter(I=>I.status==="verified"))!==null&&n!==void 0?n:[]).length>0&&(p="aal2");const _=c.amr||[];return{data:{currentLevel:h,nextLevel:p,currentAuthenticationMethods:_},error:null}}))}}Hr.nextInstanceID=0;const ml=Hr;class vl extends ml{constructor(e){super(e)}}var gl=function(t,e,r,n){function s(a){return a instanceof r?a:new r(function(c){c(a)})}return new(r||(r=Promise))(function(a,c){function h(_){try{v(n.next(_))}catch(I){c(I)}}function p(_){try{v(n.throw(_))}catch(I){c(I)}}function v(_){_.done?a(_.value):s(_.value).then(h,p)}v((n=n.apply(t,e||[])).next())})};class yl{constructor(e,r,n){var s,a,c;if(this.supabaseUrl=e,this.supabaseKey=r,!e)throw new Error("supabaseUrl is required.");if(!r)throw new Error("supabaseKey is required.");const h=Dc(e);this.realtimeUrl=`${h}/realtime/v1`.replace(/^http/i,"ws"),this.authUrl=`${h}/auth/v1`,this.storageUrl=`${h}/storage/v1`,this.functionsUrl=`${h}/functions/v1`;const p=`sb-${new URL(this.authUrl).hostname.split(".")[0]}-auth-token`,v={db:Sc,realtime:Tc,auth:Object.assign(Object.assign({},Ac),{storageKey:p}),global:Oc},_=Cc(n??{},v);this.storageKey=(s=_.auth.storageKey)!==null&&s!==void 0?s:"",this.headers=(a=_.global.headers)!==null&&a!==void 0?a:{},_.accessToken?(this.accessToken=_.accessToken,this.auth=new Proxy({},{get:(I,U)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(U)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((c=_.auth)!==null&&c!==void 0?c:{},this.headers,_.global.fetch),this.fetch=Ic(r,this._getAccessToken.bind(this),_.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers},_.realtime)),this.rest=new Ku(`${h}/rest/v1`,{headers:this.headers,schema:_.db.schema,fetch:this.fetch}),_.accessToken||this._listenForAuthEvents()}get functions(){return new wu(this.functionsUrl,{headers:this.headers,customFetch:this.fetch})}get storage(){return new bc(this.storageUrl,this.headers,this.fetch)}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,r={},n={}){return this.rest.rpc(e,r,n)}channel(e,r={config:{}}){return this.realtime.channel(e,r)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,r;return gl(this,void 0,void 0,function*(){if(this.accessToken)return yield this.accessToken();const{data:n}=yield this.auth.getSession();return(r=(e=n.session)===null||e===void 0?void 0:e.access_token)!==null&&r!==void 0?r:null})}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:r,detectSessionInUrl:n,storage:s,storageKey:a,flowType:c,lock:h,debug:p},v,_){var I;const U={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new vl({url:this.authUrl,headers:Object.assign(Object.assign({},U),v),storageKey:a,autoRefreshToken:e,persistSession:r,detectSessionInUrl:n,storage:s,flowType:c,lock:h,debug:p,fetch:_,hasCustomAuthorizationHeader:(I="Authorization"in this.headers)!==null&&I!==void 0?I:!1})}_initRealtimeClient(e){return new ac(this.realtimeUrl,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e==null?void 0:e.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((r,n)=>{this._handleTokenChanged(r,"CLIENT",n==null?void 0:n.access_token)})}_handleTokenChanged(e,r,n){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==n?(this.realtime.setAuth(n??null),this.changedAccessToken=n):e==="SIGNED_OUT"&&(this.realtime.setAuth(this.supabaseKey),r=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const _l=(t,e,r)=>new yl(t,e,r),wl="https://oqwvljqwtearyepyaslo.supabase.co",bl="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9xd3ZsanF3dGVhcnllcHlhc2xvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzEwODA1NjIsImV4cCI6MjA0NjY1NjU2Mn0.31HmSCfXawvkzhevPCaKWoVCZyD_elcQOCtgFWJMRKI",X=_l(wl,bl),Dt=as("auth",()=>{const t=ze(null),e=ze(null),r=ze(!1),n=ze(null),s=ot(()=>!!t.value),a=ot(()=>{var F,V;return((V=(F=t.value)==null?void 0:F.user_metadata)==null?void 0:V.role)==="admin"});return{user:t,session:e,loading:r,error:n,isAuthenticated:s,isAdmin:a,initializeAuth:async()=>{try{r.value=!0;const{data:{session:F}}=await X.auth.getSession();e.value=F,t.value=(F==null?void 0:F.user)||null;const{data:{subscription:V}}=X.auth.onAuthStateChange(async(oe,se)=>{e.value=se,t.value=(se==null?void 0:se.user)||null,oe==="SIGNED_IN"?console.log("User signed in:",t.value):oe==="SIGNED_OUT"&&console.log("User signed out")});return V}catch(F){n.value=F.message,console.error("Auth initialization error:",F)}finally{r.value=!1}},signUp:async(F,V,oe={})=>{try{r.value=!0,n.value=null;const{data:se,error:ae}=await X.auth.signUp({email:F,password:V,options:{data:oe}});if(ae)throw ae;return{success:!0,data:se}}catch(se){return n.value=se.message,{success:!1,error:se.message}}finally{r.value=!1}},signIn:async(F,V)=>{try{r.value=!0,n.value=null;const{data:oe,error:se}=await X.auth.signInWithPassword({email:F,password:V});if(se)throw se;return{success:!0,data:oe}}catch(oe){return n.value=oe.message,{success:!1,error:oe.message}}finally{r.value=!1}},signInWithGoogle:async()=>{try{r.value=!0,n.value=null;const{data:F,error:V}=await X.auth.signInWithOAuth({provider:"google",options:{redirectTo:`${window.location.origin}/auth/callback`}});if(V)throw V;return{success:!0,data:F}}catch(F){return n.value=F.message,{success:!1,error:F.message}}finally{r.value=!1}},signOut:async()=>{try{r.value=!0,n.value=null;const{error:F}=await X.auth.signOut();if(F)throw F;return t.value=null,e.value=null,{success:!0}}catch(F){return n.value=F.message,{success:!1,error:F.message}}finally{r.value=!1}},resetPassword:async F=>{try{r.value=!0,n.value=null;const{data:V,error:oe}=await X.auth.resetPasswordForEmail(F,{redirectTo:`${window.location.origin}/auth/reset-password`});if(oe)throw oe;return{success:!0,data:V}}catch(V){return n.value=V.message,{success:!1,error:V.message}}finally{r.value=!1}},updatePassword:async F=>{try{r.value=!0,n.value=null;const{data:V,error:oe}=await X.auth.updateUser({password:F});if(oe)throw oe;return{success:!0,data:V}}catch(V){return n.value=V.message,{success:!1,error:V.message}}finally{r.value=!1}},updateProfile:async F=>{try{r.value=!0,n.value=null;const{data:V,error:oe}=await X.auth.updateUser({data:F});if(oe)throw oe;return t.value=V.user,{success:!0,data:V}}catch(V){return n.value=V.message,{success:!1,error:V.message}}finally{r.value=!1}},clearError:()=>{n.value=null}}}),we={UNAUTHORIZED:"UNAUTHORIZED",FORBIDDEN:"FORBIDDEN",NOT_FOUND:"NOT_FOUND",VALIDATION_ERROR:"VALIDATION_ERROR",DUPLICATE_VOTE:"DUPLICATE_VOTE",SELF_VOTE:"SELF_VOTE",RATE_LIMITED:"RATE_LIMITED",CONTENT_FLAGGED:"CONTENT_FLAGGED",INSUFFICIENT_REPUTATION:"INSUFFICIENT_REPUTATION"};function L(t,e,r){function n(h,p){var v;Object.defineProperty(h,"_zod",{value:h._zod??{},enumerable:!1}),(v=h._zod).traits??(v.traits=new Set),h._zod.traits.add(t),e(h,p);for(const _ in c.prototype)_ in h||Object.defineProperty(h,_,{value:c.prototype[_].bind(h)});h._zod.constr=c,h._zod.def=p}const s=(r==null?void 0:r.Parent)??Object;class a extends s{}Object.defineProperty(a,"name",{value:t});function c(h){var p;const v=r!=null&&r.Parent?new a:this;n(v,h),(p=v._zod).deferred??(p.deferred=[]);for(const _ of v._zod.deferred)_();return v}return Object.defineProperty(c,"init",{value:n}),Object.defineProperty(c,Symbol.hasInstance,{value:h=>{var p,v;return r!=null&&r.Parent&&h instanceof r.Parent?!0:(v=(p=h==null?void 0:h._zod)==null?void 0:p.traits)==null?void 0:v.has(t)}}),Object.defineProperty(c,"name",{value:t}),c}class Gr extends Error{constructor(){super("Encountered Promise during synchronous parse. Use .parseAsync() instead.")}}const aa={};function Ct(t){return aa}function kl(t){const e=Object.values(t).filter(n=>typeof n=="number");return Object.entries(t).filter(([n,s])=>e.indexOf(+n)===-1).map(([n,s])=>s)}function El(t,e){return typeof e=="bigint"?e.toString():e}function ua(t){return{get value(){{const e=t();return Object.defineProperty(this,"value",{value:e}),e}}}}function fs(t){return t==null}function ps(t){const e=t.startsWith("^")?1:0,r=t.endsWith("$")?t.length-1:t.length;return t.slice(e,r)}function Ol(t,e){const r=(t.toString().split(".")[1]||"").length,n=(e.toString().split(".")[1]||"").length,s=r>n?r:n,a=Number.parseInt(t.toFixed(s).replace(".","")),c=Number.parseInt(e.toFixed(s).replace(".",""));return a%c/10**s}function Se(t,e,r){Object.defineProperty(t,e,{get(){{const n=r();return t[e]=n,n}},set(n){Object.defineProperty(t,e,{value:n})},configurable:!0})}function ms(t,e,r){Object.defineProperty(t,e,{value:r,writable:!0,enumerable:!0,configurable:!0})}function Br(t){return JSON.stringify(t)}const ca=Error.captureStackTrace?Error.captureStackTrace:(...t)=>{};function rs(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)}const Sl=ua(()=>{var t;if(typeof navigator<"u"&&((t=navigator==null?void 0:navigator.userAgent)!=null&&t.includes("Cloudflare")))return!1;try{const e=Function;return new e(""),!0}catch{return!1}});function Zn(t){if(rs(t)===!1)return!1;const e=t.constructor;if(e===void 0)return!0;const r=e.prototype;return!(rs(r)===!1||Object.prototype.hasOwnProperty.call(r,"isPrototypeOf")===!1)}const Al=new Set(["string","number","symbol"]);function Xn(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function nr(t,e,r){const n=new t._zod.constr(e??t._zod.def);return(!e||r!=null&&r.parent)&&(n._zod.parent=t),n}function re(t){const e=t;if(!e)return{};if(typeof e=="string")return{error:()=>e};if((e==null?void 0:e.message)!==void 0){if((e==null?void 0:e.error)!==void 0)throw new Error("Cannot specify both `message` and `error` params");e.error=e.message}return delete e.message,typeof e.error=="string"?{...e,error:()=>e.error}:e}function Tl(t){return Object.keys(t).filter(e=>t[e]._zod.optin==="optional"&&t[e]._zod.optout==="optional")}const xl={safeint:[Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],int32:[-2147483648,2147483647],uint32:[0,4294967295],float32:[-34028234663852886e22,34028234663852886e22],float64:[-Number.MAX_VALUE,Number.MAX_VALUE]};function Pl(t,e){const r={},n=t._zod.def;for(const s in e){if(!(s in n.shape))throw new Error(`Unrecognized key: "${s}"`);e[s]&&(r[s]=n.shape[s])}return nr(t,{...t._zod.def,shape:r,checks:[]})}function Rl(t,e){const r={...t._zod.def.shape},n=t._zod.def;for(const s in e){if(!(s in n.shape))throw new Error(`Unrecognized key: "${s}"`);e[s]&&delete r[s]}return nr(t,{...t._zod.def,shape:r,checks:[]})}function Il(t,e){if(!Zn(e))throw new Error("Invalid input to extend: expected a plain object");const r={...t._zod.def,get shape(){const n={...t._zod.def.shape,...e};return ms(this,"shape",n),n},checks:[]};return nr(t,r)}function $l(t,e){return nr(t,{...t._zod.def,get shape(){const r={...t._zod.def.shape,...e._zod.def.shape};return ms(this,"shape",r),r},catchall:e._zod.def.catchall,checks:[]})}function Dl(t,e,r){const n=e._zod.def.shape,s={...n};if(r)for(const a in r){if(!(a in n))throw new Error(`Unrecognized key: "${a}"`);r[a]&&(s[a]=t?new t({type:"optional",innerType:n[a]}):n[a])}else for(const a in n)s[a]=t?new t({type:"optional",innerType:n[a]}):n[a];return nr(e,{...e._zod.def,shape:s,checks:[]})}function Cl(t,e,r){const n=e._zod.def.shape,s={...n};if(r)for(const a in r){if(!(a in s))throw new Error(`Unrecognized key: "${a}"`);r[a]&&(s[a]=new t({type:"nonoptional",innerType:n[a]}))}else for(const a in n)s[a]=new t({type:"nonoptional",innerType:n[a]});return nr(e,{...e._zod.def,shape:s,checks:[]})}function Wr(t,e=0){var r;for(let n=e;n<t.issues.length;n++)if(((r=t.issues[n])==null?void 0:r.continue)!==!0)return!0;return!1}function Xt(t,e){return e.map(r=>{var n;return(n=r).path??(n.path=[]),r.path.unshift(t),r})}function zn(t){return typeof t=="string"?t:t==null?void 0:t.message}function jt(t,e,r){var s,a,c,h,p,v;const n={...t,path:t.path??[]};if(!t.message){const _=zn((c=(a=(s=t.inst)==null?void 0:s._zod.def)==null?void 0:a.error)==null?void 0:c.call(a,t))??zn((h=e==null?void 0:e.error)==null?void 0:h.call(e,t))??zn((p=r.customError)==null?void 0:p.call(r,t))??zn((v=r.localeError)==null?void 0:v.call(r,t))??"Invalid input";n.message=_}return delete n.inst,delete n.continue,e!=null&&e.reportInput||delete n.input,n}function vs(t){return Array.isArray(t)?"array":typeof t=="string"?"string":"unknown"}function Jr(...t){const[e,r,n]=t;return typeof e=="string"?{message:e,code:"custom",input:r,inst:n}:{...e}}const la=(t,e)=>{t.name="$ZodError",Object.defineProperty(t,"_zod",{value:t._zod,enumerable:!1}),Object.defineProperty(t,"issues",{value:e,enumerable:!1}),Object.defineProperty(t,"message",{get(){return JSON.stringify(e,El,2)},enumerable:!0}),Object.defineProperty(t,"toString",{value:()=>t.message,enumerable:!1})},da=L("$ZodError",la),ha=L("$ZodError",la,{Parent:Error});function jl(t,e=r=>r.message){const r={},n=[];for(const s of t.issues)s.path.length>0?(r[s.path[0]]=r[s.path[0]]||[],r[s.path[0]].push(e(s))):n.push(e(s));return{formErrors:n,fieldErrors:r}}function zl(t,e){const r=e||function(a){return a.message},n={_errors:[]},s=a=>{for(const c of a.issues)if(c.code==="invalid_union"&&c.errors.length)c.errors.map(h=>s({issues:h}));else if(c.code==="invalid_key")s({issues:c.issues});else if(c.code==="invalid_element")s({issues:c.issues});else if(c.path.length===0)n._errors.push(r(c));else{let h=n,p=0;for(;p<c.path.length;){const v=c.path[p];p===c.path.length-1?(h[v]=h[v]||{_errors:[]},h[v]._errors.push(r(c))):h[v]=h[v]||{_errors:[]},h=h[v],p++}}};return s(t),n}const Ul=t=>(e,r,n,s)=>{const a=n?Object.assign(n,{async:!1}):{async:!1},c=e._zod.run({value:r,issues:[]},a);if(c instanceof Promise)throw new Gr;if(c.issues.length){const h=new((s==null?void 0:s.Err)??t)(c.issues.map(p=>jt(p,a,Ct())));throw ca(h,s==null?void 0:s.callee),h}return c.value},Nl=t=>async(e,r,n,s)=>{const a=n?Object.assign(n,{async:!0}):{async:!0};let c=e._zod.run({value:r,issues:[]},a);if(c instanceof Promise&&(c=await c),c.issues.length){const h=new((s==null?void 0:s.Err)??t)(c.issues.map(p=>jt(p,a,Ct())));throw ca(h,s==null?void 0:s.callee),h}return c.value},fa=t=>(e,r,n)=>{const s=n?{...n,async:!1}:{async:!1},a=e._zod.run({value:r,issues:[]},s);if(a instanceof Promise)throw new Gr;return a.issues.length?{success:!1,error:new(t??da)(a.issues.map(c=>jt(c,s,Ct())))}:{success:!0,data:a.value}},Fl=fa(ha),pa=t=>async(e,r,n)=>{const s=n?Object.assign(n,{async:!0}):{async:!0};let a=e._zod.run({value:r,issues:[]},s);return a instanceof Promise&&(a=await a),a.issues.length?{success:!1,error:new t(a.issues.map(c=>jt(c,s,Ct())))}:{success:!0,data:a.value}},Ll=pa(ha),Ml=/^[cC][^\s-]{8,}$/,ql=/^[0-9a-z]+$/,Bl=/^[0-9A-HJKMNP-TV-Za-hjkmnp-tv-z]{26}$/,Zl=/^[0-9a-vA-V]{20}$/,Vl=/^[A-Za-z0-9]{27}$/,Kl=/^[a-zA-Z0-9_-]{21}$/,Wl=/^P(?:(\d+W)|(?!.*W)(?=\d|T\d)(\d+Y)?(\d+M)?(\d+D)?(T(?=\d)(\d+H)?(\d+M)?(\d+([.,]\d+)?S)?)?)$/,Hl=/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12})$/,pi=t=>t?new RegExp(`^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-${t}[0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12})$`):/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1-8][0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}|00000000-0000-0000-0000-000000000000)$/,Gl=/^(?!\.)(?!.*\.\.)([A-Za-z0-9_'+\-\.]*)[A-Za-z0-9_+-]@([A-Za-z0-9][A-Za-z0-9\-]*\.)+[A-Za-z]{2,}$/,Jl="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";function Yl(){return new RegExp(Jl,"u")}const Ql=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,Xl=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|::|([0-9a-fA-F]{1,4})?::([0-9a-fA-F]{1,4}:?){0,6})$/,ed=/^((25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/([0-9]|[1-2][0-9]|3[0-2])$/,td=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|::|([0-9a-fA-F]{1,4})?::([0-9a-fA-F]{1,4}:?){0,6})\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,rd=/^$|^(?:[0-9a-zA-Z+/]{4})*(?:(?:[0-9a-zA-Z+/]{2}==)|(?:[0-9a-zA-Z+/]{3}=))?$/,ma=/^[A-Za-z0-9_-]*$/,nd=/^([a-zA-Z0-9-]+\.)*[a-zA-Z0-9-]+$/,od=/^\+(?:[0-9]){6,14}[0-9]$/,va="(?:(?:\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-(?:(?:0[13578]|1[02])-(?:0[1-9]|[12]\\d|3[01])|(?:0[469]|11)-(?:0[1-9]|[12]\\d|30)|(?:02)-(?:0[1-9]|1\\d|2[0-8])))",sd=new RegExp(`^${va}$`);function ga(t){const e="(?:[01]\\d|2[0-3]):[0-5]\\d";return typeof t.precision=="number"?t.precision===-1?`${e}`:t.precision===0?`${e}:[0-5]\\d`:`${e}:[0-5]\\d\\.\\d{${t.precision}}`:`${e}(?::[0-5]\\d(?:\\.\\d+)?)?`}function id(t){return new RegExp(`^${ga(t)}$`)}function ad(t){const e=ga({precision:t.precision}),r=["Z"];t.local&&r.push(""),t.offset&&r.push("([+-]\\d{2}:\\d{2})");const n=`${e}(?:${r.join("|")})`;return new RegExp(`^${va}T(?:${n})$`)}const ud=t=>{const e=t?`[\\s\\S]{${(t==null?void 0:t.minimum)??0},${(t==null?void 0:t.maximum)??""}}`:"[\\s\\S]*";return new RegExp(`^${e}$`)},cd=/^\d+$/,ld=/^-?\d+(?:\.\d+)?/i,dd=/true|false/i,hd=/^[^A-Z]*$/,fd=/^[^a-z]*$/,tt=L("$ZodCheck",(t,e)=>{var r;t._zod??(t._zod={}),t._zod.def=e,(r=t._zod).onattach??(r.onattach=[])}),ya={number:"number",bigint:"bigint",object:"date"},_a=L("$ZodCheckLessThan",(t,e)=>{tt.init(t,e);const r=ya[typeof e.value];t._zod.onattach.push(n=>{const s=n._zod.bag,a=(e.inclusive?s.maximum:s.exclusiveMaximum)??Number.POSITIVE_INFINITY;e.value<a&&(e.inclusive?s.maximum=e.value:s.exclusiveMaximum=e.value)}),t._zod.check=n=>{(e.inclusive?n.value<=e.value:n.value<e.value)||n.issues.push({origin:r,code:"too_big",maximum:e.value,input:n.value,inclusive:e.inclusive,inst:t,continue:!e.abort})}}),wa=L("$ZodCheckGreaterThan",(t,e)=>{tt.init(t,e);const r=ya[typeof e.value];t._zod.onattach.push(n=>{const s=n._zod.bag,a=(e.inclusive?s.minimum:s.exclusiveMinimum)??Number.NEGATIVE_INFINITY;e.value>a&&(e.inclusive?s.minimum=e.value:s.exclusiveMinimum=e.value)}),t._zod.check=n=>{(e.inclusive?n.value>=e.value:n.value>e.value)||n.issues.push({origin:r,code:"too_small",minimum:e.value,input:n.value,inclusive:e.inclusive,inst:t,continue:!e.abort})}}),pd=L("$ZodCheckMultipleOf",(t,e)=>{tt.init(t,e),t._zod.onattach.push(r=>{var n;(n=r._zod.bag).multipleOf??(n.multipleOf=e.value)}),t._zod.check=r=>{if(typeof r.value!=typeof e.value)throw new Error("Cannot mix number and bigint in multiple_of check.");(typeof r.value=="bigint"?r.value%e.value===BigInt(0):Ol(r.value,e.value)===0)||r.issues.push({origin:typeof r.value,code:"not_multiple_of",divisor:e.value,input:r.value,inst:t,continue:!e.abort})}}),md=L("$ZodCheckNumberFormat",(t,e)=>{var c;tt.init(t,e),e.format=e.format||"float64";const r=(c=e.format)==null?void 0:c.includes("int"),n=r?"int":"number",[s,a]=xl[e.format];t._zod.onattach.push(h=>{const p=h._zod.bag;p.format=e.format,p.minimum=s,p.maximum=a,r&&(p.pattern=cd)}),t._zod.check=h=>{const p=h.value;if(r){if(!Number.isInteger(p)){h.issues.push({expected:n,format:e.format,code:"invalid_type",input:p,inst:t});return}if(!Number.isSafeInteger(p)){p>0?h.issues.push({input:p,code:"too_big",maximum:Number.MAX_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:t,origin:n,continue:!e.abort}):h.issues.push({input:p,code:"too_small",minimum:Number.MIN_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:t,origin:n,continue:!e.abort});return}}p<s&&h.issues.push({origin:"number",input:p,code:"too_small",minimum:s,inclusive:!0,inst:t,continue:!e.abort}),p>a&&h.issues.push({origin:"number",input:p,code:"too_big",maximum:a,inst:t})}}),vd=L("$ZodCheckMaxLength",(t,e)=>{var r;tt.init(t,e),(r=t._zod.def).when??(r.when=n=>{const s=n.value;return!fs(s)&&s.length!==void 0}),t._zod.onattach.push(n=>{const s=n._zod.bag.maximum??Number.POSITIVE_INFINITY;e.maximum<s&&(n._zod.bag.maximum=e.maximum)}),t._zod.check=n=>{const s=n.value;if(s.length<=e.maximum)return;const c=vs(s);n.issues.push({origin:c,code:"too_big",maximum:e.maximum,inclusive:!0,input:s,inst:t,continue:!e.abort})}}),gd=L("$ZodCheckMinLength",(t,e)=>{var r;tt.init(t,e),(r=t._zod.def).when??(r.when=n=>{const s=n.value;return!fs(s)&&s.length!==void 0}),t._zod.onattach.push(n=>{const s=n._zod.bag.minimum??Number.NEGATIVE_INFINITY;e.minimum>s&&(n._zod.bag.minimum=e.minimum)}),t._zod.check=n=>{const s=n.value;if(s.length>=e.minimum)return;const c=vs(s);n.issues.push({origin:c,code:"too_small",minimum:e.minimum,inclusive:!0,input:s,inst:t,continue:!e.abort})}}),yd=L("$ZodCheckLengthEquals",(t,e)=>{var r;tt.init(t,e),(r=t._zod.def).when??(r.when=n=>{const s=n.value;return!fs(s)&&s.length!==void 0}),t._zod.onattach.push(n=>{const s=n._zod.bag;s.minimum=e.length,s.maximum=e.length,s.length=e.length}),t._zod.check=n=>{const s=n.value,a=s.length;if(a===e.length)return;const c=vs(s),h=a>e.length;n.issues.push({origin:c,...h?{code:"too_big",maximum:e.length}:{code:"too_small",minimum:e.length},inclusive:!0,exact:!0,input:n.value,inst:t,continue:!e.abort})}}),eo=L("$ZodCheckStringFormat",(t,e)=>{var r,n;tt.init(t,e),t._zod.onattach.push(s=>{const a=s._zod.bag;a.format=e.format,e.pattern&&(a.patterns??(a.patterns=new Set),a.patterns.add(e.pattern))}),e.pattern?(r=t._zod).check??(r.check=s=>{e.pattern.lastIndex=0,!e.pattern.test(s.value)&&s.issues.push({origin:"string",code:"invalid_format",format:e.format,input:s.value,...e.pattern?{pattern:e.pattern.toString()}:{},inst:t,continue:!e.abort})}):(n=t._zod).check??(n.check=()=>{})}),_d=L("$ZodCheckRegex",(t,e)=>{eo.init(t,e),t._zod.check=r=>{e.pattern.lastIndex=0,!e.pattern.test(r.value)&&r.issues.push({origin:"string",code:"invalid_format",format:"regex",input:r.value,pattern:e.pattern.toString(),inst:t,continue:!e.abort})}}),wd=L("$ZodCheckLowerCase",(t,e)=>{e.pattern??(e.pattern=hd),eo.init(t,e)}),bd=L("$ZodCheckUpperCase",(t,e)=>{e.pattern??(e.pattern=fd),eo.init(t,e)}),kd=L("$ZodCheckIncludes",(t,e)=>{tt.init(t,e);const r=Xn(e.includes),n=new RegExp(typeof e.position=="number"?`^.{${e.position}}${r}`:r);e.pattern=n,t._zod.onattach.push(s=>{const a=s._zod.bag;a.patterns??(a.patterns=new Set),a.patterns.add(n)}),t._zod.check=s=>{s.value.includes(e.includes,e.position)||s.issues.push({origin:"string",code:"invalid_format",format:"includes",includes:e.includes,input:s.value,inst:t,continue:!e.abort})}}),Ed=L("$ZodCheckStartsWith",(t,e)=>{tt.init(t,e);const r=new RegExp(`^${Xn(e.prefix)}.*`);e.pattern??(e.pattern=r),t._zod.onattach.push(n=>{const s=n._zod.bag;s.patterns??(s.patterns=new Set),s.patterns.add(r)}),t._zod.check=n=>{n.value.startsWith(e.prefix)||n.issues.push({origin:"string",code:"invalid_format",format:"starts_with",prefix:e.prefix,input:n.value,inst:t,continue:!e.abort})}}),Od=L("$ZodCheckEndsWith",(t,e)=>{tt.init(t,e);const r=new RegExp(`.*${Xn(e.suffix)}$`);e.pattern??(e.pattern=r),t._zod.onattach.push(n=>{const s=n._zod.bag;s.patterns??(s.patterns=new Set),s.patterns.add(r)}),t._zod.check=n=>{n.value.endsWith(e.suffix)||n.issues.push({origin:"string",code:"invalid_format",format:"ends_with",suffix:e.suffix,input:n.value,inst:t,continue:!e.abort})}}),Sd=L("$ZodCheckOverwrite",(t,e)=>{tt.init(t,e),t._zod.check=r=>{r.value=e.tx(r.value)}});class Ad{constructor(e=[]){this.content=[],this.indent=0,this&&(this.args=e)}indented(e){this.indent+=1,e(this),this.indent-=1}write(e){if(typeof e=="function"){e(this,{execution:"sync"}),e(this,{execution:"async"});return}const n=e.split(`
`).filter(c=>c),s=Math.min(...n.map(c=>c.length-c.trimStart().length)),a=n.map(c=>c.slice(s)).map(c=>" ".repeat(this.indent*2)+c);for(const c of a)this.content.push(c)}compile(){const e=Function,r=this==null?void 0:this.args,s=[...((this==null?void 0:this.content)??[""]).map(a=>`  ${a}`)];return new e(...r,s.join(`
`))}}const Td={major:4,minor:0,patch:5},Te=L("$ZodType",(t,e)=>{var s;var r;t??(t={}),t._zod.def=e,t._zod.bag=t._zod.bag||{},t._zod.version=Td;const n=[...t._zod.def.checks??[]];t._zod.traits.has("$ZodCheck")&&n.unshift(t);for(const a of n)for(const c of a._zod.onattach)c(t);if(n.length===0)(r=t._zod).deferred??(r.deferred=[]),(s=t._zod.deferred)==null||s.push(()=>{t._zod.run=t._zod.parse});else{const a=(c,h,p)=>{let v=Wr(c),_;for(const I of h){if(I._zod.def.when){if(!I._zod.def.when(c))continue}else if(v)continue;const U=c.issues.length,q=I._zod.check(c);if(q instanceof Promise&&(p==null?void 0:p.async)===!1)throw new Gr;if(_||q instanceof Promise)_=(_??Promise.resolve()).then(async()=>{await q,c.issues.length!==U&&(v||(v=Wr(c,U)))});else{if(c.issues.length===U)continue;v||(v=Wr(c,U))}}return _?_.then(()=>c):c};t._zod.run=(c,h)=>{const p=t._zod.parse(c,h);if(p instanceof Promise){if(h.async===!1)throw new Gr;return p.then(v=>a(v,n,h))}return a(p,n,h)}}t["~standard"]={validate:a=>{var c;try{const h=Fl(t,a);return h.success?{value:h.data}:{issues:(c=h.error)==null?void 0:c.issues}}catch{return Ll(t,a).then(p=>{var v;return p.success?{value:p.data}:{issues:(v=p.error)==null?void 0:v.issues}})}},vendor:"zod",version:1}}),gs=L("$ZodString",(t,e)=>{var r;Te.init(t,e),t._zod.pattern=[...((r=t==null?void 0:t._zod.bag)==null?void 0:r.patterns)??[]].pop()??ud(t._zod.bag),t._zod.parse=(n,s)=>{if(e.coerce)try{n.value=String(n.value)}catch{}return typeof n.value=="string"||n.issues.push({expected:"string",code:"invalid_type",input:n.value,inst:t}),n}}),xe=L("$ZodStringFormat",(t,e)=>{eo.init(t,e),gs.init(t,e)}),xd=L("$ZodGUID",(t,e)=>{e.pattern??(e.pattern=Hl),xe.init(t,e)}),Pd=L("$ZodUUID",(t,e)=>{if(e.version){const n={v1:1,v2:2,v3:3,v4:4,v5:5,v6:6,v7:7,v8:8}[e.version];if(n===void 0)throw new Error(`Invalid UUID version: "${e.version}"`);e.pattern??(e.pattern=pi(n))}else e.pattern??(e.pattern=pi());xe.init(t,e)}),Rd=L("$ZodEmail",(t,e)=>{e.pattern??(e.pattern=Gl),xe.init(t,e)}),Id=L("$ZodURL",(t,e)=>{xe.init(t,e),t._zod.check=r=>{try{const n=r.value,s=new URL(n),a=s.href;e.hostname&&(e.hostname.lastIndex=0,e.hostname.test(s.hostname)||r.issues.push({code:"invalid_format",format:"url",note:"Invalid hostname",pattern:nd.source,input:r.value,inst:t,continue:!e.abort})),e.protocol&&(e.protocol.lastIndex=0,e.protocol.test(s.protocol.endsWith(":")?s.protocol.slice(0,-1):s.protocol)||r.issues.push({code:"invalid_format",format:"url",note:"Invalid protocol",pattern:e.protocol.source,input:r.value,inst:t,continue:!e.abort})),!n.endsWith("/")&&a.endsWith("/")?r.value=a.slice(0,-1):r.value=a;return}catch{r.issues.push({code:"invalid_format",format:"url",input:r.value,inst:t,continue:!e.abort})}}}),$d=L("$ZodEmoji",(t,e)=>{e.pattern??(e.pattern=Yl()),xe.init(t,e)}),Dd=L("$ZodNanoID",(t,e)=>{e.pattern??(e.pattern=Kl),xe.init(t,e)}),Cd=L("$ZodCUID",(t,e)=>{e.pattern??(e.pattern=Ml),xe.init(t,e)}),jd=L("$ZodCUID2",(t,e)=>{e.pattern??(e.pattern=ql),xe.init(t,e)}),zd=L("$ZodULID",(t,e)=>{e.pattern??(e.pattern=Bl),xe.init(t,e)}),Ud=L("$ZodXID",(t,e)=>{e.pattern??(e.pattern=Zl),xe.init(t,e)}),Nd=L("$ZodKSUID",(t,e)=>{e.pattern??(e.pattern=Vl),xe.init(t,e)}),Fd=L("$ZodISODateTime",(t,e)=>{e.pattern??(e.pattern=ad(e)),xe.init(t,e)}),Ld=L("$ZodISODate",(t,e)=>{e.pattern??(e.pattern=sd),xe.init(t,e)}),Md=L("$ZodISOTime",(t,e)=>{e.pattern??(e.pattern=id(e)),xe.init(t,e)}),qd=L("$ZodISODuration",(t,e)=>{e.pattern??(e.pattern=Wl),xe.init(t,e)}),Bd=L("$ZodIPv4",(t,e)=>{e.pattern??(e.pattern=Ql),xe.init(t,e),t._zod.onattach.push(r=>{const n=r._zod.bag;n.format="ipv4"})}),Zd=L("$ZodIPv6",(t,e)=>{e.pattern??(e.pattern=Xl),xe.init(t,e),t._zod.onattach.push(r=>{const n=r._zod.bag;n.format="ipv6"}),t._zod.check=r=>{try{new URL(`http://[${r.value}]`)}catch{r.issues.push({code:"invalid_format",format:"ipv6",input:r.value,inst:t,continue:!e.abort})}}}),Vd=L("$ZodCIDRv4",(t,e)=>{e.pattern??(e.pattern=ed),xe.init(t,e)}),Kd=L("$ZodCIDRv6",(t,e)=>{e.pattern??(e.pattern=td),xe.init(t,e),t._zod.check=r=>{const[n,s]=r.value.split("/");try{if(!s)throw new Error;const a=Number(s);if(`${a}`!==s)throw new Error;if(a<0||a>128)throw new Error;new URL(`http://[${n}]`)}catch{r.issues.push({code:"invalid_format",format:"cidrv6",input:r.value,inst:t,continue:!e.abort})}}});function ba(t){if(t==="")return!0;if(t.length%4!==0)return!1;try{return atob(t),!0}catch{return!1}}const Wd=L("$ZodBase64",(t,e)=>{e.pattern??(e.pattern=rd),xe.init(t,e),t._zod.onattach.push(r=>{r._zod.bag.contentEncoding="base64"}),t._zod.check=r=>{ba(r.value)||r.issues.push({code:"invalid_format",format:"base64",input:r.value,inst:t,continue:!e.abort})}});function Hd(t){if(!ma.test(t))return!1;const e=t.replace(/[-_]/g,n=>n==="-"?"+":"/"),r=e.padEnd(Math.ceil(e.length/4)*4,"=");return ba(r)}const Gd=L("$ZodBase64URL",(t,e)=>{e.pattern??(e.pattern=ma),xe.init(t,e),t._zod.onattach.push(r=>{r._zod.bag.contentEncoding="base64url"}),t._zod.check=r=>{Hd(r.value)||r.issues.push({code:"invalid_format",format:"base64url",input:r.value,inst:t,continue:!e.abort})}}),Jd=L("$ZodE164",(t,e)=>{e.pattern??(e.pattern=od),xe.init(t,e)});function Yd(t,e=null){try{const r=t.split(".");if(r.length!==3)return!1;const[n]=r;if(!n)return!1;const s=JSON.parse(atob(n));return!("typ"in s&&(s==null?void 0:s.typ)!=="JWT"||!s.alg||e&&(!("alg"in s)||s.alg!==e))}catch{return!1}}const Qd=L("$ZodJWT",(t,e)=>{xe.init(t,e),t._zod.check=r=>{Yd(r.value,e.alg)||r.issues.push({code:"invalid_format",format:"jwt",input:r.value,inst:t,continue:!e.abort})}}),ka=L("$ZodNumber",(t,e)=>{Te.init(t,e),t._zod.pattern=t._zod.bag.pattern??ld,t._zod.parse=(r,n)=>{if(e.coerce)try{r.value=Number(r.value)}catch{}const s=r.value;if(typeof s=="number"&&!Number.isNaN(s)&&Number.isFinite(s))return r;const a=typeof s=="number"?Number.isNaN(s)?"NaN":Number.isFinite(s)?void 0:"Infinity":void 0;return r.issues.push({expected:"number",code:"invalid_type",input:s,inst:t,...a?{received:a}:{}}),r}}),Xd=L("$ZodNumber",(t,e)=>{md.init(t,e),ka.init(t,e)}),eh=L("$ZodBoolean",(t,e)=>{Te.init(t,e),t._zod.pattern=dd,t._zod.parse=(r,n)=>{if(e.coerce)try{r.value=!!r.value}catch{}const s=r.value;return typeof s=="boolean"||r.issues.push({expected:"boolean",code:"invalid_type",input:s,inst:t}),r}}),th=L("$ZodAny",(t,e)=>{Te.init(t,e),t._zod.parse=r=>r}),rh=L("$ZodUnknown",(t,e)=>{Te.init(t,e),t._zod.parse=r=>r}),nh=L("$ZodNever",(t,e)=>{Te.init(t,e),t._zod.parse=(r,n)=>(r.issues.push({expected:"never",code:"invalid_type",input:r.value,inst:t}),r)});function mi(t,e,r){t.issues.length&&e.issues.push(...Xt(r,t.issues)),e.value[r]=t.value}const oh=L("$ZodArray",(t,e)=>{Te.init(t,e),t._zod.parse=(r,n)=>{const s=r.value;if(!Array.isArray(s))return r.issues.push({expected:"array",code:"invalid_type",input:s,inst:t}),r;r.value=Array(s.length);const a=[];for(let c=0;c<s.length;c++){const h=s[c],p=e.element._zod.run({value:h,issues:[]},n);p instanceof Promise?a.push(p.then(v=>mi(v,r,c))):mi(p,r,c)}return a.length?Promise.all(a).then(()=>r):r}});function Un(t,e,r){t.issues.length&&e.issues.push(...Xt(r,t.issues)),e.value[r]=t.value}function vi(t,e,r,n){t.issues.length?n[r]===void 0?r in n?e.value[r]=void 0:e.value[r]=t.value:e.issues.push(...Xt(r,t.issues)):t.value===void 0?r in n&&(e.value[r]=void 0):e.value[r]=t.value}const sh=L("$ZodObject",(t,e)=>{Te.init(t,e);const r=ua(()=>{const I=Object.keys(e.shape);for(const q of I)if(!(e.shape[q]instanceof Te))throw new Error(`Invalid element at key "${q}": expected a Zod schema`);const U=Tl(e.shape);return{shape:e.shape,keys:I,keySet:new Set(I),numKeys:I.length,optionalKeys:new Set(U)}});Se(t._zod,"propValues",()=>{const I=e.shape,U={};for(const q in I){const G=I[q]._zod;if(G.values){U[q]??(U[q]=new Set);for(const F of G.values)U[q].add(F)}}return U});const n=I=>{const U=new Ad(["shape","payload","ctx"]),q=r.value,G=se=>{const ae=Br(se);return`shape[${ae}]._zod.run({ value: input[${ae}], issues: [] }, ctx)`};U.write("const input = payload.value;");const F=Object.create(null);let V=0;for(const se of q.keys)F[se]=`key_${V++}`;U.write("const newResult = {}");for(const se of q.keys)if(q.optionalKeys.has(se)){const ae=F[se];U.write(`const ${ae} = ${G(se)};`);const le=Br(se);U.write(`
        if (${ae}.issues.length) {
          if (input[${le}] === undefined) {
            if (${le} in input) {
              newResult[${le}] = undefined;
            }
          } else {
            payload.issues = payload.issues.concat(
              ${ae}.issues.map((iss) => ({
                ...iss,
                path: iss.path ? [${le}, ...iss.path] : [${le}],
              }))
            );
          }
        } else if (${ae}.value === undefined) {
          if (${le} in input) newResult[${le}] = undefined;
        } else {
          newResult[${le}] = ${ae}.value;
        }
        `)}else{const ae=F[se];U.write(`const ${ae} = ${G(se)};`),U.write(`
          if (${ae}.issues.length) payload.issues = payload.issues.concat(${ae}.issues.map(iss => ({
            ...iss,
            path: iss.path ? [${Br(se)}, ...iss.path] : [${Br(se)}]
          })));`),U.write(`newResult[${Br(se)}] = ${ae}.value`)}U.write("payload.value = newResult;"),U.write("return payload;");const oe=U.compile();return(se,ae)=>oe(I,se,ae)};let s;const a=rs,c=!aa.jitless,p=c&&Sl.value,v=e.catchall;let _;t._zod.parse=(I,U)=>{_??(_=r.value);const q=I.value;if(!a(q))return I.issues.push({expected:"object",code:"invalid_type",input:q,inst:t}),I;const G=[];if(c&&p&&(U==null?void 0:U.async)===!1&&U.jitless!==!0)s||(s=n(e.shape)),I=s(I,U);else{I.value={};const ae=_.shape;for(const le of _.keys){const Ie=ae[le],qe=Ie._zod.run({value:q[le],issues:[]},U),Ue=Ie._zod.optin==="optional"&&Ie._zod.optout==="optional";qe instanceof Promise?G.push(qe.then(Ft=>Ue?vi(Ft,I,le,q):Un(Ft,I,le))):Ue?vi(qe,I,le,q):Un(qe,I,le)}}if(!v)return G.length?Promise.all(G).then(()=>I):I;const F=[],V=_.keySet,oe=v._zod,se=oe.def.type;for(const ae of Object.keys(q)){if(V.has(ae))continue;if(se==="never"){F.push(ae);continue}const le=oe.run({value:q[ae],issues:[]},U);le instanceof Promise?G.push(le.then(Ie=>Un(Ie,I,ae))):Un(le,I,ae)}return F.length&&I.issues.push({code:"unrecognized_keys",keys:F,input:q,inst:t}),G.length?Promise.all(G).then(()=>I):I}});function gi(t,e,r,n){for(const s of t)if(s.issues.length===0)return e.value=s.value,e;return e.issues.push({code:"invalid_union",input:e.value,inst:r,errors:t.map(s=>s.issues.map(a=>jt(a,n,Ct())))}),e}const ih=L("$ZodUnion",(t,e)=>{Te.init(t,e),Se(t._zod,"optin",()=>e.options.some(r=>r._zod.optin==="optional")?"optional":void 0),Se(t._zod,"optout",()=>e.options.some(r=>r._zod.optout==="optional")?"optional":void 0),Se(t._zod,"values",()=>{if(e.options.every(r=>r._zod.values))return new Set(e.options.flatMap(r=>Array.from(r._zod.values)))}),Se(t._zod,"pattern",()=>{if(e.options.every(r=>r._zod.pattern)){const r=e.options.map(n=>n._zod.pattern);return new RegExp(`^(${r.map(n=>ps(n.source)).join("|")})$`)}}),t._zod.parse=(r,n)=>{let s=!1;const a=[];for(const c of e.options){const h=c._zod.run({value:r.value,issues:[]},n);if(h instanceof Promise)a.push(h),s=!0;else{if(h.issues.length===0)return h;a.push(h)}}return s?Promise.all(a).then(c=>gi(c,r,t,n)):gi(a,r,t,n)}}),ah=L("$ZodIntersection",(t,e)=>{Te.init(t,e),t._zod.parse=(r,n)=>{const s=r.value,a=e.left._zod.run({value:s,issues:[]},n),c=e.right._zod.run({value:s,issues:[]},n);return a instanceof Promise||c instanceof Promise?Promise.all([a,c]).then(([p,v])=>yi(r,p,v)):yi(r,a,c)}});function ns(t,e){if(t===e)return{valid:!0,data:t};if(t instanceof Date&&e instanceof Date&&+t==+e)return{valid:!0,data:t};if(Zn(t)&&Zn(e)){const r=Object.keys(e),n=Object.keys(t).filter(a=>r.indexOf(a)!==-1),s={...t,...e};for(const a of n){const c=ns(t[a],e[a]);if(!c.valid)return{valid:!1,mergeErrorPath:[a,...c.mergeErrorPath]};s[a]=c.data}return{valid:!0,data:s}}if(Array.isArray(t)&&Array.isArray(e)){if(t.length!==e.length)return{valid:!1,mergeErrorPath:[]};const r=[];for(let n=0;n<t.length;n++){const s=t[n],a=e[n],c=ns(s,a);if(!c.valid)return{valid:!1,mergeErrorPath:[n,...c.mergeErrorPath]};r.push(c.data)}return{valid:!0,data:r}}return{valid:!1,mergeErrorPath:[]}}function yi(t,e,r){if(e.issues.length&&t.issues.push(...e.issues),r.issues.length&&t.issues.push(...r.issues),Wr(t))return t;const n=ns(e.value,r.value);if(!n.valid)throw new Error(`Unmergable intersection. Error path: ${JSON.stringify(n.mergeErrorPath)}`);return t.value=n.data,t}const uh=L("$ZodRecord",(t,e)=>{Te.init(t,e),t._zod.parse=(r,n)=>{const s=r.value;if(!Zn(s))return r.issues.push({expected:"record",code:"invalid_type",input:s,inst:t}),r;const a=[];if(e.keyType._zod.values){const c=e.keyType._zod.values;r.value={};for(const p of c)if(typeof p=="string"||typeof p=="number"||typeof p=="symbol"){const v=e.valueType._zod.run({value:s[p],issues:[]},n);v instanceof Promise?a.push(v.then(_=>{_.issues.length&&r.issues.push(...Xt(p,_.issues)),r.value[p]=_.value})):(v.issues.length&&r.issues.push(...Xt(p,v.issues)),r.value[p]=v.value)}let h;for(const p in s)c.has(p)||(h=h??[],h.push(p));h&&h.length>0&&r.issues.push({code:"unrecognized_keys",input:s,inst:t,keys:h})}else{r.value={};for(const c of Reflect.ownKeys(s)){if(c==="__proto__")continue;const h=e.keyType._zod.run({value:c,issues:[]},n);if(h instanceof Promise)throw new Error("Async schemas not supported in object keys currently");if(h.issues.length){r.issues.push({origin:"record",code:"invalid_key",issues:h.issues.map(v=>jt(v,n,Ct())),input:c,path:[c],inst:t}),r.value[h.value]=h.value;continue}const p=e.valueType._zod.run({value:s[c],issues:[]},n);p instanceof Promise?a.push(p.then(v=>{v.issues.length&&r.issues.push(...Xt(c,v.issues)),r.value[h.value]=v.value})):(p.issues.length&&r.issues.push(...Xt(c,p.issues)),r.value[h.value]=p.value)}}return a.length?Promise.all(a).then(()=>r):r}}),ch=L("$ZodEnum",(t,e)=>{Te.init(t,e);const r=kl(e.entries);t._zod.values=new Set(r),t._zod.pattern=new RegExp(`^(${r.filter(n=>Al.has(typeof n)).map(n=>typeof n=="string"?Xn(n):n.toString()).join("|")})$`),t._zod.parse=(n,s)=>{const a=n.value;return t._zod.values.has(a)||n.issues.push({code:"invalid_value",values:r,input:a,inst:t}),n}}),lh=L("$ZodTransform",(t,e)=>{Te.init(t,e),t._zod.parse=(r,n)=>{const s=e.transform(r.value,r);if(n.async)return(s instanceof Promise?s:Promise.resolve(s)).then(c=>(r.value=c,r));if(s instanceof Promise)throw new Gr;return r.value=s,r}}),dh=L("$ZodOptional",(t,e)=>{Te.init(t,e),t._zod.optin="optional",t._zod.optout="optional",Se(t._zod,"values",()=>e.innerType._zod.values?new Set([...e.innerType._zod.values,void 0]):void 0),Se(t._zod,"pattern",()=>{const r=e.innerType._zod.pattern;return r?new RegExp(`^(${ps(r.source)})?$`):void 0}),t._zod.parse=(r,n)=>e.innerType._zod.optin==="optional"?e.innerType._zod.run(r,n):r.value===void 0?r:e.innerType._zod.run(r,n)}),hh=L("$ZodNullable",(t,e)=>{Te.init(t,e),Se(t._zod,"optin",()=>e.innerType._zod.optin),Se(t._zod,"optout",()=>e.innerType._zod.optout),Se(t._zod,"pattern",()=>{const r=e.innerType._zod.pattern;return r?new RegExp(`^(${ps(r.source)}|null)$`):void 0}),Se(t._zod,"values",()=>e.innerType._zod.values?new Set([...e.innerType._zod.values,null]):void 0),t._zod.parse=(r,n)=>r.value===null?r:e.innerType._zod.run(r,n)}),fh=L("$ZodDefault",(t,e)=>{Te.init(t,e),t._zod.optin="optional",Se(t._zod,"values",()=>e.innerType._zod.values),t._zod.parse=(r,n)=>{if(r.value===void 0)return r.value=e.defaultValue,r;const s=e.innerType._zod.run(r,n);return s instanceof Promise?s.then(a=>_i(a,e)):_i(s,e)}});function _i(t,e){return t.value===void 0&&(t.value=e.defaultValue),t}const ph=L("$ZodPrefault",(t,e)=>{Te.init(t,e),t._zod.optin="optional",Se(t._zod,"values",()=>e.innerType._zod.values),t._zod.parse=(r,n)=>(r.value===void 0&&(r.value=e.defaultValue),e.innerType._zod.run(r,n))}),mh=L("$ZodNonOptional",(t,e)=>{Te.init(t,e),Se(t._zod,"values",()=>{const r=e.innerType._zod.values;return r?new Set([...r].filter(n=>n!==void 0)):void 0}),t._zod.parse=(r,n)=>{const s=e.innerType._zod.run(r,n);return s instanceof Promise?s.then(a=>wi(a,t)):wi(s,t)}});function wi(t,e){return!t.issues.length&&t.value===void 0&&t.issues.push({code:"invalid_type",expected:"nonoptional",input:t.value,inst:e}),t}const vh=L("$ZodCatch",(t,e)=>{Te.init(t,e),t._zod.optin="optional",Se(t._zod,"optout",()=>e.innerType._zod.optout),Se(t._zod,"values",()=>e.innerType._zod.values),t._zod.parse=(r,n)=>{const s=e.innerType._zod.run(r,n);return s instanceof Promise?s.then(a=>(r.value=a.value,a.issues.length&&(r.value=e.catchValue({...r,error:{issues:a.issues.map(c=>jt(c,n,Ct()))},input:r.value}),r.issues=[]),r)):(r.value=s.value,s.issues.length&&(r.value=e.catchValue({...r,error:{issues:s.issues.map(a=>jt(a,n,Ct()))},input:r.value}),r.issues=[]),r)}}),gh=L("$ZodPipe",(t,e)=>{Te.init(t,e),Se(t._zod,"values",()=>e.in._zod.values),Se(t._zod,"optin",()=>e.in._zod.optin),Se(t._zod,"optout",()=>e.out._zod.optout),Se(t._zod,"propValues",()=>e.in._zod.propValues),t._zod.parse=(r,n)=>{const s=e.in._zod.run(r,n);return s instanceof Promise?s.then(a=>bi(a,e,n)):bi(s,e,n)}});function bi(t,e,r){return Wr(t)?t:e.out._zod.run({value:t.value,issues:t.issues},r)}const yh=L("$ZodReadonly",(t,e)=>{Te.init(t,e),Se(t._zod,"propValues",()=>e.innerType._zod.propValues),Se(t._zod,"values",()=>e.innerType._zod.values),Se(t._zod,"optin",()=>e.innerType._zod.optin),Se(t._zod,"optout",()=>e.innerType._zod.optout),t._zod.parse=(r,n)=>{const s=e.innerType._zod.run(r,n);return s instanceof Promise?s.then(ki):ki(s)}});function ki(t){return t.value=Object.freeze(t.value),t}const _h=L("$ZodCustom",(t,e)=>{tt.init(t,e),Te.init(t,e),t._zod.parse=(r,n)=>r,t._zod.check=r=>{const n=r.value,s=e.fn(n);if(s instanceof Promise)return s.then(a=>Ei(a,r,n,t));Ei(s,r,n,t)}});function Ei(t,e,r,n){if(!t){const s={code:"custom",input:r,inst:n,path:[...n._zod.def.path??[]],continue:!n._zod.def.abort};n._zod.def.params&&(s.params=n._zod.def.params),e.issues.push(Jr(s))}}class wh{constructor(){this._map=new Map,this._idmap=new Map}add(e,...r){const n=r[0];if(this._map.set(e,n),n&&typeof n=="object"&&"id"in n){if(this._idmap.has(n.id))throw new Error(`ID ${n.id} already exists in the registry`);this._idmap.set(n.id,e)}return this}clear(){return this._map=new Map,this._idmap=new Map,this}remove(e){const r=this._map.get(e);return r&&typeof r=="object"&&"id"in r&&this._idmap.delete(r.id),this._map.delete(e),this}get(e){const r=e._zod.parent;if(r){const n={...this.get(r)??{}};return delete n.id,{...n,...this._map.get(e)}}return this._map.get(e)}has(e){return this._map.has(e)}}function bh(){return new wh}const Nn=bh();function kh(t,e){return new t({type:"string",...re(e)})}function Eh(t,e){return new t({type:"string",format:"email",check:"string_format",abort:!1,...re(e)})}function Oi(t,e){return new t({type:"string",format:"guid",check:"string_format",abort:!1,...re(e)})}function Oh(t,e){return new t({type:"string",format:"uuid",check:"string_format",abort:!1,...re(e)})}function Sh(t,e){return new t({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v4",...re(e)})}function Ah(t,e){return new t({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v6",...re(e)})}function Th(t,e){return new t({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v7",...re(e)})}function xh(t,e){return new t({type:"string",format:"url",check:"string_format",abort:!1,...re(e)})}function Ph(t,e){return new t({type:"string",format:"emoji",check:"string_format",abort:!1,...re(e)})}function Rh(t,e){return new t({type:"string",format:"nanoid",check:"string_format",abort:!1,...re(e)})}function Ih(t,e){return new t({type:"string",format:"cuid",check:"string_format",abort:!1,...re(e)})}function $h(t,e){return new t({type:"string",format:"cuid2",check:"string_format",abort:!1,...re(e)})}function Dh(t,e){return new t({type:"string",format:"ulid",check:"string_format",abort:!1,...re(e)})}function Ch(t,e){return new t({type:"string",format:"xid",check:"string_format",abort:!1,...re(e)})}function jh(t,e){return new t({type:"string",format:"ksuid",check:"string_format",abort:!1,...re(e)})}function zh(t,e){return new t({type:"string",format:"ipv4",check:"string_format",abort:!1,...re(e)})}function Uh(t,e){return new t({type:"string",format:"ipv6",check:"string_format",abort:!1,...re(e)})}function Nh(t,e){return new t({type:"string",format:"cidrv4",check:"string_format",abort:!1,...re(e)})}function Fh(t,e){return new t({type:"string",format:"cidrv6",check:"string_format",abort:!1,...re(e)})}function Lh(t,e){return new t({type:"string",format:"base64",check:"string_format",abort:!1,...re(e)})}function Mh(t,e){return new t({type:"string",format:"base64url",check:"string_format",abort:!1,...re(e)})}function qh(t,e){return new t({type:"string",format:"e164",check:"string_format",abort:!1,...re(e)})}function Bh(t,e){return new t({type:"string",format:"jwt",check:"string_format",abort:!1,...re(e)})}function Zh(t,e){return new t({type:"string",format:"datetime",check:"string_format",offset:!1,local:!1,precision:null,...re(e)})}function Vh(t,e){return new t({type:"string",format:"date",check:"string_format",...re(e)})}function Kh(t,e){return new t({type:"string",format:"time",check:"string_format",precision:null,...re(e)})}function Wh(t,e){return new t({type:"string",format:"duration",check:"string_format",...re(e)})}function Hh(t,e){return new t({type:"number",checks:[],...re(e)})}function Gh(t,e){return new t({type:"number",check:"number_format",abort:!1,format:"safeint",...re(e)})}function Jh(t,e){return new t({type:"boolean",...re(e)})}function Yh(t){return new t({type:"any"})}function Qh(t){return new t({type:"unknown"})}function Xh(t,e){return new t({type:"never",...re(e)})}function Si(t,e){return new _a({check:"less_than",...re(e),value:t,inclusive:!1})}function Wo(t,e){return new _a({check:"less_than",...re(e),value:t,inclusive:!0})}function Ai(t,e){return new wa({check:"greater_than",...re(e),value:t,inclusive:!1})}function Ho(t,e){return new wa({check:"greater_than",...re(e),value:t,inclusive:!0})}function Ti(t,e){return new pd({check:"multiple_of",...re(e),value:t})}function Ea(t,e){return new vd({check:"max_length",...re(e),maximum:t})}function Vn(t,e){return new gd({check:"min_length",...re(e),minimum:t})}function Oa(t,e){return new yd({check:"length_equals",...re(e),length:t})}function ef(t,e){return new _d({check:"string_format",format:"regex",...re(e),pattern:t})}function tf(t){return new wd({check:"string_format",format:"lowercase",...re(t)})}function rf(t){return new bd({check:"string_format",format:"uppercase",...re(t)})}function nf(t,e){return new kd({check:"string_format",format:"includes",...re(e),includes:t})}function of(t,e){return new Ed({check:"string_format",format:"starts_with",...re(e),prefix:t})}function sf(t,e){return new Od({check:"string_format",format:"ends_with",...re(e),suffix:t})}function Xr(t){return new Sd({check:"overwrite",tx:t})}function af(t){return Xr(e=>e.normalize(t))}function uf(){return Xr(t=>t.trim())}function cf(){return Xr(t=>t.toLowerCase())}function lf(){return Xr(t=>t.toUpperCase())}function df(t,e,r){return new t({type:"array",element:e,...re(r)})}function hf(t,e,r){return new t({type:"custom",check:"custom",fn:e,...re(r)})}const ff=L("ZodISODateTime",(t,e)=>{Fd.init(t,e),Re.init(t,e)});function pf(t){return Zh(ff,t)}const mf=L("ZodISODate",(t,e)=>{Ld.init(t,e),Re.init(t,e)});function vf(t){return Vh(mf,t)}const gf=L("ZodISOTime",(t,e)=>{Md.init(t,e),Re.init(t,e)});function yf(t){return Kh(gf,t)}const _f=L("ZodISODuration",(t,e)=>{qd.init(t,e),Re.init(t,e)});function wf(t){return Wh(_f,t)}const Sa=(t,e)=>{da.init(t,e),t.name="ZodError",Object.defineProperties(t,{format:{value:r=>zl(t,r)},flatten:{value:r=>jl(t,r)},addIssue:{value:r=>t.issues.push(r)},addIssues:{value:r=>t.issues.push(...r)},isEmpty:{get(){return t.issues.length===0}}})},to=L("ZodError",Sa),ro=L("ZodError",Sa,{Parent:Error}),bf=Ul(ro),kf=Nl(ro),Ef=fa(ro),Of=pa(ro),De=L("ZodType",(t,e)=>(Te.init(t,e),t.def=e,Object.defineProperty(t,"_def",{value:e}),t.check=(...r)=>t.clone({...e,checks:[...e.checks??[],...r.map(n=>typeof n=="function"?{_zod:{check:n,def:{check:"custom"},onattach:[]}}:n)]}),t.clone=(r,n)=>nr(t,r,n),t.brand=()=>t,t.register=(r,n)=>(r.add(t,n),t),t.parse=(r,n)=>bf(t,r,n,{callee:t.parse}),t.safeParse=(r,n)=>Ef(t,r,n),t.parseAsync=async(r,n)=>kf(t,r,n,{callee:t.parseAsync}),t.safeParseAsync=async(r,n)=>Of(t,r,n),t.spa=t.safeParseAsync,t.refine=(r,n)=>t.check(_p(r,n)),t.superRefine=r=>t.check(wp(r)),t.overwrite=r=>t.check(Xr(r)),t.optional=()=>Ii(t),t.nullable=()=>$i(t),t.nullish=()=>Ii($i(t)),t.nonoptional=r=>dp(t,r),t.array=()=>Or(t),t.or=r=>Xf([t,r]),t.and=r=>tp(t,r),t.transform=r=>Di(t,sp(r)),t.default=r=>up(t,r),t.prefault=r=>lp(t,r),t.catch=r=>fp(t,r),t.pipe=r=>Di(t,r),t.readonly=()=>vp(t),t.describe=r=>{const n=t.clone();return Nn.add(n,{description:r}),n},Object.defineProperty(t,"description",{get(){var r;return(r=Nn.get(t))==null?void 0:r.description},configurable:!0}),t.meta=(...r)=>{if(r.length===0)return Nn.get(t);const n=t.clone();return Nn.add(n,r[0]),n},t.isOptional=()=>t.safeParse(void 0).success,t.isNullable=()=>t.safeParse(null).success,t)),Aa=L("_ZodString",(t,e)=>{gs.init(t,e),De.init(t,e);const r=t._zod.bag;t.format=r.format??null,t.minLength=r.minimum??null,t.maxLength=r.maximum??null,t.regex=(...n)=>t.check(ef(...n)),t.includes=(...n)=>t.check(nf(...n)),t.startsWith=(...n)=>t.check(of(...n)),t.endsWith=(...n)=>t.check(sf(...n)),t.min=(...n)=>t.check(Vn(...n)),t.max=(...n)=>t.check(Ea(...n)),t.length=(...n)=>t.check(Oa(...n)),t.nonempty=(...n)=>t.check(Vn(1,...n)),t.lowercase=n=>t.check(tf(n)),t.uppercase=n=>t.check(rf(n)),t.trim=()=>t.check(uf()),t.normalize=(...n)=>t.check(af(...n)),t.toLowerCase=()=>t.check(cf()),t.toUpperCase=()=>t.check(lf())}),Sf=L("ZodString",(t,e)=>{gs.init(t,e),Aa.init(t,e),t.email=r=>t.check(Eh(Af,r)),t.url=r=>t.check(xh(Tf,r)),t.jwt=r=>t.check(Bh(qf,r)),t.emoji=r=>t.check(Ph(xf,r)),t.guid=r=>t.check(Oi(xi,r)),t.uuid=r=>t.check(Oh(Fn,r)),t.uuidv4=r=>t.check(Sh(Fn,r)),t.uuidv6=r=>t.check(Ah(Fn,r)),t.uuidv7=r=>t.check(Th(Fn,r)),t.nanoid=r=>t.check(Rh(Pf,r)),t.guid=r=>t.check(Oi(xi,r)),t.cuid=r=>t.check(Ih(Rf,r)),t.cuid2=r=>t.check($h(If,r)),t.ulid=r=>t.check(Dh($f,r)),t.base64=r=>t.check(Lh(Ff,r)),t.base64url=r=>t.check(Mh(Lf,r)),t.xid=r=>t.check(Ch(Df,r)),t.ksuid=r=>t.check(jh(Cf,r)),t.ipv4=r=>t.check(zh(jf,r)),t.ipv6=r=>t.check(Uh(zf,r)),t.cidrv4=r=>t.check(Nh(Uf,r)),t.cidrv6=r=>t.check(Fh(Nf,r)),t.e164=r=>t.check(qh(Mf,r)),t.datetime=r=>t.check(pf(r)),t.date=r=>t.check(vf(r)),t.time=r=>t.check(yf(r)),t.duration=r=>t.check(wf(r))});function Pe(t){return kh(Sf,t)}const Re=L("ZodStringFormat",(t,e)=>{xe.init(t,e),Aa.init(t,e)}),Af=L("ZodEmail",(t,e)=>{Rd.init(t,e),Re.init(t,e)}),xi=L("ZodGUID",(t,e)=>{xd.init(t,e),Re.init(t,e)}),Fn=L("ZodUUID",(t,e)=>{Pd.init(t,e),Re.init(t,e)}),Tf=L("ZodURL",(t,e)=>{Id.init(t,e),Re.init(t,e)}),xf=L("ZodEmoji",(t,e)=>{$d.init(t,e),Re.init(t,e)}),Pf=L("ZodNanoID",(t,e)=>{Dd.init(t,e),Re.init(t,e)}),Rf=L("ZodCUID",(t,e)=>{Cd.init(t,e),Re.init(t,e)}),If=L("ZodCUID2",(t,e)=>{jd.init(t,e),Re.init(t,e)}),$f=L("ZodULID",(t,e)=>{zd.init(t,e),Re.init(t,e)}),Df=L("ZodXID",(t,e)=>{Ud.init(t,e),Re.init(t,e)}),Cf=L("ZodKSUID",(t,e)=>{Nd.init(t,e),Re.init(t,e)}),jf=L("ZodIPv4",(t,e)=>{Bd.init(t,e),Re.init(t,e)}),zf=L("ZodIPv6",(t,e)=>{Zd.init(t,e),Re.init(t,e)}),Uf=L("ZodCIDRv4",(t,e)=>{Vd.init(t,e),Re.init(t,e)}),Nf=L("ZodCIDRv6",(t,e)=>{Kd.init(t,e),Re.init(t,e)}),Ff=L("ZodBase64",(t,e)=>{Wd.init(t,e),Re.init(t,e)}),Lf=L("ZodBase64URL",(t,e)=>{Gd.init(t,e),Re.init(t,e)}),Mf=L("ZodE164",(t,e)=>{Jd.init(t,e),Re.init(t,e)}),qf=L("ZodJWT",(t,e)=>{Qd.init(t,e),Re.init(t,e)}),Ta=L("ZodNumber",(t,e)=>{ka.init(t,e),De.init(t,e),t.gt=(n,s)=>t.check(Ai(n,s)),t.gte=(n,s)=>t.check(Ho(n,s)),t.min=(n,s)=>t.check(Ho(n,s)),t.lt=(n,s)=>t.check(Si(n,s)),t.lte=(n,s)=>t.check(Wo(n,s)),t.max=(n,s)=>t.check(Wo(n,s)),t.int=n=>t.check(Pi(n)),t.safe=n=>t.check(Pi(n)),t.positive=n=>t.check(Ai(0,n)),t.nonnegative=n=>t.check(Ho(0,n)),t.negative=n=>t.check(Si(0,n)),t.nonpositive=n=>t.check(Wo(0,n)),t.multipleOf=(n,s)=>t.check(Ti(n,s)),t.step=(n,s)=>t.check(Ti(n,s)),t.finite=()=>t;const r=t._zod.bag;t.minValue=Math.max(r.minimum??Number.NEGATIVE_INFINITY,r.exclusiveMinimum??Number.NEGATIVE_INFINITY)??null,t.maxValue=Math.min(r.maximum??Number.POSITIVE_INFINITY,r.exclusiveMaximum??Number.POSITIVE_INFINITY)??null,t.isInt=(r.format??"").includes("int")||Number.isSafeInteger(r.multipleOf??.5),t.isFinite=!0,t.format=r.format??null});function Ln(t){return Hh(Ta,t)}const Bf=L("ZodNumberFormat",(t,e)=>{Xd.init(t,e),Ta.init(t,e)});function Pi(t){return Gh(Bf,t)}const Zf=L("ZodBoolean",(t,e)=>{eh.init(t,e),De.init(t,e)});function Mn(t){return Jh(Zf,t)}const Vf=L("ZodAny",(t,e)=>{th.init(t,e),De.init(t,e)});function Kf(){return Yh(Vf)}const Wf=L("ZodUnknown",(t,e)=>{rh.init(t,e),De.init(t,e)});function Ri(){return Qh(Wf)}const Hf=L("ZodNever",(t,e)=>{nh.init(t,e),De.init(t,e)});function Gf(t){return Xh(Hf,t)}const Jf=L("ZodArray",(t,e)=>{oh.init(t,e),De.init(t,e),t.element=e.element,t.min=(r,n)=>t.check(Vn(r,n)),t.nonempty=r=>t.check(Vn(1,r)),t.max=(r,n)=>t.check(Ea(r,n)),t.length=(r,n)=>t.check(Oa(r,n)),t.unwrap=()=>t.element});function Or(t,e){return df(Jf,t,e)}const Yf=L("ZodObject",(t,e)=>{sh.init(t,e),De.init(t,e),Se(t,"shape",()=>e.shape),t.keyof=()=>zt(Object.keys(t._zod.def.shape)),t.catchall=r=>t.clone({...t._zod.def,catchall:r}),t.passthrough=()=>t.clone({...t._zod.def,catchall:Ri()}),t.loose=()=>t.clone({...t._zod.def,catchall:Ri()}),t.strict=()=>t.clone({...t._zod.def,catchall:Gf()}),t.strip=()=>t.clone({...t._zod.def,catchall:void 0}),t.extend=r=>Il(t,r),t.merge=r=>$l(t,r),t.pick=r=>Pl(t,r),t.omit=r=>Rl(t,r),t.partial=(...r)=>Dl(xa,t,r[0]),t.required=(...r)=>Cl(Pa,t,r[0])});function Nt(t,e){const r={type:"object",get shape(){return ms(this,"shape",{...t}),this.shape},...re(e)};return new Yf(r)}const Qf=L("ZodUnion",(t,e)=>{ih.init(t,e),De.init(t,e),t.options=e.options});function Xf(t,e){return new Qf({type:"union",options:t,...re(e)})}const ep=L("ZodIntersection",(t,e)=>{ah.init(t,e),De.init(t,e)});function tp(t,e){return new ep({type:"intersection",left:t,right:e})}const rp=L("ZodRecord",(t,e)=>{uh.init(t,e),De.init(t,e),t.keyType=e.keyType,t.valueType=e.valueType});function np(t,e,r){return new rp({type:"record",keyType:t,valueType:e,...re(r)})}const os=L("ZodEnum",(t,e)=>{ch.init(t,e),De.init(t,e),t.enum=e.entries,t.options=Object.values(e.entries);const r=new Set(Object.keys(e.entries));t.extract=(n,s)=>{const a={};for(const c of n)if(r.has(c))a[c]=e.entries[c];else throw new Error(`Key ${c} not found in enum`);return new os({...e,checks:[],...re(s),entries:a})},t.exclude=(n,s)=>{const a={...e.entries};for(const c of n)if(r.has(c))delete a[c];else throw new Error(`Key ${c} not found in enum`);return new os({...e,checks:[],...re(s),entries:a})}});function zt(t,e){const r=Array.isArray(t)?Object.fromEntries(t.map(n=>[n,n])):t;return new os({type:"enum",entries:r,...re(e)})}const op=L("ZodTransform",(t,e)=>{lh.init(t,e),De.init(t,e),t._zod.parse=(r,n)=>{r.addIssue=a=>{if(typeof a=="string")r.issues.push(Jr(a,r.value,e));else{const c=a;c.fatal&&(c.continue=!1),c.code??(c.code="custom"),c.input??(c.input=r.value),c.inst??(c.inst=t),c.continue??(c.continue=!0),r.issues.push(Jr(c))}};const s=e.transform(r.value,r);return s instanceof Promise?s.then(a=>(r.value=a,r)):(r.value=s,r)}});function sp(t){return new op({type:"transform",transform:t})}const xa=L("ZodOptional",(t,e)=>{dh.init(t,e),De.init(t,e),t.unwrap=()=>t._zod.def.innerType});function Ii(t){return new xa({type:"optional",innerType:t})}const ip=L("ZodNullable",(t,e)=>{hh.init(t,e),De.init(t,e),t.unwrap=()=>t._zod.def.innerType});function $i(t){return new ip({type:"nullable",innerType:t})}const ap=L("ZodDefault",(t,e)=>{fh.init(t,e),De.init(t,e),t.unwrap=()=>t._zod.def.innerType,t.removeDefault=t.unwrap});function up(t,e){return new ap({type:"default",innerType:t,get defaultValue(){return typeof e=="function"?e():e}})}const cp=L("ZodPrefault",(t,e)=>{ph.init(t,e),De.init(t,e),t.unwrap=()=>t._zod.def.innerType});function lp(t,e){return new cp({type:"prefault",innerType:t,get defaultValue(){return typeof e=="function"?e():e}})}const Pa=L("ZodNonOptional",(t,e)=>{mh.init(t,e),De.init(t,e),t.unwrap=()=>t._zod.def.innerType});function dp(t,e){return new Pa({type:"nonoptional",innerType:t,...re(e)})}const hp=L("ZodCatch",(t,e)=>{vh.init(t,e),De.init(t,e),t.unwrap=()=>t._zod.def.innerType,t.removeCatch=t.unwrap});function fp(t,e){return new hp({type:"catch",innerType:t,catchValue:typeof e=="function"?e:()=>e})}const pp=L("ZodPipe",(t,e)=>{gh.init(t,e),De.init(t,e),t.in=e.in,t.out=e.out});function Di(t,e){return new pp({type:"pipe",in:t,out:e})}const mp=L("ZodReadonly",(t,e)=>{yh.init(t,e),De.init(t,e)});function vp(t){return new mp({type:"readonly",innerType:t})}const gp=L("ZodCustom",(t,e)=>{_h.init(t,e),De.init(t,e)});function yp(t){const e=new tt({check:"custom"});return e._zod.check=t,e}function _p(t,e={}){return hf(gp,t,e)}function wp(t){const e=yp(r=>(r.addIssue=n=>{if(typeof n=="string")r.issues.push(Jr(n,r.value,e._zod.def));else{const s=n;s.fatal&&(s.continue=!1),s.code??(s.code="custom"),s.input??(s.input=r.value),s.inst??(s.inst=e),s.continue??(s.continue=!e._zod.def.abort),r.issues.push(Jr(s))}},t(r.value,r)));return e}const Ra=zt(["pending","approved","rejected","hidden"]),bp=zt(["upvote","downvote"]);zt(["user","moderator","admin"]);zt(["pending","resolved","dismissed"]);const kp=Nt({wordId:Pe().min(1,"Word ID is required").max(100,"Word ID is too long"),definition:Pe().min(5,"Definition must be at least 5 characters long").max(2e3,"Definition is too long (max 2000 characters)").refine(t=>t.trim().length>0,"Definition cannot be empty or only whitespace"),usageExample:Pe().max(1e3,"Usage example is too long (max 1000 characters)").optional().transform(t=>(t==null?void 0:t.trim())||void 0),tags:Or(Pe()).max(10,"Too many tags (max 10)").refine(t=>t.every(e=>e.length<=50),"Each tag must be 50 characters or less").refine(t=>new Set(t).size===t.length,"Tags must be unique").default([]),context:Pe().max(500,"Context is too long (max 500 characters)").optional().transform(t=>(t==null?void 0:t.trim())||void 0)}),Ep=Nt({definition:Pe().min(5,"Definition must be at least 5 characters long").max(2e3,"Definition is too long (max 2000 characters)").optional(),usageExample:Pe().max(1e3,"Usage example is too long (max 1000 characters)").optional().transform(t=>(t==null?void 0:t.trim())||void 0),tags:Or(Pe()).max(10,"Too many tags (max 10)").refine(t=>t.every(e=>e.length<=50),"Each tag must be 50 characters or less").refine(t=>new Set(t).size===t.length,"Tags must be unique").optional(),context:Pe().max(500,"Context is too long (max 500 characters)").optional().transform(t=>(t==null?void 0:t.trim())||void 0),status:Ra.optional(),moderatorNotes:Pe().max(1e3,"Moderator notes are too long (max 1000 characters)").optional().transform(t=>(t==null?void 0:t.trim())||void 0)}),Op=Nt({definitionId:Pe().uuid("Invalid definition ID format"),voteType:bp});Nt({displayName:Pe().min(1,"Display name cannot be empty").max(100,"Display name is too long (max 100 characters)").optional().transform(t=>(t==null?void 0:t.trim())||void 0),username:Pe().min(3,"Username must be at least 3 characters long").max(30,"Username is too long (max 30 characters)").regex(/^[a-zA-Z0-9_-]+$/,"Username can only contain letters, numbers, underscores, and hyphens").optional(),bio:Pe().max(500,"Bio is too long (max 500 characters)").optional().transform(t=>(t==null?void 0:t.trim())||void 0),avatarUrl:Pe().url("Invalid avatar URL").optional(),preferences:np(Kf()).optional().default({})});Nt({definitionId:Pe().uuid("Invalid definition ID format"),reason:Pe().min(10,"Report reason must be at least 10 characters long").max(1e3,"Report reason is too long (max 1000 characters)").refine(t=>t.trim().length>=10,"Report reason cannot be empty or only whitespace")});const Sp=Nt({status:Or(Ra).optional(),tags:Or(Pe()).optional(),minScore:Ln().int().optional(),maxScore:Ln().int().optional(),userId:Pe().uuid().optional(),wordId:Pe().optional(),searchTerm:Pe().min(1,"Search term cannot be empty").max(100,"Search term is too long").optional().transform(t=>(t==null?void 0:t.trim())||void 0),sortBy:zt(["score","date","votes"]).default("score"),sortOrder:zt(["asc","desc"]).default("desc"),limit:Ln().int().min(1).max(100).default(20),offset:Ln().int().min(0).default(0)}).refine(t=>!t.minScore||!t.maxScore||t.minScore<=t.maxScore,{message:"Minimum score cannot be greater than maximum score",path:["minScore"]});Nt({voteNotifications:Mn().default(!0),statusChangeNotifications:Mn().default(!0),moderationNotifications:Mn().default(!1),emailNotifications:Mn().default(!1)});Nt({action:zt(["approve","reject","hide","unhide"]),definitionIds:Or(Pe().uuid()).min(1,"At least one definition must be selected").max(50,"Too many definitions selected (max 50)"),moderatorNotes:Pe().max(1e3,"Moderator notes are too long (max 1000 characters)").optional().transform(t=>(t==null?void 0:t.trim())||void 0)});class Ut extends Error{constructor(e,r,n){super(e),this.field=r,this.code=n,this.name="CommunityValidationError"}}function Ap(t){var e,r;try{return kp.parse(t)}catch(n){if(n instanceof to){const s=(e=n.errors)==null?void 0:e[0];throw s?new Ut(s.message,((r=s.path)==null?void 0:r.join("."))||"unknown","VALIDATION_ERROR"):new Ut("Validation failed","unknown","VALIDATION_ERROR")}throw n}}function Tp(t){var e,r;try{return Ep.parse(t)}catch(n){if(n instanceof to){const s=(e=n.errors)==null?void 0:e[0];throw s?new Ut(s.message,((r=s.path)==null?void 0:r.join("."))||"unknown","VALIDATION_ERROR"):new Ut("Validation failed","unknown","VALIDATION_ERROR")}throw n}}function Ia(t){var e,r;try{return Op.parse(t)}catch(n){if(n instanceof to){const s=(e=n.errors)==null?void 0:e[0];throw s?new Ut(s.message,((r=s.path)==null?void 0:r.join("."))||"unknown","VALIDATION_ERROR"):new Ut("Validation failed","unknown","VALIDATION_ERROR")}throw n}}function xp(t){var e,r;try{return Sp.parse(t)}catch(n){if(n instanceof to){const s=(e=n.errors)==null?void 0:e[0];throw s?new Ut(s.message,((r=s.path)==null?void 0:r.join("."))||"unknown","VALIDATION_ERROR"):new Ut("Validation failed","unknown","VALIDATION_ERROR")}throw n}}function Pp(t,e){return t!==e}class Ci{constructor(e=[]){this.votes=new Map,this.userVotes=new Map,this.definitionVotes=new Map,this.loadVotes(e)}loadVotes(e){this.votes.clear(),this.userVotes.clear(),this.definitionVotes.clear();for(const r of e)this.addVoteToMaps(r)}addVoteToMaps(e){this.votes.set(e.id,e),this.userVotes.has(e.userId)||this.userVotes.set(e.userId,new Map),this.userVotes.get(e.userId).set(e.definitionId,e),this.definitionVotes.has(e.definitionId)||this.definitionVotes.set(e.definitionId,[]),this.definitionVotes.get(e.definitionId).push(e)}removeVoteFromMaps(e){this.votes.delete(e.id);const r=this.userVotes.get(e.userId);r&&(r.delete(e.definitionId),r.size===0&&this.userVotes.delete(e.userId));const n=this.definitionVotes.get(e.definitionId);if(n){const s=n.findIndex(a=>a.id===e.id);s!==-1&&n.splice(s,1),n.length===0&&this.definitionVotes.delete(e.definitionId)}}createVote(e,r,n){try{const s=Ia(e);if(!Pp(r,n))return{success:!1,error:{code:we.SELF_VOTE,message:"You cannot vote on your own content"}};const a=this.getUserVoteForDefinition(r,s.definitionId);if(a)return a.voteType===s.voteType?{success:!1,error:{code:we.DUPLICATE_VOTE,message:"You have already cast this vote"}}:this.updateVote(a.id,s.voteType);const c={id:this.generateVoteId(),definitionId:s.definitionId,userId:r,voteType:s.voteType,createdAt:new Date};return this.addVoteToMaps(c),{success:!0,data:c}}catch(s){return{success:!1,error:{code:we.VALIDATION_ERROR,message:s instanceof Error?s.message:"Validation failed"}}}}updateVote(e,r){const n=this.votes.get(e);if(!n)return{success:!1,error:{code:we.NOT_FOUND,message:"Vote not found"}};this.removeVoteFromMaps(n);const s={...n,voteType:r,createdAt:new Date};return this.addVoteToMaps(s),{success:!0,data:s}}removeVote(e,r){const n=this.votes.get(e);return n?n.userId!==r?{success:!1,error:{code:we.FORBIDDEN,message:"You can only remove your own votes"}}:(this.removeVoteFromMaps(n),{success:!0,data:!0}):{success:!1,error:{code:we.NOT_FOUND,message:"Vote not found"}}}getVoteSummary(e,r){const n=this.definitionVotes.get(e)||[],s=n.filter(p=>p.voteType==="upvote").length,a=n.filter(p=>p.voteType==="downvote").length,c=s-a;let h;if(r){const p=this.getUserVoteForDefinition(r,e);h=p==null?void 0:p.voteType}return{upvotes:s,downvotes:a,score:c,userVote:h}}getVotesForDefinition(e){return this.definitionVotes.get(e)||[]}getVotesByUser(e){const r=this.userVotes.get(e);return r?Array.from(r.values()):[]}getUserVoteForDefinition(e,r){var n;return(n=this.userVotes.get(e))==null?void 0:n.get(r)}calculateScore(e){const r=this.definitionVotes.get(e)||[],n=r.filter(a=>a.voteType==="upvote").length,s=r.filter(a=>a.voteType==="downvote").length;return n-s}getTopVotedDefinitions(e=10){return Array.from(this.definitionVotes.keys()).map(n=>({definitionId:n,score:this.calculateScore(n)})).sort((n,s)=>s.score-n.score).slice(0,e)}getVotingStats(){const e=Array.from(this.votes.values()),r=new Set(e.map(s=>s.userId)).size,n=this.definitionVotes.size;return{totalVotes:e.length,totalUpvotes:e.filter(s=>s.voteType==="upvote").length,totalDownvotes:e.filter(s=>s.voteType==="downvote").length,uniqueVoters:r,definitionsWithVotes:n}}validateIntegrity(){const e=[];for(const[r,n]of this.userVotes)for(const[s,a]of n)this.votes.has(a.id)||e.push(`Vote ${a.id} in user map but not in main map`),a.userId!==r&&e.push(`Vote ${a.id} has incorrect userId in user map`),a.definitionId!==s&&e.push(`Vote ${a.id} has incorrect definitionId in user map`);for(const[r,n]of this.definitionVotes)for(const s of n)this.votes.has(s.id)||e.push(`Vote ${s.id} in definition map but not in main map`),s.definitionId!==r&&e.push(`Vote ${s.id} has incorrect definitionId in definition map`);for(const[r,n]of this.userVotes){const s=Array.from(n.keys()),a=new Set(s);s.length!==a.size&&e.push(`User ${r} has duplicate votes on same definition`)}return{isValid:e.length===0,errors:e}}generateVoteId(){return`vote_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}exportVotes(){return Array.from(this.votes.values())}getUserVoteCount(e,r){const n=this.getVotesByUser(e);return r?n.filter(s=>s.createdAt>=r.start&&s.createdAt<=r.end).length:n.length}hasUserReachedVoteLimit(e,r,n){return this.getUserVoteCount(e,n)>=r}}const $a=as("community",()=>{const t=ze([]),e=ze(new Map),r=ze(null),n=ze([]),s=ze([]),a=ze(!1),c=ze(null),h=ze(null),p=ze(new Ci),v=ze(new Map),_=5*60*1e3,I=ze([]),U=ze(new Set),q=ot(()=>t.value.filter(T=>T.status==="approved")),G=ot(()=>t.value.filter(T=>T.status==="pending")),F=ot(()=>r.value?t.value.filter(T=>T.userId===r.value.id):[]),V=ot(()=>{var T;return((T=r.value)==null?void 0:T.reputationScore)||0}),oe=ot(()=>{var g;const T=(g=r.value)==null?void 0:g.role;return T==="moderator"||T==="admin"});async function se(){try{a.value=!0,c.value=null;const{data:{user:T}}=await X.auth.getUser();T&&await ae(T.id)}catch(T){console.error("Failed to initialize community store:",T),c.value="Failed to initialize community features"}finally{a.value=!1}}async function ae(T){try{const{data:g,error:w}=await X.from("user_profiles").select("*").eq("id",T).single();if(w){if(w.code==="PGRST116"){await le(T);return}throw w}r.value=g}catch(g){throw console.error("Failed to fetch user profile:",g),new Error("Failed to load user profile")}}async function le(T){var g;try{const{data:{user:w}}=await X.auth.getUser(),j=((g=w==null?void 0:w.email)==null?void 0:g.split("@")[0])||`user_${Date.now()}`,{data:z,error:ee}=await X.from("user_profiles").insert({id:T,username:j,reputation_score:0,role:"user",contribution_count:0}).select().single();if(ee)throw ee;r.value=z}catch(w){throw console.error("Failed to create user profile:",w),new Error("Failed to create user profile")}}async function Ie(T){var g;try{a.value=!0,c.value=null;const w=Ap(T),{data:{user:j}}=await X.auth.getUser();if(!j)throw new Error("You must be logged in to submit definitions");const z={word_id:w.wordId,user_id:j.id,definition:w.definition,usage_example:w.usageExample,tags:w.tags,context:w.context,status:"pending"};console.log("Submitting definition with payload:",z);const{data:ee,error:ne}=await X.from("community_definitions").insert(z).select("*").single();if(console.log("Insert result:",{data:ee,error:ne}),ne)throw ne;const{data:Y}=await X.from("user_profiles").select("username, reputation_score").eq("id",j.id).single(),de={...ee,username:(Y==null?void 0:Y.username)||((g=j.email)==null?void 0:g.split("@")[0])||"Anonymous",authorReputation:(Y==null?void 0:Y.reputation_score)||0,voteScore:0,upvotes:0,downvotes:0,createdAt:new Date(ee.created_at),updatedAt:new Date(ee.updated_at)};return t.value.unshift(de),n.value.unshift(de),{success:!0,data:de}}catch(w){return console.error("Failed to submit definition:",w),c.value=w.message,{success:!1,error:{code:we.VALIDATION_ERROR,message:w.message}}}finally{a.value=!1}}async function qe(T,g){try{a.value=!0,c.value=null;const w=Tp(g),{data:{user:j}}=await X.auth.getUser();if(!j)throw new Error("You must be logged in to update definitions");const{data:z,error:ee}=await X.from("community_definitions").update({...w,updated_at:new Date().toISOString()}).eq("id",T).select("*").single();if(ee)throw ee;const{data:ne}=await X.from("user_profiles").select("username, reputation_score").eq("id",z.user_id).single(),Y=t.value.findIndex(de=>de.id===T);if(Y!==-1){const de={...z,username:(ne==null?void 0:ne.username)||"Anonymous",authorReputation:(ne==null?void 0:ne.reputation_score)||0,voteScore:t.value[Y].voteScore||0,upvotes:t.value[Y].upvotes||0,downvotes:t.value[Y].downvotes||0,createdAt:new Date(z.created_at),updatedAt:new Date(z.updated_at)};t.value[Y]=de}return{success:!0,data:z}}catch(w){return console.error("Failed to update definition:",w),c.value=w.message,{success:!1,error:{code:we.VALIDATION_ERROR,message:w.message}}}finally{a.value=!1}}async function Ue(T,g={}){try{a.value=!0,c.value=null;const w=`word_${T}_${JSON.stringify(g)}`,j=v.value.get(w);if(j&&Date.now()-j.timestamp<_)return t.value=j.data,{success:!0,data:j.data};let z=X.from("community_definitions_with_scores").select("*").eq("word_id",T);if(g.status)z=z.in("status",Array.isArray(g.status)?g.status:[g.status]);else{const{data:{user:be}}=await X.auth.getUser();be||(z=z.eq("status","approved"))}const ee=g.sortBy||"vote_score",ne=g.sortOrder||"desc";z=z.order(ee,{ascending:ne==="asc"}),g.limit&&(z=z.limit(g.limit)),g.offset&&(z=z.range(g.offset,g.offset+(g.limit||20)-1));const{data:Y,error:de}=await z;if(de)throw de;const ke=Y.map(be=>({...be,createdAt:new Date(be.created_at),updatedAt:new Date(be.updated_at),voteScore:be.vote_score,authorReputation:be.author_reputation}));return v.value.set(w,{data:ke,timestamp:Date.now()}),t.value=ke,h.value=new Date,{success:!0,data:ke}}catch(w){return console.error("Failed to fetch definitions:",w),c.value=w.message,{success:!1,error:{code:we.NOT_FOUND,message:w.message}}}finally{a.value=!1}}async function Ft(T={}){try{a.value=!0,c.value=null;const g=xp(T),w=`search_${JSON.stringify(g)}`,j=v.value.get(w);if(j&&Date.now()-j.timestamp<_)return{success:!0,data:j.data};let z=X.from("community_definitions_with_scores").select("*");if(g.status&&(z=z.in("status",g.status)),g.tags&&g.tags.length>0&&(z=z.overlaps("tags",g.tags)),g.minScore!==void 0&&(z=z.gte("vote_score",g.minScore)),g.maxScore!==void 0&&(z=z.lte("vote_score",g.maxScore)),g.userId&&(z=z.eq("user_id",g.userId)),g.wordId&&(z=z.eq("word_id",g.wordId)),g.searchTerm){const ke=`%${g.searchTerm}%`;z=z.or(`definition.ilike.${ke},usage_example.ilike.${ke},context.ilike.${ke},word_id.ilike.${ke}`)}const ee=g.sortBy==="date"?"created_at":"vote_score";z=z.order(ee,{ascending:g.sortOrder==="asc"}),z=z.range(g.offset,g.offset+g.limit-1);const{data:ne,error:Y}=await z;if(console.log("Community store search - Query filters:",g),console.log("Community store search - Raw results:",ne),console.log("Community store search - Error:",Y),Y)throw Y;const de=ne.map(ke=>({...ke,createdAt:new Date(ke.created_at),updatedAt:new Date(ke.updated_at),voteScore:ke.vote_score,authorReputation:ke.author_reputation}));return v.value.set(w,{data:de,timestamp:Date.now()}),{success:!0,data:de}}catch(g){return console.error("Failed to search definitions:",g),c.value=g.message,{success:!1,error:{code:we.VALIDATION_ERROR,message:g.message}}}finally{a.value=!1}}async function oo(T){try{a.value=!0,c.value=null;const{data:{user:g}}=await X.auth.getUser();if(!g)throw new Error("You must be logged in to delete definitions");const{error:w}=await X.from("community_definitions").delete().eq("id",T);if(w)throw w;const j=t.value.findIndex(z=>z.id===T);return j!==-1&&t.value.splice(j,1),v.value.clear(),{success:!0}}catch(g){return console.error("Failed to delete definition:",g),c.value=g.message,{success:!1,error:{code:we.FORBIDDEN,message:g.message}}}finally{a.value=!1}}async function en(T){try{a.value=!0,c.value=null;const{data:{user:g}}=await X.auth.getUser();if(!g)throw new Error("You must be logged in to update your profile");const w=validateUpdateProfile(T),{data:j,error:z}=await X.from("user_profiles").update({display_name:w.displayName,username:w.username,bio:w.bio,avatar_url:w.avatarUrl,preferences:w.preferences,updated_at:new Date().toISOString()}).eq("id",g.id).select().single();if(z)throw z;return r.value={...r.value,...j},{success:!0,data:j}}catch(g){return console.error("Failed to update user profile:",g),c.value=g.message,{success:!1,error:{code:we.VALIDATION_ERROR,message:g.message}}}finally{a.value=!1}}async function tn(T){var g,w;try{const{data:j,error:z}=await X.from("community_definitions").select("status").eq("user_id",T);if(z)throw z;const{data:ee,error:ne}=await X.from("community_votes").select("vote_type, community_definitions!inner(user_id)").eq("community_definitions.user_id",T);if(ne)throw ne;const Y=ee.length,de=ee.filter(Q=>Q.vote_type==="upvote").length,ke=ee.filter(Q=>Q.vote_type==="downvote").length;return{success:!0,data:{totalDefinitions:j.length,approvedDefinitions:j.filter(Q=>Q.status==="approved").length,pendingDefinitions:j.filter(Q=>Q.status==="pending").length,rejectedDefinitions:j.filter(Q=>Q.status==="rejected").length,totalVotesReceived:Y,upvotesReceived:de,downvotesReceived:ke,reputationScore:((g=r.value)==null?void 0:g.reputationScore)||0,contributionCount:((w=r.value)==null?void 0:w.contributionCount)||0}}}catch(j){return console.error("Failed to get contribution stats:",j),{success:!1,error:{code:we.NOT_FOUND,message:j.message}}}}function Lt(T){const g=[{threshold:0,title:"New Contributor",description:"Welcome to the community!"},{threshold:10,title:"Active Member",description:"You're making valuable contributions"},{threshold:50,title:"Trusted Contributor",description:"Your contributions are highly valued"},{threshold:100,title:"Community Expert",description:"You're a recognized expert"},{threshold:250,title:"Master Contributor",description:"Your expertise is exceptional"},{threshold:500,title:"Community Leader",description:"You're leading by example"}],w=g.filter(z=>T>=z.threshold).pop()||g[0],j=g.find(z=>z.threshold>T);return{current:w,next:j,progress:j?(T-w.threshold)/(j.threshold-w.threshold):1}}function ft(T,g){return{canVote:!0,canSubmit:!0,canEdit:g==="moderator"||g==="admin",canModerate:g==="moderator"||g==="admin",canEditOthers:T>=100||g==="moderator"||g==="admin",canSkipModeration:T>=250||g==="moderator"||g==="admin",dailyVoteLimit:Math.min(50,Math.max(10,Math.floor(T/5)+10)),dailySubmissionLimit:Math.min(10,Math.max(3,Math.floor(T/10)+3))}}async function so(T,g=20){try{const{data:w,error:j}=await X.from("community_definitions").select("id, word_id, definition, status, created_at, updated_at").eq("user_id",T).order("created_at",{ascending:!1}).limit(g);if(j)throw j;const{data:z,error:ee}=await X.from("community_votes").select(`
          vote_type, 
          created_at,
          community_definitions!inner(id, word_id, definition)
        `).eq("user_id",T).order("created_at",{ascending:!1}).limit(g);if(ee)throw ee;return{success:!0,data:[...w.map(Y=>({type:"definition",action:Y.status==="pending"?"submitted":Y.status,data:Y,timestamp:new Date(Y.created_at)})),...z.map(Y=>({type:"vote",action:Y.vote_type,data:{definitionId:Y.community_definitions.id,wordId:Y.community_definitions.word_id,definition:Y.community_definitions.definition},timestamp:new Date(Y.created_at)}))].sort((Y,de)=>de.timestamp-Y.timestamp).slice(0,g)}}catch(w){return console.error("Failed to get user activity history:",w),{success:!1,error:{code:we.NOT_FOUND,message:w.message}}}}async function Tr(T="reputation",g=10){try{let w=X.from("user_profiles").select("id, username, display_name, reputation_score, contribution_count");switch(T){case"reputation":w=w.order("reputation_score",{ascending:!1});break;case"contributions":w=w.order("contribution_count",{ascending:!1});break;default:w=w.order("reputation_score",{ascending:!1})}w=w.limit(g);const{data:j,error:z}=await w;if(z)throw z;return{success:!0,data:j}}catch(w){return console.error("Failed to get leaderboard:",w),{success:!1,error:{code:we.NOT_FOUND,message:w.message}}}}async function or(T,g){var w;try{if(a.value=!0,c.value=null,((w=r.value)==null?void 0:w.role)!=="admin")throw new Error("Only administrators can update user roles");const{data:j,error:z}=await X.from("user_profiles").update({role:g,updated_at:new Date().toISOString()}).eq("id",T).select().single();if(z)throw z;return{success:!0,data:j}}catch(j){return console.error("Failed to update user role:",j),c.value=j.message,{success:!1,error:{code:we.FORBIDDEN,message:j.message}}}finally{a.value=!1}}async function io(T={}){try{if(a.value=!0,c.value=null,!oe.value)throw new Error("You do not have permission to access the moderation queue");let g=X.from("community_definitions_with_scores").select("*");const w=T.status||["pending"];if(g=g.in("status",Array.isArray(w)?w:[w]),T.searchTerm){const be=`%${T.searchTerm}%`;g=g.or(`definition.ilike.${be},usage_example.ilike.${be},word_id.ilike.${be},username.ilike.${be}`)}T.dateFrom&&(g=g.gte("created_at",T.dateFrom)),T.dateTo&&(g=g.lte("created_at",T.dateTo)),T.userId&&(g=g.eq("user_id",T.userId));const j=T.sortBy||"created_at",z=T.sortOrder||"desc";g=g.order(j,{ascending:z==="asc"});const ee=T.limit||50,ne=T.offset||0;g=g.range(ne,ne+ee-1);const{data:Y,error:de}=await g;if(de)throw de;const ke=Y.map(be=>({...be,createdAt:new Date(be.created_at),updatedAt:new Date(be.updated_at),voteScore:be.vote_score,authorReputation:be.author_reputation}));return s.value=ke,{success:!0,data:ke}}catch(g){return console.error("Failed to fetch moderation queue:",g),c.value=g.message,{success:!1,error:{code:we.FORBIDDEN,message:g.message}}}finally{a.value=!1}}async function pt(T,g=""){try{if(a.value=!0,c.value=null,!oe.value)throw new Error("You do not have permission to moderate content");const{data:{user:w}}=await X.auth.getUser();if(!w)throw new Error("You must be logged in to moderate content");const{data:j,error:z}=await X.from("community_definitions").update({status:"approved",moderator_notes:g,moderator_id:w.id,updated_at:new Date().toISOString()}).eq("id",T).select().single();if(z)throw z;const ee=s.value.findIndex(Y=>Y.id===T);ee!==-1&&s.value.splice(ee,1);const ne=t.value.findIndex(Y=>Y.id===T);return ne!==-1&&(t.value[ne]={...t.value[ne],status:"approved",moderator_notes:g,moderator_id:w.id,updatedAt:new Date}),{success:!0,data:j}}catch(w){return console.error("Failed to approve definition:",w),c.value=w.message,{success:!1,error:{code:we.FORBIDDEN,message:w.message}}}finally{a.value=!1}}async function _t(T,g=""){try{if(a.value=!0,c.value=null,!oe.value)throw new Error("You do not have permission to moderate content");const{data:{user:w}}=await X.auth.getUser();if(!w)throw new Error("You must be logged in to moderate content");const{data:j,error:z}=await X.from("community_definitions").update({status:"rejected",moderator_notes:g,moderator_id:w.id,updated_at:new Date().toISOString()}).eq("id",T).select().single();if(z)throw z;const ee=s.value.findIndex(Y=>Y.id===T);ee!==-1&&s.value.splice(ee,1);const ne=t.value.findIndex(Y=>Y.id===T);return ne!==-1&&(t.value[ne]={...t.value[ne],status:"rejected",moderator_notes:g,moderator_id:w.id,updatedAt:new Date}),{success:!0,data:j}}catch(w){return console.error("Failed to reject definition:",w),c.value=w.message,{success:!1,error:{code:we.FORBIDDEN,message:w.message}}}finally{a.value=!1}}async function it(T,g=""){try{if(a.value=!0,c.value=null,!oe.value)throw new Error("You do not have permission to moderate content");const{data:{user:w}}=await X.auth.getUser();if(!w)throw new Error("You must be logged in to moderate content");const{data:j,error:z}=await X.from("community_definitions").update({status:"approved",moderator_notes:g,moderator_id:w.id,updated_at:new Date().toISOString()}).in("id",T).select();if(z)throw z;return T.forEach(ee=>{const ne=s.value.findIndex(de=>de.id===ee);ne!==-1&&s.value.splice(ne,1);const Y=t.value.findIndex(de=>de.id===ee);Y!==-1&&(t.value[Y]={...t.value[Y],status:"approved",moderator_notes:g,moderator_id:w.id,updatedAt:new Date})}),{success:!0,data:j,count:j.length}}catch(w){return console.error("Failed to bulk approve definitions:",w),c.value=w.message,{success:!1,error:{code:we.FORBIDDEN,message:w.message}}}finally{a.value=!1}}async function xr(T,g=""){try{if(a.value=!0,c.value=null,!oe.value)throw new Error("You do not have permission to moderate content");const{data:{user:w}}=await X.auth.getUser();if(!w)throw new Error("You must be logged in to moderate content");const{data:j,error:z}=await X.from("community_definitions").update({status:"rejected",moderator_notes:g,moderator_id:w.id,updated_at:new Date().toISOString()}).in("id",T).select();if(z)throw z;return T.forEach(ee=>{const ne=s.value.findIndex(de=>de.id===ee);ne!==-1&&s.value.splice(ne,1);const Y=t.value.findIndex(de=>de.id===ee);Y!==-1&&(t.value[Y]={...t.value[Y],status:"rejected",moderator_notes:g,moderator_id:w.id,updatedAt:new Date})}),{success:!0,data:j,count:j.length}}catch(w){return console.error("Failed to bulk reject definitions:",w),c.value=w.message,{success:!1,error:{code:we.FORBIDDEN,message:w.message}}}finally{a.value=!1}}async function ao(T,g={},w=""){try{a.value=!0,c.value=null;const{data:j,error:z}=await X.rpc("promote_to_admin",{target_user_id:T,admin_permissions:g,notes:w});if(z)throw z;return{success:j.success,message:j.message,error:j.error}}catch(j){return console.error("Failed to promote user to admin:",j),c.value=j.message,{success:!1,error:{code:we.FORBIDDEN,message:j.message}}}finally{a.value=!1}}async function wt(T,g=""){try{a.value=!0,c.value=null;const{data:w,error:j}=await X.rpc("promote_to_moderator",{target_user_id:T,notes:g});if(j)throw j;return{success:w.success,message:w.message,error:w.error}}catch(w){return console.error("Failed to promote user to moderator:",w),c.value=w.message,{success:!1,error:{code:we.FORBIDDEN,message:w.message}}}finally{a.value=!1}}async function rn(T,g=""){try{a.value=!0,c.value=null;const{data:w,error:j}=await X.rpc("demote_to_user",{target_user_id:T,reason:g});if(j)throw j;return{success:w.success,message:w.message,error:w.error}}catch(w){return console.error("Failed to demote user:",w),c.value=w.message,{success:!1,error:{code:we.FORBIDDEN,message:w.message}}}finally{a.value=!1}}async function sr(T,g,w=null){try{a.value=!0,c.value=null;const{data:j,error:z}=await X.rpc("suspend_user",{target_user_id:T,reason:g,duration_days:w});if(z)throw z;return{success:j.success,message:j.message,error:j.error}}catch(j){return console.error("Failed to suspend user:",j),c.value=j.message,{success:!1,error:{code:we.FORBIDDEN,message:j.message}}}finally{a.value=!1}}async function bt(T,g=""){try{a.value=!0,c.value=null;const{data:w,error:j}=await X.rpc("reactivate_user",{target_user_id:T,notes:g});if(j)throw j;return{success:w.success,message:w.message,error:w.error}}catch(w){return console.error("Failed to reactivate user:",w),c.value=w.message,{success:!1,error:{code:we.FORBIDDEN,message:w.message}}}finally{a.value=!1}}async function Pr(){try{a.value=!0,c.value=null;const{data:T,error:g}=await X.rpc("get_admin_dashboard_stats");if(g)throw g;return{success:T.success,data:T.data,error:T.error}}catch(T){return console.error("Failed to get admin dashboard stats:",T),c.value=T.message,{success:!1,error:{code:we.FORBIDDEN,message:T.message}}}finally{a.value=!1}}async function uo(T={}){try{a.value=!0,c.value=null;const{data:g,error:w}=await X.rpc("get_user_management_list",{search_term:T.searchTerm||null,role_filter:T.roleFilter||null,status_filter:T.statusFilter||null,limit_count:T.limit||50,offset_count:T.offset||0});if(w)throw w;return{success:g.success,data:g.data,error:g.error}}catch(g){return console.error("Failed to get user management list:",g),c.value=g.message,{success:!1,error:{code:we.FORBIDDEN,message:g.message}}}finally{a.value=!1}}async function te(T){try{const{data:g,error:w}=await X.rpc("update_user_reputation",{user_id:T});if(w)throw w;const{data:{user:j}}=await X.auth.getUser();return j&&j.id===T&&await ae(T),{success:!0,data:g}}catch(g){return console.error("Failed to refresh user reputation:",g),{success:!1,error:{code:we.VALIDATION_ERROR,message:g.message}}}}async function nn(T,g){try{c.value=null;const{data:{user:w}}=await X.auth.getUser();if(!w)throw new Error("You must be logged in to vote");const z=Ia({definitionId:T,voteType:g}),ee=t.value.find(de=>de.id===T);if(!ee)throw new Error("Definition not found");const ne=p.value.createVote(z,w.id,ee.userId||ee.user_id);if(!ne.success)throw new Error(ne.error.message);const Y=e.value.get(T);e.value.set(T,{voteType:g,userId:w.id}),ve(T,g,Y==null?void 0:Y.voteType);try{const{data:de,error:ke}=await X.from("community_votes").upsert({definition_id:T,user_id:w.id,vote_type:g},{onConflict:"definition_id,user_id"}).select().single();if(ke)throw ke;return mt(T,g,Y==null?void 0:Y.voteType),{success:!0,data:de}}catch(de){throw Y?(e.value.set(T,Y),ve(T,Y.voteType,g)):(e.value.delete(T),ve(T,null,g)),de}}catch(w){return console.error("Failed to submit vote:",w),c.value=w.message,{success:!1,error:{code:we.VALIDATION_ERROR,message:w.message}}}}async function ir(T){try{c.value=null;const{data:{user:g}}=await X.auth.getUser();if(!g)throw new Error("You must be logged in to remove votes");const w=e.value.get(T);if(!w)throw new Error("No vote to remove");e.value.delete(T),ve(T,null,w.voteType);try{const{error:j}=await X.from("community_votes").delete().eq("definition_id",T).eq("user_id",g.id);if(j)throw j;return{success:!0}}catch(j){throw e.value.set(T,w),ve(T,w.voteType,null),j}}catch(g){return console.error("Failed to remove vote:",g),c.value=g.message,{success:!1,error:{code:we.VALIDATION_ERROR,message:g.message}}}}function ve(T,g,w){const j=t.value.find(Y=>Y.id===T);if(!j)return;let z=0,ee=0,ne=0;w==="upvote"&&g==="downvote"?(z=-2,ee=-1,ne=1):w==="downvote"&&g==="upvote"?(z=2,ee=1,ne=-1):w==="upvote"&&!g?(z=-1,ee=-1):w==="downvote"&&!g?(z=1,ne=-1):!w&&g==="upvote"?(z=1,ee=1):!w&&g==="downvote"&&(z=-1,ne=1),j.voteScore=(j.voteScore||0)+z,j.upvotes=Math.max(0,(j.upvotes||0)+ee),j.downvotes=Math.max(0,(j.downvotes||0)+ne),j.userVote=g}async function Mt(T){try{const{data:{user:g}}=await X.auth.getUser();if(!g||!T.length)return;const{data:w,error:j}=await X.from("community_votes").select("definition_id, vote_type").eq("user_id",g.id).in("definition_id",T);if(j)throw j;return w.forEach(z=>{e.value.set(z.definition_id,{voteType:z.vote_type,userId:g.id})}),t.value.forEach(z=>{const ee=w.find(ne=>ne.definition_id===z.id);ee&&(z.userVote=ee.vote_type)}),{success:!0,data:w}}catch(g){return console.error("Failed to fetch user votes:",g),{success:!1,error:{code:we.NOT_FOUND,message:g.message}}}}return{communityDefinitions:t,userVotes:e,userProfile:r,pendingSubmissions:n,moderationQueue:s,loading:a,error:c,lastFetch:h,approvedDefinitions:q,pendingDefinitions:G,userDefinitions:F,userReputation:V,canModerate:oe,initialize:se,fetchUserProfile:ae,createUserProfile:le,submitDefinition:Ie,updateDefinition:qe,fetchDefinitionsForWord:Ue,searchDefinitions:Ft,deleteDefinition:oo,updateUserProfile:en,getUserContributionStats:tn,getReputationMilestones:Lt,getUserPrivileges:ft,getUserActivityHistory:so,getLeaderboard:Tr,updateUserRole:or,refreshUserReputation:te,fetchModerationQueue:io,approveDefinition:pt,rejectDefinition:_t,bulkApproveDefinitions:it,bulkRejectDefinitions:xr,promoteToAdmin:ao,promoteToModerator:wt,demoteToUser:rn,suspendUser:sr,reactivateUser:bt,getAdminDashboardStats:Pr,getUserManagementList:uo,updateUserRole:or,submitVote:nn,removeVote:ir,fetchUserVotes:Mt,updateDefinitionVoteScore:ve,getVoteSummary:Ye,setupRealtimeSubscriptions:on,cleanupRealtimeSubscriptions:We,onVoteUpdate:sn,handleVoteRealtimeUpdate:ar,handleDefinitionRealtimeUpdate:ur,emitVoteUpdate:mt,refreshDefinitionVotes:lt,getVoteSummary:Ye,clearCache:Rr,reset:kt};function on(){We();const T=X.channel("community_votes").on("postgres_changes",{event:"*",schema:"public",table:"community_votes"},w=>{ar(w)}).subscribe(),g=X.channel("community_definitions").on("postgres_changes",{event:"*",schema:"public",table:"community_definitions"},w=>{ur(w)}).subscribe();return I.value=[T,g],()=>{We()}}function We(){I.value.forEach(T=>{X.removeChannel(T)}),I.value=[]}function ar(T){const{eventType:g,new:w,old:j}=T;g==="INSERT"||g==="UPDATE"?(lt(w.definition_id),mt(w.definition_id,w.vote_type,j==null?void 0:j.vote_type)):g==="DELETE"&&(lt(j.definition_id),mt(j.definition_id,null,j.vote_type))}function mt(T,g,w){const j={definitionId:T,newVoteType:g,previousVoteType:w,timestamp:new Date};U.value.forEach(z=>{try{z(j)}catch(ee){console.error("Error in vote update callback:",ee)}})}function sn(T){return U.value.add(T),()=>{U.value.delete(T)}}function ur(T){const{eventType:g,new:w,old:j}=T;if(g==="INSERT")console.log("New definition added:",w);else if(g==="UPDATE"){const z=t.value.findIndex(ee=>ee.id===w.id);z!==-1&&(t.value[z]={...t.value[z],...w,createdAt:new Date(w.created_at),updatedAt:new Date(w.updated_at)})}else if(g==="DELETE"){const z=t.value.findIndex(ee=>ee.id===j.id);z!==-1&&t.value.splice(z,1)}}async function lt(T){try{const{data:g,error:w}=await X.from("community_definitions_with_scores").select("vote_score, upvotes, downvotes").eq("id",T).single();if(w)throw w;const j=t.value.find(z=>z.id===T);j&&(j.voteScore=g.vote_score,j.upvotes=g.upvotes,j.downvotes=g.downvotes)}catch(g){console.error("Failed to refresh definition votes:",g)}}function Ye(T){const g=t.value.find(w=>w.id===T);return g?{upvotes:g.upvotes||0,downvotes:g.downvotes||0,score:g.voteScore||0,userVote:g.userVote}:{upvotes:0,downvotes:0,score:0,userVote:void 0}}function Rr(){v.value.clear()}function kt(){t.value=[],e.value=new Map,r.value=null,n.value=[],s.value=[],a.value=!1,c.value=null,h.value=null,p.value=new Ci,v.value.clear()}});var Da={exports:{}};(function(t,e){(function(r,n){t.exports=n()})(et,function(){var r=function(o,i){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(u,l){u.__proto__=l}||function(u,l){for(var d in l)Object.prototype.hasOwnProperty.call(l,d)&&(u[d]=l[d])})(o,i)},n=function(){return(n=Object.assign||function(o){for(var i,u=1,l=arguments.length;u<l;u++)for(var d in i=arguments[u])Object.prototype.hasOwnProperty.call(i,d)&&(o[d]=i[d]);return o}).apply(this,arguments)};function s(o,i,u){for(var l,d=0,f=i.length;d<f;d++)!l&&d in i||((l=l||Array.prototype.slice.call(i,0,d))[d]=i[d]);return o.concat(l||Array.prototype.slice.call(i))}var a=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:et,c=Object.keys,h=Array.isArray;function p(o,i){return typeof i!="object"||c(i).forEach(function(u){o[u]=i[u]}),o}typeof Promise>"u"||a.Promise||(a.Promise=Promise);var v=Object.getPrototypeOf,_={}.hasOwnProperty;function I(o,i){return _.call(o,i)}function U(o,i){typeof i=="function"&&(i=i(v(o))),(typeof Reflect>"u"?c:Reflect.ownKeys)(i).forEach(function(u){G(o,u,i[u])})}var q=Object.defineProperty;function G(o,i,u,l){q(o,i,p(u&&I(u,"get")&&typeof u.get=="function"?{get:u.get,set:u.set,configurable:!0}:{value:u,configurable:!0,writable:!0},l))}function F(o){return{from:function(i){return o.prototype=Object.create(i.prototype),G(o.prototype,"constructor",o),{extend:U.bind(null,o.prototype)}}}}var V=Object.getOwnPropertyDescriptor,oe=[].slice;function se(o,i,u){return oe.call(o,i,u)}function ae(o,i){return i(o)}function le(o){if(!o)throw new Error("Assertion Failed")}function Ie(o){a.setImmediate?setImmediate(o):setTimeout(o,0)}function qe(o,i){if(typeof i=="string"&&I(o,i))return o[i];if(!i)return o;if(typeof i!="string"){for(var u=[],l=0,d=i.length;l<d;++l){var f=qe(o,i[l]);u.push(f)}return u}var m=i.indexOf(".");if(m!==-1){var y=o[i.substr(0,m)];return y==null?void 0:qe(y,i.substr(m+1))}}function Ue(o,i,u){if(o&&i!==void 0&&!("isFrozen"in Object&&Object.isFrozen(o)))if(typeof i!="string"&&"length"in i){le(typeof u!="string"&&"length"in u);for(var l=0,d=i.length;l<d;++l)Ue(o,i[l],u[l])}else{var f,m,y=i.indexOf(".");y!==-1?(f=i.substr(0,y),(m=i.substr(y+1))===""?u===void 0?h(o)&&!isNaN(parseInt(f))?o.splice(f,1):delete o[f]:o[f]=u:Ue(y=!(y=o[f])||!I(o,f)?o[f]={}:y,m,u)):u===void 0?h(o)&&!isNaN(parseInt(i))?o.splice(i,1):delete o[i]:o[i]=u}}function Ft(o){var i,u={};for(i in o)I(o,i)&&(u[i]=o[i]);return u}var oo=[].concat;function en(o){return oo.apply([],o)}var gt="BigUint64Array,BigInt64Array,Array,Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,FileSystemDirectoryHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(en([8,16,32,64].map(function(o){return["Int","Uint","Float"].map(function(i){return i+o+"Array"})}))).filter(function(o){return a[o]}),tn=new Set(gt.map(function(o){return a[o]})),Lt=null;function ft(o){return Lt=new WeakMap,o=function i(u){if(!u||typeof u!="object")return u;var l=Lt.get(u);if(l)return l;if(h(u)){l=[],Lt.set(u,l);for(var d=0,f=u.length;d<f;++d)l.push(i(u[d]))}else if(tn.has(u.constructor))l=u;else{var m,y=v(u);for(m in l=y===Object.prototype?{}:Object.create(y),Lt.set(u,l),u)I(u,m)&&(l[m]=i(u[m]))}return l}(o),Lt=null,o}var so={}.toString;function Tr(o){return so.call(o).slice(8,-1)}var or=typeof Symbol<"u"?Symbol.iterator:"@@iterator",io=typeof or=="symbol"?function(o){var i;return o!=null&&(i=o[or])&&i.apply(o)}:function(){return null};function pt(o,i){return i=o.indexOf(i),0<=i&&o.splice(i,1),0<=i}var _t={};function it(o){var i,u,l,d;if(arguments.length===1){if(h(o))return o.slice();if(this===_t&&typeof o=="string")return[o];if(d=io(o)){for(u=[];!(l=d.next()).done;)u.push(l.value);return u}if(o==null)return[o];if(typeof(i=o.length)!="number")return[o];for(u=new Array(i);i--;)u[i]=o[i];return u}for(i=arguments.length,u=new Array(i);i--;)u[i]=arguments[i];return u}var xr=typeof Symbol<"u"?function(o){return o[Symbol.toStringTag]==="AsyncFunction"}:function(){return!1},g=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],st=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(g),ao={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function wt(o,i){this.name=o,this.message=i}function rn(o,i){return o+". Errors: "+Object.keys(i).map(function(u){return i[u].toString()}).filter(function(u,l,d){return d.indexOf(u)===l}).join(`
`)}function sr(o,i,u,l){this.failures=i,this.failedKeys=l,this.successCount=u,this.message=rn(o,i)}function bt(o,i){this.name="BulkError",this.failures=Object.keys(i).map(function(u){return i[u]}),this.failuresByPos=i,this.message=rn(o,this.failures)}F(wt).from(Error).extend({toString:function(){return this.name+": "+this.message}}),F(sr).from(wt),F(bt).from(wt);var Pr=st.reduce(function(o,i){return o[i]=i+"Error",o},{}),uo=wt,te=st.reduce(function(o,i){var u=i+"Error";function l(d,f){this.name=u,d?typeof d=="string"?(this.message="".concat(d).concat(f?`
 `+f:""),this.inner=f||null):typeof d=="object"&&(this.message="".concat(d.name," ").concat(d.message),this.inner=d):(this.message=ao[i]||u,this.inner=null)}return F(l).from(uo),o[i]=l,o},{});te.Syntax=SyntaxError,te.Type=TypeError,te.Range=RangeError;var nn=g.reduce(function(o,i){return o[i+"Error"]=te[i],o},{}),ir=st.reduce(function(o,i){return["Syntax","Type","Range"].indexOf(i)===-1&&(o[i+"Error"]=te[i]),o},{});function ve(){}function Mt(o){return o}function on(o,i){return o==null||o===Mt?i:function(u){return i(o(u))}}function We(o,i){return function(){o.apply(this,arguments),i.apply(this,arguments)}}function ar(o,i){return o===ve?i:function(){var u=o.apply(this,arguments);u!==void 0&&(arguments[0]=u);var l=this.onsuccess,d=this.onerror;this.onsuccess=null,this.onerror=null;var f=i.apply(this,arguments);return l&&(this.onsuccess=this.onsuccess?We(l,this.onsuccess):l),d&&(this.onerror=this.onerror?We(d,this.onerror):d),f!==void 0?f:u}}function mt(o,i){return o===ve?i:function(){o.apply(this,arguments);var u=this.onsuccess,l=this.onerror;this.onsuccess=this.onerror=null,i.apply(this,arguments),u&&(this.onsuccess=this.onsuccess?We(u,this.onsuccess):u),l&&(this.onerror=this.onerror?We(l,this.onerror):l)}}function sn(o,i){return o===ve?i:function(u){var l=o.apply(this,arguments);p(u,l);var d=this.onsuccess,f=this.onerror;return this.onsuccess=null,this.onerror=null,u=i.apply(this,arguments),d&&(this.onsuccess=this.onsuccess?We(d,this.onsuccess):d),f&&(this.onerror=this.onerror?We(f,this.onerror):f),l===void 0?u===void 0?void 0:u:p(l,u)}}function ur(o,i){return o===ve?i:function(){return i.apply(this,arguments)!==!1&&o.apply(this,arguments)}}function lt(o,i){return o===ve?i:function(){var u=o.apply(this,arguments);if(u&&typeof u.then=="function"){for(var l=this,d=arguments.length,f=new Array(d);d--;)f[d]=arguments[d];return u.then(function(){return i.apply(l,f)})}return i.apply(this,arguments)}}ir.ModifyError=sr,ir.DexieError=wt,ir.BulkError=bt;var Ye=typeof location<"u"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function Rr(o){Ye=o}var kt={},T=100,gt=typeof Promise>"u"?[]:function(){var o=Promise.resolve();if(typeof crypto>"u"||!crypto.subtle)return[o,v(o),o];var i=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[i,v(i),o]}(),g=gt[0],st=gt[1],gt=gt[2],st=st&&st.then,w=g&&g.constructor,j=!!gt,z=function(o,i){Ir.push([o,i]),ne&&(queueMicrotask(ja),ne=!1)},ee=!0,ne=!0,Y=[],de=[],ke=Mt,be={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:ve,pgp:!1,env:{},finalize:ve},Q=be,Ir=[],qt=0,an=[];function J(o){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this._lib=!1;var i=this._PSD=Q;if(typeof o!="function"){if(o!==kt)throw new TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(this._state===!1&&lo(this,this._value))}this._state=null,this._value=null,++i.ref,function u(l,d){try{d(function(f){if(l._state===null){if(f===l)throw new TypeError("A promise cannot be resolved with itself.");var m=l._lib&&cr();f&&typeof f.then=="function"?u(l,function(y,O){f instanceof J?f._then(y,O):f.then(y,O)}):(l._state=!0,l._value=f,ws(l)),m&&lr()}},lo.bind(null,l))}catch(f){lo(l,f)}}(this,o)}var co={get:function(){var o=Q,i=dn;function u(l,d){var f=this,m=!o.global&&(o!==Q||i!==dn),y=m&&!Ot(),O=new J(function(k,x){ho(f,new _s(ks(l,o,m,y),ks(d,o,m,y),k,x,o))});return this._consoleTask&&(O._consoleTask=this._consoleTask),O}return u.prototype=kt,u},set:function(o){G(this,"then",o&&o.prototype===kt?co:{get:function(){return o},set:co.set})}};function _s(o,i,u,l,d){this.onFulfilled=typeof o=="function"?o:null,this.onRejected=typeof i=="function"?i:null,this.resolve=u,this.reject=l,this.psd=d}function lo(o,i){var u,l;de.push(i),o._state===null&&(u=o._lib&&cr(),i=ke(i),o._state=!1,o._value=i,l=o,Y.some(function(d){return d._value===l._value})||Y.push(l),ws(o),u&&lr())}function ws(o){var i=o._listeners;o._listeners=[];for(var u=0,l=i.length;u<l;++u)ho(o,i[u]);var d=o._PSD;--d.ref||d.finalize(),qt===0&&(++qt,z(function(){--qt==0&&fo()},[]))}function ho(o,i){if(o._state!==null){var u=o._state?i.onFulfilled:i.onRejected;if(u===null)return(o._state?i.resolve:i.reject)(o._value);++i.psd.ref,++qt,z(Ca,[u,o,i])}else o._listeners.push(i)}function Ca(o,i,u){try{var l,d=i._value;!i._state&&de.length&&(de=[]),l=Ye&&i._consoleTask?i._consoleTask.run(function(){return o(d)}):o(d),i._state||de.indexOf(d)!==-1||function(f){for(var m=Y.length;m;)if(Y[--m]._value===f._value)return Y.splice(m,1)}(i),u.resolve(l)}catch(f){u.reject(f)}finally{--qt==0&&fo(),--u.psd.ref||u.psd.finalize()}}function ja(){Bt(be,function(){cr()&&lr()})}function cr(){var o=ee;return ne=ee=!1,o}function lr(){var o,i,u;do for(;0<Ir.length;)for(o=Ir,Ir=[],u=o.length,i=0;i<u;++i){var l=o[i];l[0].apply(null,l[1])}while(0<Ir.length);ne=ee=!0}function fo(){var o=Y;Y=[],o.forEach(function(l){l._PSD.onunhandled.call(null,l._value,l)});for(var i=an.slice(0),u=i.length;u;)i[--u]()}function un(o){return new J(kt,!1,o)}function Ae(o,i){var u=Q;return function(){var l=cr(),d=Q;try{return St(u,!0),o.apply(this,arguments)}catch(f){i&&i(f)}finally{St(d,!1),l&&lr()}}}U(J.prototype,{then:co,_then:function(o,i){ho(this,new _s(null,null,o,i,Q))},catch:function(o){if(arguments.length===1)return this.then(null,o);var i=o,u=arguments[1];return typeof i=="function"?this.then(null,function(l){return(l instanceof i?u:un)(l)}):this.then(null,function(l){return(l&&l.name===i?u:un)(l)})},finally:function(o){return this.then(function(i){return J.resolve(o()).then(function(){return i})},function(i){return J.resolve(o()).then(function(){return un(i)})})},timeout:function(o,i){var u=this;return o<1/0?new J(function(l,d){var f=setTimeout(function(){return d(new te.Timeout(i))},o);u.then(l,d).finally(clearTimeout.bind(null,f))}):this}}),typeof Symbol<"u"&&Symbol.toStringTag&&G(J.prototype,Symbol.toStringTag,"Dexie.Promise"),be.env=bs(),U(J,{all:function(){var o=it.apply(null,arguments).map(hn);return new J(function(i,u){o.length===0&&i([]);var l=o.length;o.forEach(function(d,f){return J.resolve(d).then(function(m){o[f]=m,--l||i(o)},u)})})},resolve:function(o){return o instanceof J?o:o&&typeof o.then=="function"?new J(function(i,u){o.then(i,u)}):new J(kt,!0,o)},reject:un,race:function(){var o=it.apply(null,arguments).map(hn);return new J(function(i,u){o.map(function(l){return J.resolve(l).then(i,u)})})},PSD:{get:function(){return Q},set:function(o){return Q=o}},totalEchoes:{get:function(){return dn}},newPSD:Et,usePSD:Bt,scheduler:{get:function(){return z},set:function(o){z=o}},rejectionMapper:{get:function(){return ke},set:function(o){ke=o}},follow:function(o,i){return new J(function(u,l){return Et(function(d,f){var m=Q;m.unhandleds=[],m.onunhandled=f,m.finalize=We(function(){var y,O=this;y=function(){O.unhandleds.length===0?d():f(O.unhandleds[0])},an.push(function k(){y(),an.splice(an.indexOf(k),1)}),++qt,z(function(){--qt==0&&fo()},[])},m.finalize),o()},i,u,l)})}}),w&&(w.allSettled&&G(J,"allSettled",function(){var o=it.apply(null,arguments).map(hn);return new J(function(i){o.length===0&&i([]);var u=o.length,l=new Array(u);o.forEach(function(d,f){return J.resolve(d).then(function(m){return l[f]={status:"fulfilled",value:m}},function(m){return l[f]={status:"rejected",reason:m}}).then(function(){return--u||i(l)})})})}),w.any&&typeof AggregateError<"u"&&G(J,"any",function(){var o=it.apply(null,arguments).map(hn);return new J(function(i,u){o.length===0&&u(new AggregateError([]));var l=o.length,d=new Array(l);o.forEach(function(f,m){return J.resolve(f).then(function(y){return i(y)},function(y){d[m]=y,--l||u(new AggregateError(d))})})})}));var Ne={awaits:0,echoes:0,id:0},za=0,cn=[],ln=0,dn=0,Ua=0;function Et(o,i,u,l){var d=Q,f=Object.create(d);return f.parent=d,f.ref=0,f.global=!1,f.id=++Ua,be.env,f.env=j?{Promise:J,PromiseProp:{value:J,configurable:!0,writable:!0},all:J.all,race:J.race,allSettled:J.allSettled,any:J.any,resolve:J.resolve,reject:J.reject}:{},i&&p(f,i),++d.ref,f.finalize=function(){--this.parent.ref||this.parent.finalize()},l=Bt(f,o,u,l),f.ref===0&&f.finalize(),l}function dr(){return Ne.id||(Ne.id=++za),++Ne.awaits,Ne.echoes+=T,Ne.id}function Ot(){return!!Ne.awaits&&(--Ne.awaits==0&&(Ne.id=0),Ne.echoes=Ne.awaits*T,!0)}function hn(o){return Ne.echoes&&o&&o.constructor===w?(dr(),o.then(function(i){return Ot(),i},function(i){return Ot(),Ce(i)})):o}function Na(){var o=cn[cn.length-1];cn.pop(),St(o,!1)}function St(o,i){var u,l=Q;(i?!Ne.echoes||ln++&&o===Q:!ln||--ln&&o===Q)||queueMicrotask(i?(function(d){++dn,Ne.echoes&&--Ne.echoes!=0||(Ne.echoes=Ne.awaits=Ne.id=0),cn.push(Q),St(d,!0)}).bind(null,o):Na),o!==Q&&(Q=o,l===be&&(be.env=bs()),j&&(u=be.env.Promise,i=o.env,(l.global||o.global)&&(Object.defineProperty(a,"Promise",i.PromiseProp),u.all=i.all,u.race=i.race,u.resolve=i.resolve,u.reject=i.reject,i.allSettled&&(u.allSettled=i.allSettled),i.any&&(u.any=i.any))))}function bs(){var o=a.Promise;return j?{Promise:o,PromiseProp:Object.getOwnPropertyDescriptor(a,"Promise"),all:o.all,race:o.race,allSettled:o.allSettled,any:o.any,resolve:o.resolve,reject:o.reject}:{}}function Bt(o,i,u,l,d){var f=Q;try{return St(o,!0),i(u,l,d)}finally{St(f,!1)}}function ks(o,i,u,l){return typeof o!="function"?o:function(){var d=Q;u&&dr(),St(i,!0);try{return o.apply(this,arguments)}finally{St(d,!1),l&&queueMicrotask(Ot)}}}function po(o){Promise===w&&Ne.echoes===0?ln===0?o():enqueueNativeMicroTask(o):setTimeout(o,0)}(""+st).indexOf("[native code]")===-1&&(dr=Ot=ve);var Ce=J.reject,Zt="",vt="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",Es="String expected.",hr=[],fn="__dbnames",mo="readonly",vo="readwrite";function Vt(o,i){return o?i?function(){return o.apply(this,arguments)&&i.apply(this,arguments)}:o:i}var Os={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function pn(o){return typeof o!="string"||/\./.test(o)?function(i){return i}:function(i){return i[o]===void 0&&o in i&&delete(i=ft(i))[o],i}}function Ss(){throw te.Type()}function ye(o,i){try{var u=As(o),l=As(i);if(u!==l)return u==="Array"?1:l==="Array"?-1:u==="binary"?1:l==="binary"?-1:u==="string"?1:l==="string"?-1:u==="Date"?1:l!=="Date"?NaN:-1;switch(u){case"number":case"Date":case"string":return i<o?1:o<i?-1:0;case"binary":return function(d,f){for(var m=d.length,y=f.length,O=m<y?m:y,k=0;k<O;++k)if(d[k]!==f[k])return d[k]<f[k]?-1:1;return m===y?0:m<y?-1:1}(Ts(o),Ts(i));case"Array":return function(d,f){for(var m=d.length,y=f.length,O=m<y?m:y,k=0;k<O;++k){var x=ye(d[k],f[k]);if(x!==0)return x}return m===y?0:m<y?-1:1}(o,i)}}catch{}return NaN}function As(o){var i=typeof o;return i!="object"?i:ArrayBuffer.isView(o)?"binary":(o=Tr(o),o==="ArrayBuffer"?"binary":o)}function Ts(o){return o instanceof Uint8Array?o:ArrayBuffer.isView(o)?new Uint8Array(o.buffer,o.byteOffset,o.byteLength):new Uint8Array(o)}var xs=(Oe.prototype._trans=function(o,i,u){var l=this._tx||Q.trans,d=this.name,f=Ye&&typeof console<"u"&&console.createTask&&console.createTask("Dexie: ".concat(o==="readonly"?"read":"write"," ").concat(this.name));function m(k,x,b){if(!b.schema[d])throw new te.NotFound("Table "+d+" not part of transaction");return i(b.idbtrans,b)}var y=cr();try{var O=l&&l.db._novip===this.db._novip?l===Q.trans?l._promise(o,m,u):Et(function(){return l._promise(o,m,u)},{trans:l,transless:Q.transless||Q}):function k(x,b,P,E){if(x.idbdb&&(x._state.openComplete||Q.letThrough||x._vip)){var A=x._createTransaction(b,P,x._dbSchema);try{A.create(),x._state.PR1398_maxLoop=3}catch(R){return R.name===Pr.InvalidState&&x.isOpen()&&0<--x._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),x.close({disableAutoOpen:!1}),x.open().then(function(){return k(x,b,P,E)})):Ce(R)}return A._promise(b,function(R,S){return Et(function(){return Q.trans=A,E(R,S,A)})}).then(function(R){if(b==="readwrite")try{A.idbtrans.commit()}catch{}return b==="readonly"?R:A._completion.then(function(){return R})})}if(x._state.openComplete)return Ce(new te.DatabaseClosed(x._state.dbOpenError));if(!x._state.isBeingOpened){if(!x._state.autoOpen)return Ce(new te.DatabaseClosed);x.open().catch(ve)}return x._state.dbReadyPromise.then(function(){return k(x,b,P,E)})}(this.db,o,[this.name],m);return f&&(O._consoleTask=f,O=O.catch(function(k){return console.trace(k),Ce(k)})),O}finally{y&&lr()}},Oe.prototype.get=function(o,i){var u=this;return o&&o.constructor===Object?this.where(o).first(i):o==null?Ce(new te.Type("Invalid argument to Table.get()")):this._trans("readonly",function(l){return u.core.get({trans:l,key:o}).then(function(d){return u.hook.reading.fire(d)})}).then(i)},Oe.prototype.where=function(o){if(typeof o=="string")return new this.db.WhereClause(this,o);if(h(o))return new this.db.WhereClause(this,"[".concat(o.join("+"),"]"));var i=c(o);if(i.length===1)return this.where(i[0]).equals(o[i[0]]);var u=this.schema.indexes.concat(this.schema.primKey).filter(function(O){if(O.compound&&i.every(function(x){return 0<=O.keyPath.indexOf(x)})){for(var k=0;k<i.length;++k)if(i.indexOf(O.keyPath[k])===-1)return!1;return!0}return!1}).sort(function(O,k){return O.keyPath.length-k.keyPath.length})[0];if(u&&this.db._maxKey!==Zt){var m=u.keyPath.slice(0,i.length);return this.where(m).equals(m.map(function(k){return o[k]}))}!u&&Ye&&console.warn("The query ".concat(JSON.stringify(o)," on ").concat(this.name," would benefit from a ")+"compound index [".concat(i.join("+"),"]"));var l=this.schema.idxByName,d=this.db._deps.indexedDB;function f(O,k){return d.cmp(O,k)===0}var y=i.reduce(function(P,k){var x=P[0],b=P[1],P=l[k],E=o[k];return[x||P,x||!P?Vt(b,P&&P.multi?function(A){return A=qe(A,k),h(A)&&A.some(function(R){return f(E,R)})}:function(A){return f(E,qe(A,k))}):b]},[null,null]),m=y[0],y=y[1];return m?this.where(m.name).equals(o[m.keyPath]).filter(y):u?this.filter(y):this.where(i).equals("")},Oe.prototype.filter=function(o){return this.toCollection().and(o)},Oe.prototype.count=function(o){return this.toCollection().count(o)},Oe.prototype.offset=function(o){return this.toCollection().offset(o)},Oe.prototype.limit=function(o){return this.toCollection().limit(o)},Oe.prototype.each=function(o){return this.toCollection().each(o)},Oe.prototype.toArray=function(o){return this.toCollection().toArray(o)},Oe.prototype.toCollection=function(){return new this.db.Collection(new this.db.WhereClause(this))},Oe.prototype.orderBy=function(o){return new this.db.Collection(new this.db.WhereClause(this,h(o)?"[".concat(o.join("+"),"]"):o))},Oe.prototype.reverse=function(){return this.toCollection().reverse()},Oe.prototype.mapToClass=function(o){var i,u=this.db,l=this.name;function d(){return i!==null&&i.apply(this,arguments)||this}(this.schema.mappedClass=o).prototype instanceof Ss&&(function(O,k){if(typeof k!="function"&&k!==null)throw new TypeError("Class extends value "+String(k)+" is not a constructor or null");function x(){this.constructor=O}r(O,k),O.prototype=k===null?Object.create(k):(x.prototype=k.prototype,new x)}(d,i=o),Object.defineProperty(d.prototype,"db",{get:function(){return u},enumerable:!1,configurable:!0}),d.prototype.table=function(){return l},o=d);for(var f=new Set,m=o.prototype;m;m=v(m))Object.getOwnPropertyNames(m).forEach(function(O){return f.add(O)});function y(O){if(!O)return O;var k,x=Object.create(o.prototype);for(k in O)if(!f.has(k))try{x[k]=O[k]}catch{}return x}return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=y,this.hook("reading",y),o},Oe.prototype.defineClass=function(){return this.mapToClass(function(o){p(this,o)})},Oe.prototype.add=function(o,i){var u=this,l=this.schema.primKey,d=l.auto,f=l.keyPath,m=o;return f&&d&&(m=pn(f)(o)),this._trans("readwrite",function(y){return u.core.mutate({trans:y,type:"add",keys:i!=null?[i]:null,values:[m]})}).then(function(y){return y.numFailures?J.reject(y.failures[0]):y.lastResult}).then(function(y){if(f)try{Ue(o,f,y)}catch{}return y})},Oe.prototype.update=function(o,i){return typeof o!="object"||h(o)?this.where(":id").equals(o).modify(i):(o=qe(o,this.schema.primKey.keyPath),o===void 0?Ce(new te.InvalidArgument("Given object does not contain its primary key")):this.where(":id").equals(o).modify(i))},Oe.prototype.put=function(o,i){var u=this,l=this.schema.primKey,d=l.auto,f=l.keyPath,m=o;return f&&d&&(m=pn(f)(o)),this._trans("readwrite",function(y){return u.core.mutate({trans:y,type:"put",values:[m],keys:i!=null?[i]:null})}).then(function(y){return y.numFailures?J.reject(y.failures[0]):y.lastResult}).then(function(y){if(f)try{Ue(o,f,y)}catch{}return y})},Oe.prototype.delete=function(o){var i=this;return this._trans("readwrite",function(u){return i.core.mutate({trans:u,type:"delete",keys:[o]})}).then(function(u){return u.numFailures?J.reject(u.failures[0]):void 0})},Oe.prototype.clear=function(){var o=this;return this._trans("readwrite",function(i){return o.core.mutate({trans:i,type:"deleteRange",range:Os})}).then(function(i){return i.numFailures?J.reject(i.failures[0]):void 0})},Oe.prototype.bulkGet=function(o){var i=this;return this._trans("readonly",function(u){return i.core.getMany({keys:o,trans:u}).then(function(l){return l.map(function(d){return i.hook.reading.fire(d)})})})},Oe.prototype.bulkAdd=function(o,i,u){var l=this,d=Array.isArray(i)?i:void 0,f=(u=u||(d?void 0:i))?u.allKeys:void 0;return this._trans("readwrite",function(m){var k=l.schema.primKey,y=k.auto,k=k.keyPath;if(k&&d)throw new te.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(d&&d.length!==o.length)throw new te.InvalidArgument("Arguments objects and keys must have the same length");var O=o.length,k=k&&y?o.map(pn(k)):o;return l.core.mutate({trans:m,type:"add",keys:d,values:k,wantResults:f}).then(function(A){var b=A.numFailures,P=A.results,E=A.lastResult,A=A.failures;if(b===0)return f?P:E;throw new bt("".concat(l.name,".bulkAdd(): ").concat(b," of ").concat(O," operations failed"),A)})})},Oe.prototype.bulkPut=function(o,i,u){var l=this,d=Array.isArray(i)?i:void 0,f=(u=u||(d?void 0:i))?u.allKeys:void 0;return this._trans("readwrite",function(m){var k=l.schema.primKey,y=k.auto,k=k.keyPath;if(k&&d)throw new te.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(d&&d.length!==o.length)throw new te.InvalidArgument("Arguments objects and keys must have the same length");var O=o.length,k=k&&y?o.map(pn(k)):o;return l.core.mutate({trans:m,type:"put",keys:d,values:k,wantResults:f}).then(function(A){var b=A.numFailures,P=A.results,E=A.lastResult,A=A.failures;if(b===0)return f?P:E;throw new bt("".concat(l.name,".bulkPut(): ").concat(b," of ").concat(O," operations failed"),A)})})},Oe.prototype.bulkUpdate=function(o){var i=this,u=this.core,l=o.map(function(m){return m.key}),d=o.map(function(m){return m.changes}),f=[];return this._trans("readwrite",function(m){return u.getMany({trans:m,keys:l,cache:"clone"}).then(function(y){var O=[],k=[];o.forEach(function(b,P){var E=b.key,A=b.changes,R=y[P];if(R){for(var S=0,$=Object.keys(A);S<$.length;S++){var D=$[S],C=A[D];if(D===i.schema.primKey.keyPath){if(ye(C,E)!==0)throw new te.Constraint("Cannot update primary key in bulkUpdate()")}else Ue(R,D,C)}f.push(P),O.push(E),k.push(R)}});var x=O.length;return u.mutate({trans:m,type:"put",keys:O,values:k,updates:{keys:l,changeSpecs:d}}).then(function(b){var P=b.numFailures,E=b.failures;if(P===0)return x;for(var A=0,R=Object.keys(E);A<R.length;A++){var S,$=R[A],D=f[Number($)];D!=null&&(S=E[$],delete E[$],E[D]=S)}throw new bt("".concat(i.name,".bulkUpdate(): ").concat(P," of ").concat(x," operations failed"),E)})})})},Oe.prototype.bulkDelete=function(o){var i=this,u=o.length;return this._trans("readwrite",function(l){return i.core.mutate({trans:l,type:"delete",keys:o})}).then(function(m){var d=m.numFailures,f=m.lastResult,m=m.failures;if(d===0)return f;throw new bt("".concat(i.name,".bulkDelete(): ").concat(d," of ").concat(u," operations failed"),m)})},Oe);function Oe(){}function $r(o){function i(m,y){if(y){for(var O=arguments.length,k=new Array(O-1);--O;)k[O-1]=arguments[O];return u[m].subscribe.apply(null,k),o}if(typeof m=="string")return u[m]}var u={};i.addEventType=f;for(var l=1,d=arguments.length;l<d;++l)f(arguments[l]);return i;function f(m,y,O){if(typeof m!="object"){var k;y=y||ur;var x={subscribers:[],fire:O=O||ve,subscribe:function(b){x.subscribers.indexOf(b)===-1&&(x.subscribers.push(b),x.fire=y(x.fire,b))},unsubscribe:function(b){x.subscribers=x.subscribers.filter(function(P){return P!==b}),x.fire=x.subscribers.reduce(y,O)}};return u[m]=i[m]=x}c(k=m).forEach(function(b){var P=k[b];if(h(P))f(b,k[b][0],k[b][1]);else{if(P!=="asap")throw new te.InvalidArgument("Invalid event config");var E=f(b,Mt,function(){for(var A=arguments.length,R=new Array(A);A--;)R[A]=arguments[A];E.subscribers.forEach(function(S){Ie(function(){S.apply(null,R)})})})}})}}function Dr(o,i){return F(i).from({prototype:o}),i}function fr(o,i){return!(o.filter||o.algorithm||o.or)&&(i?o.justLimit:!o.replayFilter)}function go(o,i){o.filter=Vt(o.filter,i)}function yo(o,i,u){var l=o.replayFilter;o.replayFilter=l?function(){return Vt(l(),i())}:i,o.justLimit=u&&!l}function mn(o,i){if(o.isPrimKey)return i.primaryKey;var u=i.getIndexByKeyPath(o.index);if(!u)throw new te.Schema("KeyPath "+o.index+" on object store "+i.name+" is not indexed");return u}function Ps(o,i,u){var l=mn(o,i.schema);return i.openCursor({trans:u,values:!o.keysOnly,reverse:o.dir==="prev",unique:!!o.unique,query:{index:l,range:o.range}})}function vn(o,i,u,l){var d=o.replayFilter?Vt(o.filter,o.replayFilter()):o.filter;if(o.or){var f={},m=function(y,O,k){var x,b;d&&!d(O,k,function(P){return O.stop(P)},function(P){return O.fail(P)})||((b=""+(x=O.primaryKey))=="[object ArrayBuffer]"&&(b=""+new Uint8Array(x)),I(f,b)||(f[b]=!0,i(y,O,k)))};return Promise.all([o.or._iterate(m,u),Rs(Ps(o,l,u),o.algorithm,m,!o.keysOnly&&o.valueMapper)])}return Rs(Ps(o,l,u),Vt(o.algorithm,d),i,!o.keysOnly&&o.valueMapper)}function Rs(o,i,u,l){var d=Ae(l?function(f,m,y){return u(l(f),m,y)}:u);return o.then(function(f){if(f)return f.start(function(){var m=function(){return f.continue()};i&&!i(f,function(y){return m=y},function(y){f.stop(y),m=ve},function(y){f.fail(y),m=ve})||d(f.value,f,function(y){return m=y}),m()})})}var gt=Symbol(),Cr=(Is.prototype.execute=function(o){if(this.add!==void 0){var i=this.add;if(h(i))return s(s([],h(o)?o:[],!0),i).sort();if(typeof i=="number")return(Number(o)||0)+i;if(typeof i=="bigint")try{return BigInt(o)+i}catch{return BigInt(0)+i}throw new TypeError("Invalid term ".concat(i))}if(this.remove!==void 0){var u=this.remove;if(h(u))return h(o)?o.filter(function(l){return!u.includes(l)}).sort():[];if(typeof u=="number")return Number(o)-u;if(typeof u=="bigint")try{return BigInt(o)-u}catch{return BigInt(0)-u}throw new TypeError("Invalid subtrahend ".concat(u))}return i=(i=this.replacePrefix)===null||i===void 0?void 0:i[0],i&&typeof o=="string"&&o.startsWith(i)?this.replacePrefix[1]+o.substring(i.length):o},Is);function Is(o){Object.assign(this,o)}var Fa=(_e.prototype._read=function(o,i){var u=this._ctx;return u.error?u.table._trans(null,Ce.bind(null,u.error)):u.table._trans("readonly",o).then(i)},_e.prototype._write=function(o){var i=this._ctx;return i.error?i.table._trans(null,Ce.bind(null,i.error)):i.table._trans("readwrite",o,"locked")},_e.prototype._addAlgorithm=function(o){var i=this._ctx;i.algorithm=Vt(i.algorithm,o)},_e.prototype._iterate=function(o,i){return vn(this._ctx,o,i,this._ctx.table.core)},_e.prototype.clone=function(o){var i=Object.create(this.constructor.prototype),u=Object.create(this._ctx);return o&&p(u,o),i._ctx=u,i},_e.prototype.raw=function(){return this._ctx.valueMapper=null,this},_e.prototype.each=function(o){var i=this._ctx;return this._read(function(u){return vn(i,o,u,i.table.core)})},_e.prototype.count=function(o){var i=this;return this._read(function(u){var l=i._ctx,d=l.table.core;if(fr(l,!0))return d.count({trans:u,query:{index:mn(l,d.schema),range:l.range}}).then(function(m){return Math.min(m,l.limit)});var f=0;return vn(l,function(){return++f,!1},u,d).then(function(){return f})}).then(o)},_e.prototype.sortBy=function(o,i){var u=o.split(".").reverse(),l=u[0],d=u.length-1;function f(O,k){return k?f(O[u[k]],k-1):O[l]}var m=this._ctx.dir==="next"?1:-1;function y(O,k){return O=f(O,d),k=f(k,d),O<k?-m:k<O?m:0}return this.toArray(function(O){return O.sort(y)}).then(i)},_e.prototype.toArray=function(o){var i=this;return this._read(function(u){var l=i._ctx;if(l.dir==="next"&&fr(l,!0)&&0<l.limit){var d=l.valueMapper,f=mn(l,l.table.core.schema);return l.table.core.query({trans:u,limit:l.limit,values:!0,query:{index:f,range:l.range}}).then(function(y){return y=y.result,d?y.map(d):y})}var m=[];return vn(l,function(y){return m.push(y)},u,l.table.core).then(function(){return m})},o)},_e.prototype.offset=function(o){var i=this._ctx;return o<=0||(i.offset+=o,fr(i)?yo(i,function(){var u=o;return function(l,d){return u===0||(u===1?--u:d(function(){l.advance(u),u=0}),!1)}}):yo(i,function(){var u=o;return function(){return--u<0}})),this},_e.prototype.limit=function(o){return this._ctx.limit=Math.min(this._ctx.limit,o),yo(this._ctx,function(){var i=o;return function(u,l,d){return--i<=0&&l(d),0<=i}},!0),this},_e.prototype.until=function(o,i){return go(this._ctx,function(u,l,d){return!o(u.value)||(l(d),i)}),this},_e.prototype.first=function(o){return this.limit(1).toArray(function(i){return i[0]}).then(o)},_e.prototype.last=function(o){return this.reverse().first(o)},_e.prototype.filter=function(o){var i;return go(this._ctx,function(u){return o(u.value)}),(i=this._ctx).isMatch=Vt(i.isMatch,o),this},_e.prototype.and=function(o){return this.filter(o)},_e.prototype.or=function(o){return new this.db.WhereClause(this._ctx.table,o,this)},_e.prototype.reverse=function(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},_e.prototype.desc=function(){return this.reverse()},_e.prototype.eachKey=function(o){var i=this._ctx;return i.keysOnly=!i.isMatch,this.each(function(u,l){o(l.key,l)})},_e.prototype.eachUniqueKey=function(o){return this._ctx.unique="unique",this.eachKey(o)},_e.prototype.eachPrimaryKey=function(o){var i=this._ctx;return i.keysOnly=!i.isMatch,this.each(function(u,l){o(l.primaryKey,l)})},_e.prototype.keys=function(o){var i=this._ctx;i.keysOnly=!i.isMatch;var u=[];return this.each(function(l,d){u.push(d.key)}).then(function(){return u}).then(o)},_e.prototype.primaryKeys=function(o){var i=this._ctx;if(i.dir==="next"&&fr(i,!0)&&0<i.limit)return this._read(function(l){var d=mn(i,i.table.core.schema);return i.table.core.query({trans:l,values:!1,limit:i.limit,query:{index:d,range:i.range}})}).then(function(l){return l.result}).then(o);i.keysOnly=!i.isMatch;var u=[];return this.each(function(l,d){u.push(d.primaryKey)}).then(function(){return u}).then(o)},_e.prototype.uniqueKeys=function(o){return this._ctx.unique="unique",this.keys(o)},_e.prototype.firstKey=function(o){return this.limit(1).keys(function(i){return i[0]}).then(o)},_e.prototype.lastKey=function(o){return this.reverse().firstKey(o)},_e.prototype.distinct=function(){var o=this._ctx,o=o.index&&o.table.schema.idxByName[o.index];if(!o||!o.multi)return this;var i={};return go(this._ctx,function(d){var l=d.primaryKey.toString(),d=I(i,l);return i[l]=!0,!d}),this},_e.prototype.modify=function(o){var i=this,u=this._ctx;return this._write(function(l){var d,f,m;m=typeof o=="function"?o:(d=c(o),f=d.length,function(S){for(var $=!1,D=0;D<f;++D){var C=d[D],N=o[C],B=qe(S,C);N instanceof Cr?(Ue(S,C,N.execute(B)),$=!0):B!==N&&(Ue(S,C,N),$=!0)}return $});function y(S,C){var D=C.failures,C=C.numFailures;A+=S-C;for(var N=0,B=c(D);N<B.length;N++){var W=B[N];E.push(D[W])}}var O=u.table.core,k=O.schema.primaryKey,x=k.outbound,b=k.extractKey,P=i.db._options.modifyChunkSize||200,E=[],A=0,R=[];return i.clone().primaryKeys().then(function(S){function $(C){var N=Math.min(P,S.length-C);return O.getMany({trans:l,keys:S.slice(C,C+N),cache:"immutable"}).then(function(B){for(var W=[],Z=[],K=x?[]:null,H=[],M=0;M<N;++M){var ue=B[M],ce={value:ft(ue),primKey:S[C+M]};m.call(ce,ce.value,ce)!==!1&&(ce.value==null?H.push(S[C+M]):x||ye(b(ue),b(ce.value))===0?(Z.push(ce.value),x&&K.push(S[C+M])):(H.push(S[C+M]),W.push(ce.value)))}return Promise.resolve(0<W.length&&O.mutate({trans:l,type:"add",values:W}).then(function(me){for(var he in me.failures)H.splice(parseInt(he),1);y(W.length,me)})).then(function(){return(0<Z.length||D&&typeof o=="object")&&O.mutate({trans:l,type:"put",keys:K,values:Z,criteria:D,changeSpec:typeof o!="function"&&o,isAdditionalChunk:0<C}).then(function(me){return y(Z.length,me)})}).then(function(){return(0<H.length||D&&o===_o)&&O.mutate({trans:l,type:"delete",keys:H,criteria:D,isAdditionalChunk:0<C}).then(function(me){return y(H.length,me)})}).then(function(){return S.length>C+N&&$(C+P)})})}var D=fr(u)&&u.limit===1/0&&(typeof o!="function"||o===_o)&&{index:u.index,range:u.range};return $(0).then(function(){if(0<E.length)throw new sr("Error modifying one or more objects",E,A,R);return S.length})})})},_e.prototype.delete=function(){var o=this._ctx,i=o.range;return fr(o)&&(o.isPrimKey||i.type===3)?this._write(function(u){var l=o.table.core.schema.primaryKey,d=i;return o.table.core.count({trans:u,query:{index:l,range:d}}).then(function(f){return o.table.core.mutate({trans:u,type:"deleteRange",range:d}).then(function(m){var y=m.failures;if(m.lastResult,m.results,m=m.numFailures,m)throw new sr("Could not delete some values",Object.keys(y).map(function(O){return y[O]}),f-m);return f-m})})}):this.modify(_o)},_e);function _e(){}var _o=function(o,i){return i.value=null};function La(o,i){return o<i?-1:o===i?0:1}function Ma(o,i){return i<o?-1:o===i?0:1}function rt(o,i,u){return o=o instanceof Ds?new o.Collection(o):o,o._ctx.error=new(u||TypeError)(i),o}function pr(o){return new o.Collection(o,function(){return $s("")}).limit(0)}function gn(o,i,u,l){var d,f,m,y,O,k,x,b=u.length;if(!u.every(function(A){return typeof A=="string"}))return rt(o,Es);function P(A){d=A==="next"?function(S){return S.toUpperCase()}:function(S){return S.toLowerCase()},f=A==="next"?function(S){return S.toLowerCase()}:function(S){return S.toUpperCase()},m=A==="next"?La:Ma;var R=u.map(function(S){return{lower:f(S),upper:d(S)}}).sort(function(S,$){return m(S.lower,$.lower)});y=R.map(function(S){return S.upper}),O=R.map(function(S){return S.lower}),x=(k=A)==="next"?"":l}P("next"),o=new o.Collection(o,function(){return At(y[0],O[b-1]+l)}),o._ondirectionchange=function(A){P(A)};var E=0;return o._addAlgorithm(function(A,R,S){var $=A.key;if(typeof $!="string")return!1;var D=f($);if(i(D,O,E))return!0;for(var C=null,N=E;N<b;++N){var B=function(W,Z,K,H,M,ue){for(var ce=Math.min(W.length,H.length),me=-1,he=0;he<ce;++he){var at=Z[he];if(at!==H[he])return M(W[he],K[he])<0?W.substr(0,he)+K[he]+K.substr(he+1):M(W[he],H[he])<0?W.substr(0,he)+H[he]+K.substr(he+1):0<=me?W.substr(0,me)+Z[me]+K.substr(me+1):null;M(W[he],at)<0&&(me=he)}return ce<H.length&&ue==="next"?W+K.substr(W.length):ce<W.length&&ue==="prev"?W.substr(0,K.length):me<0?null:W.substr(0,me)+H[me]+K.substr(me+1)}($,D,y[N],O[N],m,k);B===null&&C===null?E=N+1:(C===null||0<m(C,B))&&(C=B)}return R(C!==null?function(){A.continue(C+x)}:S),!1}),o}function At(o,i,u,l){return{type:2,lower:o,upper:i,lowerOpen:u,upperOpen:l}}function $s(o){return{type:1,lower:o,upper:o}}var Ds=(Object.defineProperty(Fe.prototype,"Collection",{get:function(){return this._ctx.table.db.Collection},enumerable:!1,configurable:!0}),Fe.prototype.between=function(o,i,u,l){u=u!==!1,l=l===!0;try{return 0<this._cmp(o,i)||this._cmp(o,i)===0&&(u||l)&&(!u||!l)?pr(this):new this.Collection(this,function(){return At(o,i,!u,!l)})}catch{return rt(this,vt)}},Fe.prototype.equals=function(o){return o==null?rt(this,vt):new this.Collection(this,function(){return $s(o)})},Fe.prototype.above=function(o){return o==null?rt(this,vt):new this.Collection(this,function(){return At(o,void 0,!0)})},Fe.prototype.aboveOrEqual=function(o){return o==null?rt(this,vt):new this.Collection(this,function(){return At(o,void 0,!1)})},Fe.prototype.below=function(o){return o==null?rt(this,vt):new this.Collection(this,function(){return At(void 0,o,!1,!0)})},Fe.prototype.belowOrEqual=function(o){return o==null?rt(this,vt):new this.Collection(this,function(){return At(void 0,o)})},Fe.prototype.startsWith=function(o){return typeof o!="string"?rt(this,Es):this.between(o,o+Zt,!0,!0)},Fe.prototype.startsWithIgnoreCase=function(o){return o===""?this.startsWith(o):gn(this,function(i,u){return i.indexOf(u[0])===0},[o],Zt)},Fe.prototype.equalsIgnoreCase=function(o){return gn(this,function(i,u){return i===u[0]},[o],"")},Fe.prototype.anyOfIgnoreCase=function(){var o=it.apply(_t,arguments);return o.length===0?pr(this):gn(this,function(i,u){return u.indexOf(i)!==-1},o,"")},Fe.prototype.startsWithAnyOfIgnoreCase=function(){var o=it.apply(_t,arguments);return o.length===0?pr(this):gn(this,function(i,u){return u.some(function(l){return i.indexOf(l)===0})},o,Zt)},Fe.prototype.anyOf=function(){var o=this,i=it.apply(_t,arguments),u=this._cmp;try{i.sort(u)}catch{return rt(this,vt)}if(i.length===0)return pr(this);var l=new this.Collection(this,function(){return At(i[0],i[i.length-1])});l._ondirectionchange=function(f){u=f==="next"?o._ascending:o._descending,i.sort(u)};var d=0;return l._addAlgorithm(function(f,m,y){for(var O=f.key;0<u(O,i[d]);)if(++d===i.length)return m(y),!1;return u(O,i[d])===0||(m(function(){f.continue(i[d])}),!1)}),l},Fe.prototype.notEqual=function(o){return this.inAnyRange([[-1/0,o],[o,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})},Fe.prototype.noneOf=function(){var o=it.apply(_t,arguments);if(o.length===0)return new this.Collection(this);try{o.sort(this._ascending)}catch{return rt(this,vt)}var i=o.reduce(function(u,l){return u?u.concat([[u[u.length-1][1],l]]):[[-1/0,l]]},null);return i.push([o[o.length-1],this.db._maxKey]),this.inAnyRange(i,{includeLowers:!1,includeUppers:!1})},Fe.prototype.inAnyRange=function($,i){var u=this,l=this._cmp,d=this._ascending,f=this._descending,m=this._min,y=this._max;if($.length===0)return pr(this);if(!$.every(function(D){return D[0]!==void 0&&D[1]!==void 0&&d(D[0],D[1])<=0}))return rt(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",te.InvalidArgument);var O=!i||i.includeLowers!==!1,k=i&&i.includeUppers===!0,x,b=d;function P(D,C){return b(D[0],C[0])}try{(x=$.reduce(function(D,C){for(var N=0,B=D.length;N<B;++N){var W=D[N];if(l(C[0],W[1])<0&&0<l(C[1],W[0])){W[0]=m(W[0],C[0]),W[1]=y(W[1],C[1]);break}}return N===B&&D.push(C),D},[])).sort(P)}catch{return rt(this,vt)}var E=0,A=k?function(D){return 0<d(D,x[E][1])}:function(D){return 0<=d(D,x[E][1])},R=O?function(D){return 0<f(D,x[E][0])}:function(D){return 0<=f(D,x[E][0])},S=A,$=new this.Collection(this,function(){return At(x[0][0],x[x.length-1][1],!O,!k)});return $._ondirectionchange=function(D){b=D==="next"?(S=A,d):(S=R,f),x.sort(P)},$._addAlgorithm(function(D,C,N){for(var B,W=D.key;S(W);)if(++E===x.length)return C(N),!1;return!A(B=W)&&!R(B)||(u._cmp(W,x[E][1])===0||u._cmp(W,x[E][0])===0||C(function(){b===d?D.continue(x[E][0]):D.continue(x[E][1])}),!1)}),$},Fe.prototype.startsWithAnyOf=function(){var o=it.apply(_t,arguments);return o.every(function(i){return typeof i=="string"})?o.length===0?pr(this):this.inAnyRange(o.map(function(i){return[i,i+Zt]})):rt(this,"startsWithAnyOf() only works with strings")},Fe);function Fe(){}function dt(o){return Ae(function(i){return jr(i),o(i.target.error),!1})}function jr(o){o.stopPropagation&&o.stopPropagation(),o.preventDefault&&o.preventDefault()}var zr="storagemutated",wo="x-storagemutated-1",Tt=$r(null,zr),qa=(ht.prototype._lock=function(){return le(!Q.global),++this._reculock,this._reculock!==1||Q.global||(Q.lockOwnerFor=this),this},ht.prototype._unlock=function(){if(le(!Q.global),--this._reculock==0)for(Q.global||(Q.lockOwnerFor=null);0<this._blockedFuncs.length&&!this._locked();){var o=this._blockedFuncs.shift();try{Bt(o[1],o[0])}catch{}}return this},ht.prototype._locked=function(){return this._reculock&&Q.lockOwnerFor!==this},ht.prototype.create=function(o){var i=this;if(!this.mode)return this;var u=this.db.idbdb,l=this.db._state.dbOpenError;if(le(!this.idbtrans),!o&&!u)switch(l&&l.name){case"DatabaseClosedError":throw new te.DatabaseClosed(l);case"MissingAPIError":throw new te.MissingAPI(l.message,l);default:throw new te.OpenFailed(l)}if(!this.active)throw new te.TransactionInactive;return le(this._completion._state===null),(o=this.idbtrans=o||(this.db.core||u).transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability})).onerror=Ae(function(d){jr(d),i._reject(o.error)}),o.onabort=Ae(function(d){jr(d),i.active&&i._reject(new te.Abort(o.error)),i.active=!1,i.on("abort").fire(d)}),o.oncomplete=Ae(function(){i.active=!1,i._resolve(),"mutatedParts"in o&&Tt.storagemutated.fire(o.mutatedParts)}),this},ht.prototype._promise=function(o,i,u){var l=this;if(o==="readwrite"&&this.mode!=="readwrite")return Ce(new te.ReadOnly("Transaction is readonly"));if(!this.active)return Ce(new te.TransactionInactive);if(this._locked())return new J(function(f,m){l._blockedFuncs.push([function(){l._promise(o,i,u).then(f,m)},Q])});if(u)return Et(function(){var f=new J(function(m,y){l._lock();var O=i(m,y,l);O&&O.then&&O.then(m,y)});return f.finally(function(){return l._unlock()}),f._lib=!0,f});var d=new J(function(f,m){var y=i(f,m,l);y&&y.then&&y.then(f,m)});return d._lib=!0,d},ht.prototype._root=function(){return this.parent?this.parent._root():this},ht.prototype.waitFor=function(o){var i,u=this._root(),l=J.resolve(o);u._waitingFor?u._waitingFor=u._waitingFor.then(function(){return l}):(u._waitingFor=l,u._waitingQueue=[],i=u.idbtrans.objectStore(u.storeNames[0]),function f(){for(++u._spinCount;u._waitingQueue.length;)u._waitingQueue.shift()();u._waitingFor&&(i.get(-1/0).onsuccess=f)}());var d=u._waitingFor;return new J(function(f,m){l.then(function(y){return u._waitingQueue.push(Ae(f.bind(null,y)))},function(y){return u._waitingQueue.push(Ae(m.bind(null,y)))}).finally(function(){u._waitingFor===d&&(u._waitingFor=null)})})},ht.prototype.abort=function(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new te.Abort))},ht.prototype.table=function(o){var i=this._memoizedTables||(this._memoizedTables={});if(I(i,o))return i[o];var u=this.schema[o];if(!u)throw new te.NotFound("Table "+o+" not part of transaction");return u=new this.db.Table(o,u,this),u.core=this.db.core.table(o),i[o]=u},ht);function ht(){}function bo(o,i,u,l,d,f,m){return{name:o,keyPath:i,unique:u,multi:l,auto:d,compound:f,src:(u&&!m?"&":"")+(l?"*":"")+(d?"++":"")+Cs(i)}}function Cs(o){return typeof o=="string"?o:o?"["+[].join.call(o,"+")+"]":""}function ko(o,i,u){return{name:o,primKey:i,indexes:u,mappedClass:null,idxByName:(l=function(d){return[d.name,d]},u.reduce(function(d,f,m){return m=l(f,m),m&&(d[m[0]]=m[1]),d},{}))};var l}var Ur=function(o){try{return o.only([[]]),Ur=function(){return[[]]},[[]]}catch{return Ur=function(){return Zt},Zt}};function Eo(o){return o==null?function(){}:typeof o=="string"?(i=o).split(".").length===1?function(u){return u[i]}:function(u){return qe(u,i)}:function(u){return qe(u,o)};var i}function js(o){return[].slice.call(o)}var Ba=0;function Nr(o){return o==null?":id":typeof o=="string"?o:"[".concat(o.join("+"),"]")}function Za(o,i,O){function l(S){if(S.type===3)return null;if(S.type===4)throw new Error("Cannot convert never type to IDBKeyRange");var E=S.lower,A=S.upper,R=S.lowerOpen,S=S.upperOpen;return E===void 0?A===void 0?null:i.upperBound(A,!!S):A===void 0?i.lowerBound(E,!!R):i.bound(E,A,!!R,!!S)}function d(P){var E,A=P.name;return{name:A,schema:P,mutate:function(R){var S=R.trans,$=R.type,D=R.keys,C=R.values,N=R.range;return new Promise(function(B,W){B=Ae(B);var Z=S.objectStore(A),K=Z.keyPath==null,H=$==="put"||$==="add";if(!H&&$!=="delete"&&$!=="deleteRange")throw new Error("Invalid operation type: "+$);var M,ue=(D||C||{length:1}).length;if(D&&C&&D.length!==C.length)throw new Error("Given keys array must have same length as given values array.");if(ue===0)return B({numFailures:0,failures:{},results:[],lastResult:void 0});function ce(Ge){++at,jr(Ge)}var me=[],he=[],at=0;if($==="deleteRange"){if(N.type===4)return B({numFailures:at,failures:he,results:[],lastResult:void 0});N.type===3?me.push(M=Z.clear()):me.push(M=Z.delete(l(N)))}else{var K=H?K?[C,D]:[C,null]:[D,null],fe=K[0],Be=K[1];if(H)for(var Ze=0;Ze<ue;++Ze)me.push(M=Be&&Be[Ze]!==void 0?Z[$](fe[Ze],Be[Ze]):Z[$](fe[Ze])),M.onerror=ce;else for(Ze=0;Ze<ue;++Ze)me.push(M=Z[$](fe[Ze])),M.onerror=ce}function Rn(Ge){Ge=Ge.target.result,me.forEach(function(Ht,Mo){return Ht.error!=null&&(he[Mo]=Ht.error)}),B({numFailures:at,failures:he,results:$==="delete"?D:me.map(function(Ht){return Ht.result}),lastResult:Ge})}M.onerror=function(Ge){ce(Ge),Rn(Ge)},M.onsuccess=Rn})},getMany:function(R){var S=R.trans,$=R.keys;return new Promise(function(D,C){D=Ae(D);for(var N,B=S.objectStore(A),W=$.length,Z=new Array(W),K=0,H=0,M=function(me){me=me.target,Z[me._pos]=me.result,++H===K&&D(Z)},ue=dt(C),ce=0;ce<W;++ce)$[ce]!=null&&((N=B.get($[ce]))._pos=ce,N.onsuccess=M,N.onerror=ue,++K);K===0&&D(Z)})},get:function(R){var S=R.trans,$=R.key;return new Promise(function(D,C){D=Ae(D);var N=S.objectStore(A).get($);N.onsuccess=function(B){return D(B.target.result)},N.onerror=dt(C)})},query:(E=k,function(R){return new Promise(function(S,$){S=Ae(S);var D,C,N,K=R.trans,B=R.values,W=R.limit,M=R.query,Z=W===1/0?void 0:W,H=M.index,M=M.range,K=K.objectStore(A),H=H.isPrimaryKey?K:K.index(H.name),M=l(M);if(W===0)return S({result:[]});E?((Z=B?H.getAll(M,Z):H.getAllKeys(M,Z)).onsuccess=function(ue){return S({result:ue.target.result})},Z.onerror=dt($)):(D=0,C=!B&&"openKeyCursor"in H?H.openKeyCursor(M):H.openCursor(M),N=[],C.onsuccess=function(ue){var ce=C.result;return ce?(N.push(B?ce.value:ce.primaryKey),++D===W?S({result:N}):void ce.continue()):S({result:N})},C.onerror=dt($))})}),openCursor:function(R){var S=R.trans,$=R.values,D=R.query,C=R.reverse,N=R.unique;return new Promise(function(B,W){B=Ae(B);var H=D.index,Z=D.range,K=S.objectStore(A),K=H.isPrimaryKey?K:K.index(H.name),H=C?N?"prevunique":"prev":N?"nextunique":"next",M=!$&&"openKeyCursor"in K?K.openKeyCursor(l(Z),H):K.openCursor(l(Z),H);M.onerror=dt(W),M.onsuccess=Ae(function(ue){var ce,me,he,at,fe=M.result;fe?(fe.___id=++Ba,fe.done=!1,ce=fe.continue.bind(fe),me=(me=fe.continuePrimaryKey)&&me.bind(fe),he=fe.advance.bind(fe),at=function(){throw new Error("Cursor not stopped")},fe.trans=S,fe.stop=fe.continue=fe.continuePrimaryKey=fe.advance=function(){throw new Error("Cursor not started")},fe.fail=Ae(W),fe.next=function(){var Be=this,Ze=1;return this.start(function(){return Ze--?Be.continue():Be.stop()}).then(function(){return Be})},fe.start=function(Be){function Ze(){if(M.result)try{Be()}catch(Ge){fe.fail(Ge)}else fe.done=!0,fe.start=function(){throw new Error("Cursor behind last entry")},fe.stop()}var Rn=new Promise(function(Ge,Ht){Ge=Ae(Ge),M.onerror=dt(Ht),fe.fail=Ht,fe.stop=function(Mo){fe.stop=fe.continue=fe.continuePrimaryKey=fe.advance=at,Ge(Mo)}});return M.onsuccess=Ae(function(Ge){M.onsuccess=Ze,Ze()}),fe.continue=ce,fe.continuePrimaryKey=me,fe.advance=he,Ze(),Rn},B(fe)):B(null)},W)})},count:function(R){var S=R.query,$=R.trans,D=S.index,C=S.range;return new Promise(function(N,B){var W=$.objectStore(A),Z=D.isPrimaryKey?W:W.index(D.name),W=l(C),Z=W?Z.count(W):Z.count();Z.onsuccess=Ae(function(K){return N(K.target.result)}),Z.onerror=dt(B)})}}}var f,m,y,x=(m=O,y=js((f=o).objectStoreNames),{schema:{name:f.name,tables:y.map(function(P){return m.objectStore(P)}).map(function(P){var E=P.keyPath,S=P.autoIncrement,A=h(E),R={},S={name:P.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:E==null,compound:A,keyPath:E,autoIncrement:S,unique:!0,extractKey:Eo(E)},indexes:js(P.indexNames).map(function($){return P.index($)}).map(function(N){var D=N.name,C=N.unique,B=N.multiEntry,N=N.keyPath,B={name:D,compound:h(N),keyPath:N,unique:C,multiEntry:B,extractKey:Eo(N)};return R[Nr(N)]=B}),getIndexByKeyPath:function($){return R[Nr($)]}};return R[":id"]=S.primaryKey,E!=null&&(R[Nr(E)]=S.primaryKey),S})},hasGetAll:0<y.length&&"getAll"in m.objectStore(y[0])&&!(typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}),O=x.schema,k=x.hasGetAll,x=O.tables.map(d),b={};return x.forEach(function(P){return b[P.name]=P}),{stack:"dbcore",transaction:o.transaction.bind(o),table:function(P){if(!b[P])throw new Error("Table '".concat(P,"' not found"));return b[P]},MIN_KEY:-1/0,MAX_KEY:Ur(i),schema:O}}function Va(o,i,u,l){var d=u.IDBKeyRange;return u.indexedDB,{dbcore:(l=Za(i,d,l),o.dbcore.reduce(function(f,m){return m=m.create,n(n({},f),m(f))},l))}}function yn(o,l){var u=l.db,l=Va(o._middlewares,u,o._deps,l);o.core=l.dbcore,o.tables.forEach(function(d){var f=d.name;o.core.schema.tables.some(function(m){return m.name===f})&&(d.core=o.core.table(f),o[f]instanceof o.Table&&(o[f].core=d.core))})}function _n(o,i,u,l){u.forEach(function(d){var f=l[d];i.forEach(function(m){var y=function O(k,x){return V(k,x)||(k=v(k))&&O(k,x)}(m,d);(!y||"value"in y&&y.value===void 0)&&(m===o.Transaction.prototype||m instanceof o.Transaction?G(m,d,{get:function(){return this.table(d)},set:function(O){q(this,d,{value:O,writable:!0,configurable:!0,enumerable:!0})}}):m[d]=new o.Table(d,f))})})}function Oo(o,i){i.forEach(function(u){for(var l in u)u[l]instanceof o.Table&&delete u[l]})}function Ka(o,i){return o._cfg.version-i._cfg.version}function Wa(o,i,u,l){var d=o._dbSchema;u.objectStoreNames.contains("$meta")&&!d.$meta&&(d.$meta=ko("$meta",Us("")[0],[]),o._storeNames.push("$meta"));var f=o._createTransaction("readwrite",o._storeNames,d);f.create(u),f._completion.catch(l);var m=f._reject.bind(f),y=Q.transless||Q;Et(function(){return Q.trans=f,Q.transless=y,i!==0?(yn(o,u),k=i,((O=f).storeNames.includes("$meta")?O.table("$meta").get("version").then(function(x){return x??k}):J.resolve(k)).then(function(x){return P=x,E=f,A=u,R=[],x=(b=o)._versions,S=b._dbSchema=bn(0,b.idbdb,A),(x=x.filter(function($){return $._cfg.version>=P})).length!==0?(x.forEach(function($){R.push(function(){var D=S,C=$._cfg.dbschema;kn(b,D,A),kn(b,C,A),S=b._dbSchema=C;var N=So(D,C);N.add.forEach(function(H){Ao(A,H[0],H[1].primKey,H[1].indexes)}),N.change.forEach(function(H){if(H.recreate)throw new te.Upgrade("Not yet support for changing primary key");var M=A.objectStore(H.name);H.add.forEach(function(ue){return wn(M,ue)}),H.change.forEach(function(ue){M.deleteIndex(ue.name),wn(M,ue)}),H.del.forEach(function(ue){return M.deleteIndex(ue)})});var B=$._cfg.contentUpgrade;if(B&&$._cfg.version>P){yn(b,A),E._memoizedTables={};var W=Ft(C);N.del.forEach(function(H){W[H]=D[H]}),Oo(b,[b.Transaction.prototype]),_n(b,[b.Transaction.prototype],c(W),W),E.schema=W;var Z,K=xr(B);return K&&dr(),N=J.follow(function(){var H;(Z=B(E))&&K&&(H=Ot.bind(null,null),Z.then(H,H))}),Z&&typeof Z.then=="function"?J.resolve(Z):N.then(function(){return Z})}}),R.push(function(D){var C,N,B=$._cfg.dbschema;C=B,N=D,[].slice.call(N.db.objectStoreNames).forEach(function(W){return C[W]==null&&N.db.deleteObjectStore(W)}),Oo(b,[b.Transaction.prototype]),_n(b,[b.Transaction.prototype],b._storeNames,b._dbSchema),E.schema=b._dbSchema}),R.push(function(D){b.idbdb.objectStoreNames.contains("$meta")&&(Math.ceil(b.idbdb.version/10)===$._cfg.version?(b.idbdb.deleteObjectStore("$meta"),delete b._dbSchema.$meta,b._storeNames=b._storeNames.filter(function(C){return C!=="$meta"})):D.objectStore("$meta").put($._cfg.version,"version"))})}),function $(){return R.length?J.resolve(R.shift()(E.idbtrans)).then($):J.resolve()}().then(function(){zs(S,A)})):J.resolve();var b,P,E,A,R,S}).catch(m)):(c(d).forEach(function(x){Ao(u,x,d[x].primKey,d[x].indexes)}),yn(o,u),void J.follow(function(){return o.on.populate.fire(f)}).catch(m));var O,k})}function Ha(o,i){zs(o._dbSchema,i),i.db.version%10!=0||i.objectStoreNames.contains("$meta")||i.db.createObjectStore("$meta").add(Math.ceil(i.db.version/10-1),"version");var u=bn(0,o.idbdb,i);kn(o,o._dbSchema,i);for(var l=0,d=So(u,o._dbSchema).change;l<d.length;l++){var f=function(m){if(m.change.length||m.recreate)return console.warn("Unable to patch indexes of table ".concat(m.name," because it has changes on the type of index or primary key.")),{value:void 0};var y=i.objectStore(m.name);m.add.forEach(function(O){Ye&&console.debug("Dexie upgrade patch: Creating missing index ".concat(m.name,".").concat(O.src)),wn(y,O)})}(d[l]);if(typeof f=="object")return f.value}}function So(o,i){var u,l={del:[],add:[],change:[]};for(u in o)i[u]||l.del.push(u);for(u in i){var d=o[u],f=i[u];if(d){var m={name:u,def:f,recreate:!1,del:[],add:[],change:[]};if(""+(d.primKey.keyPath||"")!=""+(f.primKey.keyPath||"")||d.primKey.auto!==f.primKey.auto)m.recreate=!0,l.change.push(m);else{var y=d.idxByName,O=f.idxByName,k=void 0;for(k in y)O[k]||m.del.push(k);for(k in O){var x=y[k],b=O[k];x?x.src!==b.src&&m.change.push(b):m.add.push(b)}(0<m.del.length||0<m.add.length||0<m.change.length)&&l.change.push(m)}}else l.add.push([u,f])}return l}function Ao(o,i,u,l){var d=o.db.createObjectStore(i,u.keyPath?{keyPath:u.keyPath,autoIncrement:u.auto}:{autoIncrement:u.auto});return l.forEach(function(f){return wn(d,f)}),d}function zs(o,i){c(o).forEach(function(u){i.db.objectStoreNames.contains(u)||(Ye&&console.debug("Dexie: Creating missing table",u),Ao(i,u,o[u].primKey,o[u].indexes))})}function wn(o,i){o.createIndex(i.name,i.keyPath,{unique:i.unique,multiEntry:i.multi})}function bn(o,i,u){var l={};return se(i.objectStoreNames,0).forEach(function(d){for(var f=u.objectStore(d),m=bo(Cs(k=f.keyPath),k||"",!0,!1,!!f.autoIncrement,k&&typeof k!="string",!0),y=[],O=0;O<f.indexNames.length;++O){var x=f.index(f.indexNames[O]),k=x.keyPath,x=bo(x.name,k,!!x.unique,!!x.multiEntry,!1,k&&typeof k!="string",!1);y.push(x)}l[d]=ko(d,m,y)}),l}function kn(o,i,u){for(var l=u.db.objectStoreNames,d=0;d<l.length;++d){var f=l[d],m=u.objectStore(f);o._hasGetAll="getAll"in m;for(var y=0;y<m.indexNames.length;++y){var O=m.indexNames[y],k=m.index(O).keyPath,x=typeof k=="string"?k:"["+se(k).join("+")+"]";!i[f]||(k=i[f].idxByName[x])&&(k.name=O,delete i[f].idxByName[x],i[f].idxByName[O]=k)}}typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&a.WorkerGlobalScope&&a instanceof a.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(o._hasGetAll=!1)}function Us(o){return o.split(",").map(function(i,u){var l=(i=i.trim()).replace(/([&*]|\+\+)/g,""),d=/^\[/.test(l)?l.match(/^\[(.*)\]$/)[1].split("+"):l;return bo(l,d||null,/\&/.test(i),/\*/.test(i),/\+\+/.test(i),h(d),u===0)})}var Ga=(En.prototype._parseStoresSpec=function(o,i){c(o).forEach(function(u){if(o[u]!==null){var l=Us(o[u]),d=l.shift();if(d.unique=!0,d.multi)throw new te.Schema("Primary key cannot be multi-valued");l.forEach(function(f){if(f.auto)throw new te.Schema("Only primary key can be marked as autoIncrement (++)");if(!f.keyPath)throw new te.Schema("Index must have a name and cannot be an empty string")}),i[u]=ko(u,d,l)}})},En.prototype.stores=function(u){var i=this.db;this._cfg.storesSource=this._cfg.storesSource?p(this._cfg.storesSource,u):u;var u=i._versions,l={},d={};return u.forEach(function(f){p(l,f._cfg.storesSource),d=f._cfg.dbschema={},f._parseStoresSpec(l,d)}),i._dbSchema=d,Oo(i,[i._allTables,i,i.Transaction.prototype]),_n(i,[i._allTables,i,i.Transaction.prototype,this._cfg.tables],c(d),d),i._storeNames=c(d),this},En.prototype.upgrade=function(o){return this._cfg.contentUpgrade=lt(this._cfg.contentUpgrade||ve,o),this},En);function En(){}function To(o,i){var u=o._dbNamesDB;return u||(u=o._dbNamesDB=new yt(fn,{addons:[],indexedDB:o,IDBKeyRange:i})).version(1).stores({dbnames:"name"}),u.table("dbnames")}function xo(o){return o&&typeof o.databases=="function"}function Po(o){return Et(function(){return Q.letThrough=!0,o()})}function Ro(o){return!("from"in o)}var He=function(o,i){if(!this){var u=new He;return o&&"d"in o&&p(u,o),u}p(this,arguments.length?{d:1,from:o,to:1<arguments.length?i:o}:{d:0})};function Fr(o,i,u){var l=ye(i,u);if(!isNaN(l)){if(0<l)throw RangeError();if(Ro(o))return p(o,{from:i,to:u,d:1});var d=o.l,l=o.r;if(ye(u,o.from)<0)return d?Fr(d,i,u):o.l={from:i,to:u,d:1,l:null,r:null},Fs(o);if(0<ye(i,o.to))return l?Fr(l,i,u):o.r={from:i,to:u,d:1,l:null,r:null},Fs(o);ye(i,o.from)<0&&(o.from=i,o.l=null,o.d=l?l.d+1:1),0<ye(u,o.to)&&(o.to=u,o.r=null,o.d=o.l?o.l.d+1:1),u=!o.r,d&&!o.l&&Lr(o,d),l&&u&&Lr(o,l)}}function Lr(o,i){Ro(i)||function u(l,O){var f=O.from,m=O.to,y=O.l,O=O.r;Fr(l,f,m),y&&u(l,y),O&&u(l,O)}(o,i)}function Ns(o,i){var u=On(i),l=u.next();if(l.done)return!1;for(var d=l.value,f=On(o),m=f.next(d.from),y=m.value;!l.done&&!m.done;){if(ye(y.from,d.to)<=0&&0<=ye(y.to,d.from))return!0;ye(d.from,y.from)<0?d=(l=u.next(y.from)).value:y=(m=f.next(d.from)).value}return!1}function On(o){var i=Ro(o)?null:{s:0,n:o};return{next:function(u){for(var l=0<arguments.length;i;)switch(i.s){case 0:if(i.s=1,l)for(;i.n.l&&ye(u,i.n.from)<0;)i={up:i,n:i.n.l,s:1};else for(;i.n.l;)i={up:i,n:i.n.l,s:1};case 1:if(i.s=2,!l||ye(u,i.n.to)<=0)return{value:i.n,done:!1};case 2:if(i.n.r){i.s=3,i={up:i,n:i.n.r,s:0};continue}case 3:i=i.up}return{done:!0}}}}function Fs(o){var i,u,l=(((i=o.r)===null||i===void 0?void 0:i.d)||0)-(((u=o.l)===null||u===void 0?void 0:u.d)||0),d=1<l?"r":l<-1?"l":"";d&&(i=d=="r"?"l":"r",u=n({},o),l=o[d],o.from=l.from,o.to=l.to,o[d]=l[d],u[d]=l[i],(o[i]=u).d=Ls(u)),o.d=Ls(o)}function Ls(u){var i=u.r,u=u.l;return(i?u?Math.max(i.d,u.d):i.d:u?u.d:0)+1}function Sn(o,i){return c(i).forEach(function(u){o[u]?Lr(o[u],i[u]):o[u]=function l(d){var f,m,y={};for(f in d)I(d,f)&&(m=d[f],y[f]=!m||typeof m!="object"||tn.has(m.constructor)?m:l(m));return y}(i[u])}),o}function Io(o,i){return o.all||i.all||Object.keys(o).some(function(u){return i[u]&&Ns(i[u],o[u])})}U(He.prototype,((st={add:function(o){return Lr(this,o),this},addKey:function(o){return Fr(this,o,o),this},addKeys:function(o){var i=this;return o.forEach(function(u){return Fr(i,u,u)}),this},hasKey:function(o){var i=On(this).next(o).value;return i&&ye(i.from,o)<=0&&0<=ye(i.to,o)}})[or]=function(){return On(this)},st));var Kt={},$o={},Do=!1;function An(o){Sn($o,o),Do||(Do=!0,setTimeout(function(){Do=!1,Co($o,!($o={}))},0))}function Co(o,i){i===void 0&&(i=!1);var u=new Set;if(o.all)for(var l=0,d=Object.values(Kt);l<d.length;l++)Ms(m=d[l],o,u,i);else for(var f in o){var m,y=/^idb\:\/\/(.*)\/(.*)\//.exec(f);y&&(f=y[1],y=y[2],(m=Kt["idb://".concat(f,"/").concat(y)])&&Ms(m,o,u,i))}u.forEach(function(O){return O()})}function Ms(o,i,u,l){for(var d=[],f=0,m=Object.entries(o.queries.query);f<m.length;f++){for(var y=m[f],O=y[0],k=[],x=0,b=y[1];x<b.length;x++){var P=b[x];Io(i,P.obsSet)?P.subscribers.forEach(function(S){return u.add(S)}):l&&k.push(P)}l&&d.push([O,k])}if(l)for(var E=0,A=d;E<A.length;E++){var R=A[E],O=R[0],k=R[1];o.queries.query[O]=k}}function Ja(o){var i=o._state,u=o._deps.indexedDB;if(i.isBeingOpened||o.idbdb)return i.dbReadyPromise.then(function(){return i.dbOpenError?Ce(i.dbOpenError):o});i.isBeingOpened=!0,i.dbOpenError=null,i.openComplete=!1;var l=i.openCanceller,d=Math.round(10*o.verno),f=!1;function m(){if(i.openCanceller!==l)throw new te.DatabaseClosed("db.open() was cancelled")}function y(){return new J(function(P,E){if(m(),!u)throw new te.MissingAPI;var A=o.name,R=i.autoSchema||!d?u.open(A):u.open(A,d);if(!R)throw new te.MissingAPI;R.onerror=dt(E),R.onblocked=Ae(o._fireOnBlocked),R.onupgradeneeded=Ae(function(S){var $;x=R.transaction,i.autoSchema&&!o._options.allowEmptyDB?(R.onerror=jr,x.abort(),R.result.close(),($=u.deleteDatabase(A)).onsuccess=$.onerror=Ae(function(){E(new te.NoSuchDatabase("Database ".concat(A," doesnt exist")))})):(x.onerror=dt(E),S=S.oldVersion>Math.pow(2,62)?0:S.oldVersion,b=S<1,o.idbdb=R.result,f&&Ha(o,x),Wa(o,S/10,x,E))},E),R.onsuccess=Ae(function(){x=null;var S,$,D,C,N,B=o.idbdb=R.result,W=se(B.objectStoreNames);if(0<W.length)try{var Z=B.transaction((C=W).length===1?C[0]:C,"readonly");if(i.autoSchema)$=B,D=Z,(S=o).verno=$.version/10,D=S._dbSchema=bn(0,$,D),S._storeNames=se($.objectStoreNames,0),_n(S,[S._allTables],c(D),D);else if(kn(o,o._dbSchema,Z),((N=So(bn(0,(N=o).idbdb,Z),N._dbSchema)).add.length||N.change.some(function(K){return K.add.length||K.change.length}))&&!f)return console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Dexie will add missing parts and increment native version number to workaround this."),B.close(),d=B.version+1,f=!0,P(y());yn(o,Z)}catch{}hr.push(o),B.onversionchange=Ae(function(K){i.vcFired=!0,o.on("versionchange").fire(K)}),B.onclose=Ae(function(K){o.on("close").fire(K)}),b&&(N=o._deps,Z=A,B=N.indexedDB,N=N.IDBKeyRange,xo(B)||Z===fn||To(B,N).put({name:Z}).catch(ve)),P()},E)}).catch(function(P){switch(P==null?void 0:P.name){case"UnknownError":if(0<i.PR1398_maxLoop)return i.PR1398_maxLoop--,console.warn("Dexie: Workaround for Chrome UnknownError on open()"),y();break;case"VersionError":if(0<d)return d=0,y()}return J.reject(P)})}var O,k=i.dbReadyResolve,x=null,b=!1;return J.race([l,(typeof navigator>"u"?J.resolve():!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise(function(P){function E(){return indexedDB.databases().finally(P)}O=setInterval(E,100),E()}).finally(function(){return clearInterval(O)}):Promise.resolve()).then(y)]).then(function(){return m(),i.onReadyBeingFired=[],J.resolve(Po(function(){return o.on.ready.fire(o.vip)})).then(function P(){if(0<i.onReadyBeingFired.length){var E=i.onReadyBeingFired.reduce(lt,ve);return i.onReadyBeingFired=[],J.resolve(Po(function(){return E(o.vip)})).then(P)}})}).finally(function(){i.openCanceller===l&&(i.onReadyBeingFired=null,i.isBeingOpened=!1)}).catch(function(P){i.dbOpenError=P;try{x&&x.abort()}catch{}return l===i.openCanceller&&o._close(),Ce(P)}).finally(function(){i.openComplete=!0,k()}).then(function(){var P;return b&&(P={},o.tables.forEach(function(E){E.schema.indexes.forEach(function(A){A.name&&(P["idb://".concat(o.name,"/").concat(E.name,"/").concat(A.name)]=new He(-1/0,[[[]]]))}),P["idb://".concat(o.name,"/").concat(E.name,"/")]=P["idb://".concat(o.name,"/").concat(E.name,"/:dels")]=new He(-1/0,[[[]]])}),Tt(zr).fire(P),Co(P,!0)),o})}function jo(o){function i(f){return o.next(f)}var u=d(i),l=d(function(f){return o.throw(f)});function d(f){return function(O){var y=f(O),O=y.value;return y.done?O:O&&typeof O.then=="function"?O.then(u,l):h(O)?Promise.all(O).then(u,l):u(O)}}return d(i)()}function Tn(o,i,u){for(var l=h(o)?o.slice():[o],d=0;d<u;++d)l.push(i);return l}var Ya={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(o){return n(n({},o),{table:function(i){var u=o.table(i),l=u.schema,d={},f=[];function m(b,P,E){var A=Nr(b),R=d[A]=d[A]||[],S=b==null?0:typeof b=="string"?1:b.length,$=0<P,$=n(n({},E),{name:$?"".concat(A,"(virtual-from:").concat(E.name,")"):E.name,lowLevelIndex:E,isVirtual:$,keyTail:P,keyLength:S,extractKey:Eo(b),unique:!$&&E.unique});return R.push($),$.isPrimaryKey||f.push($),1<S&&m(S===2?b[0]:b.slice(0,S-1),P+1,E),R.sort(function(D,C){return D.keyTail-C.keyTail}),$}i=m(l.primaryKey.keyPath,0,l.primaryKey),d[":id"]=[i];for(var y=0,O=l.indexes;y<O.length;y++){var k=O[y];m(k.keyPath,0,k)}function x(b){var P,E=b.query.index;return E.isVirtual?n(n({},b),{query:{index:E.lowLevelIndex,range:(P=b.query.range,E=E.keyTail,{type:P.type===1?2:P.type,lower:Tn(P.lower,P.lowerOpen?o.MAX_KEY:o.MIN_KEY,E),lowerOpen:!0,upper:Tn(P.upper,P.upperOpen?o.MIN_KEY:o.MAX_KEY,E),upperOpen:!0})}}):b}return n(n({},u),{schema:n(n({},l),{primaryKey:i,indexes:f,getIndexByKeyPath:function(b){return(b=d[Nr(b)])&&b[0]}}),count:function(b){return u.count(x(b))},query:function(b){return u.query(x(b))},openCursor:function(b){var P=b.query.index,E=P.keyTail,A=P.isVirtual,R=P.keyLength;return A?u.openCursor(x(b)).then(function($){return $&&S($)}):u.openCursor(b);function S($){return Object.create($,{continue:{value:function(D){D!=null?$.continue(Tn(D,b.reverse?o.MAX_KEY:o.MIN_KEY,E)):b.unique?$.continue($.key.slice(0,R).concat(b.reverse?o.MIN_KEY:o.MAX_KEY,E)):$.continue()}},continuePrimaryKey:{value:function(D,C){$.continuePrimaryKey(Tn(D,o.MAX_KEY,E),C)}},primaryKey:{get:function(){return $.primaryKey}},key:{get:function(){var D=$.key;return R===1?D[0]:D.slice(0,R)}},value:{get:function(){return $.value}}})}}})}})}};function zo(o,i,u,l){return u=u||{},l=l||"",c(o).forEach(function(d){var f,m,y;I(i,d)?(f=o[d],m=i[d],typeof f=="object"&&typeof m=="object"&&f&&m?(y=Tr(f))!==Tr(m)?u[l+d]=i[d]:y==="Object"?zo(f,m,u,l+d+"."):f!==m&&(u[l+d]=i[d]):f!==m&&(u[l+d]=i[d])):u[l+d]=void 0}),c(i).forEach(function(d){I(o,d)||(u[l+d]=i[d])}),u}function Uo(o,i){return i.type==="delete"?i.keys:i.keys||i.values.map(o.extractKey)}var Qa={stack:"dbcore",name:"HooksMiddleware",level:2,create:function(o){return n(n({},o),{table:function(i){var u=o.table(i),l=u.schema.primaryKey;return n(n({},u),{mutate:function(d){var f=Q.trans,m=f.table(i).hook,y=m.deleting,O=m.creating,k=m.updating;switch(d.type){case"add":if(O.fire===ve)break;return f._promise("readwrite",function(){return x(d)},!0);case"put":if(O.fire===ve&&k.fire===ve)break;return f._promise("readwrite",function(){return x(d)},!0);case"delete":if(y.fire===ve)break;return f._promise("readwrite",function(){return x(d)},!0);case"deleteRange":if(y.fire===ve)break;return f._promise("readwrite",function(){return function b(P,E,A){return u.query({trans:P,values:!1,query:{index:l,range:E},limit:A}).then(function(R){var S=R.result;return x({type:"delete",keys:S,trans:P}).then(function($){return 0<$.numFailures?Promise.reject($.failures[0]):S.length<A?{failures:[],numFailures:0,lastResult:void 0}:b(P,n(n({},E),{lower:S[S.length-1],lowerOpen:!0}),A)})})}(d.trans,d.range,1e4)},!0)}return u.mutate(d);function x(b){var P,E,A,R=Q.trans,S=b.keys||Uo(l,b);if(!S)throw new Error("Keys missing");return(b=b.type==="add"||b.type==="put"?n(n({},b),{keys:S}):n({},b)).type!=="delete"&&(b.values=s([],b.values)),b.keys&&(b.keys=s([],b.keys)),P=u,A=S,((E=b).type==="add"?Promise.resolve([]):P.getMany({trans:E.trans,keys:A,cache:"immutable"})).then(function($){var D=S.map(function(C,N){var B,W,Z,K=$[N],H={onerror:null,onsuccess:null};return b.type==="delete"?y.fire.call(H,C,K,R):b.type==="add"||K===void 0?(B=O.fire.call(H,C,b.values[N],R),C==null&&B!=null&&(b.keys[N]=C=B,l.outbound||Ue(b.values[N],l.keyPath,C))):(B=zo(K,b.values[N]),(W=k.fire.call(H,B,C,K,R))&&(Z=b.values[N],Object.keys(W).forEach(function(M){I(Z,M)?Z[M]=W[M]:Ue(Z,M,W[M])}))),H});return u.mutate(b).then(function(C){for(var N=C.failures,B=C.results,W=C.numFailures,C=C.lastResult,Z=0;Z<S.length;++Z){var K=(B||S)[Z],H=D[Z];K==null?H.onerror&&H.onerror(N[Z]):H.onsuccess&&H.onsuccess(b.type==="put"&&$[Z]?b.values[Z]:K)}return{failures:N,results:B,numFailures:W,lastResult:C}}).catch(function(C){return D.forEach(function(N){return N.onerror&&N.onerror(C)}),Promise.reject(C)})})}}})}})}};function qs(o,i,u){try{if(!i||i.keys.length<o.length)return null;for(var l=[],d=0,f=0;d<i.keys.length&&f<o.length;++d)ye(i.keys[d],o[f])===0&&(l.push(u?ft(i.values[d]):i.values[d]),++f);return l.length===o.length?l:null}catch{return null}}var Xa={stack:"dbcore",level:-1,create:function(o){return{table:function(i){var u=o.table(i);return n(n({},u),{getMany:function(l){if(!l.cache)return u.getMany(l);var d=qs(l.keys,l.trans._cache,l.cache==="clone");return d?J.resolve(d):u.getMany(l).then(function(f){return l.trans._cache={keys:l.keys,values:l.cache==="clone"?ft(f):f},f})},mutate:function(l){return l.type!=="add"&&(l.trans._cache=null),u.mutate(l)}})}}}};function Bs(o,i){return o.trans.mode==="readonly"&&!!o.subscr&&!o.trans.explicit&&o.trans.db._options.cache!=="disabled"&&!i.schema.primaryKey.outbound}function Zs(o,i){switch(o){case"query":return i.values&&!i.unique;case"get":case"getMany":case"count":case"openCursor":return!1}}var eu={stack:"dbcore",level:0,name:"Observability",create:function(o){var i=o.schema.name,u=new He(o.MIN_KEY,o.MAX_KEY);return n(n({},o),{transaction:function(l,d,f){if(Q.subscr&&d!=="readonly")throw new te.ReadOnly("Readwrite transaction in liveQuery context. Querier source: ".concat(Q.querier));return o.transaction(l,d,f)},table:function(l){var d=o.table(l),f=d.schema,m=f.primaryKey,b=f.indexes,y=m.extractKey,O=m.outbound,k=m.autoIncrement&&b.filter(function(E){return E.compound&&E.keyPath.includes(m.keyPath)}),x=n(n({},d),{mutate:function(E){function A(M){return M="idb://".concat(i,"/").concat(l,"/").concat(M),C[M]||(C[M]=new He)}var R,S,$,D=E.trans,C=E.mutatedParts||(E.mutatedParts={}),N=A(""),B=A(":dels"),W=E.type,H=E.type==="deleteRange"?[E.range]:E.type==="delete"?[E.keys]:E.values.length<50?[Uo(m,E).filter(function(M){return M}),E.values]:[],Z=H[0],K=H[1],H=E.trans._cache;return h(Z)?(N.addKeys(Z),(H=W==="delete"||Z.length===K.length?qs(Z,H):null)||B.addKeys(Z),(H||K)&&(R=A,S=H,$=K,f.indexes.forEach(function(M){var ue=R(M.name||"");function ce(he){return he!=null?M.extractKey(he):null}function me(he){return M.multiEntry&&h(he)?he.forEach(function(at){return ue.addKey(at)}):ue.addKey(he)}(S||$).forEach(function(he,Be){var fe=S&&ce(S[Be]),Be=$&&ce($[Be]);ye(fe,Be)!==0&&(fe!=null&&me(fe),Be!=null&&me(Be))})}))):Z?(K={from:Z.lower,to:Z.upper},B.add(K),N.add(K)):(N.add(u),B.add(u),f.indexes.forEach(function(M){return A(M.name).add(u)})),d.mutate(E).then(function(M){return!Z||E.type!=="add"&&E.type!=="put"||(N.addKeys(M.results),k&&k.forEach(function(ue){var ce=E.values.map(function(he){return ue.extractKey(he)}),me=ue.keyPath.findIndex(function(he){return he===m.keyPath});M.results.forEach(function(he){return ce[me]=he}),A(ue.name).addKeys(ce)})),D.mutatedParts=Sn(D.mutatedParts||{},C),M})}}),b=function(A){var R=A.query,A=R.index,R=R.range;return[A,new He((A=R.lower)!==null&&A!==void 0?A:o.MIN_KEY,(R=R.upper)!==null&&R!==void 0?R:o.MAX_KEY)]},P={get:function(E){return[m,new He(E.key)]},getMany:function(E){return[m,new He().addKeys(E.keys)]},count:b,query:b,openCursor:b};return c(P).forEach(function(E){x[E]=function(A){var R=Q.subscr,S=!!R,$=Bs(Q,d)&&Zs(E,A)?A.obsSet={}:R;if(S){var D=function(K){return K="idb://".concat(i,"/").concat(l,"/").concat(K),$[K]||($[K]=new He)},C=D(""),N=D(":dels"),R=P[E](A),S=R[0],R=R[1];if((E==="query"&&S.isPrimaryKey&&!A.values?N:D(S.name||"")).add(R),!S.isPrimaryKey){if(E!=="count"){var B=E==="query"&&O&&A.values&&d.query(n(n({},A),{values:!1}));return d[E].apply(this,arguments).then(function(K){if(E==="query"){if(O&&A.values)return B.then(function(ce){return ce=ce.result,C.addKeys(ce),K});var H=A.values?K.result.map(y):K.result;(A.values?C:N).addKeys(H)}else if(E==="openCursor"){var M=K,ue=A.values;return M&&Object.create(M,{key:{get:function(){return N.addKey(M.primaryKey),M.key}},primaryKey:{get:function(){var ce=M.primaryKey;return N.addKey(ce),ce}},value:{get:function(){return ue&&C.addKey(M.primaryKey),M.value}}})}return K})}N.add(u)}}return d[E].apply(this,arguments)}}),x}})}};function Vs(o,i,u){if(u.numFailures===0)return i;if(i.type==="deleteRange")return null;var l=i.keys?i.keys.length:"values"in i&&i.values?i.values.length:1;return u.numFailures===l?null:(i=n({},i),h(i.keys)&&(i.keys=i.keys.filter(function(d,f){return!(f in u.failures)})),"values"in i&&h(i.values)&&(i.values=i.values.filter(function(d,f){return!(f in u.failures)})),i)}function No(o,i){return u=o,((l=i).lower===void 0||(l.lowerOpen?0<ye(u,l.lower):0<=ye(u,l.lower)))&&(o=o,(i=i).upper===void 0||(i.upperOpen?ye(o,i.upper)<0:ye(o,i.upper)<=0));var u,l}function Ks(o,i,P,l,d,f){if(!P||P.length===0)return o;var m=i.query.index,y=m.multiEntry,O=i.query.range,k=l.schema.primaryKey.extractKey,x=m.extractKey,b=(m.lowLevelIndex||m).extractKey,P=P.reduce(function(E,A){var R=E,S=[];if(A.type==="add"||A.type==="put")for(var $=new He,D=A.values.length-1;0<=D;--D){var C,N=A.values[D],B=k(N);$.hasKey(B)||(C=x(N),(y&&h(C)?C.some(function(H){return No(H,O)}):No(C,O))&&($.addKey(B),S.push(N)))}switch(A.type){case"add":R=E.concat(i.values?S:S.map(function(M){return k(M)}));break;case"put":var W=new He().addKeys(A.values.map(function(M){return k(M)})),R=E.filter(function(M){return!W.hasKey(i.values?k(M):M)}).concat(i.values?S:S.map(function(M){return k(M)}));break;case"delete":var Z=new He().addKeys(A.keys);R=E.filter(function(M){return!Z.hasKey(i.values?k(M):M)});break;case"deleteRange":var K=A.range;R=E.filter(function(M){return!No(k(M),K)})}return R},o);return P===o?o:(P.sort(function(E,A){return ye(b(E),b(A))||ye(k(E),k(A))}),i.limit&&i.limit<1/0&&(P.length>i.limit?P.length=i.limit:o.length===i.limit&&P.length<i.limit&&(d.dirty=!0)),f?Object.freeze(P):P)}function Ws(o,i){return ye(o.lower,i.lower)===0&&ye(o.upper,i.upper)===0&&!!o.lowerOpen==!!i.lowerOpen&&!!o.upperOpen==!!i.upperOpen}function tu(o,i){return function(u,l,d,f){if(u===void 0)return l!==void 0?-1:0;if(l===void 0)return 1;if((l=ye(u,l))===0){if(d&&f)return 0;if(d)return 1;if(f)return-1}return l}(o.lower,i.lower,o.lowerOpen,i.lowerOpen)<=0&&0<=function(u,l,d,f){if(u===void 0)return l!==void 0?1:0;if(l===void 0)return-1;if((l=ye(u,l))===0){if(d&&f)return 0;if(d)return-1;if(f)return 1}return l}(o.upper,i.upper,o.upperOpen,i.upperOpen)}function ru(o,i,u,l){o.subscribers.add(u),l.addEventListener("abort",function(){var d,f;o.subscribers.delete(u),o.subscribers.size===0&&(d=o,f=i,setTimeout(function(){d.subscribers.size===0&&pt(f,d)},3e3))})}var nu={stack:"dbcore",level:0,name:"Cache",create:function(o){var i=o.schema.name;return n(n({},o),{transaction:function(u,l,d){var f,m,y=o.transaction(u,l,d);return l==="readwrite"&&(m=(f=new AbortController).signal,d=function(O){return function(){if(f.abort(),l==="readwrite"){for(var k=new Set,x=0,b=u;x<b.length;x++){var P=b[x],E=Kt["idb://".concat(i,"/").concat(P)];if(E){var A=o.table(P),R=E.optimisticOps.filter(function(ue){return ue.trans===y});if(y._explicit&&O&&y.mutatedParts)for(var S=0,$=Object.values(E.queries.query);S<$.length;S++)for(var D=0,C=(W=$[S]).slice();D<C.length;D++)Io((Z=C[D]).obsSet,y.mutatedParts)&&(pt(W,Z),Z.subscribers.forEach(function(ue){return k.add(ue)}));else if(0<R.length){E.optimisticOps=E.optimisticOps.filter(function(ue){return ue.trans!==y});for(var N=0,B=Object.values(E.queries.query);N<B.length;N++)for(var W,Z,K,H=0,M=(W=B[N]).slice();H<M.length;H++)(Z=M[H]).res!=null&&y.mutatedParts&&(O&&!Z.dirty?(K=Object.isFrozen(Z.res),K=Ks(Z.res,Z.req,R,A,Z,K),Z.dirty?(pt(W,Z),Z.subscribers.forEach(function(ue){return k.add(ue)})):K!==Z.res&&(Z.res=K,Z.promise=J.resolve({result:K}))):(Z.dirty&&pt(W,Z),Z.subscribers.forEach(function(ue){return k.add(ue)})))}}}k.forEach(function(ue){return ue()})}}},y.addEventListener("abort",d(!1),{signal:m}),y.addEventListener("error",d(!1),{signal:m}),y.addEventListener("complete",d(!0),{signal:m})),y},table:function(u){var l=o.table(u),d=l.schema.primaryKey;return n(n({},l),{mutate:function(f){var m=Q.trans;if(d.outbound||m.db._options.cache==="disabled"||m.explicit)return l.mutate(f);var y=Kt["idb://".concat(i,"/").concat(u)];return y?(m=l.mutate(f),f.type!=="add"&&f.type!=="put"||!(50<=f.values.length||Uo(d,f).some(function(O){return O==null}))?(y.optimisticOps.push(f),f.mutatedParts&&An(f.mutatedParts),m.then(function(O){0<O.numFailures&&(pt(y.optimisticOps,f),(O=Vs(0,f,O))&&y.optimisticOps.push(O),f.mutatedParts&&An(f.mutatedParts))}),m.catch(function(){pt(y.optimisticOps,f),f.mutatedParts&&An(f.mutatedParts)})):m.then(function(O){var k=Vs(0,n(n({},f),{values:f.values.map(function(E,b){var P,E=(P=d.keyPath)!==null&&P!==void 0&&P.includes(".")?ft(E):n({},E);return Ue(E,d.keyPath,O.results[b]),E})}),O);y.optimisticOps.push(k),queueMicrotask(function(){return f.mutatedParts&&An(f.mutatedParts)})}),m):l.mutate(f)},query:function(f){if(!Bs(Q,l)||!Zs("query",f))return l.query(f);var m=((k=Q.trans)===null||k===void 0?void 0:k.db._options.cache)==="immutable",b=Q,y=b.requery,O=b.signal,k=function(A,R,S,$){var D=Kt["idb://".concat(A,"/").concat(R)];if(!D)return[];if(!(R=D.queries[S]))return[null,!1,D,null];var C=R[($.query?$.query.index.name:null)||""];if(!C)return[null,!1,D,null];switch(S){case"query":var N=C.find(function(B){return B.req.limit===$.limit&&B.req.values===$.values&&Ws(B.req.query.range,$.query.range)});return N?[N,!0,D,C]:[C.find(function(B){return("limit"in B.req?B.req.limit:1/0)>=$.limit&&(!$.values||B.req.values)&&tu(B.req.query.range,$.query.range)}),!1,D,C];case"count":return N=C.find(function(B){return Ws(B.req.query.range,$.query.range)}),[N,!!N,D,C]}}(i,u,"query",f),x=k[0],b=k[1],P=k[2],E=k[3];return x&&b?x.obsSet=f.obsSet:(b=l.query(f).then(function(A){var R=A.result;if(x&&(x.res=R),m){for(var S=0,$=R.length;S<$;++S)Object.freeze(R[S]);Object.freeze(R)}else A.result=ft(R);return A}).catch(function(A){return E&&x&&pt(E,x),Promise.reject(A)}),x={obsSet:f.obsSet,promise:b,subscribers:new Set,type:"query",req:f,dirty:!1},E?E.push(x):(E=[x],(P=P||(Kt["idb://".concat(i,"/").concat(u)]={queries:{query:{},count:{}},objs:new Map,optimisticOps:[],unsignaledParts:{}})).queries.query[f.query.index.name||""]=E)),ru(x,E,y,O),x.promise.then(function(A){return{result:Ks(A.result,f,P==null?void 0:P.optimisticOps,l,x,m)}})}})}})}};function xn(o,i){return new Proxy(o,{get:function(u,l,d){return l==="db"?i:Reflect.get(u,l,d)}})}var yt=(je.prototype.version=function(o){if(isNaN(o)||o<.1)throw new te.Type("Given version is not a positive number");if(o=Math.round(10*o)/10,this.idbdb||this._state.isBeingOpened)throw new te.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,o);var i=this._versions,u=i.filter(function(l){return l._cfg.version===o})[0];return u||(u=new this.Version(o),i.push(u),i.sort(Ka),u.stores({}),this._state.autoSchema=!1,u)},je.prototype._whenReady=function(o){var i=this;return this.idbdb&&(this._state.openComplete||Q.letThrough||this._vip)?o():new J(function(u,l){if(i._state.openComplete)return l(new te.DatabaseClosed(i._state.dbOpenError));if(!i._state.isBeingOpened){if(!i._state.autoOpen)return void l(new te.DatabaseClosed);i.open().catch(ve)}i._state.dbReadyPromise.then(u,l)}).then(o)},je.prototype.use=function(o){var i=o.stack,u=o.create,l=o.level,d=o.name;return d&&this.unuse({stack:i,name:d}),o=this._middlewares[i]||(this._middlewares[i]=[]),o.push({stack:i,create:u,level:l??10,name:d}),o.sort(function(f,m){return f.level-m.level}),this},je.prototype.unuse=function(o){var i=o.stack,u=o.name,l=o.create;return i&&this._middlewares[i]&&(this._middlewares[i]=this._middlewares[i].filter(function(d){return l?d.create!==l:!!u&&d.name!==u})),this},je.prototype.open=function(){var o=this;return Bt(be,function(){return Ja(o)})},je.prototype._close=function(){var o=this._state,i=hr.indexOf(this);if(0<=i&&hr.splice(i,1),this.idbdb){try{this.idbdb.close()}catch{}this.idbdb=null}o.isBeingOpened||(o.dbReadyPromise=new J(function(u){o.dbReadyResolve=u}),o.openCanceller=new J(function(u,l){o.cancelOpen=l}))},je.prototype.close=function(u){var i=(u===void 0?{disableAutoOpen:!0}:u).disableAutoOpen,u=this._state;i?(u.isBeingOpened&&u.cancelOpen(new te.DatabaseClosed),this._close(),u.autoOpen=!1,u.dbOpenError=new te.DatabaseClosed):(this._close(),u.autoOpen=this._options.autoOpen||u.isBeingOpened,u.openComplete=!1,u.dbOpenError=null)},je.prototype.delete=function(o){var i=this;o===void 0&&(o={disableAutoOpen:!0});var u=0<arguments.length&&typeof arguments[0]!="object",l=this._state;return new J(function(d,f){function m(){i.close(o);var y=i._deps.indexedDB.deleteDatabase(i.name);y.onsuccess=Ae(function(){var O,k,x;O=i._deps,k=i.name,x=O.indexedDB,O=O.IDBKeyRange,xo(x)||k===fn||To(x,O).delete(k).catch(ve),d()}),y.onerror=dt(f),y.onblocked=i._fireOnBlocked}if(u)throw new te.InvalidArgument("Invalid closeOptions argument to db.delete()");l.isBeingOpened?l.dbReadyPromise.then(m):m()})},je.prototype.backendDB=function(){return this.idbdb},je.prototype.isOpen=function(){return this.idbdb!==null},je.prototype.hasBeenClosed=function(){var o=this._state.dbOpenError;return o&&o.name==="DatabaseClosed"},je.prototype.hasFailed=function(){return this._state.dbOpenError!==null},je.prototype.dynamicallyOpened=function(){return this._state.autoSchema},Object.defineProperty(je.prototype,"tables",{get:function(){var o=this;return c(this._allTables).map(function(i){return o._allTables[i]})},enumerable:!1,configurable:!0}),je.prototype.transaction=function(){var o=(function(i,u,l){var d=arguments.length;if(d<2)throw new te.InvalidArgument("Too few arguments");for(var f=new Array(d-1);--d;)f[d-1]=arguments[d];return l=f.pop(),[i,en(f),l]}).apply(this,arguments);return this._transaction.apply(this,o)},je.prototype._transaction=function(o,i,u){var l=this,d=Q.trans;d&&d.db===this&&o.indexOf("!")===-1||(d=null);var f,m,y=o.indexOf("?")!==-1;o=o.replace("!","").replace("?","");try{if(m=i.map(function(k){if(k=k instanceof l.Table?k.name:k,typeof k!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return k}),o=="r"||o===mo)f=mo;else{if(o!="rw"&&o!=vo)throw new te.InvalidArgument("Invalid transaction mode: "+o);f=vo}if(d){if(d.mode===mo&&f===vo){if(!y)throw new te.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");d=null}d&&m.forEach(function(k){if(d&&d.storeNames.indexOf(k)===-1){if(!y)throw new te.SubTransaction("Table "+k+" not included in parent transaction.");d=null}}),y&&d&&!d.active&&(d=null)}}catch(k){return d?d._promise(null,function(x,b){b(k)}):Ce(k)}var O=(function k(x,b,P,E,A){return J.resolve().then(function(){var R=Q.transless||Q,S=x._createTransaction(b,P,x._dbSchema,E);if(S.explicit=!0,R={trans:S,transless:R},E)S.idbtrans=E.idbtrans;else try{S.create(),S.idbtrans._explicit=!0,x._state.PR1398_maxLoop=3}catch(C){return C.name===Pr.InvalidState&&x.isOpen()&&0<--x._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),x.close({disableAutoOpen:!1}),x.open().then(function(){return k(x,b,P,null,A)})):Ce(C)}var $,D=xr(A);return D&&dr(),R=J.follow(function(){var C;($=A.call(S,S))&&(D?(C=Ot.bind(null,null),$.then(C,C)):typeof $.next=="function"&&typeof $.throw=="function"&&($=jo($)))},R),($&&typeof $.then=="function"?J.resolve($).then(function(C){return S.active?C:Ce(new te.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))}):R.then(function(){return $})).then(function(C){return E&&S._resolve(),S._completion.then(function(){return C})}).catch(function(C){return S._reject(C),Ce(C)})})}).bind(null,this,f,m,d,u);return d?d._promise(f,O,"lock"):Q.trans?Bt(Q.transless,function(){return l._whenReady(O)}):this._whenReady(O)},je.prototype.table=function(o){if(!I(this._allTables,o))throw new te.InvalidTable("Table ".concat(o," does not exist"));return this._allTables[o]},je);function je(o,i){var u=this;this._middlewares={},this.verno=0;var l=je.dependencies;this._options=i=n({addons:je.addons,autoOpen:!0,indexedDB:l.indexedDB,IDBKeyRange:l.IDBKeyRange,cache:"cloned"},i),this._deps={indexedDB:i.indexedDB,IDBKeyRange:i.IDBKeyRange},l=i.addons,this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;var d,f,m,y,O,k={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:ve,dbReadyPromise:null,cancelOpen:ve,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3,autoOpen:i.autoOpen};k.dbReadyPromise=new J(function(b){k.dbReadyResolve=b}),k.openCanceller=new J(function(b,P){k.cancelOpen=P}),this._state=k,this.name=o,this.on=$r(this,"populate","blocked","versionchange","close",{ready:[lt,ve]}),this.on.ready.subscribe=ae(this.on.ready.subscribe,function(b){return function(P,E){je.vip(function(){var A,R=u._state;R.openComplete?(R.dbOpenError||J.resolve().then(P),E&&b(P)):R.onReadyBeingFired?(R.onReadyBeingFired.push(P),E&&b(P)):(b(P),A=u,E||b(function S(){A.on.ready.unsubscribe(P),A.on.ready.unsubscribe(S)}))})}}),this.Collection=(d=this,Dr(Fa.prototype,function($,S){this.db=d;var E=Os,A=null;if(S)try{E=S()}catch(D){A=D}var R=$._ctx,S=R.table,$=S.hook.reading.fire;this._ctx={table:S,index:R.index,isPrimKey:!R.index||S.schema.primKey.keyPath&&R.index===S.schema.primKey.name,range:E,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:A,or:R.or,valueMapper:$!==Mt?$:null}})),this.Table=(f=this,Dr(xs.prototype,function(b,P,E){this.db=f,this._tx=E,this.name=b,this.schema=P,this.hook=f._allTables[b]?f._allTables[b].hook:$r(null,{creating:[ar,ve],reading:[on,Mt],updating:[sn,ve],deleting:[mt,ve]})})),this.Transaction=(m=this,Dr(qa.prototype,function(b,P,E,A,R){var S=this;this.db=m,this.mode=b,this.storeNames=P,this.schema=E,this.chromeTransactionDurability=A,this.idbtrans=null,this.on=$r(this,"complete","error","abort"),this.parent=R||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new J(function($,D){S._resolve=$,S._reject=D}),this._completion.then(function(){S.active=!1,S.on.complete.fire()},function($){var D=S.active;return S.active=!1,S.on.error.fire($),S.parent?S.parent._reject($):D&&S.idbtrans&&S.idbtrans.abort(),Ce($)})})),this.Version=(y=this,Dr(Ga.prototype,function(b){this.db=y,this._cfg={version:b,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})),this.WhereClause=(O=this,Dr(Ds.prototype,function(b,P,E){if(this.db=O,this._ctx={table:b,index:P===":id"?null:P,or:E},this._cmp=this._ascending=ye,this._descending=function(A,R){return ye(R,A)},this._max=function(A,R){return 0<ye(A,R)?A:R},this._min=function(A,R){return ye(A,R)<0?A:R},this._IDBKeyRange=O._deps.IDBKeyRange,!this._IDBKeyRange)throw new te.MissingAPI})),this.on("versionchange",function(b){0<b.newVersion?console.warn("Another connection wants to upgrade database '".concat(u.name,"'. Closing db now to resume the upgrade.")):console.warn("Another connection wants to delete database '".concat(u.name,"'. Closing db now to resume the delete request.")),u.close({disableAutoOpen:!1})}),this.on("blocked",function(b){!b.newVersion||b.newVersion<b.oldVersion?console.warn("Dexie.delete('".concat(u.name,"') was blocked")):console.warn("Upgrade '".concat(u.name,"' blocked by other connection holding version ").concat(b.oldVersion/10))}),this._maxKey=Ur(i.IDBKeyRange),this._createTransaction=function(b,P,E,A){return new u.Transaction(b,P,E,u._options.chromeTransactionDurability,A)},this._fireOnBlocked=function(b){u.on("blocked").fire(b),hr.filter(function(P){return P.name===u.name&&P!==u&&!P._state.vcFired}).map(function(P){return P.on("versionchange").fire(b)})},this.use(Xa),this.use(nu),this.use(eu),this.use(Ya),this.use(Qa);var x=new Proxy(this,{get:function(b,P,E){if(P==="_vip")return!0;if(P==="table")return function(R){return xn(u.table(R),x)};var A=Reflect.get(b,P,E);return A instanceof xs?xn(A,x):P==="tables"?A.map(function(R){return xn(R,x)}):P==="_createTransaction"?function(){return xn(A.apply(this,arguments),x)}:A}});this.vip=x,l.forEach(function(b){return b(u)})}var Pn,st=typeof Symbol<"u"&&"observable"in Symbol?Symbol.observable:"@@observable",ou=(Fo.prototype.subscribe=function(o,i,u){return this._subscribe(o&&typeof o!="function"?o:{next:o,error:i,complete:u})},Fo.prototype[st]=function(){return this},Fo);function Fo(o){this._subscribe=o}try{Pn={indexedDB:a.indexedDB||a.mozIndexedDB||a.webkitIndexedDB||a.msIndexedDB,IDBKeyRange:a.IDBKeyRange||a.webkitIDBKeyRange}}catch{Pn={indexedDB:null,IDBKeyRange:null}}function Hs(o){var i,u=!1,l=new ou(function(d){var f=xr(o),m,y=!1,O={},k={},x={get closed(){return y},unsubscribe:function(){y||(y=!0,m&&m.abort(),b&&Tt.storagemutated.unsubscribe(E))}};d.start&&d.start(x);var b=!1,P=function(){return po(A)},E=function(R){Sn(O,R),Io(k,O)&&P()},A=function(){var R,S,$;!y&&Pn.indexedDB&&(O={},R={},m&&m.abort(),m=new AbortController,$=function(D){var C=cr();try{f&&dr();var N=Et(o,D);return N=f?N.finally(Ot):N}finally{C&&lr()}}(S={subscr:R,signal:m.signal,requery:P,querier:o,trans:null}),Promise.resolve($).then(function(D){u=!0,i=D,y||S.signal.aborted||(O={},function(C){for(var N in C)if(I(C,N))return;return 1}(k=R)||b||(Tt(zr,E),b=!0),po(function(){return!y&&d.next&&d.next(D)}))},function(D){u=!1,["DatabaseClosedError","AbortError"].includes(D==null?void 0:D.name)||y||po(function(){y||d.error&&d.error(D)})}))};return setTimeout(P,0),x});return l.hasValue=function(){return u},l.getValue=function(){return i},l}var Wt=yt;function Lo(o){var i=xt;try{xt=!0,Tt.storagemutated.fire(o),Co(o,!0)}finally{xt=i}}U(Wt,n(n({},ir),{delete:function(o){return new Wt(o,{addons:[]}).delete()},exists:function(o){return new Wt(o,{addons:[]}).open().then(function(i){return i.close(),!0}).catch("NoSuchDatabaseError",function(){return!1})},getDatabaseNames:function(o){try{return i=Wt.dependencies,u=i.indexedDB,i=i.IDBKeyRange,(xo(u)?Promise.resolve(u.databases()).then(function(l){return l.map(function(d){return d.name}).filter(function(d){return d!==fn})}):To(u,i).toCollection().primaryKeys()).then(o)}catch{return Ce(new te.MissingAPI)}var i,u},defineClass:function(){return function(o){p(this,o)}},ignoreTransaction:function(o){return Q.trans?Bt(Q.transless,o):o()},vip:Po,async:function(o){return function(){try{var i=jo(o.apply(this,arguments));return i&&typeof i.then=="function"?i:J.resolve(i)}catch(u){return Ce(u)}}},spawn:function(o,i,u){try{var l=jo(o.apply(u,i||[]));return l&&typeof l.then=="function"?l:J.resolve(l)}catch(d){return Ce(d)}},currentTransaction:{get:function(){return Q.trans||null}},waitFor:function(o,i){return i=J.resolve(typeof o=="function"?Wt.ignoreTransaction(o):o).timeout(i||6e4),Q.trans?Q.trans.waitFor(i):i},Promise:J,debug:{get:function(){return Ye},set:function(o){Rr(o)}},derive:F,extend:p,props:U,override:ae,Events:$r,on:Tt,liveQuery:Hs,extendObservabilitySet:Sn,getByKeyPath:qe,setByKeyPath:Ue,delByKeyPath:function(o,i){typeof i=="string"?Ue(o,i,void 0):"length"in i&&[].map.call(i,function(u){Ue(o,u,void 0)})},shallowClone:Ft,deepClone:ft,getObjectDiff:zo,cmp:ye,asap:Ie,minKey:-1/0,addons:[],connections:hr,errnames:Pr,dependencies:Pn,cache:Kt,semVer:"4.0.8",version:"4.0.8".split(".").map(function(o){return parseInt(o)}).reduce(function(o,i,u){return o+i/Math.pow(10,2*u)})})),Wt.maxKey=Ur(Wt.dependencies.IDBKeyRange),typeof dispatchEvent<"u"&&typeof addEventListener<"u"&&(Tt(zr,function(o){xt||(o=new CustomEvent(wo,{detail:o}),xt=!0,dispatchEvent(o),xt=!1)}),addEventListener(wo,function(o){o=o.detail,xt||Lo(o)}));var mr,xt=!1,Gs=function(){};return typeof BroadcastChannel<"u"&&((Gs=function(){(mr=new BroadcastChannel(wo)).onmessage=function(o){return o.data&&Lo(o.data)}})(),typeof mr.unref=="function"&&mr.unref(),Tt(zr,function(o){xt||mr.postMessage(o)})),typeof addEventListener<"u"&&(addEventListener("pagehide",function(o){if(!yt.disableBfCache&&o.persisted){Ye&&console.debug("Dexie: handling persisted pagehide"),mr!=null&&mr.close();for(var i=0,u=hr;i<u.length;i++)u[i].close({disableAutoOpen:!1})}}),addEventListener("pageshow",function(o){!yt.disableBfCache&&o.persisted&&(Ye&&console.debug("Dexie: handling persisted pageshow"),Gs(),Lo({all:new He(-1/0,[[]])}))})),J.rejectionMapper=function(o,i){return!o||o instanceof wt||o instanceof TypeError||o instanceof SyntaxError||!o.name||!nn[o.name]?o:(i=new nn[o.name](i||o.message,o),"stack"in o&&G(i,"stack",{get:function(){return this.inner.stack}}),i)},Rr(Ye),n(yt,Object.freeze({__proto__:null,Dexie:yt,liveQuery:Hs,Entity:Ss,cmp:ye,PropModSymbol:gt,PropModification:Cr,replacePrefix:function(o,i){return new Cr({replacePrefix:[o,i]})},add:function(o){return new Cr({add:o})},remove:function(o){return new Cr({remove:o})},default:yt,RangeSet:He,mergeRanges:Lr,rangesOverlap:Ns}),{default:yt}),yt})})(Da);var Rp=Da.exports;const ss=bu(Rp),ji=Symbol.for("Dexie"),is=globalThis[ji]||(globalThis[ji]=ss);if(ss.semVer!==is.semVer)throw new Error(`Two different versions of Dexie loaded in the same app: ${ss.semVer} and ${is.semVer}`);const Ve=new is("DictionaryDB");Ve.version(1).stores({words:"id,type,chinese,romaji,classification,audioid,english, created_at, sort, taiwanese, english_mknoll, simplified, pinyin, english_ccedict, classification_english, zhuyin, audio_url ",definitions:"defid,wordid,partofspeech,def_chinese,def_english",cedict:"id, created_at, traditional, simplified, pinyin, english_edict",searchHistory:"++id, term",searchResults:"++id, results",cedictResults:"++id, results",mknollResults:"++id, results",crossRefResults:"++id, results",randomWordHistory:"++id_rw, word"});Ve.version(2).stores({words:"id,type,chinese,romaji,classification,audioid,english, created_at, sort, taiwanese, english_mknoll, simplified, pinyin, english_ccedict, classification_english, zhuyin, audio_url ",definitions:"defid,wordid,partofspeech,def_chinese,def_english",cedict:"id, created_at, traditional, simplified, pinyin, english_edict",searchHistory:"++id, term",searchResults:"++id, results",cedictResults:"++id, results",mknollResults:"++id, results",crossRefResults:"++id, results",randomWordHistory:"++id_rw, word",favorites:"++id, word_id, word_data, created_at"}).upgrade(t=>(console.log("Upgrading database from version 1 to 2, adding favorites table"),t.favorites.clear()));const Ip=as("dictionary",{state:()=>({searchHistory:[],searchResults:[],cedictResults:[],mknollResults:[],crossRefResults:[],randomWordHistory:[],showRandomWord:!0}),actions:{async loadFromIndexedDB(){var t,e,r,n;try{this.searchHistory=await Ve.searchHistory.toArray(),this.randomWordHistory=await Ve.randomWordHistory.toArray();const s=await Ve.searchResults.toArray();this.searchResults=((t=s.pop())==null?void 0:t.results)||[];const a=await Ve.mknollResults.toArray();this.mknollResults=((e=a.pop())==null?void 0:e.results)||[];const c=await Ve.cedictResults.toArray();this.cedictResults=((r=c.pop())==null?void 0:r.results)||[];const h=await Ve.crossRefResults.toArray();this.crossRefResults=((n=h.pop())==null?void 0:n.results)||[]}catch(s){console.error("Error loading from IndexedDB:",s)}},async clearSearchHistory(){try{this.searchHistory=[],await Ve.searchHistory.clear();const t=Dt();if(t.isAuthenticated){const{error:e}=await X.from("search_history").delete().eq("user_id",t.user.id);e&&console.error("Error clearing search history from Supabase:",e)}}catch(t){console.error("Error clearing search history:",t)}},async clearRandomWordHistory(){try{this.randomWordHistory=[],await Ve.randomWordHistory.clear()}catch(t){console.error("Error clearing random word history:",t)}},async addToHistory(t){try{if(!this.searchHistory.find(e=>e.term===t)){const e={term:t};this.searchHistory.unshift(e),this.searchHistory.length>10&&this.searchHistory.pop(),await Ve.searchHistory.add(e);const r=Dt();if(r.isAuthenticated){const{error:n}=await X.from("search_history").insert({user_id:r.user.id,term:t});n&&console.error("Error saving search history to Supabase:",n)}}}catch(e){console.error("Error adding to search history:",e)}},async addToRandomHistory(t){try{this.randomWordHistory.unshift(t),console.log(this.randomWordHistory.length),this.randomWordHistory.length>5&&this.randomWordHistory.pop(),await Ve.randomWordHistory.add(t)}catch(e){console.error("Error adding to random word history:",e)}},async setSearchResults(t){try{this.searchResults=t,await Ve.searchResults.put({results:t})}catch(e){console.error("Error setting search results:",e)}},async setCedictResults(t){try{this.cedictResults=t,await Ve.cedictResults.put({results:t})}catch(e){console.error("Error setting cedict results:",e)}},async setMknollResults(t){try{this.mknollResults=t,await Ve.mknollResults.put({results:t})}catch(e){console.error("Error setting mknoll results:",e)}},async setCrossRefCedict(t){try{this.crossRefResults=t,await Ve.crossRefResults.put({results:t})}catch(e){console.error("Error setting cross ref results:",e)}},async loadSearchHistoryFromSupabase(){try{const t=Dt();if(t.isAuthenticated){const{data:e,error:r}=await X.from("search_history").select("*").eq("user_id",t.user.id).order("created_at",{ascending:!1}).limit(10);if(r){console.error("Error loading search history from Supabase:",r);return}e&&(this.searchHistory=e.map(n=>({term:n.term})))}}catch(t){console.error("Error loading search history from Supabase:",t)}},toggleRandomWord(){this.showRandomWord=!this.showRandomWord}}}),ys=(t,e)=>{const r=t.__vccOpts||t;for(const[n,s]of e)r[n]=s;return r},$p={class:"auth-modal-header"},Dp={class:"auth-modal-content"},Cp={class:"form-group"},jp=["disabled"],zp={class:"form-group"},Up=["disabled"],Np={class:"form-actions"},Fp=["disabled"],Lp={key:0},Mp={key:1},qp={class:"form-links"},Bp={class:"form-group"},Zp=["disabled"],Vp={class:"form-group"},Kp=["disabled"],Wp={class:"form-group"},Hp=["disabled"],Gp={class:"form-actions"},Jp=["disabled"],Yp={key:0},Qp={key:1},Xp={class:"form-links"},em={class:"form-group"},tm=["disabled"],rm={class:"form-actions"},nm=["disabled"],om={key:0},sm={key:1},im={class:"form-links"},am={key:3,class:"success-message"},um={key:4,class:"error-message"},cm={__name:"AuthModal",props:{visible:{type:Boolean,default:!1},initialMode:{type:String,default:"signin"}},emits:["close","success"],setup(t,{emit:e}){const r=t,n=e,s=Dt(),a=ze(r.initialMode),c=ze(""),h=ze({email:"",password:"",confirmPassword:""}),p=ot(()=>{switch(a.value){case"signin":return"Log in";case"signup":return"Create Account";case"forgot":return"Reset Password";default:return"Authentication"}}),v=G=>{a.value=G,s.clearError(),c.value="",h.value={email:"",password:"",confirmPassword:""}},_=()=>{n("close"),v("signin")},I=async()=>{(await s.signIn(h.value.email,h.value.password)).success&&(c.value="Successfully logged in!",setTimeout(()=>{n("success"),_()},1e3))},U=async()=>{if(h.value.password!==h.value.confirmPassword){s.error="Passwords do not match";return}(await s.signUp(h.value.email,h.value.password)).success&&(c.value="Account created! Please check your email to verify your account.",setTimeout(()=>{_()},3e3))},q=async()=>{(await s.resetPassword(h.value.email)).success&&(c.value="Password reset link sent to your email!",setTimeout(()=>{v("signin")},3e3))};return su(()=>s.error,()=>{s.error&&(c.value="")}),(G,F)=>t.visible?(Me(),Ke("div",{key:0,class:"auth-modal-overlay",onClick:_},[ie("div",{class:"auth-modal",onClick:F[10]||(F[10]=In(()=>{},["stop"]))},[ie("div",$p,[ie("h2",null,br(p.value),1),ie("button",{class:"close-button",onClick:_},F[11]||(F[11]=[ie("span",null,"",-1)]))]),ie("div",Dp,[a.value==="signin"?(Me(),Ke("form",{key:0,onSubmit:In(I,["prevent"]),class:"auth-form"},[ie("div",Cp,[F[12]||(F[12]=ie("label",{for:"email"},"Email",-1)),vr(ie("input",{id:"email","onUpdate:modelValue":F[0]||(F[0]=V=>h.value.email=V),type:"email",required:"",placeholder:"Enter your email",disabled:Je(s).loading},null,8,jp),[[gr,h.value.email]])]),ie("div",zp,[F[13]||(F[13]=ie("label",{for:"password"},"Password",-1)),vr(ie("input",{id:"password","onUpdate:modelValue":F[1]||(F[1]=V=>h.value.password=V),type:"password",required:"",placeholder:"Enter your password",disabled:Je(s).loading},null,8,Up),[[gr,h.value.password]])]),ie("div",Np,[ie("button",{type:"submit",class:"btn-primary",disabled:Je(s).loading},[Je(s).loading?(Me(),Ke("span",Lp,"Logging in...")):(Me(),Ke("span",Mp,"Log in"))],8,Fp)]),ie("div",qp,[ie("button",{type:"button",class:"link-button",onClick:F[2]||(F[2]=V=>v("forgot"))}," Forgot password? "),ie("button",{type:"button",class:"link-button",onClick:F[3]||(F[3]=V=>v("signup"))}," Don't have an account? Sign up ")])],32)):Jt("",!0),a.value==="signup"?(Me(),Ke("form",{key:1,onSubmit:In(U,["prevent"]),class:"auth-form"},[ie("div",Bp,[F[14]||(F[14]=ie("label",{for:"signup-email"},"Email",-1)),vr(ie("input",{id:"signup-email","onUpdate:modelValue":F[4]||(F[4]=V=>h.value.email=V),type:"email",required:"",placeholder:"Enter your email",disabled:Je(s).loading},null,8,Zp),[[gr,h.value.email]])]),ie("div",Vp,[F[15]||(F[15]=ie("label",{for:"signup-password"},"Password",-1)),vr(ie("input",{id:"signup-password","onUpdate:modelValue":F[5]||(F[5]=V=>h.value.password=V),type:"password",required:"",placeholder:"Enter your password",disabled:Je(s).loading},null,8,Kp),[[gr,h.value.password]])]),ie("div",Wp,[F[16]||(F[16]=ie("label",{for:"confirm-password"},"Confirm Password",-1)),vr(ie("input",{id:"confirm-password","onUpdate:modelValue":F[6]||(F[6]=V=>h.value.confirmPassword=V),type:"password",required:"",placeholder:"Confirm your password",disabled:Je(s).loading},null,8,Hp),[[gr,h.value.confirmPassword]])]),ie("div",Gp,[ie("button",{type:"submit",class:"btn-primary",disabled:Je(s).loading},[Je(s).loading?(Me(),Ke("span",Yp,"Creating account...")):(Me(),Ke("span",Qp,"Sign Up"))],8,Jp)]),ie("div",Xp,[ie("button",{type:"button",class:"link-button",onClick:F[7]||(F[7]=V=>v("signin"))}," Already have an account? Log in ")])],32)):Jt("",!0),a.value==="forgot"?(Me(),Ke("form",{key:2,onSubmit:In(q,["prevent"]),class:"auth-form"},[ie("div",em,[F[17]||(F[17]=ie("label",{for:"reset-email"},"Email",-1)),vr(ie("input",{id:"reset-email","onUpdate:modelValue":F[8]||(F[8]=V=>h.value.email=V),type:"email",required:"",placeholder:"Enter your email",disabled:Je(s).loading},null,8,tm),[[gr,h.value.email]])]),ie("div",rm,[ie("button",{type:"submit",class:"btn-primary",disabled:Je(s).loading},[Je(s).loading?(Me(),Ke("span",om,"Sending...")):(Me(),Ke("span",sm,"Send Reset Link"))],8,nm)]),ie("div",im,[ie("button",{type:"button",class:"link-button",onClick:F[9]||(F[9]=V=>v("signin"))}," Back to log in ")])],32)):Jt("",!0),c.value?(Me(),Ke("div",am,br(c.value),1)):Jt("",!0),Je(s).error?(Me(),Ke("div",um,br(Je(s).error),1)):Jt("",!0)])])])):Jt("",!0)}},lm=ys(cm,[["__scopeId","data-v-49649deb"]]),dm={class:"auth-header"},hm={key:0,class:"auth-actions"},fm={key:1,class:"user-menu"},pm={class:"user-left"},mm={__name:"AuthHeader",setup(t){const e=Dt(),r=$a(),n=Ip(),s=ze(!1),a=ze("signin");ot(()=>{var q;return(q=e.user)!=null&&q.email?e.user.email:""});const c=ot(()=>{var q;return(q=e.user)!=null&&q.email?e.user.email.charAt(0).toUpperCase():"?"}),h=ot(()=>n.showRandomWord),p=ot(()=>r.canModerate);ot(()=>{var G;return((G=r.userProfile)==null?void 0:G.role)==="admin"});const v=async()=>{s.value=!1,await r.initialize()},_=()=>{e.signOut()},I=()=>{n.toggleRandomWord()},U=async()=>{await n.clearSearchHistory(),await n.clearRandomWordHistory(),await n.setSearchResults([]),await n.setCedictResults([]),await n.setMknollResults([]),await n.setCrossRefCedict([])};return(q,G)=>{const F=Ui("router-link");return Me(),Ke("div",dm,[Je(e).isAuthenticated?(Me(),Ke("div",fm,[ie("div",pm,[qn(F,{to:"/profile",class:"user-avatar"},{default:Js(()=>[Ys(br(c.value),1)]),_:1}),p.value?(Me(),iu(F,{key:0,to:"/admin",class:"admin-btn"},{default:Js(()=>G[2]||(G[2]=[Ys(" Admin Dashboard ")])),_:1})):Jt("",!0),ie("button",{onClick:_}," Sign Out "),ie("button",{onClick:U}," Clear cache ")]),ie("button",{onClick:I},br(h.value?"Hide random word":"Show random word"),1)])):(Me(),Ke("div",hm,[ie("button",{onClick:I},br(h.value?"Hide random word":"Show random word"),1),ie("button",{onClick:G[0]||(G[0]=V=>s.value=!0)}," Log in ")])),qn(lm,{visible:s.value,"initial-mode":a.value,onClose:G[1]||(G[1]=V=>s.value=!1),onSuccess:v},null,8,["visible","initial-mode"])])}}},vm=ys(mm,[["__scopeId","data-v-d137c4e6"]]),gm={__name:"App",setup(t){const e=Dt(),r=$a();return au(async()=>{await e.initializeAuth(),e.isAuthenticated&&await r.initialize()}),(n,s)=>{const a=Ui("router-view");return Me(),Ke(uu,null,[ie("header",null,[qn(vm)]),ie("main",null,[qn(a)]),s[0]||(s[0]=ie("footer",null,null,-1))],64)}}},ym=ys(gm,[["__scopeId","data-v-482f2ec9"]]),_m=[{path:"/",name:"dictionary",component:()=>$e(()=>import("./DictionarySearch-C9fa7WW8.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24])),meta:{title:"Taigi Dictionary"}},{path:"/search/:query?",name:"search",component:()=>$e(()=>import("./DictionarySearch-C9fa7WW8.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24])),props:!0,meta:{title:"Search Results"}},{path:"/word/:id",name:"word-detail",component:()=>$e(()=>import("./WordDetail-B5uxwNpk.js"),__vite__mapDeps([25,2,1,3,4,5,6,18,19,13,20,14,15,16,21,7,8,9,10,11,22,23,26])),props:!0,meta:{title:"Word Detail"}},{path:"/random",name:"random-word",component:()=>$e(()=>import("./RandomWord-DOE8s4vb.js"),__vite__mapDeps([12,3,1,4,5,6,7,8,2,9,13,14,15,16,17])),meta:{title:"Random Word"}},{path:"/comparison",name:"comparison",component:()=>$e(()=>import("./ComparisonTable-Bu_aFAvO.js"),__vite__mapDeps([27,1,2])),meta:{title:"Dictionary Comparison"}},{path:"/profile",name:"profile",component:()=>$e(()=>import("./UserProfile-Bncy3LLl.js"),__vite__mapDeps([28,1,2,15,16,5,6,29])),meta:{requiresAuth:!0,title:"User Profile"}},{path:"/favorites",name:"favorites",component:()=>$e(()=>import("./Favorites-B9oakTXc.js"),__vite__mapDeps([30,15,1,16,3,4,5,6,19,13,20,2,31])),meta:{requiresAuth:!0,title:"Favorites"}},{path:"/history",name:"search-history",component:()=>$e(()=>import("./SearchHistory-CLPnVaVq.js"),__vite__mapDeps([32,1,3,4,7,8,5,6,2,9,20,33])),meta:{requiresAuth:!0,title:"Search History"}},{path:"/edit-word/:id?",name:"edit-word",component:()=>$e(()=>import("./EditWord-CQd5qnB_.js"),__vite__mapDeps([7,1,8,5,6,2,9])),props:!0,meta:{requiresAuth:!0,title:"Edit Word"}},{path:"/edit-word-mknoll/:id?",name:"edit-word-mknoll",component:()=>$e(()=>import("./EditWordMknoll-CsFCvzmE.js"),__vite__mapDeps([10,1,8,5,6,2,11])),props:!0,meta:{requiresAuth:!0,title:"Edit Word (Mknoll)"}},{path:"/admin",name:"admin",component:()=>$e(()=>import("./AdminDashboard-Dqv7CwZA.js"),__vite__mapDeps([34,1,2,35,36,37,38,39])),meta:{requiresAuth:!0,requiresAdmin:!0,title:"Admin Dashboard"},children:[{path:"",name:"admin-dashboard",component:()=>$e(()=>import("./AdminDashboard-Dqv7CwZA.js"),__vite__mapDeps([34,1,2,35,36,37,38,39])),meta:{requiresAuth:!0,requiresAdmin:!0,title:"Admin Dashboard"}},{path:"users",name:"admin-users",component:()=>$e(()=>import("./UserManagementPanel-CISrlDwJ.js"),__vite__mapDeps([37,1,2,38])),meta:{requiresAuth:!0,requiresAdmin:!0,title:"User Management"}},{path:"moderation",name:"admin-moderation",component:()=>$e(()=>import("./CommunityModerationPanel-CjBc-mqK.js"),__vite__mapDeps([35,1,2,36])),meta:{requiresAuth:!0,requiresAdmin:!0,title:"Content Moderation"}},{path:"community",name:"admin-community",component:()=>$e(()=>import("./CommunitySubmissionManager-Bf9w2zJs.js"),__vite__mapDeps([40,22,1,23,2,41])),meta:{requiresAuth:!0,requiresAdmin:!0,title:"Community Management"}}]},{path:"/404",name:"not-found",component:()=>$e(()=>import("./NotFound-CLjgmdCf.js"),__vite__mapDeps([42,2,1,43])),meta:{title:"Page Not Found"}},{path:"/:pathMatch(.*)*",name:"catch-all",redirect:"/404"}];function wm(t){t.beforeEach(async(e,r,n)=>{const s=Dt();try{if(!s.user&&!s.loading&&await s.initializeAuth(),e.meta.requiresAdmin){if(!s.isAuthenticated){console.log("Access denied: Authentication required for admin area"),n({name:"dictionary",query:{redirect:e.fullPath,message:"Please log in to access admin area"}});return}if(!s.isAdmin){console.log("Access denied: Admin privileges required"),n({name:"profile",query:{message:"Admin privileges required to access this area"}});return}}else if(e.meta.requiresAuth&&!s.isAuthenticated){console.log("Access denied: Authentication required"),n({name:"dictionary",query:{redirect:e.fullPath,message:"Please log in to access this page"}});return}e.meta.title?document.title=`${e.meta.title} - Taigi Dictionary`:document.title="Taigi Dictionary",n()}catch(a){console.error("Navigation guard error:",a),n()}}),t.afterEach((e,r)=>{console.log(`Navigated from ${r.name||"unknown"} to ${e.name||"unknown"}`);const n=Dt();n.error&&setTimeout(()=>{n.clearError()},5e3)}),t.onError(e=>{console.error("Router navigation error:",e),e.message.includes("Loading chunk")?(console.log("Chunk loading error detected, attempting recovery..."),t.push("/").catch(()=>{console.log("Failed to navigate to home, reloading page..."),window.location.reload()})):e.message.includes("Failed to resolve component")?(console.log("Component resolution error, redirecting to 404..."),t.push("/404").catch(()=>{console.error("Failed to redirect to 404 page")})):(console.log("Attempting to recover from navigation error..."),t.push("/").catch(()=>{console.error("Failed to recover from navigation error")}))})}const bm=()=>hu(),km=bm(),er=du({history:km,routes:_m,scrollBehavior(t,e,r){return r||{top:0}}});wm(er);er.onError(t=>{if(console.error("Router navigation error:",t),t.name!=="NavigationDuplicated"){if(t.name==="NavigationAborted"){console.warn("Navigation aborted:",t.message);return}if(t.name==="NavigationCancelled"){console.warn("Navigation cancelled:",t.message);return}er.currentRoute.value.name!=="not-found"&&er.push("/404").catch(()=>{console.error("Failed to redirect to 404 page:",t)})}});const zi=er.resolve;er.resolve=function(t,e){try{return zi.call(this,t,e)}catch(r){return console.error("Route resolution error:",r),zi.call(this,"/404",e)}};const no=cu(ym),Em=lu();no.use(Em);no.use(er);no.mount("#app");no.config.errorHandler=(t,e,r)=>{console.error("Global error:",t),console.error("Error info:",r),t.message&&t.message.includes("auth")&&console.error("Authentication error detected")};export{Ut as C,ys as _,$a as a,Dt as b,et as c,Ve as d,bu as g,X as s,Ip as u,Ap as v};
